{"ast":null,"code":"import { css as _css } from \"@emotion/react\";import _isEqual from \"lodash/isEqual\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable react-hooks/rules-of-hooks */\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport { Behavior, isFeatureEnabled, FeatureFlag, GenericDataType, getChartMetadataRegistry, NativeFilterType, styled, t, getClientErrorObject } from '@superset-ui/core';\n\nimport { forwardRef, useCallback, useEffect, useImperativeHandle, useMemo, useState, memo } from 'react';\nimport rison from 'rison';\nimport { useSelector } from 'react-redux';\nimport { getChartDataRequest } from 'src/components/Chart/chartAction';\nimport { Input, TextArea } from 'src/components/Input';\nimport { Select } from 'src/components';\nimport Collapse from 'src/components/Collapse';\nimport BasicErrorAlert from 'src/components/ErrorMessage/BasicErrorAlert';\nimport ErrorMessageWithStackTrace from 'src/components/ErrorMessage/ErrorMessageWithStackTrace';\nimport { FormItem } from 'src/components/Form';\nimport Icons from 'src/components/Icons';\nimport Loading from 'src/components/Loading';\nimport { addDangerToast } from 'src/components/MessageToasts/actions';\nimport { Radio } from 'src/components/Radio';\nimport Tabs from 'src/components/Tabs';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { cachedSupersetGet } from 'src/utils/cachedSupersetGet';\nimport DateFilterControl from 'src/explore/components/controls/DateFilterControl';\nimport AdhocFilterControl from 'src/explore/components/controls/FilterControl/AdhocFilterControl';\nimport { waitForAsyncData } from 'src/middleware/asyncEvent';\nimport { SingleValueType } from 'src/filters/components/Range/SingleValueType';\nimport { getFormData, mergeExtraFormData } from 'src/dashboard/components/nativeFilters/utils';\nimport { DatasetSelectLabel } from 'src/features/datasets/DatasetSelectLabel';\nimport { ALLOW_DEPENDENCIES as TYPES_SUPPORT_DEPENDENCIES, getFiltersConfigModalTestId } from '../FiltersConfigModal';\nimport { CollapsibleControl } from './CollapsibleControl';\nimport { ColumnSelect } from './ColumnSelect';\nimport DatasetSelect from './DatasetSelect';\nimport DefaultValue from './DefaultValue';\nimport FilterScope from './FilterScope/FilterScope';\nimport getControlItemsMap from './getControlItemsMap';\nimport RemovedFilter from './RemovedFilter';\nimport { useBackendFormUpdate, useDefaultValue } from './state';\nimport { hasTemporalColumns, mostUsedDataset, setNativeFilterFieldValues, useForceUpdate } from './utils';\nimport { FILTER_SUPPORTED_TYPES, INPUT_WIDTH } from './constants';\nimport DependencyList from './DependencyList';import { jsx as _jsx, Fragment as _Fragment, jsxs as _jsxs } from \"@emotion/react/jsx-runtime\";\nconst FORM_ITEM_WIDTH = 260;\nconst TabPane = styled(Tabs.TabPane)`\n  padding: ${({ theme }) => theme.gridUnit * 4}px 0px;\n`;\nconst StyledContainer = styled.div`\n  ${({ theme }) => `\n    display: flex;\n    flex-direction: row-reverse;\n    justify-content: space-between;\n    padding: 0px ${theme.gridUnit * 4}px;\n  `}\n`;\nconst StyledRowContainer = styled.div`\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  width: 100%;\n  padding: 0px ${({ theme }) => theme.gridUnit * 4}px;\n`;\nconst controlsOrder = [\n'enableEmptyFilter',\n'defaultToFirstItem',\n'multiSelect',\n'searchAllOptions',\n'inverseSelection'];\n\nexport const StyledFormItem = styled(FormItem)`\n  width: ${({ expanded }) => expanded ? '49%' : `${FORM_ITEM_WIDTH}px`};\n  margin-bottom: ${({ theme }) => theme.gridUnit * 4}px;\n\n  & .ant-form-item-label {\n    padding-bottom: 0;\n  }\n\n  & .ant-form-item-control-input {\n    min-height: ${({ theme }) => theme.gridUnit * 10}px;\n  }\n`;\nexport const StyledRowFormItem = styled(FormItem)`\n  margin-bottom: 0;\n  padding-bottom: 0;\n  min-width: ${({ expanded }) => expanded ? '50%' : `${FORM_ITEM_WIDTH}px`};\n\n  & .ant-form-item-label {\n    padding-bottom: 0;\n  }\n\n  .ant-form-item-control-input-content > div > div {\n    height: auto;\n  }\n\n  & .ant-form-item-control-input {\n    min-height: ${({ theme }) => theme.gridUnit * 10}px;\n  }\n`;\nexport const StyledRowSubFormItem = styled(FormItem)`\n  min-width: ${({ expanded }) => expanded ? '50%' : `${FORM_ITEM_WIDTH}px`};\n\n  & .ant-form-item-label {\n    padding-bottom: 0;\n  }\n\n  .ant-form-item {\n    margin-bottom: 0;\n  }\n\n  .ant-form-item-control-input-content > div > div {\n    height: auto;\n  }\n\n  .ant-form-item-extra {\n    display: none;\n  }\n\n  & .ant-form-item-control-input {\n    height: auto;\n  }\n`;\nexport const StyledLabel = styled.span`\n  color: ${({ theme }) => theme.colors.grayscale.base};\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  text-transform: uppercase;\n`;\nconst CleanFormItem = styled(FormItem)`\n  margin-bottom: 0;\n`;\nconst DefaultValueContainer = styled.div`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n`;\nconst RefreshIcon = styled(Icons.Refresh)`\n  margin-left: ${({ theme }) => theme.gridUnit * 2}px;\n  color: ${({ theme }) => theme.colors.primary.base};\n`;\nconst StyledCollapse = styled(Collapse)`\n  border-left: 0;\n  border-top: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  border-radius: 0;\n\n  .ant-collapse-header {\n    border-bottom: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    border-top: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    margin-top: -1px;\n    border-radius: 0;\n  }\n\n  .ant-collapse-content {\n    border: 0;\n  }\n\n  .ant-collapse-content-box {\n    padding-top: ${({ theme }) => theme.gridUnit * 2}px;\n  }\n\n  &.ant-collapse > .ant-collapse-item {\n    border: 0;\n    border-radius: 0;\n  }\n`;\nconst StyledTabs = styled(Tabs)`\n  .ant-tabs-nav {\n    position: sticky;\n    top: 0;\n    background: ${({ theme }) => theme.colors.grayscale.light5};\n    z-index: 1;\n  }\n\n  .ant-tabs-nav-list {\n    padding: 0;\n  }\n\n  .ant-form-item-label {\n    padding-bottom: 0;\n  }\n`;\nconst StyledAsterisk = styled.span`\n  color: ${({ theme }) => theme.colors.error.base};\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  margin-left: ${({ theme }) => theme.gridUnit - 1}px;\n  &:before {\n    content: '*';\n  }\n`;\nconst FilterTypeInfo = styled.div`\n  ${({ theme, expanded }) => `\n    width: ${expanded ? '49%' : `${FORM_ITEM_WIDTH}px`};\n    font-size: ${theme.typography.sizes.s}px;\n    color: ${theme.colors.grayscale.light1};\n    margin:\n      ${-theme.gridUnit * 2}px\n      0px\n      ${theme.gridUnit * 4}px\n      ${theme.gridUnit * 4}px;\n  `}\n`;\nconst FilterTabs = {\n  configuration: {\n    key: 'configuration',\n    name: t('Settings')\n  },\n  scoping: {\n    key: 'scoping',\n    name: t('Scoping')\n  }\n};\nexport const FilterPanels = {\n  configuration: {\n    key: 'configuration',\n    name: t('Filter Configuration')\n  },\n  settings: {\n    key: 'settings',\n    name: t('Filter Settings')\n  }\n};\nconst FILTERS_WITH_ADHOC_FILTERS = ['filter_select', 'filter_range'];\n// TODO: Rename the filter plugins and remove this mapping\nconst FILTER_TYPE_NAME_MAPPING = {\n  [t('Select filter')]: t('Value'),\n  [t('Range filter')]: t('Numerical range'),\n  [t('Time filter')]: t('Time range'),\n  [t('Time column')]: t('Time column'),\n  [t('Time grain')]: t('Time grain'),\n  [t('Group By')]: t('Group by')\n};\n/**\n * The configuration form for a specific filter.\n * Assigns field values to `filters[filterId]` in the form.\n */\nconst FiltersConfigForm = ({ expanded, filterId, filterToEdit, removedFilters, form, getAvailableFilters, activeFilterPanelKeys, restoreFilter, handleActiveFilterPanelChange, setErroredFilters, validateDependencies, getDependencySuggestion, isActive }, ref) => {var _formFilter$dataset2, _nativeFilterItems$fo, _nativeFilterItems$fo2, _ref, _formFilter$dataset$v, _formFilter$dataset3, _filterToEdit$targets, _nativeFilterItems$fo3, _nativeFilterItem$val, _formFilter$isDataDir, _formFilter$dataset6, _filterToEdit$adhoc_f, _formFilter$controlVa, _filterToEdit$control, _filterToEdit$control2, _formFilter$controlVa2, _formFilter$controlVa3, _filterToEdit$control3, _filterToEdit$control4, _formFilter$controlVa4, _formFilter$adhoc_fil, _formFilter$controlVa5, _formFilter$dataset9, _datasetDetails$colum, _error$errors;\n  const isRemoved = !!removedFilters[filterId];\n  const [error, setError] = useState();\n  const [metrics, setMetrics] = useState([]);\n  const [activeTabKey, setActiveTabKey] = useState(FilterTabs.configuration.key);\n  const dashboardId = useSelector((state) => state.dashboardInfo.id);\n  const [undoFormValues, setUndoFormValues] = useState(null);\n  const forceUpdate = useForceUpdate(isActive);\n  const [datasetDetails, setDatasetDetails] = useState();\n  const defaultFormFilter = useMemo(() => ({}), []);\n  const filters = form.getFieldValue('filters');\n  const formValues = filters == null ? void 0 : filters[filterId];\n  const formFilter = formValues || undoFormValues || defaultFormFilter;\n  const dependencies = (formFilter == null ? void 0 : formFilter.dependencies) || (filterToEdit == null ? void 0 : filterToEdit.cascadeParentIds) || [];\n  const nativeFilterItems = getChartMetadataRegistry().items;\n  const nativeFilterVizTypes = Object.entries(nativeFilterItems)\n  // @ts-ignore\n  .filter(([, { value }]) => {var _value$behaviors;return (_value$behaviors = value.behaviors) == null ? void 0 : _value$behaviors.includes(Behavior.NativeFilter);}).\n  map(([key]) => key);\n  const loadedDatasets = useSelector(({ datasources }) => datasources);\n  const charts = useSelector(({ charts }) => charts);\n  const doLoadedDatasetsHaveTemporalColumns = useMemo(() => Object.values(loadedDatasets).some((dataset) => hasTemporalColumns(dataset)), [loadedDatasets]);\n  const showTimeRangePicker = useMemo(() => {\n    const currentDataset = Object.values(loadedDatasets).find((dataset) => {var _formFilter$dataset;return dataset.id === (formFilter == null ? void 0 : (_formFilter$dataset = formFilter.dataset) == null ? void 0 : _formFilter$dataset.value);});\n    return currentDataset ? hasTemporalColumns(currentDataset) : true;\n  }, [formFilter == null ? void 0 : (_formFilter$dataset2 = formFilter.dataset) == null ? void 0 : _formFilter$dataset2.value, loadedDatasets]);\n  const hasDataset =\n  // @ts-ignore\n  !!((_nativeFilterItems$fo = nativeFilterItems[formFilter == null ? void 0 : formFilter.filterType]) != null && (_nativeFilterItems$fo2 = _nativeFilterItems$fo.value) != null && _nativeFilterItems$fo2.datasourceCount);\n  const datasetId = (_ref = (_formFilter$dataset$v = formFilter == null ? void 0 : (_formFilter$dataset3 = formFilter.dataset) == null ? void 0 : _formFilter$dataset3.value) != null ? _formFilter$dataset$v :\n  filterToEdit == null ? void 0 : (_filterToEdit$targets = filterToEdit.targets[0]) == null ? void 0 : _filterToEdit$targets.datasetId) != null ? _ref :\n  mostUsedDataset(loadedDatasets, charts);\n  const { controlItems = {}, mainControlItems = {} } = formFilter ?\n  getControlItemsMap({\n    expanded,\n    datasetId,\n    disabled: false,\n    forceUpdate,\n    form,\n    filterId,\n    filterType: formFilter == null ? void 0 : formFilter.filterType,\n    filterToEdit,\n    formFilter,\n    removed: isRemoved\n  }) :\n  {};\n  const hasColumn = !!mainControlItems.groupby;\n  const nativeFilterItem = (_nativeFilterItems$fo3 = nativeFilterItems[formFilter == null ? void 0 : formFilter.filterType]) != null ? _nativeFilterItems$fo3 : {};\n  // @ts-ignore\n  const enableNoResults = !!((_nativeFilterItem$val = nativeFilterItem.value) != null && _nativeFilterItem$val.enableNoResults);\n  const hasMetrics = hasColumn && !!metrics.length;\n  const hasFilledDataset = !hasDataset || datasetId && ((formFilter == null ? void 0 : formFilter.column) || !hasColumn);\n  const hasAdditionalFilters = FILTERS_WITH_ADHOC_FILTERS.includes(formFilter == null ? void 0 : formFilter.filterType);\n  const canDependOnOtherFilters = TYPES_SUPPORT_DEPENDENCIES.includes(formFilter == null ? void 0 : formFilter.filterType);\n  const isDataDirty = (_formFilter$isDataDir = formFilter == null ? void 0 : formFilter.isDataDirty) != null ? _formFilter$isDataDir : true;\n  const setNativeFilterFieldValuesWrapper = (values) => {\n    setNativeFilterFieldValues(form, filterId, values);\n    setError(undefined);\n    forceUpdate();\n  };\n  const setErrorWrapper = (error) => {\n    setNativeFilterFieldValues(form, filterId, {\n      defaultValueQueriesData: null\n    });\n    setError(error);\n    forceUpdate();\n  };\n  // Calculates the dependencies default values to be used\n  // to extract the available values to the filter\n  let dependenciesDefaultValues = {};\n  if (dependencies && dependencies.length > 0 && filters) {\n    dependencies.forEach((dependency) => {var _filters$dependency, _filters$dependency$d;\n      const extraFormData = (_filters$dependency = filters[dependency]) == null ? void 0 : (_filters$dependency$d = _filters$dependency.defaultDataMask) == null ? void 0 : _filters$dependency$d.extraFormData;\n      dependenciesDefaultValues = mergeExtraFormData(dependenciesDefaultValues, extraFormData);\n    });\n  }\n  const dependenciesText = JSON.stringify(dependenciesDefaultValues);\n  const refreshHandler = useCallback((force = false) => {var _formFilter$dataset4, _formFilter$dataset5;\n    if (!hasDataset || !(formFilter != null && (_formFilter$dataset4 = formFilter.dataset) != null && _formFilter$dataset4.value)) {\n      forceUpdate();\n      return;\n    }\n    const formData = getFormData({\n      datasetId: formFilter == null ? void 0 : (_formFilter$dataset5 = formFilter.dataset) == null ? void 0 : _formFilter$dataset5.value,\n      dashboardId,\n      groupby: formFilter == null ? void 0 : formFilter.column,\n      ...formFilter\n    });\n    formData.extra_form_data = dependenciesDefaultValues;\n    setNativeFilterFieldValuesWrapper({\n      defaultValueQueriesData: null,\n      isDataDirty: false\n    });\n    getChartDataRequest({\n      formData,\n      force\n    }).\n    then(({ response, json }) => {\n      if (isFeatureEnabled(FeatureFlag.GlobalAsyncQueries)) {\n        // deal with getChartDataRequest transforming the response data\n        const result = 'result' in json ? json.result[0] : json;\n        if (response.status === 200) {\n          setNativeFilterFieldValuesWrapper({\n            defaultValueQueriesData: [result]\n          });\n        } else\n        if (response.status === 202) {\n          waitForAsyncData(result).\n          then((asyncResult) => {\n            setNativeFilterFieldValuesWrapper({\n              defaultValueQueriesData: asyncResult\n            });\n          }).\n          catch((error) => {\n            getClientErrorObject(error).then((clientErrorObject) => {\n              setErrorWrapper(clientErrorObject);\n            });\n          });\n        } else\n        {\n          throw new Error(`Received unexpected response status (${response.status}) while fetching chart data`);\n        }\n      } else\n      {\n        setNativeFilterFieldValuesWrapper({\n          defaultValueQueriesData: json.result\n        });\n      }\n    }).\n    catch((error) => {\n      getClientErrorObject(error).then((clientErrorObject) => {\n        setError(clientErrorObject);\n      });\n    });\n  }, [filterId, forceUpdate, form, formFilter, hasDataset, dependenciesText]);\n  // TODO: refreshHandler changes itself because of the dependencies. Needs refactor.\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  useEffect(() => refreshHandler(), [dependenciesText]);\n  const newFormData = getFormData({\n    datasetId,\n    groupby: hasColumn ? formFilter == null ? void 0 : formFilter.column : undefined,\n    ...formFilter\n  });\n  newFormData.extra_form_data = dependenciesDefaultValues;\n  const [hasDefaultValue, isRequired, defaultValueTooltip, setHasDefaultValue] = useDefaultValue(formFilter, filterToEdit);\n  const showDataset = !datasetId || datasetDetails || (formFilter == null ? void 0 : (_formFilter$dataset6 = formFilter.dataset) == null ? void 0 : _formFilter$dataset6.label);\n  const formChanged = useCallback(() => {\n    form.setFields([\n    {\n      name: 'changed',\n      value: true\n    }]\n    );\n  }, [form]);\n  const updateFormValues = useCallback((values) => {\n    setNativeFilterFieldValues(form, filterId, values);\n    formChanged();\n  }, [filterId, form, formChanged]);\n  const hasPreFilter = !!(formFilter != null && formFilter.adhoc_filters) ||\n  !!(formFilter != null && formFilter.time_range) ||\n  !!(filterToEdit != null && (_filterToEdit$adhoc_f = filterToEdit.adhoc_filters) != null && _filterToEdit$adhoc_f.length) ||\n  !!(filterToEdit != null && filterToEdit.time_range);\n  const hasEnableSingleValue = (formFilter == null ? void 0 : (_formFilter$controlVa = formFilter.controlValues) == null ? void 0 : _formFilter$controlVa.enableSingleValue) !== undefined ||\n  (filterToEdit == null ? void 0 : (_filterToEdit$control = filterToEdit.controlValues) == null ? void 0 : _filterToEdit$control.enableSingleValue) !== undefined;\n  let enableSingleValue = filterToEdit == null ? void 0 : (_filterToEdit$control2 = filterToEdit.controlValues) == null ? void 0 : _filterToEdit$control2.enableSingleValue;\n  if ((formFilter == null ? void 0 : (_formFilter$controlVa2 = formFilter.controlValues) == null ? void 0 : _formFilter$controlVa2.enableSingleMaxValue) !== undefined) {\n    ({ enableSingleValue } = formFilter.controlValues);\n  }\n  const hasSorting = typeof (formFilter == null ? void 0 : (_formFilter$controlVa3 = formFilter.controlValues) == null ? void 0 : _formFilter$controlVa3.sortAscending) === 'boolean' ||\n  typeof (filterToEdit == null ? void 0 : (_filterToEdit$control3 = filterToEdit.controlValues) == null ? void 0 : _filterToEdit$control3.sortAscending) === 'boolean';\n  let sort = filterToEdit == null ? void 0 : (_filterToEdit$control4 = filterToEdit.controlValues) == null ? void 0 : _filterToEdit$control4.sortAscending;\n  if (typeof (formFilter == null ? void 0 : (_formFilter$controlVa4 = formFilter.controlValues) == null ? void 0 : _formFilter$controlVa4.sortAscending) === 'boolean') {\n    sort = formFilter.controlValues.sortAscending;\n  }\n  const showDefaultValue = !hasDataset ||\n  !isDataDirty && hasFilledDataset ||\n  !mainControlItems.groupby;\n  const onSortChanged = (value) => {var _form$getFieldValue;\n    const previous = (_form$getFieldValue = form.getFieldValue('filters')) == null ? void 0 : _form$getFieldValue[filterId].controlValues;\n    setNativeFilterFieldValues(form, filterId, {\n      controlValues: {\n        ...previous,\n        sortAscending: value\n      }\n    });\n    forceUpdate();\n  };\n  const onEnableSingleValueChanged = (value) => {var _form$getFieldValue2;\n    const previous = (_form$getFieldValue2 = form.getFieldValue('filters')) == null ? void 0 : _form$getFieldValue2[filterId].controlValues;\n    setNativeFilterFieldValues(form, filterId, {\n      controlValues: {\n        ...previous,\n        enableSingleValue: value\n      }\n    });\n    forceUpdate();\n  };\n  const validatePreFilter = () => setTimeout(() => form.validateFields([\n  ['filters', filterId, 'adhoc_filters'],\n  ['filters', filterId, 'time_range']]\n  ), 0);\n  const hasTimeRange = (formFilter == null ? void 0 : formFilter.time_range) && formFilter.time_range !== 'No filter';\n  const hasAdhoc = (formFilter == null ? void 0 : (_formFilter$adhoc_fil = formFilter.adhoc_filters) == null ? void 0 : _formFilter$adhoc_fil.length) > 0;\n  const defaultToFirstItem = formFilter == null ? void 0 : (_formFilter$controlVa5 = formFilter.controlValues) == null ? void 0 : _formFilter$controlVa5.defaultToFirstItem;\n  const initialDefaultValue = (formFilter == null ? void 0 : formFilter.filterType) === (filterToEdit == null ? void 0 : filterToEdit.filterType) ?\n  filterToEdit == null ? void 0 : filterToEdit.defaultDataMask :\n  null;\n  const preFilterValidator = () => {\n    if (hasTimeRange || hasAdhoc) {\n      return Promise.resolve();\n    }\n    return Promise.reject(new Error(t('Pre-filter is required')));\n  };\n  const availableFilters = getAvailableFilters(filterId);\n  const hasAvailableFilters = availableFilters.length > 0;\n  const hasTimeDependency = availableFilters.\n  filter((filter) => filter.type === 'filter_time').\n  some((filter) => dependencies == null ? void 0 : dependencies.includes(filter.value));\n  useEffect(() => {\n    if (datasetId) {\n      cachedSupersetGet({\n        endpoint: `/api/v1/dataset/${datasetId}?q=${rison.encode({\n          columns: [\n          'columns.column_name',\n          'columns.expression',\n          'columns.filterable',\n          'columns.is_dttm',\n          'columns.type',\n          'columns.verbose_name',\n          'database.id',\n          'database.database_name',\n          'datasource_type',\n          'filter_select_enabled',\n          'id',\n          'is_sqllab_view',\n          'main_dttm_col',\n          'metrics.metric_name',\n          'metrics.verbose_name',\n          'schema',\n          'sql',\n          'table_name']\n\n        })}`\n      }).\n      then((response) => {var _response$json, _response$json$result, _response$json2;\n        setMetrics((_response$json = response.json) == null ? void 0 : (_response$json$result = _response$json.result) == null ? void 0 : _response$json$result.metrics);\n        const dataset = (_response$json2 = response.json) == null ? void 0 : _response$json2.result;\n        // modify the response to fit structure expected by AdhocFilterControl\n        dataset.type = dataset.datasource_type;\n        dataset.filter_select = true;\n        setDatasetDetails(dataset);\n      }).\n      catch((response) => {\n        addDangerToast(response.message);\n      });\n    }\n  }, [datasetId]);\n  useImperativeHandle(ref, () => ({\n    changeTab(tab) {\n      setActiveTabKey(tab);\n    }\n  }));\n  useBackendFormUpdate(form, filterId);\n  useEffect(() => {\n    if (hasDataset && hasFilledDataset && hasDefaultValue && isDataDirty) {\n      refreshHandler();\n    }\n  }, [\n  hasDataset,\n  hasFilledDataset,\n  hasDefaultValue,\n  isDataDirty,\n  refreshHandler,\n  showDataset]\n  );\n  const initiallyExcludedCharts = useMemo(() => {var _formFilter$dataset7;\n    const excluded = [];\n    if ((formFilter == null ? void 0 : (_formFilter$dataset7 = formFilter.dataset) == null ? void 0 : _formFilter$dataset7.value) === undefined) {\n      return [];\n    }\n    Object.values(charts).forEach((chart) => {var _chart$form_data, _loadedDatasets$chart, _formFilter$dataset8;\n      const chartDatasetUid = (_chart$form_data = chart.form_data) == null ? void 0 : _chart$form_data.datasource;\n      if (chartDatasetUid === undefined) {\n        return;\n      }\n      if (((_loadedDatasets$chart = loadedDatasets[chartDatasetUid]) == null ? void 0 : _loadedDatasets$chart.id) !== (formFilter == null ? void 0 : (_formFilter$dataset8 = formFilter.dataset) == null ? void 0 : _formFilter$dataset8.value)) {\n        excluded.push(chart.id);\n      }\n    });\n    return excluded;\n  }, [\n  JSON.stringify(charts),\n  formFilter == null ? void 0 : (_formFilter$dataset9 = formFilter.dataset) == null ? void 0 : _formFilter$dataset9.value,\n  JSON.stringify(loadedDatasets)]\n  );\n  useEffect(() => {\n    // just removed, saving current form items for eventual undo\n    if (isRemoved) {\n      setUndoFormValues(formValues);\n    }\n  }, [isRemoved]);\n  useEffect(() => {\n    // the filter was just restored after undo\n    if (undoFormValues && !isRemoved) {\n      setNativeFilterFieldValues(form, filterId, undoFormValues);\n      setUndoFormValues(null);\n    }\n  }, [formValues, filterId, form, isRemoved, undoFormValues]);\n  if (isRemoved) {\n    return _jsx(RemovedFilter, { onClick: () => restoreFilter(filterId) });\n  }\n  const timeColumn = _jsx(StyledRowFormItem, { expanded: expanded, name: ['filters', filterId, 'granularity_sqla'], label: _jsxs(_Fragment, { children: [\n      _jsx(StyledLabel, { children: t('Time column') }), \"\\xA0\",\n      _jsx(InfoTooltipWithTrigger, { placement: \"top\", tooltip: hasTimeDependency ?\n        t('Time column to apply dependent temporal filter to') :\n        t('Time column to apply time range to') })] }\n    ), initialValue: filterToEdit == null ? void 0 : filterToEdit.granularity_sqla, children:\n    _jsx(ColumnSelect, { allowClear: true, form: form, formField: \"granularity_sqla\", filterId: filterId, filterValues: (column) => !!column.is_dttm, datasetId: datasetId, onChange: (column) => {\n        // We need reset default value when when column changed\n        setNativeFilterFieldValues(form, filterId, {\n          granularity_sqla: column\n        });\n        forceUpdate();\n      } }) }\n  );\n  return _jsxs(StyledTabs, { activeKey: activeTabKey, onChange: (activeKey) => setActiveTabKey(activeKey), centered: true, children: [\n    _jsxs(TabPane, { tab: FilterTabs.configuration.name, forceRender: true, children: [\n      _jsxs(StyledContainer, { children: [\n        _jsx(StyledFormItem, { expanded: expanded, name: ['filters', filterId, 'type'], hidden: true, initialValue: NativeFilterType.NativeFilter, children:\n          _jsx(Input, {}) }\n        ),\n        _jsx(StyledFormItem, { expanded: expanded, name: ['filters', filterId, 'name'], label: _jsx(StyledLabel, { children: t('Filter name') }), initialValue: filterToEdit == null ? void 0 : filterToEdit.name, rules: [{ required: !isRemoved, message: t('Name is required') }], children:\n          _jsx(Input, { ...getFiltersConfigModalTestId('name-input') }) }\n        ),\n        _jsx(StyledFormItem, { expanded: expanded, name: ['filters', filterId, 'filterType'], rules: [{ required: !isRemoved, message: t('Name is required') }], initialValue: (filterToEdit == null ? void 0 : filterToEdit.filterType) || 'filter_select', label: _jsx(StyledLabel, { children: t('Filter Type') }), ...getFiltersConfigModalTestId('filter-type'), children:\n          _jsx(Select, { ariaLabel: t('Filter type'), options: nativeFilterVizTypes.map((filterType) => {var _nativeFilterItems$fi, _FILTER_SUPPORTED_TYP, _FILTER_SUPPORTED_TYP2;\n              // @ts-ignore\n              const name = (_nativeFilterItems$fi = nativeFilterItems[filterType]) == null ? void 0 : _nativeFilterItems$fi.value.name;\n              const mappedName = name ?\n              FILTER_TYPE_NAME_MAPPING[name] :\n              undefined;\n              const isDisabled = ((_FILTER_SUPPORTED_TYP = FILTER_SUPPORTED_TYPES[filterType]) == null ? void 0 : _FILTER_SUPPORTED_TYP.length) === 1 && ((_FILTER_SUPPORTED_TYP2 =\n              FILTER_SUPPORTED_TYPES[filterType]) == null ? void 0 : _FILTER_SUPPORTED_TYP2.includes(GenericDataType.Temporal)) &&\n              !doLoadedDatasetsHaveTemporalColumns;\n              return {\n                value: filterType,\n                label: mappedName || name,\n                customLabel: isDisabled ? _jsx(Tooltip, { title: t('Datasets do not contain a temporal column'), children:\n                  mappedName || name }\n                ) : undefined,\n                disabled: isDisabled\n              };\n            }), onChange: (value) => {\n              setNativeFilterFieldValues(form, filterId, {\n                filterType: value,\n                defaultDataMask: null,\n                column: null\n              });\n              forceUpdate();\n            } }) }\n        )] }\n      ),\n      (formFilter == null ? void 0 : formFilter.filterType) === 'filter_time' && _jsx(FilterTypeInfo, { expanded: expanded, children:\n        t(`Dashboard time range filters apply to temporal columns defined in\n          the filter section of each chart. Add temporal columns to the chart\n          filters to have this dashboard filter impact those charts.`) }\n      ),\n      hasDataset && _jsxs(StyledRowContainer, { children: [\n        showDataset ? _jsx(StyledFormItem, { expanded: expanded, name: ['filters', filterId, 'dataset'], label: _jsx(StyledLabel, { children: t('Dataset') }), initialValue: datasetDetails ?\n          {\n            label: DatasetSelectLabel({\n              id: datasetDetails.id,\n              table_name: datasetDetails.table_name,\n              schema: datasetDetails.schema,\n              database: {\n                database_name: datasetDetails.database.database_name\n              }\n            }),\n            value: datasetDetails.id\n          } :\n          undefined, rules: [\n          { required: !isRemoved, message: t('Dataset is required') }], ...\n          getFiltersConfigModalTestId('datasource-input'), children:\n          _jsx(DatasetSelect, { onChange: (value) => {\n              // We need to reset the column when the dataset has changed\n              if (value.value !== datasetId) {\n                setNativeFilterFieldValues(form, filterId, {\n                  dataset: value,\n                  defaultDataMask: null,\n                  column: null\n                });\n              }\n              forceUpdate();\n            } }) }\n        ) : _jsx(StyledFormItem, { expanded: expanded, label: _jsx(StyledLabel, { children: t('Dataset') }), children:\n          _jsx(Loading, { position: \"inline-centered\" }) }\n        ),\n        hasDataset &&\n        Object.keys(mainControlItems).map((key) => mainControlItems[key].element)] }\n      ),\n      _jsxs(StyledCollapse, { defaultActiveKey: activeFilterPanelKeys, onChange: (key) => {\n          handleActiveFilterPanelChange(key);\n        }, expandIconPosition: \"right\", children: [\n        (formFilter == null ? void 0 : formFilter.filterType) !== 'filter_time' && _jsxs(Collapse.Panel, { forceRender: true, header: FilterPanels.configuration.name, children: [\n          canDependOnOtherFilters && hasAvailableFilters && _jsx(StyledRowFormItem, { expanded: expanded, name: ['filters', filterId, 'dependencies'], initialValue: dependencies, children:\n            _jsx(DependencyList, { availableFilters: availableFilters, dependencies: dependencies, onDependenciesChange: (dependencies) => {\n                setNativeFilterFieldValues(form, filterId, {\n                  dependencies\n                });\n                forceUpdate();\n                validateDependencies();\n                formChanged();\n              }, getDependencySuggestion: () => getDependencySuggestion(filterId), children:\n              hasTimeDependency ? timeColumn : undefined }\n            ) }\n          ),\n          hasDataset && hasAdditionalFilters && _jsx(CleanFormItem, { name: ['filters', filterId, 'preFilter'], children:\n            _jsxs(CollapsibleControl, { initialValue: hasPreFilter, title: t('Pre-filter available values'), tooltip: t(`Add filter clauses to control the filter's source query,\n                    though only in the context of the autocomplete i.e., these conditions\n                    do not impact how the filter is applied to the dashboard. This is useful\n                    when you want to improve the query's performance by only scanning a subset\n                    of the underlying data or limit the available values displayed in the filter.`), onChange: (checked) => {\n                formChanged();\n                if (checked) {\n                  validatePreFilter();\n                }\n              }, children: [\n              _jsx(StyledRowSubFormItem, { expanded: expanded, name: ['filters', filterId, 'adhoc_filters'], css: /*#__PURE__*/_css({ width: INPUT_WIDTH }, process.env.NODE_ENV === \"production\" ? \"\" : \";label:FiltersConfigForm;\", process.env.NODE_ENV === \"production\" ? \"\" : \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9hcHAvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL2Rhc2hib2FyZC9jb21wb25lbnRzL25hdGl2ZUZpbHRlcnMvRmlsdGVyc0NvbmZpZ01vZGFsL0ZpbHRlcnNDb25maWdGb3JtL0ZpbHRlcnNDb25maWdGb3JtLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFrcUI0RyIsImZpbGUiOiIvYXBwL3N1cGVyc2V0LWZyb250ZW5kL3NyYy9kYXNoYm9hcmQvY29tcG9uZW50cy9uYXRpdmVGaWx0ZXJzL0ZpbHRlcnNDb25maWdNb2RhbC9GaWx0ZXJzQ29uZmlnRm9ybS9GaWx0ZXJzQ29uZmlnRm9ybS50c3giLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmVcbiAqIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxuICogZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGVcbiAqIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcbiAqIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuICogc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbiAqIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4gKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbiAqIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKiBlc2xpbnQtZGlzYWJsZSByZWFjdC1ob29rcy9ydWxlcy1vZi1ob29rcyAqL1xuaW1wb3J0IHsgSW5mb1Rvb2x0aXBXaXRoVHJpZ2dlciwgfSBmcm9tICdAc3VwZXJzZXQtdWkvY2hhcnQtY29udHJvbHMnO1xuaW1wb3J0IHsgQmVoYXZpb3IsIGlzRmVhdHVyZUVuYWJsZWQsIEZlYXR1cmVGbGFnLCBHZW5lcmljRGF0YVR5cGUsIGdldENoYXJ0TWV0YWRhdGFSZWdpc3RyeSwgTmF0aXZlRmlsdGVyVHlwZSwgc3R5bGVkLCB0LCBnZXRDbGllbnRFcnJvck9iamVjdCwgfSBmcm9tICdAc3VwZXJzZXQtdWkvY29yZSc7XG5pbXBvcnQgeyBpc0VxdWFsIH0gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IGZvcndhcmRSZWYsIHVzZUNhbGxiYWNrLCB1c2VFZmZlY3QsIHVzZUltcGVyYXRpdmVIYW5kbGUsIHVzZU1lbW8sIHVzZVN0YXRlLCBtZW1vLCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCByaXNvbiBmcm9tICdyaXNvbic7XG5pbXBvcnQgeyB1c2VTZWxlY3RvciB9IGZyb20gJ3JlYWN0LXJlZHV4JztcbmltcG9ydCB7IGdldENoYXJ0RGF0YVJlcXVlc3QgfSBmcm9tICdzcmMvY29tcG9uZW50cy9DaGFydC9jaGFydEFjdGlvbic7XG5pbXBvcnQgeyBJbnB1dCwgVGV4dEFyZWEgfSBmcm9tICdzcmMvY29tcG9uZW50cy9JbnB1dCc7XG5pbXBvcnQgeyBTZWxlY3QgfSBmcm9tICdzcmMvY29tcG9uZW50cyc7XG5pbXBvcnQgQ29sbGFwc2UgZnJvbSAnc3JjL2NvbXBvbmVudHMvQ29sbGFwc2UnO1xuaW1wb3J0IEJhc2ljRXJyb3JBbGVydCBmcm9tICdzcmMvY29tcG9uZW50cy9FcnJvck1lc3NhZ2UvQmFzaWNFcnJvckFsZXJ0JztcbmltcG9ydCBFcnJvck1lc3NhZ2VXaXRoU3RhY2tUcmFjZSBmcm9tICdzcmMvY29tcG9uZW50cy9FcnJvck1lc3NhZ2UvRXJyb3JNZXNzYWdlV2l0aFN0YWNrVHJhY2UnO1xuaW1wb3J0IHsgRm9ybUl0ZW0gfSBmcm9tICdzcmMvY29tcG9uZW50cy9Gb3JtJztcbmltcG9ydCBJY29ucyBmcm9tICdzcmMvY29tcG9uZW50cy9JY29ucyc7XG5pbXBvcnQgTG9hZGluZyBmcm9tICdzcmMvY29tcG9uZW50cy9Mb2FkaW5nJztcbmltcG9ydCB7IGFkZERhbmdlclRvYXN0IH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvTWVzc2FnZVRvYXN0cy9hY3Rpb25zJztcbmltcG9ydCB7IFJhZGlvIH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvUmFkaW8nO1xuaW1wb3J0IFRhYnMgZnJvbSAnc3JjL2NvbXBvbmVudHMvVGFicyc7XG5pbXBvcnQgeyBUb29sdGlwIH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvVG9vbHRpcCc7XG5pbXBvcnQgeyBjYWNoZWRTdXBlcnNldEdldCB9IGZyb20gJ3NyYy91dGlscy9jYWNoZWRTdXBlcnNldEdldCc7XG5pbXBvcnQgRGF0ZUZpbHRlckNvbnRyb2wgZnJvbSAnc3JjL2V4cGxvcmUvY29tcG9uZW50cy9jb250cm9scy9EYXRlRmlsdGVyQ29udHJvbCc7XG5pbXBvcnQgQWRob2NGaWx0ZXJDb250cm9sIGZyb20gJ3NyYy9leHBsb3JlL2NvbXBvbmVudHMvY29udHJvbHMvRmlsdGVyQ29udHJvbC9BZGhvY0ZpbHRlckNvbnRyb2wnO1xuaW1wb3J0IHsgd2FpdEZvckFzeW5jRGF0YSB9IGZyb20gJ3NyYy9taWRkbGV3YXJlL2FzeW5jRXZlbnQnO1xuaW1wb3J0IHsgU2luZ2xlVmFsdWVUeXBlIH0gZnJvbSAnc3JjL2ZpbHRlcnMvY29tcG9uZW50cy9SYW5nZS9TaW5nbGVWYWx1ZVR5cGUnO1xuaW1wb3J0IHsgZ2V0Rm9ybURhdGEsIG1lcmdlRXh0cmFGb3JtRGF0YSwgfSBmcm9tICdzcmMvZGFzaGJvYXJkL2NvbXBvbmVudHMvbmF0aXZlRmlsdGVycy91dGlscyc7XG5pbXBvcnQgeyBEYXRhc2V0U2VsZWN0TGFiZWwgfSBmcm9tICdzcmMvZmVhdHVyZXMvZGF0YXNldHMvRGF0YXNldFNlbGVjdExhYmVsJztcbmltcG9ydCB7IEFMTE9XX0RFUEVOREVOQ0lFUyBhcyBUWVBFU19TVVBQT1JUX0RFUEVOREVOQ0lFUywgZ2V0RmlsdGVyc0NvbmZpZ01vZGFsVGVzdElkLCB9IGZyb20gJy4uL0ZpbHRlcnNDb25maWdNb2RhbCc7XG5pbXBvcnQgeyBDb2xsYXBzaWJsZUNvbnRyb2wgfSBmcm9tICcuL0NvbGxhcHNpYmxlQ29udHJvbCc7XG5pbXBvcnQgeyBDb2x1bW5TZWxlY3QgfSBmcm9tICcuL0NvbHVtblNlbGVjdCc7XG5pbXBvcnQgRGF0YXNldFNlbGVjdCBmcm9tICcuL0RhdGFzZXRTZWxlY3QnO1xuaW1wb3J0IERlZmF1bHRWYWx1ZSBmcm9tICcuL0RlZmF1bHRWYWx1ZSc7XG5pbXBvcnQgRmlsdGVyU2NvcGUgZnJvbSAnLi9GaWx0ZXJTY29wZS9GaWx0ZXJTY29wZSc7XG5pbXBvcnQgZ2V0Q29udHJvbEl0ZW1zTWFwIGZyb20gJy4vZ2V0Q29udHJvbEl0ZW1zTWFwJztcbmltcG9ydCBSZW1vdmVkRmlsdGVyIGZyb20gJy4vUmVtb3ZlZEZpbHRlcic7XG5pbXBvcnQgeyB1c2VCYWNrZW5kRm9ybVVwZGF0ZSwgdXNlRGVmYXVsdFZhbHVlIH0gZnJvbSAnLi9zdGF0ZSc7XG5pbXBvcnQgeyBoYXNUZW1wb3JhbENvbHVtbnMsIG1vc3RVc2VkRGF0YXNldCwgc2V0TmF0aXZlRmlsdGVyRmllbGRWYWx1ZXMsIHVzZUZvcmNlVXBkYXRlLCB9IGZyb20gJy4vdXRpbHMnO1xuaW1wb3J0IHsgRklMVEVSX1NVUFBPUlRFRF9UWVBFUywgSU5QVVRfV0lEVEggfSBmcm9tICcuL2NvbnN0YW50cyc7XG5pbXBvcnQgRGVwZW5kZW5jeUxpc3QgZnJvbSAnLi9EZXBlbmRlbmN5TGlzdCc7XG5jb25zdCBGT1JNX0lURU1fV0lEVEggPSAyNjA7XG5jb25zdCBUYWJQYW5lID0gc3R5bGVkKFRhYnMuVGFiUGFuZSkgYFxuICBwYWRkaW5nOiAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmdyaWRVbml0ICogNH1weCAwcHg7XG5gO1xuY29uc3QgU3R5bGVkQ29udGFpbmVyID0gc3R5bGVkLmRpdiBgXG4gICR7KHsgdGhlbWUgfSkgPT4gYFxuICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgZmxleC1kaXJlY3Rpb246IHJvdy1yZXZlcnNlO1xuICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjtcbiAgICBwYWRkaW5nOiAwcHggJHt0aGVtZS5ncmlkVW5pdCAqIDR9cHg7XG4gIGB9XG5gO1xuY29uc3QgU3R5bGVkUm93Q29udGFpbmVyID0gc3R5bGVkLmRpdiBgXG4gIGRpc3BsYXk6IGZsZXg7XG4gIGZsZXgtZGlyZWN0aW9uOiByb3c7XG4gIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjtcbiAgd2lkdGg6IDEwMCU7XG4gIHBhZGRpbmc6IDBweCAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmdyaWRVbml0ICogNH1weDtcbmA7XG5jb25zdCBjb250cm9sc09yZGVyID0gW1xuICAgICdlbmFibGVFbXB0eUZpbHRlcicsXG4gICAgJ2RlZmF1bHRUb0ZpcnN0SXRlbScsXG4gICAgJ211bHRpU2VsZWN0JyxcbiAgICAnc2VhcmNoQWxsT3B0aW9ucycsXG4gICAgJ2ludmVyc2VTZWxlY3Rpb24nLFxuXTtcbmV4cG9ydCBjb25zdCBTdHlsZWRGb3JtSXRlbSA9IHN0eWxlZChGb3JtSXRlbSkgYFxuICB3aWR0aDogJHsoeyBleHBhbmRlZCB9KSA9PiAoZXhwYW5kZWQgPyAnNDklJyA6IGAke0ZPUk1fSVRFTV9XSURUSH1weGApfTtcbiAgbWFyZ2luLWJvdHRvbTogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5ncmlkVW5pdCAqIDR9cHg7XG5cbiAgJiAuYW50LWZvcm0taXRlbS1sYWJlbCB7XG4gICAgcGFkZGluZy1ib3R0b206IDA7XG4gIH1cblxuICAmIC5hbnQtZm9ybS1pdGVtLWNvbnRyb2wtaW5wdXQge1xuICAgIG1pbi1oZWlnaHQ6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuZ3JpZFVuaXQgKiAxMH1weDtcbiAgfVxuYDtcbmV4cG9ydCBjb25zdCBTdHlsZWRSb3dGb3JtSXRlbSA9IHN0eWxlZChGb3JtSXRlbSkgYFxuICBtYXJnaW4tYm90dG9tOiAwO1xuICBwYWRkaW5nLWJvdHRvbTogMDtcbiAgbWluLXdpZHRoOiAkeyh7IGV4cGFuZGVkIH0pID0+IChleHBhbmRlZCA/ICc1MCUnIDogYCR7Rk9STV9JVEVNX1dJRFRIfXB4YCl9O1xuXG4gICYgLmFudC1mb3JtLWl0ZW0tbGFiZWwge1xuICAgIHBhZGRpbmctYm90dG9tOiAwO1xuICB9XG5cbiAgLmFudC1mb3JtLWl0ZW0tY29udHJvbC1pbnB1dC1jb250ZW50ID4gZGl2ID4gZGl2IHtcbiAgICBoZWlnaHQ6IGF1dG87XG4gIH1cblxuICAmIC5hbnQtZm9ybS1pdGVtLWNvbnRyb2wtaW5wdXQge1xuICAgIG1pbi1oZWlnaHQ6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuZ3JpZFVuaXQgKiAxMH1weDtcbiAgfVxuYDtcbmV4cG9ydCBjb25zdCBTdHlsZWRSb3dTdWJGb3JtSXRlbSA9IHN0eWxlZChGb3JtSXRlbSkgYFxuICBtaW4td2lkdGg6ICR7KHsgZXhwYW5kZWQgfSkgPT4gKGV4cGFuZGVkID8gJzUwJScgOiBgJHtGT1JNX0lURU1fV0lEVEh9cHhgKX07XG5cbiAgJiAuYW50LWZvcm0taXRlbS1sYWJlbCB7XG4gICAgcGFkZGluZy1ib3R0b206IDA7XG4gIH1cblxuICAuYW50LWZvcm0taXRlbSB7XG4gICAgbWFyZ2luLWJvdHRvbTogMDtcbiAgfVxuXG4gIC5hbnQtZm9ybS1pdGVtLWNvbnRyb2wtaW5wdXQtY29udGVudCA+IGRpdiA+IGRpdiB7XG4gICAgaGVpZ2h0OiBhdXRvO1xuICB9XG5cbiAgLmFudC1mb3JtLWl0ZW0tZXh0cmEge1xuICAgIGRpc3BsYXk6IG5vbmU7XG4gIH1cblxuICAmIC5hbnQtZm9ybS1pdGVtLWNvbnRyb2wtaW5wdXQge1xuICAgIGhlaWdodDogYXV0bztcbiAgfVxuYDtcbmV4cG9ydCBjb25zdCBTdHlsZWRMYWJlbCA9IHN0eWxlZC5zcGFuIGBcbiAgY29sb3I6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuY29sb3JzLmdyYXlzY2FsZS5iYXNlfTtcbiAgZm9udC1zaXplOiAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLnR5cG9ncmFwaHkuc2l6ZXMuc31weDtcbiAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTtcbmA7XG5jb25zdCBDbGVhbkZvcm1JdGVtID0gc3R5bGVkKEZvcm1JdGVtKSBgXG4gIG1hcmdpbi1ib3R0b206IDA7XG5gO1xuY29uc3QgRGVmYXVsdFZhbHVlQ29udGFpbmVyID0gc3R5bGVkLmRpdiBgXG4gIGRpc3BsYXk6IGZsZXg7XG4gIGZsZXgtZGlyZWN0aW9uOiByb3c7XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG5gO1xuY29uc3QgUmVmcmVzaEljb24gPSBzdHlsZWQoSWNvbnMuUmVmcmVzaCkgYFxuICBtYXJnaW4tbGVmdDogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5ncmlkVW5pdCAqIDJ9cHg7XG4gIGNvbG9yOiAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmNvbG9ycy5wcmltYXJ5LmJhc2V9O1xuYDtcbmNvbnN0IFN0eWxlZENvbGxhcHNlID0gc3R5bGVkKENvbGxhcHNlKSBgXG4gIGJvcmRlci1sZWZ0OiAwO1xuICBib3JkZXItdG9wOiAxcHggc29saWQgJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5jb2xvcnMuZ3JheXNjYWxlLmxpZ2h0Mn07XG4gIGJvcmRlci1yYWRpdXM6IDA7XG5cbiAgLmFudC1jb2xsYXBzZS1oZWFkZXIge1xuICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmNvbG9ycy5ncmF5c2NhbGUubGlnaHQyfTtcbiAgICBib3JkZXItdG9wOiAxcHggc29saWQgJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5jb2xvcnMuZ3JheXNjYWxlLmxpZ2h0Mn07XG4gICAgbWFyZ2luLXRvcDogLTFweDtcbiAgICBib3JkZXItcmFkaXVzOiAwO1xuICB9XG5cbiAgLmFudC1jb2xsYXBzZS1jb250ZW50IHtcbiAgICBib3JkZXI6IDA7XG4gIH1cblxuICAuYW50LWNvbGxhcHNlLWNvbnRlbnQtYm94IHtcbiAgICBwYWRkaW5nLXRvcDogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5ncmlkVW5pdCAqIDJ9cHg7XG4gIH1cblxuICAmLmFudC1jb2xsYXBzZSA+IC5hbnQtY29sbGFwc2UtaXRlbSB7XG4gICAgYm9yZGVyOiAwO1xuICAgIGJvcmRlci1yYWRpdXM6IDA7XG4gIH1cbmA7XG5jb25zdCBTdHlsZWRUYWJzID0gc3R5bGVkKFRhYnMpIGBcbiAgLmFudC10YWJzLW5hdiB7XG4gICAgcG9zaXRpb246IHN0aWNreTtcbiAgICB0b3A6IDA7XG4gICAgYmFja2dyb3VuZDogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5jb2xvcnMuZ3JheXNjYWxlLmxpZ2h0NX07XG4gICAgei1pbmRleDogMTtcbiAgfVxuXG4gIC5hbnQtdGFicy1uYXYtbGlzdCB7XG4gICAgcGFkZGluZzogMDtcbiAgfVxuXG4gIC5hbnQtZm9ybS1pdGVtLWxhYmVsIHtcbiAgICBwYWRkaW5nLWJvdHRvbTogMDtcbiAgfVxuYDtcbmNvbnN0IFN0eWxlZEFzdGVyaXNrID0gc3R5bGVkLnNwYW4gYFxuICBjb2xvcjogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5jb2xvcnMuZXJyb3IuYmFzZX07XG4gIGZvbnQtc2l6ZTogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS50eXBvZ3JhcGh5LnNpemVzLnN9cHg7XG4gIG1hcmdpbi1sZWZ0OiAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmdyaWRVbml0IC0gMX1weDtcbiAgJjpiZWZvcmUge1xuICAgIGNvbnRlbnQ6ICcqJztcbiAgfVxuYDtcbmNvbnN0IEZpbHRlclR5cGVJbmZvID0gc3R5bGVkLmRpdiBgXG4gICR7KHsgdGhlbWUsIGV4cGFuZGVkIH0pID0+IGBcbiAgICB3aWR0aDogJHtleHBhbmRlZCA/ICc0OSUnIDogYCR7Rk9STV9JVEVNX1dJRFRIfXB4YH07XG4gICAgZm9udC1zaXplOiAke3RoZW1lLnR5cG9ncmFwaHkuc2l6ZXMuc31weDtcbiAgICBjb2xvcjogJHt0aGVtZS5jb2xvcnMuZ3JheXNjYWxlLmxpZ2h0MX07XG4gICAgbWFyZ2luOlxuICAgICAgJHstdGhlbWUuZ3JpZFVuaXQgKiAyfXB4XG4gICAgICAwcHhcbiAgICAgICR7dGhlbWUuZ3JpZFVuaXQgKiA0fXB4XG4gICAgICAke3RoZW1lLmdyaWRVbml0ICogNH1weDtcbiAgYH1cbmA7XG5jb25zdCBGaWx0ZXJUYWJzID0ge1xuICAgIGNvbmZpZ3VyYXRpb246IHtcbiAgICAgICAga2V5OiAnY29uZmlndXJhdGlvbicsXG4gICAgICAgIG5hbWU6IHQoJ1NldHRpbmdzJyksXG4gICAgfSxcbiAgICBzY29waW5nOiB7XG4gICAgICAgIGtleTogJ3Njb3BpbmcnLFxuICAgICAgICBuYW1lOiB0KCdTY29waW5nJyksXG4gICAgfSxcbn07XG5leHBvcnQgY29uc3QgRmlsdGVyUGFuZWxzID0ge1xuICAgIGNvbmZpZ3VyYXRpb246IHtcbiAgICAgICAga2V5OiAnY29uZmlndXJhdGlvbicsXG4gICAgICAgIG5hbWU6IHQoJ0ZpbHRlciBDb25maWd1cmF0aW9uJyksXG4gICAgfSxcbiAgICBzZXR0aW5nczoge1xuICAgICAgICBrZXk6ICdzZXR0aW5ncycsXG4gICAgICAgIG5hbWU6IHQoJ0ZpbHRlciBTZXR0aW5ncycpLFxuICAgIH0sXG59O1xuY29uc3QgRklMVEVSU19XSVRIX0FESE9DX0ZJTFRFUlMgPSBbJ2ZpbHRlcl9zZWxlY3QnLCAnZmlsdGVyX3JhbmdlJ107XG4vLyBUT0RPOiBSZW5hbWUgdGhlIGZpbHRlciBwbHVnaW5zIGFuZCByZW1vdmUgdGhpcyBtYXBwaW5nXG5jb25zdCBGSUxURVJfVFlQRV9OQU1FX01BUFBJTkcgPSB7XG4gICAgW3QoJ1NlbGVjdCBmaWx0ZXInKV06IHQoJ1ZhbHVlJyksXG4gICAgW3QoJ1JhbmdlIGZpbHRlcicpXTogdCgnTnVtZXJpY2FsIHJhbmdlJyksXG4gICAgW3QoJ1RpbWUgZmlsdGVyJyldOiB0KCdUaW1lIHJhbmdlJyksXG4gICAgW3QoJ1RpbWUgY29sdW1uJyldOiB0KCdUaW1lIGNvbHVtbicpLFxuICAgIFt0KCdUaW1lIGdyYWluJyldOiB0KCdUaW1lIGdyYWluJyksXG4gICAgW3QoJ0dyb3VwIEJ5JyldOiB0KCdHcm91cCBieScpLFxufTtcbi8qKlxuICogVGhlIGNvbmZpZ3VyYXRpb24gZm9ybSBmb3IgYSBzcGVjaWZpYyBmaWx0ZXIuXG4gKiBBc3NpZ25zIGZpZWxkIHZhbHVlcyB0byBgZmlsdGVyc1tmaWx0ZXJJZF1gIGluIHRoZSBmb3JtLlxuICovXG5jb25zdCBGaWx0ZXJzQ29uZmlnRm9ybSA9ICh7IGV4cGFuZGVkLCBmaWx0ZXJJZCwgZmlsdGVyVG9FZGl0LCByZW1vdmVkRmlsdGVycywgZm9ybSwgZ2V0QXZhaWxhYmxlRmlsdGVycywgYWN0aXZlRmlsdGVyUGFuZWxLZXlzLCByZXN0b3JlRmlsdGVyLCBoYW5kbGVBY3RpdmVGaWx0ZXJQYW5lbENoYW5nZSwgc2V0RXJyb3JlZEZpbHRlcnMsIHZhbGlkYXRlRGVwZW5kZW5jaWVzLCBnZXREZXBlbmRlbmN5U3VnZ2VzdGlvbiwgaXNBY3RpdmUsIH0sIHJlZikgPT4ge1xuICAgIGNvbnN0IGlzUmVtb3ZlZCA9ICEhcmVtb3ZlZEZpbHRlcnNbZmlsdGVySWRdO1xuICAgIGNvbnN0IFtlcnJvciwgc2V0RXJyb3JdID0gdXNlU3RhdGUoKTtcbiAgICBjb25zdCBbbWV0cmljcywgc2V0TWV0cmljc10gPSB1c2VTdGF0ZShbXSk7XG4gICAgY29uc3QgW2FjdGl2ZVRhYktleSwgc2V0QWN0aXZlVGFiS2V5XSA9IHVzZVN0YXRlKEZpbHRlclRhYnMuY29uZmlndXJhdGlvbi5rZXkpO1xuICAgIGNvbnN0IGRhc2hib2FyZElkID0gdXNlU2VsZWN0b3Ioc3RhdGUgPT4gc3RhdGUuZGFzaGJvYXJkSW5mby5pZCk7XG4gICAgY29uc3QgW3VuZG9Gb3JtVmFsdWVzLCBzZXRVbmRvRm9ybVZhbHVlc10gPSB1c2VTdGF0ZShudWxsKTtcbiAgICBjb25zdCBmb3JjZVVwZGF0ZSA9IHVzZUZvcmNlVXBkYXRlKGlzQWN0aXZlKTtcbiAgICBjb25zdCBbZGF0YXNldERldGFpbHMsIHNldERhdGFzZXREZXRhaWxzXSA9IHVzZVN0YXRlKCk7XG4gICAgY29uc3QgZGVmYXVsdEZvcm1GaWx0ZXIgPSB1c2VNZW1vKCgpID0+ICh7fSksIFtdKTtcbiAgICBjb25zdCBmaWx0ZXJzID0gZm9ybS5nZXRGaWVsZFZhbHVlKCdmaWx0ZXJzJyk7XG4gICAgY29uc3QgZm9ybVZhbHVlcyA9IGZpbHRlcnM/LltmaWx0ZXJJZF07XG4gICAgY29uc3QgZm9ybUZpbHRlciA9IGZvcm1WYWx1ZXMgfHwgdW5kb0Zvcm1WYWx1ZXMgfHwgZGVmYXVsdEZvcm1GaWx0ZXI7XG4gICAgY29uc3QgZGVwZW5kZW5jaWVzID0gZm9ybUZpbHRlcj8uZGVwZW5kZW5jaWVzIHx8IGZpbHRlclRvRWRpdD8uY2FzY2FkZVBhcmVudElkcyB8fCBbXTtcbiAgICBjb25zdCBuYXRpdmVGaWx0ZXJJdGVtcyA9IGdldENoYXJ0TWV0YWRhdGFSZWdpc3RyeSgpLml0ZW1zO1xuICAgIGNvbnN0IG5hdGl2ZUZpbHRlclZpelR5cGVzID0gT2JqZWN0LmVudHJpZXMobmF0aXZlRmlsdGVySXRlbXMpXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgLmZpbHRlcigoWywgeyB2YWx1ZSB9XSkgPT4gdmFsdWUuYmVoYXZpb3JzPy5pbmNsdWRlcyhCZWhhdmlvci5OYXRpdmVGaWx0ZXIpKVxuICAgICAgICAubWFwKChba2V5XSkgPT4ga2V5KTtcbiAgICBjb25zdCBsb2FkZWREYXRhc2V0cyA9IHVzZVNlbGVjdG9yKCh7IGRhdGFzb3VyY2VzIH0pID0+IGRhdGFzb3VyY2VzKTtcbiAgICBjb25zdCBjaGFydHMgPSB1c2VTZWxlY3RvcigoeyBjaGFydHMgfSkgPT4gY2hhcnRzKTtcbiAgICBjb25zdCBkb0xvYWRlZERhdGFzZXRzSGF2ZVRlbXBvcmFsQ29sdW1ucyA9IHVzZU1lbW8oKCkgPT4gT2JqZWN0LnZhbHVlcyhsb2FkZWREYXRhc2V0cykuc29tZShkYXRhc2V0ID0+IGhhc1RlbXBvcmFsQ29sdW1ucyhkYXRhc2V0KSksIFtsb2FkZWREYXRhc2V0c10pO1xuICAgIGNvbnN0IHNob3dUaW1lUmFuZ2VQaWNrZXIgPSB1c2VNZW1vKCgpID0+IHtcbiAgICAgICAgY29uc3QgY3VycmVudERhdGFzZXQgPSBPYmplY3QudmFsdWVzKGxvYWRlZERhdGFzZXRzKS5maW5kKGRhdGFzZXQgPT4gZGF0YXNldC5pZCA9PT0gZm9ybUZpbHRlcj8uZGF0YXNldD8udmFsdWUpO1xuICAgICAgICByZXR1cm4gY3VycmVudERhdGFzZXQgPyBoYXNUZW1wb3JhbENvbHVtbnMoY3VycmVudERhdGFzZXQpIDogdHJ1ZTtcbiAgICB9LCBbZm9ybUZpbHRlcj8uZGF0YXNldD8udmFsdWUsIGxvYWRlZERhdGFzZXRzXSk7XG4gICAgY29uc3QgaGFzRGF0YXNldCA9IFxuICAgIC8vIEB0cy1pZ25vcmVcbiAgICAhIW5hdGl2ZUZpbHRlckl0ZW1zW2Zvcm1GaWx0ZXI/LmZpbHRlclR5cGVdPy52YWx1ZT8uZGF0YXNvdXJjZUNvdW50O1xuICAgIGNvbnN0IGRhdGFzZXRJZCA9IGZvcm1GaWx0ZXI/LmRhdGFzZXQ/LnZhbHVlID8/XG4gICAgICAgIGZpbHRlclRvRWRpdD8udGFyZ2V0c1swXT8uZGF0YXNldElkID8/XG4gICAgICAgIG1vc3RVc2VkRGF0YXNldChsb2FkZWREYXRhc2V0cywgY2hhcnRzKTtcbiAgICBjb25zdCB7IGNvbnRyb2xJdGVtcyA9IHt9LCBtYWluQ29udHJvbEl0ZW1zID0ge30gfSA9IGZvcm1GaWx0ZXJcbiAgICAgICAgPyBnZXRDb250cm9sSXRlbXNNYXAoe1xuICAgICAgICAgICAgZXhwYW5kZWQsXG4gICAgICAgICAgICBkYXRhc2V0SWQsXG4gICAgICAgICAgICBkaXNhYmxlZDogZmFsc2UsXG4gICAgICAgICAgICBmb3JjZVVwZGF0ZSxcbiAgICAgICAgICAgIGZvcm0sXG4gICAgICAgICAgICBmaWx0ZXJJZCxcbiAgICAgICAgICAgIGZpbHRlclR5cGU6IGZvcm1GaWx0ZXI/LmZpbHRlclR5cGUsXG4gICAgICAgICAgICBmaWx0ZXJUb0VkaXQsXG4gICAgICAgICAgICBmb3JtRmlsdGVyLFxuICAgICAgICAgICAgcmVtb3ZlZDogaXNSZW1vdmVkLFxuICAgICAgICB9KVxuICAgICAgICA6IHt9O1xuICAgIGNvbnN0IGhhc0NvbHVtbiA9ICEhbWFpbkNvbnRyb2xJdGVtcy5ncm91cGJ5O1xuICAgIGNvbnN0IG5hdGl2ZUZpbHRlckl0ZW0gPSBuYXRpdmVGaWx0ZXJJdGVtc1tmb3JtRmlsdGVyPy5maWx0ZXJUeXBlXSA/PyB7fTtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgY29uc3QgZW5hYmxlTm9SZXN1bHRzID0gISFuYXRpdmVGaWx0ZXJJdGVtLnZhbHVlPy5lbmFibGVOb1Jlc3VsdHM7XG4gICAgY29uc3QgaGFzTWV0cmljcyA9IGhhc0NvbHVtbiAmJiAhIW1ldHJpY3MubGVuZ3RoO1xuICAgIGNvbnN0IGhhc0ZpbGxlZERhdGFzZXQgPSAhaGFzRGF0YXNldCB8fCAoZGF0YXNldElkICYmIChmb3JtRmlsdGVyPy5jb2x1bW4gfHwgIWhhc0NvbHVtbikpO1xuICAgIGNvbnN0IGhhc0FkZGl0aW9uYWxGaWx0ZXJzID0gRklMVEVSU19XSVRIX0FESE9DX0ZJTFRFUlMuaW5jbHVkZXMoZm9ybUZpbHRlcj8uZmlsdGVyVHlwZSk7XG4gICAgY29uc3QgY2FuRGVwZW5kT25PdGhlckZpbHRlcnMgPSBUWVBFU19TVVBQT1JUX0RFUEVOREVOQ0lFUy5pbmNsdWRlcyhmb3JtRmlsdGVyPy5maWx0ZXJUeXBlKTtcbiAgICBjb25zdCBpc0RhdGFEaXJ0eSA9IGZvcm1GaWx0ZXI/LmlzRGF0YURpcnR5ID8/IHRydWU7XG4gICAgY29uc3Qgc2V0TmF0aXZlRmlsdGVyRmllbGRWYWx1ZXNXcmFwcGVyID0gKHZhbHVlcykgPT4ge1xuICAgICAgICBzZXROYXRpdmVGaWx0ZXJGaWVsZFZhbHVlcyhmb3JtLCBmaWx0ZXJJZCwgdmFsdWVzKTtcbiAgICAgICAgc2V0RXJyb3IodW5kZWZpbmVkKTtcbiAgICAgICAgZm9yY2VVcGRhdGUoKTtcbiAgICB9O1xuICAgIGNvbnN0IHNldEVycm9yV3JhcHBlciA9IChlcnJvcikgPT4ge1xuICAgICAgICBzZXROYXRpdmVGaWx0ZXJGaWVsZFZhbHVlcyhmb3JtLCBmaWx0ZXJJZCwge1xuICAgICAgICAgICAgZGVmYXVsdFZhbHVlUXVlcmllc0RhdGE6IG51bGwsXG4gICAgICAgIH0pO1xuICAgICAgICBzZXRFcnJvcihlcnJvcik7XG4gICAgICAgIGZvcmNlVXBkYXRlKCk7XG4gICAgfTtcbiAgICAvLyBDYWxjdWxhdGVzIHRoZSBkZXBlbmRlbmNpZXMgZGVmYXVsdCB2YWx1ZXMgdG8gYmUgdXNlZFxuICAgIC8vIHRvIGV4dHJhY3QgdGhlIGF2YWlsYWJsZSB2YWx1ZXMgdG8gdGhlIGZpbHRlclxuICAgIGxldCBkZXBlbmRlbmNpZXNEZWZhdWx0VmFsdWVzID0ge307XG4gICAgaWYgKGRlcGVuZGVuY2llcyAmJiBkZXBlbmRlbmNpZXMubGVuZ3RoID4gMCAmJiBmaWx0ZXJzKSB7XG4gICAgICAgIGRlcGVuZGVuY2llcy5mb3JFYWNoKGRlcGVuZGVuY3kgPT4ge1xuICAgICAgICAgICAgY29uc3QgZXh0cmFGb3JtRGF0YSA9IGZpbHRlcnNbZGVwZW5kZW5jeV0/LmRlZmF1bHREYXRhTWFzaz8uZXh0cmFGb3JtRGF0YTtcbiAgICAgICAgICAgIGRlcGVuZGVuY2llc0RlZmF1bHRWYWx1ZXMgPSBtZXJnZUV4dHJhRm9ybURhdGEoZGVwZW5kZW5jaWVzRGVmYXVsdFZhbHVlcywgZXh0cmFGb3JtRGF0YSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBkZXBlbmRlbmNpZXNUZXh0ID0gSlNPTi5zdHJpbmdpZnkoZGVwZW5kZW5jaWVzRGVmYXVsdFZhbHVlcyk7XG4gICAgY29uc3QgcmVmcmVzaEhhbmRsZXIgPSB1c2VDYWxsYmFjaygoZm9yY2UgPSBmYWxzZSkgPT4ge1xuICAgICAgICBpZiAoIWhhc0RhdGFzZXQgfHwgIWZvcm1GaWx0ZXI/LmRhdGFzZXQ/LnZhbHVlKSB7XG4gICAgICAgICAgICBmb3JjZVVwZGF0ZSgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGZvcm1EYXRhID0gZ2V0Rm9ybURhdGEoe1xuICAgICAgICAgICAgZGF0YXNldElkOiBmb3JtRmlsdGVyPy5kYXRhc2V0Py52YWx1ZSxcbiAgICAgICAgICAgIGRhc2hib2FyZElkLFxuICAgICAgICAgICAgZ3JvdXBieTogZm9ybUZpbHRlcj8uY29sdW1uLFxuICAgICAgICAgICAgLi4uZm9ybUZpbHRlcixcbiAgICAgICAgfSk7XG4gICAgICAgIGZvcm1EYXRhLmV4dHJhX2Zvcm1fZGF0YSA9IGRlcGVuZGVuY2llc0RlZmF1bHRWYWx1ZXM7XG4gICAgICAgIHNldE5hdGl2ZUZpbHRlckZpZWxkVmFsdWVzV3JhcHBlcih7XG4gICAgICAgICAgICBkZWZhdWx0VmFsdWVRdWVyaWVzRGF0YTogbnVsbCxcbiAgICAgICAgICAgIGlzRGF0YURpcnR5OiBmYWxzZSxcbiAgICAgICAgfSk7XG4gICAgICAgIGdldENoYXJ0RGF0YVJlcXVlc3Qoe1xuICAgICAgICAgICAgZm9ybURhdGEsXG4gICAgICAgICAgICBmb3JjZSxcbiAgICAgICAgfSlcbiAgICAgICAgICAgIC50aGVuKCh7IHJlc3BvbnNlLCBqc29uIH0pID0+IHtcbiAgICAgICAgICAgIGlmIChpc0ZlYXR1cmVFbmFibGVkKEZlYXR1cmVGbGFnLkdsb2JhbEFzeW5jUXVlcmllcykpIHtcbiAgICAgICAgICAgICAgICAvLyBkZWFsIHdpdGggZ2V0Q2hhcnREYXRhUmVxdWVzdCB0cmFuc2Zvcm1pbmcgdGhlIHJlc3BvbnNlIGRhdGFcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSAncmVzdWx0JyBpbiBqc29uID8ganNvbi5yZXN1bHRbMF0gOiBqc29uO1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgICAgICAgICAgICBzZXROYXRpdmVGaWx0ZXJGaWVsZFZhbHVlc1dyYXBwZXIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlUXVlcmllc0RhdGE6IFtyZXN1bHRdLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDIpIHtcbiAgICAgICAgICAgICAgICAgICAgd2FpdEZvckFzeW5jRGF0YShyZXN1bHQpXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbigoYXN5bmNSZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldE5hdGl2ZUZpbHRlckZpZWxkVmFsdWVzV3JhcHBlcih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlUXVlcmllc0RhdGE6IGFzeW5jUmVzdWx0LFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRDbGllbnRFcnJvck9iamVjdChlcnJvcikudGhlbihjbGllbnRFcnJvck9iamVjdCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0RXJyb3JXcmFwcGVyKGNsaWVudEVycm9yT2JqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgUmVjZWl2ZWQgdW5leHBlY3RlZCByZXNwb25zZSBzdGF0dXMgKCR7cmVzcG9uc2Uuc3RhdHVzfSkgd2hpbGUgZmV0Y2hpbmcgY2hhcnQgZGF0YWApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHNldE5hdGl2ZUZpbHRlckZpZWxkVmFsdWVzV3JhcHBlcih7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZVF1ZXJpZXNEYXRhOiBqc29uLnJlc3VsdCxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgICAgIGdldENsaWVudEVycm9yT2JqZWN0KGVycm9yKS50aGVuKGNsaWVudEVycm9yT2JqZWN0ID0+IHtcbiAgICAgICAgICAgICAgICBzZXRFcnJvcihjbGllbnRFcnJvck9iamVjdCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSwgW2ZpbHRlcklkLCBmb3JjZVVwZGF0ZSwgZm9ybSwgZm9ybUZpbHRlciwgaGFzRGF0YXNldCwgZGVwZW5kZW5jaWVzVGV4dF0pO1xuICAgIC8vIFRPRE86IHJlZnJlc2hIYW5kbGVyIGNoYW5nZXMgaXRzZWxmIGJlY2F1c2Ugb2YgdGhlIGRlcGVuZGVuY2llcy4gTmVlZHMgcmVmYWN0b3IuXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0LWhvb2tzL2V4aGF1c3RpdmUtZGVwc1xuICAgIHVzZUVmZmVjdCgoKSA9PiByZWZyZXNoSGFuZGxlcigpLCBbZGVwZW5kZW5jaWVzVGV4dF0pO1xuICAgIGNvbnN0IG5ld0Zvcm1EYXRhID0gZ2V0Rm9ybURhdGEoe1xuICAgICAgICBkYXRhc2V0SWQsXG4gICAgICAgIGdyb3VwYnk6IGhhc0NvbHVtbiA/IGZvcm1GaWx0ZXI/LmNvbHVtbiA6IHVuZGVmaW5lZCxcbiAgICAgICAgLi4uZm9ybUZpbHRlcixcbiAgICB9KTtcbiAgICBuZXdGb3JtRGF0YS5leHRyYV9mb3JtX2RhdGEgPSBkZXBlbmRlbmNpZXNEZWZhdWx0VmFsdWVzO1xuICAgIGNvbnN0IFtoYXNEZWZhdWx0VmFsdWUsIGlzUmVxdWlyZWQsIGRlZmF1bHRWYWx1ZVRvb2x0aXAsIHNldEhhc0RlZmF1bHRWYWx1ZV0gPSB1c2VEZWZhdWx0VmFsdWUoZm9ybUZpbHRlciwgZmlsdGVyVG9FZGl0KTtcbiAgICBjb25zdCBzaG93RGF0YXNldCA9ICFkYXRhc2V0SWQgfHwgZGF0YXNldERldGFpbHMgfHwgZm9ybUZpbHRlcj8uZGF0YXNldD8ubGFiZWw7XG4gICAgY29uc3QgZm9ybUNoYW5nZWQgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgICAgIGZvcm0uc2V0RmllbGRzKFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnY2hhbmdlZCcsXG4gICAgICAgICAgICAgICAgdmFsdWU6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICBdKTtcbiAgICB9LCBbZm9ybV0pO1xuICAgIGNvbnN0IHVwZGF0ZUZvcm1WYWx1ZXMgPSB1c2VDYWxsYmFjaygodmFsdWVzKSA9PiB7XG4gICAgICAgIHNldE5hdGl2ZUZpbHRlckZpZWxkVmFsdWVzKGZvcm0sIGZpbHRlcklkLCB2YWx1ZXMpO1xuICAgICAgICBmb3JtQ2hhbmdlZCgpO1xuICAgIH0sIFtmaWx0ZXJJZCwgZm9ybSwgZm9ybUNoYW5nZWRdKTtcbiAgICBjb25zdCBoYXNQcmVGaWx0ZXIgPSAhIWZvcm1GaWx0ZXI/LmFkaG9jX2ZpbHRlcnMgfHxcbiAgICAgICAgISFmb3JtRmlsdGVyPy50aW1lX3JhbmdlIHx8XG4gICAgICAgICEhZmlsdGVyVG9FZGl0Py5hZGhvY19maWx0ZXJzPy5sZW5ndGggfHxcbiAgICAgICAgISFmaWx0ZXJUb0VkaXQ/LnRpbWVfcmFuZ2U7XG4gICAgY29uc3QgaGFzRW5hYmxlU2luZ2xlVmFsdWUgPSBmb3JtRmlsdGVyPy5jb250cm9sVmFsdWVzPy5lbmFibGVTaW5nbGVWYWx1ZSAhPT0gdW5kZWZpbmVkIHx8XG4gICAgICAgIGZpbHRlclRvRWRpdD8uY29udHJvbFZhbHVlcz8uZW5hYmxlU2luZ2xlVmFsdWUgIT09IHVuZGVmaW5lZDtcbiAgICBsZXQgZW5hYmxlU2luZ2xlVmFsdWUgPSBmaWx0ZXJUb0VkaXQ/LmNvbnRyb2xWYWx1ZXM/LmVuYWJsZVNpbmdsZVZhbHVlO1xuICAgIGlmIChmb3JtRmlsdGVyPy5jb250cm9sVmFsdWVzPy5lbmFibGVTaW5nbGVNYXhWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICh7IGVuYWJsZVNpbmdsZVZhbHVlIH0gPSBmb3JtRmlsdGVyLmNvbnRyb2xWYWx1ZXMpO1xuICAgIH1cbiAgICBjb25zdCBoYXNTb3J0aW5nID0gdHlwZW9mIGZvcm1GaWx0ZXI/LmNvbnRyb2xWYWx1ZXM/LnNvcnRBc2NlbmRpbmcgPT09ICdib29sZWFuJyB8fFxuICAgICAgICB0eXBlb2YgZmlsdGVyVG9FZGl0Py5jb250cm9sVmFsdWVzPy5zb3J0QXNjZW5kaW5nID09PSAnYm9vbGVhbic7XG4gICAgbGV0IHNvcnQgPSBmaWx0ZXJUb0VkaXQ/LmNvbnRyb2xWYWx1ZXM/LnNvcnRBc2NlbmRpbmc7XG4gICAgaWYgKHR5cGVvZiBmb3JtRmlsdGVyPy5jb250cm9sVmFsdWVzPy5zb3J0QXNjZW5kaW5nID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgc29ydCA9IGZvcm1GaWx0ZXIuY29udHJvbFZhbHVlcy5zb3J0QXNjZW5kaW5nO1xuICAgIH1cbiAgICBjb25zdCBzaG93RGVmYXVsdFZhbHVlID0gIWhhc0RhdGFzZXQgfHxcbiAgICAgICAgKCFpc0RhdGFEaXJ0eSAmJiBoYXNGaWxsZWREYXRhc2V0KSB8fFxuICAgICAgICAhbWFpbkNvbnRyb2xJdGVtcy5ncm91cGJ5O1xuICAgIGNvbnN0IG9uU29ydENoYW5nZWQgPSAodmFsdWUpID0+IHtcbiAgICAgICAgY29uc3QgcHJldmlvdXMgPSBmb3JtLmdldEZpZWxkVmFsdWUoJ2ZpbHRlcnMnKT8uW2ZpbHRlcklkXS5jb250cm9sVmFsdWVzO1xuICAgICAgICBzZXROYXRpdmVGaWx0ZXJGaWVsZFZhbHVlcyhmb3JtLCBmaWx0ZXJJZCwge1xuICAgICAgICAgICAgY29udHJvbFZhbHVlczoge1xuICAgICAgICAgICAgICAgIC4uLnByZXZpb3VzLFxuICAgICAgICAgICAgICAgIHNvcnRBc2NlbmRpbmc6IHZhbHVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICAgIGZvcmNlVXBkYXRlKCk7XG4gICAgfTtcbiAgICBjb25zdCBvbkVuYWJsZVNpbmdsZVZhbHVlQ2hhbmdlZCA9ICh2YWx1ZSkgPT4ge1xuICAgICAgICBjb25zdCBwcmV2aW91cyA9IGZvcm0uZ2V0RmllbGRWYWx1ZSgnZmlsdGVycycpPy5bZmlsdGVySWRdLmNvbnRyb2xWYWx1ZXM7XG4gICAgICAgIHNldE5hdGl2ZUZpbHRlckZpZWxkVmFsdWVzKGZvcm0sIGZpbHRlcklkLCB7XG4gICAgICAgICAgICBjb250cm9sVmFsdWVzOiB7XG4gICAgICAgICAgICAgICAgLi4ucHJldmlvdXMsXG4gICAgICAgICAgICAgICAgZW5hYmxlU2luZ2xlVmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICAgIGZvcmNlVXBkYXRlKCk7XG4gICAgfTtcbiAgICBjb25zdCB2YWxpZGF0ZVByZUZpbHRlciA9ICgpID0+IHNldFRpbWVvdXQoKCkgPT4gZm9ybS52YWxpZGF0ZUZpZWxkcyhbXG4gICAgICAgIFsnZmlsdGVycycsIGZpbHRlcklkLCAnYWRob2NfZmlsdGVycyddLFxuICAgICAgICBbJ2ZpbHRlcnMnLCBmaWx0ZXJJZCwgJ3RpbWVfcmFuZ2UnXSxcbiAgICBdKSwgMCk7XG4gICAgY29uc3QgaGFzVGltZVJhbmdlID0gZm9ybUZpbHRlcj8udGltZV9yYW5nZSAmJiBmb3JtRmlsdGVyLnRpbWVfcmFuZ2UgIT09ICdObyBmaWx0ZXInO1xuICAgIGNvbnN0IGhhc0FkaG9jID0gZm9ybUZpbHRlcj8uYWRob2NfZmlsdGVycz8ubGVuZ3RoID4gMDtcbiAgICBjb25zdCBkZWZhdWx0VG9GaXJzdEl0ZW0gPSBmb3JtRmlsdGVyPy5jb250cm9sVmFsdWVzPy5kZWZhdWx0VG9GaXJzdEl0ZW07XG4gICAgY29uc3QgaW5pdGlhbERlZmF1bHRWYWx1ZSA9IGZvcm1GaWx0ZXI/LmZpbHRlclR5cGUgPT09IGZpbHRlclRvRWRpdD8uZmlsdGVyVHlwZVxuICAgICAgICA/IGZpbHRlclRvRWRpdD8uZGVmYXVsdERhdGFNYXNrXG4gICAgICAgIDogbnVsbDtcbiAgICBjb25zdCBwcmVGaWx0ZXJWYWxpZGF0b3IgPSAoKSA9PiB7XG4gICAgICAgIGlmIChoYXNUaW1lUmFuZ2UgfHwgaGFzQWRob2MpIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKHQoJ1ByZS1maWx0ZXIgaXMgcmVxdWlyZWQnKSkpO1xuICAgIH07XG4gICAgY29uc3QgYXZhaWxhYmxlRmlsdGVycyA9IGdldEF2YWlsYWJsZUZpbHRlcnMoZmlsdGVySWQpO1xuICAgIGNvbnN0IGhhc0F2YWlsYWJsZUZpbHRlcnMgPSBhdmFpbGFibGVGaWx0ZXJzLmxlbmd0aCA+IDA7XG4gICAgY29uc3QgaGFzVGltZURlcGVuZGVuY3kgPSBhdmFpbGFibGVGaWx0ZXJzXG4gICAgICAgIC5maWx0ZXIoZmlsdGVyID0+IGZpbHRlci50eXBlID09PSAnZmlsdGVyX3RpbWUnKVxuICAgICAgICAuc29tZShmaWx0ZXIgPT4gZGVwZW5kZW5jaWVzPy5pbmNsdWRlcyhmaWx0ZXIudmFsdWUpKTtcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBpZiAoZGF0YXNldElkKSB7XG4gICAgICAgICAgICBjYWNoZWRTdXBlcnNldEdldCh7XG4gICAgICAgICAgICAgICAgZW5kcG9pbnQ6IGAvYXBpL3YxL2RhdGFzZXQvJHtkYXRhc2V0SWR9P3E9JHtyaXNvbi5lbmNvZGUoe1xuICAgICAgICAgICAgICAgICAgICBjb2x1bW5zOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAnY29sdW1ucy5jb2x1bW5fbmFtZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAnY29sdW1ucy5leHByZXNzaW9uJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICdjb2x1bW5zLmZpbHRlcmFibGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2NvbHVtbnMuaXNfZHR0bScsXG4gICAgICAgICAgICAgICAgICAgICAgICAnY29sdW1ucy50eXBlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICdjb2x1bW5zLnZlcmJvc2VfbmFtZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAnZGF0YWJhc2UuaWQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2RhdGFiYXNlLmRhdGFiYXNlX25hbWUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2RhdGFzb3VyY2VfdHlwZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAnZmlsdGVyX3NlbGVjdF9lbmFibGVkJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICdpZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAnaXNfc3FsbGFiX3ZpZXcnLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ21haW5fZHR0bV9jb2wnLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ21ldHJpY3MubWV0cmljX25hbWUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ21ldHJpY3MudmVyYm9zZV9uYW1lJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICdzY2hlbWEnLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ3NxbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAndGFibGVfbmFtZScsXG4gICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgfSl9YCxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgc2V0TWV0cmljcyhyZXNwb25zZS5qc29uPy5yZXN1bHQ/Lm1ldHJpY3MpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGRhdGFzZXQgPSByZXNwb25zZS5qc29uPy5yZXN1bHQ7XG4gICAgICAgICAgICAgICAgLy8gbW9kaWZ5IHRoZSByZXNwb25zZSB0byBmaXQgc3RydWN0dXJlIGV4cGVjdGVkIGJ5IEFkaG9jRmlsdGVyQ29udHJvbFxuICAgICAgICAgICAgICAgIGRhdGFzZXQudHlwZSA9IGRhdGFzZXQuZGF0YXNvdXJjZV90eXBlO1xuICAgICAgICAgICAgICAgIGRhdGFzZXQuZmlsdGVyX3NlbGVjdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgc2V0RGF0YXNldERldGFpbHMoZGF0YXNldCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaCgocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICBhZGREYW5nZXJUb2FzdChyZXNwb25zZS5tZXNzYWdlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSwgW2RhdGFzZXRJZF0pO1xuICAgIHVzZUltcGVyYXRpdmVIYW5kbGUocmVmLCAoKSA9PiAoe1xuICAgICAgICBjaGFuZ2VUYWIodGFiKSB7XG4gICAgICAgICAgICBzZXRBY3RpdmVUYWJLZXkodGFiKTtcbiAgICAgICAgfSxcbiAgICB9KSk7XG4gICAgdXNlQmFja2VuZEZvcm1VcGRhdGUoZm9ybSwgZmlsdGVySWQpO1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIGlmIChoYXNEYXRhc2V0ICYmIGhhc0ZpbGxlZERhdGFzZXQgJiYgaGFzRGVmYXVsdFZhbHVlICYmIGlzRGF0YURpcnR5KSB7XG4gICAgICAgICAgICByZWZyZXNoSGFuZGxlcigpO1xuICAgICAgICB9XG4gICAgfSwgW1xuICAgICAgICBoYXNEYXRhc2V0LFxuICAgICAgICBoYXNGaWxsZWREYXRhc2V0LFxuICAgICAgICBoYXNEZWZhdWx0VmFsdWUsXG4gICAgICAgIGlzRGF0YURpcnR5LFxuICAgICAgICByZWZyZXNoSGFuZGxlcixcbiAgICAgICAgc2hvd0RhdGFzZXQsXG4gICAgXSk7XG4gICAgY29uc3QgaW5pdGlhbGx5RXhjbHVkZWRDaGFydHMgPSB1c2VNZW1vKCgpID0+IHtcbiAgICAgICAgY29uc3QgZXhjbHVkZWQgPSBbXTtcbiAgICAgICAgaWYgKGZvcm1GaWx0ZXI/LmRhdGFzZXQ/LnZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBPYmplY3QudmFsdWVzKGNoYXJ0cykuZm9yRWFjaCgoY2hhcnQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNoYXJ0RGF0YXNldFVpZCA9IGNoYXJ0LmZvcm1fZGF0YT8uZGF0YXNvdXJjZTtcbiAgICAgICAgICAgIGlmIChjaGFydERhdGFzZXRVaWQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChsb2FkZWREYXRhc2V0c1tjaGFydERhdGFzZXRVaWRdPy5pZCAhPT0gZm9ybUZpbHRlcj8uZGF0YXNldD8udmFsdWUpIHtcbiAgICAgICAgICAgICAgICBleGNsdWRlZC5wdXNoKGNoYXJ0LmlkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBleGNsdWRlZDtcbiAgICB9LCBbXG4gICAgICAgIEpTT04uc3RyaW5naWZ5KGNoYXJ0cyksXG4gICAgICAgIGZvcm1GaWx0ZXI/LmRhdGFzZXQ/LnZhbHVlLFxuICAgICAgICBKU09OLnN0cmluZ2lmeShsb2FkZWREYXRhc2V0cyksXG4gICAgXSk7XG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgLy8ganVzdCByZW1vdmVkLCBzYXZpbmcgY3VycmVudCBmb3JtIGl0ZW1zIGZvciBldmVudHVhbCB1bmRvXG4gICAgICAgIGlmIChpc1JlbW92ZWQpIHtcbiAgICAgICAgICAgIHNldFVuZG9Gb3JtVmFsdWVzKGZvcm1WYWx1ZXMpO1xuICAgICAgICB9XG4gICAgfSwgW2lzUmVtb3ZlZF0pO1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIC8vIHRoZSBmaWx0ZXIgd2FzIGp1c3QgcmVzdG9yZWQgYWZ0ZXIgdW5kb1xuICAgICAgICBpZiAodW5kb0Zvcm1WYWx1ZXMgJiYgIWlzUmVtb3ZlZCkge1xuICAgICAgICAgICAgc2V0TmF0aXZlRmlsdGVyRmllbGRWYWx1ZXMoZm9ybSwgZmlsdGVySWQsIHVuZG9Gb3JtVmFsdWVzKTtcbiAgICAgICAgICAgIHNldFVuZG9Gb3JtVmFsdWVzKG51bGwpO1xuICAgICAgICB9XG4gICAgfSwgW2Zvcm1WYWx1ZXMsIGZpbHRlcklkLCBmb3JtLCBpc1JlbW92ZWQsIHVuZG9Gb3JtVmFsdWVzXSk7XG4gICAgaWYgKGlzUmVtb3ZlZCkge1xuICAgICAgICByZXR1cm4gPFJlbW92ZWRGaWx0ZXIgb25DbGljaz17KCkgPT4gcmVzdG9yZUZpbHRlcihmaWx0ZXJJZCl9Lz47XG4gICAgfVxuICAgIGNvbnN0IHRpbWVDb2x1bW4gPSAoPFN0eWxlZFJvd0Zvcm1JdGVtIGV4cGFuZGVkPXtleHBhbmRlZH0gbmFtZT17WydmaWx0ZXJzJywgZmlsdGVySWQsICdncmFudWxhcml0eV9zcWxhJ119IGxhYmVsPXs8PlxuICAgICAgICAgIDxTdHlsZWRMYWJlbD57dCgnVGltZSBjb2x1bW4nKX08L1N0eWxlZExhYmVsPiZuYnNwO1xuICAgICAgICAgIDxJbmZvVG9vbHRpcFdpdGhUcmlnZ2VyIHBsYWNlbWVudD1cInRvcFwiIHRvb2x0aXA9e2hhc1RpbWVEZXBlbmRlbmN5XG4gICAgICAgICAgICAgICAgPyB0KCdUaW1lIGNvbHVtbiB0byBhcHBseSBkZXBlbmRlbnQgdGVtcG9yYWwgZmlsdGVyIHRvJylcbiAgICAgICAgICAgICAgICA6IHQoJ1RpbWUgY29sdW1uIHRvIGFwcGx5IHRpbWUgcmFuZ2UgdG8nKX0vPlxuICAgICAgICA8Lz59IGluaXRpYWxWYWx1ZT17ZmlsdGVyVG9FZGl0Py5ncmFudWxhcml0eV9zcWxhfT5cbiAgICAgIDxDb2x1bW5TZWxlY3QgYWxsb3dDbGVhciBmb3JtPXtmb3JtfSBmb3JtRmllbGQ9XCJncmFudWxhcml0eV9zcWxhXCIgZmlsdGVySWQ9e2ZpbHRlcklkfSBmaWx0ZXJWYWx1ZXM9eyhjb2x1bW4pID0+ICEhY29sdW1uLmlzX2R0dG19IGRhdGFzZXRJZD17ZGF0YXNldElkfSBvbkNoYW5nZT17Y29sdW1uID0+IHtcbiAgICAgICAgICAgIC8vIFdlIG5lZWQgcmVzZXQgZGVmYXVsdCB2YWx1ZSB3aGVuIHdoZW4gY29sdW1uIGNoYW5nZWRcbiAgICAgICAgICAgIHNldE5hdGl2ZUZpbHRlckZpZWxkVmFsdWVzKGZvcm0sIGZpbHRlcklkLCB7XG4gICAgICAgICAgICAgICAgZ3JhbnVsYXJpdHlfc3FsYTogY29sdW1uLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBmb3JjZVVwZGF0ZSgpO1xuICAgICAgICB9fS8+XG4gICAgPC9TdHlsZWRSb3dGb3JtSXRlbT4pO1xuICAgIHJldHVybiAoPFN0eWxlZFRhYnMgYWN0aXZlS2V5PXthY3RpdmVUYWJLZXl9IG9uQ2hhbmdlPXthY3RpdmVLZXkgPT4gc2V0QWN0aXZlVGFiS2V5KGFjdGl2ZUtleSl9IGNlbnRlcmVkPlxuICAgICAgPFRhYlBhbmUgdGFiPXtGaWx0ZXJUYWJzLmNvbmZpZ3VyYXRpb24ubmFtZX0ga2V5PXtGaWx0ZXJUYWJzLmNvbmZpZ3VyYXRpb24ua2V5fSBmb3JjZVJlbmRlcj5cbiAgICAgICAgPFN0eWxlZENvbnRhaW5lcj5cbiAgICAgICAgICA8U3R5bGVkRm9ybUl0ZW0gZXhwYW5kZWQ9e2V4cGFuZGVkfSBuYW1lPXtbJ2ZpbHRlcnMnLCBmaWx0ZXJJZCwgJ3R5cGUnXX0gaGlkZGVuIGluaXRpYWxWYWx1ZT17TmF0aXZlRmlsdGVyVHlwZS5OYXRpdmVGaWx0ZXJ9PlxuICAgICAgICAgICAgPElucHV0IC8+XG4gICAgICAgICAgPC9TdHlsZWRGb3JtSXRlbT5cbiAgICAgICAgICA8U3R5bGVkRm9ybUl0ZW0gZXhwYW5kZWQ9e2V4cGFuZGVkfSBuYW1lPXtbJ2ZpbHRlcnMnLCBmaWx0ZXJJZCwgJ25hbWUnXX0gbGFiZWw9ezxTdHlsZWRMYWJlbD57dCgnRmlsdGVyIG5hbWUnKX08L1N0eWxlZExhYmVsPn0gaW5pdGlhbFZhbHVlPXtmaWx0ZXJUb0VkaXQ/Lm5hbWV9IHJ1bGVzPXtbeyByZXF1aXJlZDogIWlzUmVtb3ZlZCwgbWVzc2FnZTogdCgnTmFtZSBpcyByZXF1aXJlZCcpIH1dfT5cbiAgICAgICAgICAgIDxJbnB1dCB7Li4uZ2V0RmlsdGVyc0NvbmZpZ01vZGFsVGVzdElkKCduYW1lLWlucHV0Jyl9Lz5cbiAgICAgICAgICA8L1N0eWxlZEZvcm1JdGVtPlxuICAgICAgICAgIDxTdHlsZWRGb3JtSXRlbSBleHBhbmRlZD17ZXhwYW5kZWR9IG5hbWU9e1snZmlsdGVycycsIGZpbHRlcklkLCAnZmlsdGVyVHlwZSddfSBydWxlcz17W3sgcmVxdWlyZWQ6ICFpc1JlbW92ZWQsIG1lc3NhZ2U6IHQoJ05hbWUgaXMgcmVxdWlyZWQnKSB9XX0gaW5pdGlhbFZhbHVlPXtmaWx0ZXJUb0VkaXQ/LmZpbHRlclR5cGUgfHwgJ2ZpbHRlcl9zZWxlY3QnfSBsYWJlbD17PFN0eWxlZExhYmVsPnt0KCdGaWx0ZXIgVHlwZScpfTwvU3R5bGVkTGFiZWw+fSB7Li4uZ2V0RmlsdGVyc0NvbmZpZ01vZGFsVGVzdElkKCdmaWx0ZXItdHlwZScpfT5cbiAgICAgICAgICAgIDxTZWxlY3QgYXJpYUxhYmVsPXt0KCdGaWx0ZXIgdHlwZScpfSBvcHRpb25zPXtuYXRpdmVGaWx0ZXJWaXpUeXBlcy5tYXAoZmlsdGVyVHlwZSA9PiB7XG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBjb25zdCBuYW1lID0gbmF0aXZlRmlsdGVySXRlbXNbZmlsdGVyVHlwZV0/LnZhbHVlLm5hbWU7XG4gICAgICAgICAgICBjb25zdCBtYXBwZWROYW1lID0gbmFtZVxuICAgICAgICAgICAgICAgID8gRklMVEVSX1RZUEVfTkFNRV9NQVBQSU5HW25hbWVdXG4gICAgICAgICAgICAgICAgOiB1bmRlZmluZWQ7XG4gICAgICAgICAgICBjb25zdCBpc0Rpc2FibGVkID0gRklMVEVSX1NVUFBPUlRFRF9UWVBFU1tmaWx0ZXJUeXBlXT8ubGVuZ3RoID09PSAxICYmXG4gICAgICAgICAgICAgICAgRklMVEVSX1NVUFBPUlRFRF9UWVBFU1tmaWx0ZXJUeXBlXT8uaW5jbHVkZXMoR2VuZXJpY0RhdGFUeXBlLlRlbXBvcmFsKSAmJlxuICAgICAgICAgICAgICAgICFkb0xvYWRlZERhdGFzZXRzSGF2ZVRlbXBvcmFsQ29sdW1ucztcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IGZpbHRlclR5cGUsXG4gICAgICAgICAgICAgICAgbGFiZWw6IG1hcHBlZE5hbWUgfHwgbmFtZSxcbiAgICAgICAgICAgICAgICBjdXN0b21MYWJlbDogaXNEaXNhYmxlZCA/ICg8VG9vbHRpcCB0aXRsZT17dCgnRGF0YXNldHMgZG8gbm90IGNvbnRhaW4gYSB0ZW1wb3JhbCBjb2x1bW4nKX0+XG4gICAgICAgICAgICAgICAgICAgICAge21hcHBlZE5hbWUgfHwgbmFtZX1cbiAgICAgICAgICAgICAgICAgICAgPC9Ub29sdGlwPikgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgZGlzYWJsZWQ6IGlzRGlzYWJsZWQsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KX0gb25DaGFuZ2U9e3ZhbHVlID0+IHtcbiAgICAgICAgICAgIHNldE5hdGl2ZUZpbHRlckZpZWxkVmFsdWVzKGZvcm0sIGZpbHRlcklkLCB7XG4gICAgICAgICAgICAgICAgZmlsdGVyVHlwZTogdmFsdWUsXG4gICAgICAgICAgICAgICAgZGVmYXVsdERhdGFNYXNrOiBudWxsLFxuICAgICAgICAgICAgICAgIGNvbHVtbjogbnVsbCxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZm9yY2VVcGRhdGUoKTtcbiAgICAgICAgfX0vPlxuICAgICAgICAgIDwvU3R5bGVkRm9ybUl0ZW0+XG4gICAgICAgIDwvU3R5bGVkQ29udGFpbmVyPlxuICAgICAgICB7Zm9ybUZpbHRlcj8uZmlsdGVyVHlwZSA9PT0gJ2ZpbHRlcl90aW1lJyAmJiAoPEZpbHRlclR5cGVJbmZvIGV4cGFuZGVkPXtleHBhbmRlZH0+XG4gICAgICAgICAgICB7dChgRGFzaGJvYXJkIHRpbWUgcmFuZ2UgZmlsdGVycyBhcHBseSB0byB0ZW1wb3JhbCBjb2x1bW5zIGRlZmluZWQgaW5cbiAgICAgICAgICB0aGUgZmlsdGVyIHNlY3Rpb24gb2YgZWFjaCBjaGFydC4gQWRkIHRlbXBvcmFsIGNvbHVtbnMgdG8gdGhlIGNoYXJ0XG4gICAgICAgICAgZmlsdGVycyB0byBoYXZlIHRoaXMgZGFzaGJvYXJkIGZpbHRlciBpbXBhY3QgdGhvc2UgY2hhcnRzLmApfVxuICAgICAgICAgIDwvRmlsdGVyVHlwZUluZm8+KX1cbiAgICAgICAge2hhc0RhdGFzZXQgJiYgKDxTdHlsZWRSb3dDb250YWluZXI+XG4gICAgICAgICAgICB7c2hvd0RhdGFzZXQgPyAoPFN0eWxlZEZvcm1JdGVtIGV4cGFuZGVkPXtleHBhbmRlZH0gbmFtZT17WydmaWx0ZXJzJywgZmlsdGVySWQsICdkYXRhc2V0J119IGxhYmVsPXs8U3R5bGVkTGFiZWw+e3QoJ0RhdGFzZXQnKX08L1N0eWxlZExhYmVsPn0gaW5pdGlhbFZhbHVlPXtkYXRhc2V0RGV0YWlsc1xuICAgICAgICAgICAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiBEYXRhc2V0U2VsZWN0TGFiZWwoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBkYXRhc2V0RGV0YWlscy5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZV9uYW1lOiBkYXRhc2V0RGV0YWlscy50YWJsZV9uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVtYTogZGF0YXNldERldGFpbHMuc2NoZW1hLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFiYXNlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFiYXNlX25hbWU6IGRhdGFzZXREZXRhaWxzLmRhdGFiYXNlLmRhdGFiYXNlX25hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGRhdGFzZXREZXRhaWxzLmlkLFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkfSBydWxlcz17W1xuICAgICAgICAgICAgICAgICAgICB7IHJlcXVpcmVkOiAhaXNSZW1vdmVkLCBtZXNzYWdlOiB0KCdEYXRhc2V0IGlzIHJlcXVpcmVkJykgfSxcbiAgICAgICAgICAgICAgICBdfSB7Li4uZ2V0RmlsdGVyc0NvbmZpZ01vZGFsVGVzdElkKCdkYXRhc291cmNlLWlucHV0Jyl9PlxuICAgICAgICAgICAgICAgIDxEYXRhc2V0U2VsZWN0IG9uQ2hhbmdlPXsodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gV2UgbmVlZCB0byByZXNldCB0aGUgY29sdW1uIHdoZW4gdGhlIGRhdGFzZXQgaGFzIGNoYW5nZWRcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnZhbHVlICE9PSBkYXRhc2V0SWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldE5hdGl2ZUZpbHRlckZpZWxkVmFsdWVzKGZvcm0sIGZpbHRlcklkLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YXNldDogdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdERhdGFNYXNrOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbjogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKCk7XG4gICAgICAgICAgICAgICAgfX0vPlxuICAgICAgICAgICAgICA8L1N0eWxlZEZvcm1JdGVtPikgOiAoPFN0eWxlZEZvcm1JdGVtIGV4cGFuZGVkPXtleHBhbmRlZH0gbGFiZWw9ezxTdHlsZWRMYWJlbD57dCgnRGF0YXNldCcpfTwvU3R5bGVkTGFiZWw+fT5cbiAgICAgICAgICAgICAgICA8TG9hZGluZyBwb3NpdGlvbj1cImlubGluZS1jZW50ZXJlZFwiLz5cbiAgICAgICAgICAgICAgPC9TdHlsZWRGb3JtSXRlbT4pfVxuICAgICAgICAgICAge2hhc0RhdGFzZXQgJiZcbiAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhtYWluQ29udHJvbEl0ZW1zKS5tYXAoa2V5ID0+IG1haW5Db250cm9sSXRlbXNba2V5XS5lbGVtZW50KX1cbiAgICAgICAgICA8L1N0eWxlZFJvd0NvbnRhaW5lcj4pfVxuICAgICAgICA8U3R5bGVkQ29sbGFwc2UgZGVmYXVsdEFjdGl2ZUtleT17YWN0aXZlRmlsdGVyUGFuZWxLZXlzfSBvbkNoYW5nZT17a2V5ID0+IHtcbiAgICAgICAgICAgIGhhbmRsZUFjdGl2ZUZpbHRlclBhbmVsQ2hhbmdlKGtleSk7XG4gICAgICAgIH19IGV4cGFuZEljb25Qb3NpdGlvbj1cInJpZ2h0XCIga2V5PXtgbmF0aXZlLWZpbHRlci1jb25maWctJHtmaWx0ZXJJZH1gfT5cbiAgICAgICAgICB7Zm9ybUZpbHRlcj8uZmlsdGVyVHlwZSAhPT0gJ2ZpbHRlcl90aW1lJyAmJiAoPENvbGxhcHNlLlBhbmVsIGZvcmNlUmVuZGVyIGhlYWRlcj17RmlsdGVyUGFuZWxzLmNvbmZpZ3VyYXRpb24ubmFtZX0ga2V5PXtgJHtmaWx0ZXJJZH0tJHtGaWx0ZXJQYW5lbHMuY29uZmlndXJhdGlvbi5rZXl9YH0+XG4gICAgICAgICAgICAgIHtjYW5EZXBlbmRPbk90aGVyRmlsdGVycyAmJiBoYXNBdmFpbGFibGVGaWx0ZXJzICYmICg8U3R5bGVkUm93Rm9ybUl0ZW0gZXhwYW5kZWQ9e2V4cGFuZGVkfSBuYW1lPXtbJ2ZpbHRlcnMnLCBmaWx0ZXJJZCwgJ2RlcGVuZGVuY2llcyddfSBpbml0aWFsVmFsdWU9e2RlcGVuZGVuY2llc30+XG4gICAgICAgICAgICAgICAgICA8RGVwZW5kZW5jeUxpc3QgYXZhaWxhYmxlRmlsdGVycz17YXZhaWxhYmxlRmlsdGVyc30gZGVwZW5kZW5jaWVzPXtkZXBlbmRlbmNpZXN9IG9uRGVwZW5kZW5jaWVzQ2hhbmdlPXtkZXBlbmRlbmNpZXMgPT4ge1xuICAgICAgICAgICAgICAgICAgICBzZXROYXRpdmVGaWx0ZXJGaWVsZFZhbHVlcyhmb3JtLCBmaWx0ZXJJZCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVwZW5kZW5jaWVzLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGVEZXBlbmRlbmNpZXMoKTtcbiAgICAgICAgICAgICAgICAgICAgZm9ybUNoYW5nZWQoKTtcbiAgICAgICAgICAgICAgICB9fSBnZXREZXBlbmRlbmN5U3VnZ2VzdGlvbj17KCkgPT4gZ2V0RGVwZW5kZW5jeVN1Z2dlc3Rpb24oZmlsdGVySWQpfT5cbiAgICAgICAgICAgICAgICAgICAge2hhc1RpbWVEZXBlbmRlbmN5ID8gdGltZUNvbHVtbiA6IHVuZGVmaW5lZH1cbiAgICAgICAgICAgICAgICAgIDwvRGVwZW5kZW5jeUxpc3Q+XG4gICAgICAgICAgICAgICAgPC9TdHlsZWRSb3dGb3JtSXRlbT4pfVxuICAgICAgICAgICAgICB7aGFzRGF0YXNldCAmJiBoYXNBZGRpdGlvbmFsRmlsdGVycyAmJiAoPENsZWFuRm9ybUl0ZW0gbmFtZT17WydmaWx0ZXJzJywgZmlsdGVySWQsICdwcmVGaWx0ZXInXX0+XG4gICAgICAgICAgICAgICAgICA8Q29sbGFwc2libGVDb250cm9sIGluaXRpYWxWYWx1ZT17aGFzUHJlRmlsdGVyfSB0aXRsZT17dCgnUHJlLWZpbHRlciBhdmFpbGFibGUgdmFsdWVzJyl9IHRvb2x0aXA9e3QoYEFkZCBmaWx0ZXIgY2xhdXNlcyB0byBjb250cm9sIHRoZSBmaWx0ZXIncyBzb3VyY2UgcXVlcnksXG4gICAgICAgICAgICAgICAgICAgIHRob3VnaCBvbmx5IGluIHRoZSBjb250ZXh0IG9mIHRoZSBhdXRvY29tcGxldGUgaS5lLiwgdGhlc2UgY29uZGl0aW9uc1xuICAgICAgICAgICAgICAgICAgICBkbyBub3QgaW1wYWN0IGhvdyB0aGUgZmlsdGVyIGlzIGFwcGxpZWQgdG8gdGhlIGRhc2hib2FyZC4gVGhpcyBpcyB1c2VmdWxcbiAgICAgICAgICAgICAgICAgICAgd2hlbiB5b3Ugd2FudCB0byBpbXByb3ZlIHRoZSBxdWVyeSdzIHBlcmZvcm1hbmNlIGJ5IG9ubHkgc2Nhbm5pbmcgYSBzdWJzZXRcbiAgICAgICAgICAgICAgICAgICAgb2YgdGhlIHVuZGVybHlpbmcgZGF0YSBvciBsaW1pdCB0aGUgYXZhaWxhYmxlIHZhbHVlcyBkaXNwbGF5ZWQgaW4gdGhlIGZpbHRlci5gKX0gb25DaGFuZ2U9e2NoZWNrZWQgPT4ge1xuICAgICAgICAgICAgICAgICAgICBmb3JtQ2hhbmdlZCgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2hlY2tlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGVQcmVGaWx0ZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH19PlxuICAgICAgICAgICAgICAgICAgICA8U3R5bGVkUm93U3ViRm9ybUl0ZW0gZXhwYW5kZWQ9e2V4cGFuZGVkfSBuYW1lPXtbJ2ZpbHRlcnMnLCBmaWx0ZXJJZCwgJ2FkaG9jX2ZpbHRlcnMnXX0gY3NzPXt7IHdpZHRoOiBJTlBVVF9XSURUSCB9fSBpbml0aWFsVmFsdWU9e2ZpbHRlclRvRWRpdD8uYWRob2NfZmlsdGVyc30gcmVxdWlyZWQgcnVsZXM9e1tcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWRhdG9yOiBwcmVGaWx0ZXJWYWxpZGF0b3IsXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgXX0+XG4gICAgICAgICAgICAgICAgICAgICAgPEFkaG9jRmlsdGVyQ29udHJvbCBjb2x1bW5zPXtkYXRhc2V0RGV0YWlscz8uY29sdW1ucz8uZmlsdGVyKChjKSA9PiBjLmZpbHRlcmFibGUpIHx8IFtdfSBzYXZlZE1ldHJpY3M9e2RhdGFzZXREZXRhaWxzPy5tZXRyaWNzIHx8IFtdfSBkYXRhc291cmNlPXtkYXRhc2V0RGV0YWlsc30gb25DaGFuZ2U9eyhmaWx0ZXJzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHNldE5hdGl2ZUZpbHRlckZpZWxkVmFsdWVzKGZvcm0sIGZpbHRlcklkLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhZGhvY19maWx0ZXJzOiBmaWx0ZXJzLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGVQcmVGaWx0ZXIoKTtcbiAgICAgICAgICAgICAgICB9fSBsYWJlbD17PHNwYW4+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPFN0eWxlZExhYmVsPnt0KCdQcmUtZmlsdGVyJyl9PC9TdHlsZWRMYWJlbD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IWhhc1RpbWVSYW5nZSAmJiA8U3R5bGVkQXN0ZXJpc2sgLz59XG4gICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj59Lz5cbiAgICAgICAgICAgICAgICAgICAgPC9TdHlsZWRSb3dTdWJGb3JtSXRlbT5cbiAgICAgICAgICAgICAgICAgICAge3Nob3dUaW1lUmFuZ2VQaWNrZXIgJiYgKDxTdHlsZWRSb3dGb3JtSXRlbSBleHBhbmRlZD17ZXhwYW5kZWR9IG5hbWU9e1snZmlsdGVycycsIGZpbHRlcklkLCAndGltZV9yYW5nZSddfSBsYWJlbD17PFN0eWxlZExhYmVsPnt0KCdUaW1lIHJhbmdlJyl9PC9TdHlsZWRMYWJlbD59IGluaXRpYWxWYWx1ZT17ZmlsdGVyVG9FZGl0Py50aW1lX3JhbmdlIHx8IHQoJ05vIGZpbHRlcicpfSByZXF1aXJlZD17IWhhc0FkaG9jfSBydWxlcz17W1xuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkYXRvcjogcHJlRmlsdGVyVmFsaWRhdG9yLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgXX0+XG4gICAgICAgICAgICAgICAgICAgICAgICA8RGF0ZUZpbHRlckNvbnRyb2wgbmFtZT1cInRpbWVfcmFuZ2VcIiBvbkNoYW5nZT17dGltZVJhbmdlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldE5hdGl2ZUZpbHRlckZpZWxkVmFsdWVzKGZvcm0sIGZpbHRlcklkLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZV9yYW5nZTogdGltZVJhbmdlLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGVQcmVGaWx0ZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgfX0vPlxuICAgICAgICAgICAgICAgICAgICAgIDwvU3R5bGVkUm93Rm9ybUl0ZW0+KX1cbiAgICAgICAgICAgICAgICAgICAge2hhc1RpbWVSYW5nZSAmJiAhaGFzVGltZURlcGVuZGVuY3lcbiAgICAgICAgICAgICAgICAgICAgPyB0aW1lQ29sdW1uXG4gICAgICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkfVxuICAgICAgICAgICAgICAgICAgPC9Db2xsYXBzaWJsZUNvbnRyb2w+XG4gICAgICAgICAgICAgICAgPC9DbGVhbkZvcm1JdGVtPil9XG4gICAgICAgICAgICAgIHtmb3JtRmlsdGVyPy5maWx0ZXJUeXBlICE9PSAnZmlsdGVyX3JhbmdlJyA/ICg8Q2xlYW5Gb3JtSXRlbSBuYW1lPXtbJ2ZpbHRlcnMnLCBmaWx0ZXJJZCwgJ3NvcnRGaWx0ZXInXX0+XG4gICAgICAgICAgICAgICAgICA8Q29sbGFwc2libGVDb250cm9sIGluaXRpYWxWYWx1ZT17aGFzU29ydGluZ30gdGl0bGU9e3QoJ1NvcnQgZmlsdGVyIHZhbHVlcycpfSBvbkNoYW5nZT17Y2hlY2tlZCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIG9uU29ydENoYW5nZWQoY2hlY2tlZCB8fCB1bmRlZmluZWQpO1xuICAgICAgICAgICAgICAgICAgICBmb3JtQ2hhbmdlZCgpO1xuICAgICAgICAgICAgICAgIH19PlxuICAgICAgICAgICAgICAgICAgICA8U3R5bGVkUm93Rm9ybUl0ZW0gZXhwYW5kZWQ9e2V4cGFuZGVkfSBuYW1lPXtbXG4gICAgICAgICAgICAgICAgICAgICdmaWx0ZXJzJyxcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVySWQsXG4gICAgICAgICAgICAgICAgICAgICdjb250cm9sVmFsdWVzJyxcbiAgICAgICAgICAgICAgICAgICAgJ3NvcnRBc2NlbmRpbmcnLFxuICAgICAgICAgICAgICAgIF19IGluaXRpYWxWYWx1ZT17c29ydH0gbGFiZWw9ezxTdHlsZWRMYWJlbD57dCgnU29ydCB0eXBlJyl9PC9TdHlsZWRMYWJlbD59PlxuICAgICAgICAgICAgICAgICAgICAgIDxSYWRpby5Hcm91cCBvbkNoYW5nZT17dmFsdWUgPT4ge1xuICAgICAgICAgICAgICAgICAgICBvblNvcnRDaGFuZ2VkKHZhbHVlLnRhcmdldC52YWx1ZSk7XG4gICAgICAgICAgICAgICAgfX0+XG4gICAgICAgICAgICAgICAgICAgICAgICA8UmFkaW8gdmFsdWU+e3QoJ1NvcnQgYXNjZW5kaW5nJyl9PC9SYWRpbz5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxSYWRpbyB2YWx1ZT17ZmFsc2V9Pnt0KCdTb3J0IGRlc2NlbmRpbmcnKX08L1JhZGlvPlxuICAgICAgICAgICAgICAgICAgICAgIDwvUmFkaW8uR3JvdXA+XG4gICAgICAgICAgICAgICAgICAgIDwvU3R5bGVkUm93Rm9ybUl0ZW0+XG4gICAgICAgICAgICAgICAgICAgIHtoYXNNZXRyaWNzICYmICg8U3R5bGVkUm93U3ViRm9ybUl0ZW0gZXhwYW5kZWQ9e2V4cGFuZGVkfSBuYW1lPXtbJ2ZpbHRlcnMnLCBmaWx0ZXJJZCwgJ3NvcnRNZXRyaWMnXX0gaW5pdGlhbFZhbHVlPXtmaWx0ZXJUb0VkaXQ/LnNvcnRNZXRyaWN9IGxhYmVsPXs8PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxTdHlsZWRMYWJlbD57dCgnU29ydCBNZXRyaWMnKX08L1N0eWxlZExhYmVsPiZuYnNwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxJbmZvVG9vbHRpcFdpdGhUcmlnZ2VyIHBsYWNlbWVudD1cInRvcFwiIHRvb2x0aXA9e3QoJ0lmIGEgbWV0cmljIGlzIHNwZWNpZmllZCwgc29ydGluZyB3aWxsIGJlIGRvbmUgYmFzZWQgb24gdGhlIG1ldHJpYyB2YWx1ZScpfS8+XG4gICAgICAgICAgICAgICAgICAgICAgICAgIDwvPn0gZGF0YS10ZXN0PVwiZmllbGQtaW5wdXRcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxTZWxlY3QgYWxsb3dDbGVhciBhcmlhTGFiZWw9e3QoJ1NvcnQgbWV0cmljJyl9IG5hbWU9XCJzb3J0TWV0cmljXCIgb3B0aW9ucz17bWV0cmljcy5tYXAoKG1ldHJpYykgPT4gKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBtZXRyaWMubWV0cmljX25hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogbWV0cmljLnZlcmJvc2VfbmFtZSA/PyBtZXRyaWMubWV0cmljX25hbWUsXG4gICAgICAgICAgICAgICAgICAgIH0pKX0gb25DaGFuZ2U9e3ZhbHVlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0TmF0aXZlRmlsdGVyRmllbGRWYWx1ZXMoZm9ybSwgZmlsdGVySWQsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc29ydE1ldHJpYzogdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfX0vPlxuICAgICAgICAgICAgICAgICAgICAgIDwvU3R5bGVkUm93U3ViRm9ybUl0ZW0+KX1cbiAgICAgICAgICAgICAgICAgIDwvQ29sbGFwc2libGVDb250cm9sPlxuICAgICAgICAgICAgICAgIDwvQ2xlYW5Gb3JtSXRlbT4pIDogKDxDbGVhbkZvcm1JdGVtIG5hbWU9e1snZmlsdGVycycsIGZpbHRlcklkLCAncmFuZ2VGaWx0ZXInXX0+XG4gICAgICAgICAgICAgICAgICA8Q29sbGFwc2libGVDb250cm9sIGluaXRpYWxWYWx1ZT17aGFzRW5hYmxlU2luZ2xlVmFsdWV9IHRpdGxlPXt0KCdTaW5nbGUgVmFsdWUnKX0gb25DaGFuZ2U9e2NoZWNrZWQgPT4ge1xuICAgICAgICAgICAgICAgICAgICBvbkVuYWJsZVNpbmdsZVZhbHVlQ2hhbmdlZChjaGVja2VkID8gU2luZ2xlVmFsdWVUeXBlLkV4YWN0IDogdW5kZWZpbmVkKTtcbiAgICAgICAgICAgICAgICAgICAgZm9ybUNoYW5nZWQoKTtcbiAgICAgICAgICAgICAgICB9fT5cbiAgICAgICAgICAgICAgICAgICAgPFN0eWxlZFJvd0Zvcm1JdGVtIGV4cGFuZGVkPXtleHBhbmRlZH0gbmFtZT17W1xuICAgICAgICAgICAgICAgICAgICAnZmlsdGVycycsXG4gICAgICAgICAgICAgICAgICAgIGZpbHRlcklkLFxuICAgICAgICAgICAgICAgICAgICAnY29udHJvbFZhbHVlcycsXG4gICAgICAgICAgICAgICAgICAgICdlbmFibGVTaW5nbGVWYWx1ZScsXG4gICAgICAgICAgICAgICAgXX0gaW5pdGlhbFZhbHVlPXtlbmFibGVTaW5nbGVWYWx1ZX0gbGFiZWw9ezxTdHlsZWRMYWJlbD57dCgnU2luZ2xlIHZhbHVlIHR5cGUnKX08L1N0eWxlZExhYmVsPn0+XG4gICAgICAgICAgICAgICAgICAgICAgPFJhZGlvLkdyb3VwIG9uQ2hhbmdlPXt2YWx1ZSA9PiBvbkVuYWJsZVNpbmdsZVZhbHVlQ2hhbmdlZCh2YWx1ZS50YXJnZXQudmFsdWUpfT5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxSYWRpbyB2YWx1ZT17U2luZ2xlVmFsdWVUeXBlLk1pbmltdW19PlxuICAgICAgICAgICAgICAgICAgICAgICAgICB7dCgnTWluaW11bScpfVxuICAgICAgICAgICAgICAgICAgICAgICAgPC9SYWRpbz5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxSYWRpbyB2YWx1ZT17U2luZ2xlVmFsdWVUeXBlLkV4YWN0fT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAge3QoJ0V4YWN0Jyl9XG4gICAgICAgICAgICAgICAgICAgICAgICA8L1JhZGlvPlxuICAgICAgICAgICAgICAgICAgICAgICAgPFJhZGlvIHZhbHVlPXtTaW5nbGVWYWx1ZVR5cGUuTWF4aW11bX0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHt0KCdNYXhpbXVtJyl9XG4gICAgICAgICAgICAgICAgICAgICAgICA8L1JhZGlvPlxuICAgICAgICAgICAgICAgICAgICAgIDwvUmFkaW8uR3JvdXA+XG4gICAgICAgICAgICAgICAgICAgIDwvU3R5bGVkUm93Rm9ybUl0ZW0+XG4gICAgICAgICAgICAgICAgICA8L0NvbGxhcHNpYmxlQ29udHJvbD5cbiAgICAgICAgICAgICAgICA8L0NsZWFuRm9ybUl0ZW0+KX1cbiAgICAgICAgICAgIDwvQ29sbGFwc2UuUGFuZWw+KX1cbiAgICAgICAgICA8Q29sbGFwc2UuUGFuZWwgZm9yY2VSZW5kZXIgaGVhZGVyPXtGaWx0ZXJQYW5lbHMuc2V0dGluZ3MubmFtZX0ga2V5PXtgJHtmaWx0ZXJJZH0tJHtGaWx0ZXJQYW5lbHMuc2V0dGluZ3Mua2V5fWB9PlxuICAgICAgICAgICAgPFN0eWxlZEZvcm1JdGVtIGV4cGFuZGVkPXtleHBhbmRlZH0gbmFtZT17WydmaWx0ZXJzJywgZmlsdGVySWQsICdkZXNjcmlwdGlvbiddfSBpbml0aWFsVmFsdWU9e2ZpbHRlclRvRWRpdD8uZGVzY3JpcHRpb259IGxhYmVsPXs8U3R5bGVkTGFiZWw+e3QoJ0Rlc2NyaXB0aW9uJyl9PC9TdHlsZWRMYWJlbD59PlxuICAgICAgICAgICAgICA8VGV4dEFyZWEgLz5cbiAgICAgICAgICAgIDwvU3R5bGVkRm9ybUl0ZW0+XG4gICAgICAgICAgICA8Q2xlYW5Gb3JtSXRlbSBuYW1lPXtbJ2ZpbHRlcnMnLCBmaWx0ZXJJZCwgJ2RlZmF1bHRWYWx1ZVF1ZXJpZXNEYXRhJ119IGhpZGRlbiBpbml0aWFsVmFsdWU9e251bGx9Lz5cbiAgICAgICAgICAgIDxDbGVhbkZvcm1JdGVtIG5hbWU9e1snZmlsdGVycycsIGZpbHRlcklkLCAnZGVmYXVsdFZhbHVlJ119PlxuICAgICAgICAgICAgICA8Q29sbGFwc2libGVDb250cm9sIGNoZWNrZWQ9e2hhc0RlZmF1bHRWYWx1ZX0gZGlzYWJsZWQ9e2lzUmVxdWlyZWQgfHwgZGVmYXVsdFRvRmlyc3RJdGVtfSBpbml0aWFsVmFsdWU9e2hhc0RlZmF1bHRWYWx1ZX0gdGl0bGU9e3QoJ0ZpbHRlciBoYXMgZGVmYXVsdCB2YWx1ZScpfSB0b29sdGlwPXtkZWZhdWx0VmFsdWVUb29sdGlwfSBvbkNoYW5nZT17dmFsdWUgPT4ge1xuICAgICAgICAgICAgc2V0SGFzRGVmYXVsdFZhbHVlKHZhbHVlKTtcbiAgICAgICAgICAgIGlmICghdmFsdWUpIHtcbiAgICAgICAgICAgICAgICBzZXROYXRpdmVGaWx0ZXJGaWVsZFZhbHVlcyhmb3JtLCBmaWx0ZXJJZCwge1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0RGF0YU1hc2s6IG51bGwsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3JtQ2hhbmdlZCgpO1xuICAgICAgICB9fT5cbiAgICAgICAgICAgICAgICB7IWlzUmVtb3ZlZCAmJiAoPFN0eWxlZFJvd1N1YkZvcm1JdGVtIGV4cGFuZGVkPXtleHBhbmRlZH0gbmFtZT17WydmaWx0ZXJzJywgZmlsdGVySWQsICdkZWZhdWx0RGF0YU1hc2snXX0gaW5pdGlhbFZhbHVlPXtpbml0aWFsRGVmYXVsdFZhbHVlfSBkYXRhLXRlc3Q9XCJkZWZhdWx0LWlucHV0XCIgbGFiZWw9ezxTdHlsZWRMYWJlbD57dCgnRGVmYXVsdCBWYWx1ZScpfTwvU3R5bGVkTGFiZWw+fSByZXF1aXJlZD17aGFzRGVmYXVsdFZhbHVlfSBydWxlcz17W1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsaWRhdG9yOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZm9ybUZpbHRlcj8uZGVmYXVsdERhdGFNYXNrPy5maWx0ZXJTdGF0ZT8udmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyByZXF1aXJlcyBtYW5hZ2luZyB0aGUgZXJyb3IgYXMgdGhlIERlZmF1bHRWYWx1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbXBvbmVudCBkb2VzIG5vdCB1c2UgYW4gQW50ZGVzaWduIGNvbXBhdGlibGUgaW5wdXRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmb3JtVmFsaWRhdGlvbkZpZWxkcyA9IGZvcm0uZ2V0RmllbGRzRXJyb3IoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRFcnJvcmVkRmlsdGVycyhwcmV2RXJyb3JlZEZpbHRlcnMgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJldkVycm9yZWRGaWx0ZXJzLmxlbmd0aCAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIWZvcm1WYWxpZGF0aW9uRmllbGRzLmZpbmQoZiA9PiBmLmVycm9ycy5sZW5ndGggPiAwKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwcmV2RXJyb3JlZEZpbHRlcnM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0RXJyb3JlZEZpbHRlcnMocHJldkVycm9yZWRGaWx0ZXJzID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJldkVycm9yZWRGaWx0ZXJzLmluY2x1ZGVzKGZpbHRlcklkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJldkVycm9yZWRGaWx0ZXJzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWy4uLnByZXZFcnJvcmVkRmlsdGVycywgZmlsdGVySWRdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKHQoJ0RlZmF1bHQgdmFsdWUgaXMgcmVxdWlyZWQnKSkpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdfT5cbiAgICAgICAgICAgICAgICAgICAge2Vycm9yIHx8IHNob3dEZWZhdWx0VmFsdWUgPyAoPERlZmF1bHRWYWx1ZUNvbnRhaW5lcj5cbiAgICAgICAgICAgICAgICAgICAgICAgIHtlcnJvciA/ICg8RXJyb3JNZXNzYWdlV2l0aFN0YWNrVHJhY2UgZXJyb3I9e2Vycm9yLmVycm9ycz8uWzBdfSBmYWxsYmFjaz17PEJhc2ljRXJyb3JBbGVydCB0aXRsZT17dCgnQ2Fubm90IGxvYWQgZmlsdGVyJyl9IGJvZHk9e2Vycm9yLmVycm9yfSBsZXZlbD1cImVycm9yXCIvPn0vPikgOiAoPERlZmF1bHRWYWx1ZSBzZXREYXRhTWFzaz17ZGF0YU1hc2sgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0VxdWFsKGluaXRpYWxEZWZhdWx0VmFsdWU/LmZpbHRlclN0YXRlPy52YWx1ZSwgZGF0YU1hc2s/LmZpbHRlclN0YXRlPy52YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtQ2hhbmdlZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0TmF0aXZlRmlsdGVyRmllbGRWYWx1ZXMoZm9ybSwgZmlsdGVySWQsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0RGF0YU1hc2s6IGRhdGFNYXNrLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtLnZhbGlkYXRlRmllbGRzKFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbJ2ZpbHRlcnMnLCBmaWx0ZXJJZCwgJ2RlZmF1bHREYXRhTWFzayddLFxuICAgICAgICAgICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICB9fSBoYXNEZWZhdWx0VmFsdWU9e2hhc0RlZmF1bHRWYWx1ZX0gZmlsdGVySWQ9e2ZpbHRlcklkfSBoYXNEYXRhc2V0PXtoYXNEYXRhc2V0fSBmb3JtPXtmb3JtfSBmb3JtRGF0YT17bmV3Rm9ybURhdGF9IGVuYWJsZU5vUmVzdWx0cz17ZW5hYmxlTm9SZXN1bHRzfS8+KX1cbiAgICAgICAgICAgICAgICAgICAgICAgIHtoYXNEYXRhc2V0ICYmIGRhdGFzZXRJZCAmJiAoPFRvb2x0aXAgdGl0bGU9e3QoJ1JlZnJlc2ggdGhlIGRlZmF1bHQgdmFsdWVzJyl9PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxSZWZyZXNoSWNvbiBvbkNsaWNrPXsoKSA9PiByZWZyZXNoSGFuZGxlcih0cnVlKX0vPlxuICAgICAgICAgICAgICAgICAgICAgICAgICA8L1Rvb2x0aXA+KX1cbiAgICAgICAgICAgICAgICAgICAgICA8L0RlZmF1bHRWYWx1ZUNvbnRhaW5lcj4pIDogKHQoJ0ZpbGwgYWxsIHJlcXVpcmVkIGZpZWxkcyB0byBlbmFibGUgXCJEZWZhdWx0IFZhbHVlXCInKSl9XG4gICAgICAgICAgICAgICAgICA8L1N0eWxlZFJvd1N1YkZvcm1JdGVtPil9XG4gICAgICAgICAgICAgIDwvQ29sbGFwc2libGVDb250cm9sPlxuICAgICAgICAgICAgPC9DbGVhbkZvcm1JdGVtPlxuICAgICAgICAgICAge09iamVjdC5rZXlzKGNvbnRyb2xJdGVtcylcbiAgICAgICAgICAgIC5zb3J0KChhLCBiKSA9PiBjb250cm9sc09yZGVyLmluZGV4T2YoYSkgLVxuICAgICAgICAgICAgY29udHJvbHNPcmRlci5pbmRleE9mKGIpKVxuICAgICAgICAgICAgLm1hcChrZXkgPT4gY29udHJvbEl0ZW1zW2tleV0uZWxlbWVudCl9XG4gICAgICAgICAgPC9Db2xsYXBzZS5QYW5lbD5cbiAgICAgICAgPC9TdHlsZWRDb2xsYXBzZT5cbiAgICAgIDwvVGFiUGFuZT5cbiAgICAgIDxUYWJQYW5lIHRhYj17RmlsdGVyVGFicy5zY29waW5nLm5hbWV9IGtleT17RmlsdGVyVGFicy5zY29waW5nLmtleX0gZm9yY2VSZW5kZXI+XG4gICAgICAgIDxGaWx0ZXJTY29wZSB1cGRhdGVGb3JtVmFsdWVzPXt1cGRhdGVGb3JtVmFsdWVzfSBwYXRoVG9Gb3JtVmFsdWU9e1snZmlsdGVycycsIGZpbHRlcklkXX0gZm9yY2VVcGRhdGU9e2ZvcmNlVXBkYXRlfSBmaWx0ZXJTY29wZT17ZmlsdGVyVG9FZGl0Py5zY29wZX0gZm9ybUZpbHRlclNjb3BlPXtmb3JtRmlsdGVyPy5zY29wZX0gZm9ybVNjb3BpbmdUeXBlPXtmb3JtRmlsdGVyPy5zY29waW5nfSBpbml0aWFsbHlFeGNsdWRlZENoYXJ0cz17aW5pdGlhbGx5RXhjbHVkZWRDaGFydHN9Lz5cbiAgICAgIDwvVGFiUGFuZT5cbiAgICA8L1N0eWxlZFRhYnM+KTtcbn07XG5leHBvcnQgZGVmYXVsdCBtZW1vKGZvcndhcmRSZWYoRmlsdGVyc0NvbmZpZ0Zvcm0pKTtcbiJdfQ== */\"), initialValue: filterToEdit == null ? void 0 : filterToEdit.adhoc_filters, required: true, rules: [\n                {\n                  validator: preFilterValidator\n                }], children:\n\n                _jsx(AdhocFilterControl, { columns: (datasetDetails == null ? void 0 : (_datasetDetails$colum = datasetDetails.columns) == null ? void 0 : _datasetDetails$colum.filter((c) => c.filterable)) || [], savedMetrics: (datasetDetails == null ? void 0 : datasetDetails.metrics) || [], datasource: datasetDetails, onChange: (filters) => {\n                    setNativeFilterFieldValues(form, filterId, {\n                      adhoc_filters: filters\n                    });\n                    forceUpdate();\n                    validatePreFilter();\n                  }, label: _jsxs(\"span\", { children: [\n                    _jsx(StyledLabel, { children: t('Pre-filter') }),\n                    !hasTimeRange && _jsx(StyledAsterisk, {})] }\n                  ) }) }\n              ),\n              showTimeRangePicker && _jsx(StyledRowFormItem, { expanded: expanded, name: ['filters', filterId, 'time_range'], label: _jsx(StyledLabel, { children: t('Time range') }), initialValue: (filterToEdit == null ? void 0 : filterToEdit.time_range) || t('No filter'), required: !hasAdhoc, rules: [\n                {\n                  validator: preFilterValidator\n                }], children:\n\n                _jsx(DateFilterControl, { name: \"time_range\", onChange: (timeRange) => {\n                    setNativeFilterFieldValues(form, filterId, {\n                      time_range: timeRange\n                    });\n                    forceUpdate();\n                    validatePreFilter();\n                  } }) }\n              ),\n              hasTimeRange && !hasTimeDependency ?\n              timeColumn :\n              undefined] }\n            ) }\n          ),\n          (formFilter == null ? void 0 : formFilter.filterType) !== 'filter_range' ? _jsx(CleanFormItem, { name: ['filters', filterId, 'sortFilter'], children:\n            _jsxs(CollapsibleControl, { initialValue: hasSorting, title: t('Sort filter values'), onChange: (checked) => {\n                onSortChanged(checked || undefined);\n                formChanged();\n              }, children: [\n              _jsx(StyledRowFormItem, { expanded: expanded, name: [\n                'filters',\n                filterId,\n                'controlValues',\n                'sortAscending'],\n                initialValue: sort, label: _jsx(StyledLabel, { children: t('Sort type') }), children:\n                _jsxs(Radio.Group, { onChange: (value) => {\n                    onSortChanged(value.target.value);\n                  }, children: [\n                  _jsx(Radio, { value: true, children: t('Sort ascending') }),\n                  _jsx(Radio, { value: false, children: t('Sort descending') })] }\n                ) }\n              ),\n              hasMetrics && _jsx(StyledRowSubFormItem, { expanded: expanded, name: ['filters', filterId, 'sortMetric'], initialValue: filterToEdit == null ? void 0 : filterToEdit.sortMetric, label: _jsxs(_Fragment, { children: [\n                  _jsx(StyledLabel, { children: t('Sort Metric') }), \"\\xA0\",\n                  _jsx(InfoTooltipWithTrigger, { placement: \"top\", tooltip: t('If a metric is specified, sorting will be done based on the metric value') })] }\n                ), \"data-test\": \"field-input\", children:\n                _jsx(Select, { allowClear: true, ariaLabel: t('Sort metric'), name: \"sortMetric\", options: metrics.map((metric) => {var _metric$verbose_name;return {\n                      value: metric.metric_name,\n                      label: (_metric$verbose_name = metric.verbose_name) != null ? _metric$verbose_name : metric.metric_name\n                    };}), onChange: (value) => {\n                    if (value !== undefined) {\n                      setNativeFilterFieldValues(form, filterId, {\n                        sortMetric: value\n                      });\n                      forceUpdate();\n                    }\n                  } }) }\n              )] }\n            ) }\n          ) : _jsx(CleanFormItem, { name: ['filters', filterId, 'rangeFilter'], children:\n            _jsx(CollapsibleControl, { initialValue: hasEnableSingleValue, title: t('Single Value'), onChange: (checked) => {\n                onEnableSingleValueChanged(checked ? SingleValueType.Exact : undefined);\n                formChanged();\n              }, children:\n              _jsx(StyledRowFormItem, { expanded: expanded, name: [\n                'filters',\n                filterId,\n                'controlValues',\n                'enableSingleValue'],\n                initialValue: enableSingleValue, label: _jsx(StyledLabel, { children: t('Single value type') }), children:\n                _jsxs(Radio.Group, { onChange: (value) => onEnableSingleValueChanged(value.target.value), children: [\n                  _jsx(Radio, { value: SingleValueType.Minimum, children:\n                    t('Minimum') }\n                  ),\n                  _jsx(Radio, { value: SingleValueType.Exact, children:\n                    t('Exact') }\n                  ),\n                  _jsx(Radio, { value: SingleValueType.Maximum, children:\n                    t('Maximum') }\n                  )] }\n                ) }\n              ) }\n            ) }\n          )] }, `${filterId}-${FilterPanels.configuration.key}`\n        ),\n        _jsxs(Collapse.Panel, { forceRender: true, header: FilterPanels.settings.name, children: [\n          _jsx(StyledFormItem, { expanded: expanded, name: ['filters', filterId, 'description'], initialValue: filterToEdit == null ? void 0 : filterToEdit.description, label: _jsx(StyledLabel, { children: t('Description') }), children:\n            _jsx(TextArea, {}) }\n          ),\n          _jsx(CleanFormItem, { name: ['filters', filterId, 'defaultValueQueriesData'], hidden: true, initialValue: null }),\n          _jsx(CleanFormItem, { name: ['filters', filterId, 'defaultValue'], children:\n            _jsx(CollapsibleControl, { checked: hasDefaultValue, disabled: isRequired || defaultToFirstItem, initialValue: hasDefaultValue, title: t('Filter has default value'), tooltip: defaultValueTooltip, onChange: (value) => {\n                setHasDefaultValue(value);\n                if (!value) {\n                  setNativeFilterFieldValues(form, filterId, {\n                    defaultDataMask: null\n                  });\n                }\n                formChanged();\n              }, children:\n              !isRemoved && _jsx(StyledRowSubFormItem, { expanded: expanded, name: ['filters', filterId, 'defaultDataMask'], initialValue: initialDefaultValue, \"data-test\": \"default-input\", label: _jsx(StyledLabel, { children: t('Default Value') }), required: hasDefaultValue, rules: [\n                {\n                  validator: () => {var _formFilter$defaultDa, _formFilter$defaultDa2;\n                    if (formFilter != null && (_formFilter$defaultDa = formFilter.defaultDataMask) != null && (_formFilter$defaultDa2 = _formFilter$defaultDa.filterState) != null && _formFilter$defaultDa2.value) {\n                      // requires managing the error as the DefaultValue\n                      // component does not use an Antdesign compatible input\n                      const formValidationFields = form.getFieldsError();\n                      setErroredFilters((prevErroredFilters) => {\n                        if (prevErroredFilters.length &&\n                        !formValidationFields.find((f) => f.errors.length > 0)) {\n                          return [];\n                        }\n                        return prevErroredFilters;\n                      });\n                      return Promise.resolve();\n                    }\n                    setErroredFilters((prevErroredFilters) => {\n                      if (prevErroredFilters.includes(filterId)) {\n                        return prevErroredFilters;\n                      }\n                      return [...prevErroredFilters, filterId];\n                    });\n                    return Promise.reject(new Error(t('Default value is required')));\n                  }\n                }], children:\n\n                error || showDefaultValue ? _jsxs(DefaultValueContainer, { children: [\n                  error ? _jsx(ErrorMessageWithStackTrace, { error: (_error$errors = error.errors) == null ? void 0 : _error$errors[0], fallback: _jsx(BasicErrorAlert, { title: t('Cannot load filter'), body: error.error, level: \"error\" }) }) : _jsx(DefaultValue, { setDataMask: (dataMask) => {var _initialDefaultValue$, _dataMask$filterState;\n                      if (!_isEqual(initialDefaultValue == null ? void 0 : (_initialDefaultValue$ = initialDefaultValue.filterState) == null ? void 0 : _initialDefaultValue$.value, dataMask == null ? void 0 : (_dataMask$filterState = dataMask.filterState) == null ? void 0 : _dataMask$filterState.value)) {\n                        formChanged();\n                      }\n                      setNativeFilterFieldValues(form, filterId, {\n                        defaultDataMask: dataMask\n                      });\n                      form.validateFields([\n                      ['filters', filterId, 'defaultDataMask']]\n                      );\n                      forceUpdate();\n                    }, hasDefaultValue: hasDefaultValue, filterId: filterId, hasDataset: hasDataset, form: form, formData: newFormData, enableNoResults: enableNoResults }),\n                  hasDataset && datasetId && _jsx(Tooltip, { title: t('Refresh the default values'), children:\n                    _jsx(RefreshIcon, { onClick: () => refreshHandler(true) }) }\n                  )] }\n                ) : t('Fill all required fields to enable \"Default Value\"') }\n              ) }\n            ) }\n          ),\n          Object.keys(controlItems).\n          sort((a, b) => controlsOrder.indexOf(a) -\n          controlsOrder.indexOf(b)).\n          map((key) => controlItems[key].element)] }, `${filterId}-${FilterPanels.settings.key}`\n        )] }, `native-filter-config-${filterId}`\n      )] }, FilterTabs.configuration.key\n    ),\n    _jsx(TabPane, { tab: FilterTabs.scoping.name, forceRender: true, children:\n      _jsx(FilterScope, { updateFormValues: updateFormValues, pathToFormValue: ['filters', filterId], forceUpdate: forceUpdate, filterScope: filterToEdit == null ? void 0 : filterToEdit.scope, formFilterScope: formFilter == null ? void 0 : formFilter.scope, formScopingType: formFilter == null ? void 0 : formFilter.scoping, initiallyExcludedCharts: initiallyExcludedCharts }) }, FilterTabs.scoping.key\n    )] }\n  );\n};__signature__(FiltersConfigForm, \"useState{[error, setError]}\\nuseState{[metrics, setMetrics]([])}\\nuseState{[activeTabKey, setActiveTabKey](FilterTabs.configuration.key)}\\nuseSelector{dashboardId}\\nuseState{[undoFormValues, setUndoFormValues](null)}\\nuseForceUpdate{forceUpdate}\\nuseState{[datasetDetails, setDatasetDetails]}\\nuseMemo{defaultFormFilter}\\nuseSelector{loadedDatasets}\\nuseSelector{charts}\\nuseMemo{doLoadedDatasetsHaveTemporalColumns}\\nuseMemo{showTimeRangePicker}\\nuseCallback{refreshHandler}\\nuseEffect{}\\nuseDefaultValue{[hasDefaultValue, isRequired, defaultValueTooltip, setHasDefaultValue]}\\nuseCallback{formChanged}\\nuseCallback{updateFormValues}\\nuseEffect{}\\nuseImperativeHandle{}\\nuseBackendFormUpdate{}\\nuseEffect{}\\nuseMemo{initiallyExcludedCharts}\\nuseEffect{}\\nuseEffect{}\", () => [useSelector, useForceUpdate, useSelector, useSelector, useDefaultValue, useImperativeHandle, useBackendFormUpdate]);const _default = /*#__PURE__*/\nmemo( /*#__PURE__*/forwardRef(FiltersConfigForm));export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(FORM_ITEM_WIDTH, \"FORM_ITEM_WIDTH\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/FiltersConfigForm.tsx\");reactHotLoader.register(TabPane, \"TabPane\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/FiltersConfigForm.tsx\");reactHotLoader.register(StyledContainer, \"StyledContainer\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/FiltersConfigForm.tsx\");reactHotLoader.register(StyledRowContainer, \"StyledRowContainer\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/FiltersConfigForm.tsx\");reactHotLoader.register(controlsOrder, \"controlsOrder\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/FiltersConfigForm.tsx\");reactHotLoader.register(StyledFormItem, \"StyledFormItem\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/FiltersConfigForm.tsx\");reactHotLoader.register(StyledRowFormItem, \"StyledRowFormItem\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/FiltersConfigForm.tsx\");reactHotLoader.register(StyledRowSubFormItem, \"StyledRowSubFormItem\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/FiltersConfigForm.tsx\");reactHotLoader.register(StyledLabel, \"StyledLabel\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/FiltersConfigForm.tsx\");reactHotLoader.register(CleanFormItem, \"CleanFormItem\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/FiltersConfigForm.tsx\");reactHotLoader.register(DefaultValueContainer, \"DefaultValueContainer\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/FiltersConfigForm.tsx\");reactHotLoader.register(RefreshIcon, \"RefreshIcon\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/FiltersConfigForm.tsx\");reactHotLoader.register(StyledCollapse, \"StyledCollapse\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/FiltersConfigForm.tsx\");reactHotLoader.register(StyledTabs, \"StyledTabs\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/FiltersConfigForm.tsx\");reactHotLoader.register(StyledAsterisk, \"StyledAsterisk\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/FiltersConfigForm.tsx\");reactHotLoader.register(FilterTypeInfo, \"FilterTypeInfo\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/FiltersConfigForm.tsx\");reactHotLoader.register(FilterTabs, \"FilterTabs\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/FiltersConfigForm.tsx\");reactHotLoader.register(FilterPanels, \"FilterPanels\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/FiltersConfigForm.tsx\");reactHotLoader.register(FILTERS_WITH_ADHOC_FILTERS, \"FILTERS_WITH_ADHOC_FILTERS\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/FiltersConfigForm.tsx\");reactHotLoader.register(FILTER_TYPE_NAME_MAPPING, \"FILTER_TYPE_NAME_MAPPING\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/FiltersConfigForm.tsx\");reactHotLoader.register(FiltersConfigForm, \"FiltersConfigForm\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/FiltersConfigForm.tsx\");reactHotLoader.register(_default, \"default\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/FiltersConfigForm.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["InfoTooltipWithTrigger","Behavior","isFeatureEnabled","FeatureFlag","GenericDataType","getChartMetadataRegistry","NativeFilterType","styled","t","getClientErrorObject","forwardRef","useCallback","useEffect","useImperativeHandle","useMemo","useState","memo","rison","useSelector","getChartDataRequest","Input","TextArea","Select","Collapse","BasicErrorAlert","ErrorMessageWithStackTrace","FormItem","Icons","Loading","addDangerToast","Radio","Tabs","Tooltip","cachedSupersetGet","DateFilterControl","AdhocFilterControl","waitForAsyncData","SingleValueType","getFormData","mergeExtraFormData","DatasetSelectLabel","ALLOW_DEPENDENCIES","TYPES_SUPPORT_DEPENDENCIES","getFiltersConfigModalTestId","CollapsibleControl","ColumnSelect","DatasetSelect","DefaultValue","FilterScope","getControlItemsMap","RemovedFilter","useBackendFormUpdate","useDefaultValue","hasTemporalColumns","mostUsedDataset","setNativeFilterFieldValues","useForceUpdate","FILTER_SUPPORTED_TYPES","INPUT_WIDTH","DependencyList","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","FORM_ITEM_WIDTH","TabPane","theme","gridUnit","StyledContainer","div","StyledRowContainer","controlsOrder","StyledFormItem","expanded","StyledRowFormItem","StyledRowSubFormItem","StyledLabel","span","colors","grayscale","base","typography","sizes","s","CleanFormItem","DefaultValueContainer","RefreshIcon","Refresh","primary","StyledCollapse","light2","StyledTabs","light5","StyledAsterisk","error","FilterTypeInfo","light1","FilterTabs","configuration","key","name","scoping","FilterPanels","settings","FILTERS_WITH_ADHOC_FILTERS","FILTER_TYPE_NAME_MAPPING","FiltersConfigForm","filterId","filterToEdit","removedFilters","form","getAvailableFilters","activeFilterPanelKeys","restoreFilter","handleActiveFilterPanelChange","setErroredFilters","validateDependencies","getDependencySuggestion","isActive","ref","_formFilter$dataset2","_nativeFilterItems$fo","_nativeFilterItems$fo2","_ref","_formFilter$dataset$v","_formFilter$dataset3","_filterToEdit$targets","_nativeFilterItems$fo3","_nativeFilterItem$val","_formFilter$isDataDir","_formFilter$dataset6","_filterToEdit$adhoc_f","_formFilter$controlVa","_filterToEdit$control","_filterToEdit$control2","_formFilter$controlVa2","_formFilter$controlVa3","_filterToEdit$control3","_filterToEdit$control4","_formFilter$controlVa4","_formFilter$adhoc_fil","_formFilter$controlVa5","_formFilter$dataset9","_datasetDetails$colum","_error$errors","isRemoved","setError","metrics","setMetrics","activeTabKey","setActiveTabKey","dashboardId","state","dashboardInfo","id","undoFormValues","setUndoFormValues","forceUpdate","datasetDetails","setDatasetDetails","defaultFormFilter","filters","getFieldValue","formValues","formFilter","dependencies","cascadeParentIds","nativeFilterItems","items","nativeFilterVizTypes","Object","entries","filter","value","_value$behaviors","behaviors","includes","NativeFilter","map","loadedDatasets","datasources","charts","doLoadedDatasetsHaveTemporalColumns","values","some","dataset","showTimeRangePicker","currentDataset","find","_formFilter$dataset","hasDataset","filterType","datasourceCount","datasetId","targets","controlItems","mainControlItems","disabled","removed","hasColumn","groupby","nativeFilterItem","enableNoResults","hasMetrics","length","hasFilledDataset","column","hasAdditionalFilters","canDependOnOtherFilters","isDataDirty","setNativeFilterFieldValuesWrapper","undefined","setErrorWrapper","defaultValueQueriesData","dependenciesDefaultValues","forEach","dependency","_filters$dependency","_filters$dependency$d","extraFormData","defaultDataMask","dependenciesText","JSON","stringify","refreshHandler","force","_formFilter$dataset4","_formFilter$dataset5","formData","extra_form_data","then","response","json","GlobalAsyncQueries","result","status","asyncResult","catch","clientErrorObject","Error","newFormData","hasDefaultValue","isRequired","defaultValueTooltip","setHasDefaultValue","showDataset","label","formChanged","setFields","updateFormValues","hasPreFilter","adhoc_filters","time_range","hasEnableSingleValue","controlValues","enableSingleValue","enableSingleMaxValue","hasSorting","sortAscending","sort","showDefaultValue","onSortChanged","_form$getFieldValue","previous","onEnableSingleValueChanged","_form$getFieldValue2","validatePreFilter","setTimeout","validateFields","hasTimeRange","hasAdhoc","defaultToFirstItem","initialDefaultValue","preFilterValidator","Promise","resolve","reject","availableFilters","hasAvailableFilters","hasTimeDependency","type","endpoint","encode","columns","_response$json","_response$json$result","_response$json2","datasource_type","filter_select","message","changeTab","tab","initiallyExcludedCharts","_formFilter$dataset7","excluded","chart","_chart$form_data","_loadedDatasets$chart","_formFilter$dataset8","chartDatasetUid","form_data","datasource","push","onClick","timeColumn","children","placement","tooltip","initialValue","granularity_sqla","allowClear","formField","filterValues","is_dttm","onChange","activeKey","centered","forceRender","hidden","rules","required","ariaLabel","options","_nativeFilterItems$fi","_FILTER_SUPPORTED_TYP","_FILTER_SUPPORTED_TYP2","mappedName","isDisabled","Temporal","customLabel","title","table_name","schema","database","database_name","position","keys","element","defaultActiveKey","expandIconPosition","Panel","header","onDependenciesChange","checked","css","_css","width","process","env","NODE_ENV","validator","c","filterable","savedMetrics","timeRange","Group","target","sortMetric","metric","_metric$verbose_name","metric_name","verbose_name","Exact","Minimum","Maximum","description","_formFilter$defaultDa","_formFilter$defaultDa2","filterState","formValidationFields","getFieldsError","prevErroredFilters","f","errors","fallback","body","level","setDataMask","dataMask","_initialDefaultValue$","_dataMask$filterState","_isEqual","a","b","indexOf","pathToFormValue","filterScope","scope","formFilterScope","formScopingType","__signature__","_default","reactHotLoader","reactHotLoaderGlobal","default","register","leaveModule","module"],"sources":["/app/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/FiltersConfigForm.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable react-hooks/rules-of-hooks */\nimport {\n  ColumnMeta,\n  InfoTooltipWithTrigger,\n  Metric,\n} from '@superset-ui/chart-controls';\nimport {\n  AdhocFilter,\n  Behavior,\n  ChartDataResponseResult,\n  Column,\n  isFeatureEnabled,\n  FeatureFlag,\n  Filter,\n  GenericDataType,\n  getChartMetadataRegistry,\n  JsonResponse,\n  NativeFilterType,\n  styled,\n  SupersetApiError,\n  t,\n  ClientErrorObject,\n  getClientErrorObject,\n} from '@superset-ui/core';\nimport { isEqual } from 'lodash';\nimport {\n  forwardRef,\n  useCallback,\n  useEffect,\n  useImperativeHandle,\n  useMemo,\n  useState,\n  RefObject,\n  memo,\n} from 'react';\nimport rison from 'rison';\nimport { PluginFilterSelectCustomizeProps } from 'src/filters/components/Select/types';\nimport { useSelector } from 'react-redux';\nimport { getChartDataRequest } from 'src/components/Chart/chartAction';\nimport { Input, TextArea } from 'src/components/Input';\nimport { Select, FormInstance } from 'src/components';\nimport Collapse from 'src/components/Collapse';\nimport BasicErrorAlert from 'src/components/ErrorMessage/BasicErrorAlert';\nimport ErrorMessageWithStackTrace from 'src/components/ErrorMessage/ErrorMessageWithStackTrace';\nimport { FormItem } from 'src/components/Form';\nimport Icons from 'src/components/Icons';\nimport Loading from 'src/components/Loading';\nimport { addDangerToast } from 'src/components/MessageToasts/actions';\nimport { Radio } from 'src/components/Radio';\nimport Tabs from 'src/components/Tabs';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { cachedSupersetGet } from 'src/utils/cachedSupersetGet';\nimport {\n  Chart,\n  ChartsState,\n  DatasourcesState,\n  RootState,\n} from 'src/dashboard/types';\nimport DateFilterControl from 'src/explore/components/controls/DateFilterControl';\nimport AdhocFilterControl from 'src/explore/components/controls/FilterControl/AdhocFilterControl';\nimport { waitForAsyncData } from 'src/middleware/asyncEvent';\nimport { SingleValueType } from 'src/filters/components/Range/SingleValueType';\nimport {\n  getFormData,\n  mergeExtraFormData,\n} from 'src/dashboard/components/nativeFilters/utils';\nimport { DatasetSelectLabel } from 'src/features/datasets/DatasetSelectLabel';\nimport {\n  ALLOW_DEPENDENCIES as TYPES_SUPPORT_DEPENDENCIES,\n  getFiltersConfigModalTestId,\n} from '../FiltersConfigModal';\nimport { FilterRemoval, NativeFiltersForm } from '../types';\nimport { CollapsibleControl } from './CollapsibleControl';\nimport { ColumnSelect } from './ColumnSelect';\nimport DatasetSelect from './DatasetSelect';\nimport DefaultValue from './DefaultValue';\nimport FilterScope from './FilterScope/FilterScope';\nimport getControlItemsMap from './getControlItemsMap';\nimport RemovedFilter from './RemovedFilter';\nimport { useBackendFormUpdate, useDefaultValue } from './state';\nimport {\n  hasTemporalColumns,\n  mostUsedDataset,\n  setNativeFilterFieldValues,\n  useForceUpdate,\n} from './utils';\nimport { FILTER_SUPPORTED_TYPES, INPUT_WIDTH } from './constants';\nimport DependencyList from './DependencyList';\n\nconst FORM_ITEM_WIDTH = 260;\n\nconst TabPane = styled(Tabs.TabPane)`\n  padding: ${({ theme }) => theme.gridUnit * 4}px 0px;\n`;\n\nconst StyledContainer = styled.div`\n  ${({ theme }) => `\n    display: flex;\n    flex-direction: row-reverse;\n    justify-content: space-between;\n    padding: 0px ${theme.gridUnit * 4}px;\n  `}\n`;\n\nconst StyledRowContainer = styled.div`\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  width: 100%;\n  padding: 0px ${({ theme }) => theme.gridUnit * 4}px;\n`;\n\ntype ControlKey = keyof PluginFilterSelectCustomizeProps;\n\nconst controlsOrder: ControlKey[] = [\n  'enableEmptyFilter',\n  'defaultToFirstItem',\n  'multiSelect',\n  'searchAllOptions',\n  'inverseSelection',\n];\n\nexport const StyledFormItem = styled(FormItem)<{ expanded: boolean }>`\n  width: ${({ expanded }) => (expanded ? '49%' : `${FORM_ITEM_WIDTH}px`)};\n  margin-bottom: ${({ theme }) => theme.gridUnit * 4}px;\n\n  & .ant-form-item-label {\n    padding-bottom: 0;\n  }\n\n  & .ant-form-item-control-input {\n    min-height: ${({ theme }) => theme.gridUnit * 10}px;\n  }\n`;\n\nexport const StyledRowFormItem = styled(FormItem)<{ expanded: boolean }>`\n  margin-bottom: 0;\n  padding-bottom: 0;\n  min-width: ${({ expanded }) => (expanded ? '50%' : `${FORM_ITEM_WIDTH}px`)};\n\n  & .ant-form-item-label {\n    padding-bottom: 0;\n  }\n\n  .ant-form-item-control-input-content > div > div {\n    height: auto;\n  }\n\n  & .ant-form-item-control-input {\n    min-height: ${({ theme }) => theme.gridUnit * 10}px;\n  }\n`;\n\nexport const StyledRowSubFormItem = styled(FormItem)<{ expanded: boolean }>`\n  min-width: ${({ expanded }) => (expanded ? '50%' : `${FORM_ITEM_WIDTH}px`)};\n\n  & .ant-form-item-label {\n    padding-bottom: 0;\n  }\n\n  .ant-form-item {\n    margin-bottom: 0;\n  }\n\n  .ant-form-item-control-input-content > div > div {\n    height: auto;\n  }\n\n  .ant-form-item-extra {\n    display: none;\n  }\n\n  & .ant-form-item-control-input {\n    height: auto;\n  }\n`;\n\nexport const StyledLabel = styled.span`\n  color: ${({ theme }) => theme.colors.grayscale.base};\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  text-transform: uppercase;\n`;\n\nconst CleanFormItem = styled(FormItem)`\n  margin-bottom: 0;\n`;\n\nconst DefaultValueContainer = styled.div`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n`;\n\nconst RefreshIcon = styled(Icons.Refresh)`\n  margin-left: ${({ theme }) => theme.gridUnit * 2}px;\n  color: ${({ theme }) => theme.colors.primary.base};\n`;\n\nconst StyledCollapse = styled(Collapse)`\n  border-left: 0;\n  border-top: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  border-radius: 0;\n\n  .ant-collapse-header {\n    border-bottom: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    border-top: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    margin-top: -1px;\n    border-radius: 0;\n  }\n\n  .ant-collapse-content {\n    border: 0;\n  }\n\n  .ant-collapse-content-box {\n    padding-top: ${({ theme }) => theme.gridUnit * 2}px;\n  }\n\n  &.ant-collapse > .ant-collapse-item {\n    border: 0;\n    border-radius: 0;\n  }\n`;\n\nconst StyledTabs = styled(Tabs)`\n  .ant-tabs-nav {\n    position: sticky;\n    top: 0;\n    background: ${({ theme }) => theme.colors.grayscale.light5};\n    z-index: 1;\n  }\n\n  .ant-tabs-nav-list {\n    padding: 0;\n  }\n\n  .ant-form-item-label {\n    padding-bottom: 0;\n  }\n`;\n\nconst StyledAsterisk = styled.span`\n  color: ${({ theme }) => theme.colors.error.base};\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  margin-left: ${({ theme }) => theme.gridUnit - 1}px;\n  &:before {\n    content: '*';\n  }\n`;\n\nconst FilterTypeInfo = styled.div<{ expanded: boolean }>`\n  ${({ theme, expanded }) => `\n    width: ${expanded ? '49%' : `${FORM_ITEM_WIDTH}px`};\n    font-size: ${theme.typography.sizes.s}px;\n    color: ${theme.colors.grayscale.light1};\n    margin:\n      ${-theme.gridUnit * 2}px\n      0px\n      ${theme.gridUnit * 4}px\n      ${theme.gridUnit * 4}px;\n  `}\n`;\n\nconst FilterTabs = {\n  configuration: {\n    key: 'configuration',\n    name: t('Settings'),\n  },\n  scoping: {\n    key: 'scoping',\n    name: t('Scoping'),\n  },\n};\n\nexport const FilterPanels = {\n  configuration: {\n    key: 'configuration',\n    name: t('Filter Configuration'),\n  },\n  settings: {\n    key: 'settings',\n    name: t('Filter Settings'),\n  },\n};\n\nexport interface FiltersConfigFormProps {\n  expanded: boolean;\n  filterId: string;\n  filterToEdit?: Filter;\n  removedFilters: Record<string, FilterRemoval>;\n  restoreFilter: (filterId: string) => void;\n  form: FormInstance<NativeFiltersForm>;\n  getAvailableFilters: (\n    filterId: string,\n  ) => { label: string; value: string; type: string | undefined }[];\n  handleActiveFilterPanelChange: (activeFilterPanel: string | string[]) => void;\n  activeFilterPanelKeys: string | string[];\n  isActive: boolean;\n  setErroredFilters: (f: (filters: string[]) => string[]) => void;\n  validateDependencies: () => void;\n  getDependencySuggestion: (filterId: string) => string;\n}\n\nconst FILTERS_WITH_ADHOC_FILTERS = ['filter_select', 'filter_range'];\n\n// TODO: Rename the filter plugins and remove this mapping\nconst FILTER_TYPE_NAME_MAPPING = {\n  [t('Select filter')]: t('Value'),\n  [t('Range filter')]: t('Numerical range'),\n  [t('Time filter')]: t('Time range'),\n  [t('Time column')]: t('Time column'),\n  [t('Time grain')]: t('Time grain'),\n  [t('Group By')]: t('Group by'),\n};\n\n/**\n * The configuration form for a specific filter.\n * Assigns field values to `filters[filterId]` in the form.\n */\nconst FiltersConfigForm = (\n  {\n    expanded,\n    filterId,\n    filterToEdit,\n    removedFilters,\n    form,\n    getAvailableFilters,\n    activeFilterPanelKeys,\n    restoreFilter,\n    handleActiveFilterPanelChange,\n    setErroredFilters,\n    validateDependencies,\n    getDependencySuggestion,\n    isActive,\n  }: FiltersConfigFormProps,\n  ref: RefObject<any>,\n) => {\n  const isRemoved = !!removedFilters[filterId];\n  const [error, setError] = useState<ClientErrorObject>();\n  const [metrics, setMetrics] = useState<Metric[]>([]);\n  const [activeTabKey, setActiveTabKey] = useState<string>(\n    FilterTabs.configuration.key,\n  );\n  const dashboardId = useSelector<RootState, number>(\n    state => state.dashboardInfo.id,\n  );\n  const [undoFormValues, setUndoFormValues] = useState<Record<\n    string,\n    any\n  > | null>(null);\n  const forceUpdate = useForceUpdate(isActive);\n  const [datasetDetails, setDatasetDetails] = useState<Record<string, any>>();\n  const defaultFormFilter = useMemo(() => ({}), []);\n  const filters = form.getFieldValue('filters');\n  const formValues = filters?.[filterId];\n  const formFilter = formValues || undoFormValues || defaultFormFilter;\n\n  const dependencies: string[] =\n    formFilter?.dependencies || filterToEdit?.cascadeParentIds || [];\n\n  const nativeFilterItems = getChartMetadataRegistry().items;\n  const nativeFilterVizTypes = Object.entries(nativeFilterItems)\n    // @ts-ignore\n    .filter(([, { value }]) => value.behaviors?.includes(Behavior.NativeFilter))\n    .map(([key]) => key as keyof typeof FILTER_SUPPORTED_TYPES);\n\n  const loadedDatasets = useSelector<RootState, DatasourcesState>(\n    ({ datasources }) => datasources,\n  );\n\n  const charts = useSelector<RootState, ChartsState>(({ charts }) => charts);\n\n  const doLoadedDatasetsHaveTemporalColumns = useMemo(\n    () =>\n      Object.values(loadedDatasets).some(dataset =>\n        hasTemporalColumns(dataset),\n      ),\n    [loadedDatasets],\n  );\n\n  const showTimeRangePicker = useMemo(() => {\n    const currentDataset = Object.values(loadedDatasets).find(\n      dataset => dataset.id === formFilter?.dataset?.value,\n    );\n\n    return currentDataset ? hasTemporalColumns(currentDataset) : true;\n  }, [formFilter?.dataset?.value, loadedDatasets]);\n\n  const hasDataset =\n    // @ts-ignore\n    !!nativeFilterItems[formFilter?.filterType]?.value?.datasourceCount;\n\n  const datasetId =\n    formFilter?.dataset?.value ??\n    filterToEdit?.targets[0]?.datasetId ??\n    mostUsedDataset(loadedDatasets, charts);\n\n  const { controlItems = {}, mainControlItems = {} } = formFilter\n    ? getControlItemsMap({\n        expanded,\n        datasetId,\n        disabled: false,\n        forceUpdate,\n        form,\n        filterId,\n        filterType: formFilter?.filterType,\n        filterToEdit,\n        formFilter,\n        removed: isRemoved,\n      })\n    : {};\n  const hasColumn = !!mainControlItems.groupby;\n\n  const nativeFilterItem = nativeFilterItems[formFilter?.filterType] ?? {};\n  // @ts-ignore\n  const enableNoResults = !!nativeFilterItem.value?.enableNoResults;\n\n  const hasMetrics = hasColumn && !!metrics.length;\n\n  const hasFilledDataset =\n    !hasDataset || (datasetId && (formFilter?.column || !hasColumn));\n\n  const hasAdditionalFilters = FILTERS_WITH_ADHOC_FILTERS.includes(\n    formFilter?.filterType,\n  );\n\n  const canDependOnOtherFilters = TYPES_SUPPORT_DEPENDENCIES.includes(\n    formFilter?.filterType,\n  );\n\n  const isDataDirty = formFilter?.isDataDirty ?? true;\n\n  const setNativeFilterFieldValuesWrapper = (values: object) => {\n    setNativeFilterFieldValues(form, filterId, values);\n    setError(undefined);\n    forceUpdate();\n  };\n\n  const setErrorWrapper = (error: ClientErrorObject) => {\n    setNativeFilterFieldValues(form, filterId, {\n      defaultValueQueriesData: null,\n    });\n    setError(error);\n    forceUpdate();\n  };\n\n  // Calculates the dependencies default values to be used\n  // to extract the available values to the filter\n  let dependenciesDefaultValues = {};\n  if (dependencies && dependencies.length > 0 && filters) {\n    dependencies.forEach(dependency => {\n      const extraFormData = filters[dependency]?.defaultDataMask?.extraFormData;\n      dependenciesDefaultValues = mergeExtraFormData(\n        dependenciesDefaultValues,\n        extraFormData,\n      );\n    });\n  }\n\n  const dependenciesText = JSON.stringify(dependenciesDefaultValues);\n\n  const refreshHandler = useCallback(\n    (force = false) => {\n      if (!hasDataset || !formFilter?.dataset?.value) {\n        forceUpdate();\n        return;\n      }\n      const formData = getFormData({\n        datasetId: formFilter?.dataset?.value,\n        dashboardId,\n        groupby: formFilter?.column,\n        ...formFilter,\n      });\n\n      formData.extra_form_data = dependenciesDefaultValues;\n\n      setNativeFilterFieldValuesWrapper({\n        defaultValueQueriesData: null,\n        isDataDirty: false,\n      });\n      getChartDataRequest({\n        formData,\n        force,\n      })\n        .then(({ response, json }) => {\n          if (isFeatureEnabled(FeatureFlag.GlobalAsyncQueries)) {\n            // deal with getChartDataRequest transforming the response data\n            const result = 'result' in json ? json.result[0] : json;\n\n            if (response.status === 200) {\n              setNativeFilterFieldValuesWrapper({\n                defaultValueQueriesData: [result],\n              });\n            } else if (response.status === 202) {\n              waitForAsyncData(result)\n                .then((asyncResult: ChartDataResponseResult[]) => {\n                  setNativeFilterFieldValuesWrapper({\n                    defaultValueQueriesData: asyncResult,\n                  });\n                })\n                .catch((error: Response) => {\n                  getClientErrorObject(error).then(clientErrorObject => {\n                    setErrorWrapper(clientErrorObject);\n                  });\n                });\n            } else {\n              throw new Error(\n                `Received unexpected response status (${response.status}) while fetching chart data`,\n              );\n            }\n          } else {\n            setNativeFilterFieldValuesWrapper({\n              defaultValueQueriesData: json.result,\n            });\n          }\n        })\n        .catch((error: Response) => {\n          getClientErrorObject(error).then(clientErrorObject => {\n            setError(clientErrorObject);\n          });\n        });\n    },\n    [filterId, forceUpdate, form, formFilter, hasDataset, dependenciesText],\n  );\n\n  // TODO: refreshHandler changes itself because of the dependencies. Needs refactor.\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  useEffect(() => refreshHandler(), [dependenciesText]);\n\n  const newFormData = getFormData({\n    datasetId,\n    groupby: hasColumn ? formFilter?.column : undefined,\n    ...formFilter,\n  });\n  newFormData.extra_form_data = dependenciesDefaultValues;\n\n  const [hasDefaultValue, isRequired, defaultValueTooltip, setHasDefaultValue] =\n    useDefaultValue(formFilter, filterToEdit);\n\n  const showDataset =\n    !datasetId || datasetDetails || formFilter?.dataset?.label;\n\n  const formChanged = useCallback(() => {\n    form.setFields([\n      {\n        name: 'changed',\n        value: true,\n      },\n    ]);\n  }, [form]);\n\n  const updateFormValues = useCallback(\n    (values: any) => {\n      setNativeFilterFieldValues(form, filterId, values);\n      formChanged();\n    },\n    [filterId, form, formChanged],\n  );\n\n  const hasPreFilter =\n    !!formFilter?.adhoc_filters ||\n    !!formFilter?.time_range ||\n    !!filterToEdit?.adhoc_filters?.length ||\n    !!filterToEdit?.time_range;\n\n  const hasEnableSingleValue =\n    formFilter?.controlValues?.enableSingleValue !== undefined ||\n    filterToEdit?.controlValues?.enableSingleValue !== undefined;\n\n  let enableSingleValue = filterToEdit?.controlValues?.enableSingleValue;\n  if (formFilter?.controlValues?.enableSingleMaxValue !== undefined) {\n    ({ enableSingleValue } = formFilter.controlValues);\n  }\n\n  const hasSorting =\n    typeof formFilter?.controlValues?.sortAscending === 'boolean' ||\n    typeof filterToEdit?.controlValues?.sortAscending === 'boolean';\n\n  let sort = filterToEdit?.controlValues?.sortAscending;\n  if (typeof formFilter?.controlValues?.sortAscending === 'boolean') {\n    sort = formFilter.controlValues.sortAscending;\n  }\n\n  const showDefaultValue =\n    !hasDataset ||\n    (!isDataDirty && hasFilledDataset) ||\n    !mainControlItems.groupby;\n\n  const onSortChanged = (value: boolean | undefined) => {\n    const previous = form.getFieldValue('filters')?.[filterId].controlValues;\n    setNativeFilterFieldValues(form, filterId, {\n      controlValues: {\n        ...previous,\n        sortAscending: value,\n      },\n    });\n    forceUpdate();\n  };\n\n  const onEnableSingleValueChanged = (value: SingleValueType | undefined) => {\n    const previous = form.getFieldValue('filters')?.[filterId].controlValues;\n    setNativeFilterFieldValues(form, filterId, {\n      controlValues: {\n        ...previous,\n        enableSingleValue: value,\n      },\n    });\n    forceUpdate();\n  };\n\n  const validatePreFilter = () =>\n    setTimeout(\n      () =>\n        form.validateFields([\n          ['filters', filterId, 'adhoc_filters'],\n          ['filters', filterId, 'time_range'],\n        ]),\n      0,\n    );\n\n  const hasTimeRange =\n    formFilter?.time_range && formFilter.time_range !== 'No filter';\n\n  const hasAdhoc = formFilter?.adhoc_filters?.length > 0;\n\n  const defaultToFirstItem = formFilter?.controlValues?.defaultToFirstItem;\n\n  const initialDefaultValue =\n    formFilter?.filterType === filterToEdit?.filterType\n      ? filterToEdit?.defaultDataMask\n      : null;\n\n  const preFilterValidator = () => {\n    if (hasTimeRange || hasAdhoc) {\n      return Promise.resolve();\n    }\n    return Promise.reject(new Error(t('Pre-filter is required')));\n  };\n\n  const availableFilters = getAvailableFilters(filterId);\n  const hasAvailableFilters = availableFilters.length > 0;\n  const hasTimeDependency = availableFilters\n    .filter(filter => filter.type === 'filter_time')\n    .some(filter => dependencies?.includes(filter.value));\n\n  useEffect(() => {\n    if (datasetId) {\n      cachedSupersetGet({\n        endpoint: `/api/v1/dataset/${datasetId}?q=${rison.encode({\n          columns: [\n            'columns.column_name',\n            'columns.expression',\n            'columns.filterable',\n            'columns.is_dttm',\n            'columns.type',\n            'columns.verbose_name',\n            'database.id',\n            'database.database_name',\n            'datasource_type',\n            'filter_select_enabled',\n            'id',\n            'is_sqllab_view',\n            'main_dttm_col',\n            'metrics.metric_name',\n            'metrics.verbose_name',\n            'schema',\n            'sql',\n            'table_name',\n          ],\n        })}`,\n      })\n        .then((response: JsonResponse) => {\n          setMetrics(response.json?.result?.metrics);\n          const dataset = response.json?.result;\n          // modify the response to fit structure expected by AdhocFilterControl\n          dataset.type = dataset.datasource_type;\n          dataset.filter_select = true;\n          setDatasetDetails(dataset);\n        })\n        .catch((response: SupersetApiError) => {\n          addDangerToast(response.message);\n        });\n    }\n  }, [datasetId]);\n\n  useImperativeHandle(ref, () => ({\n    changeTab(tab: 'configuration' | 'scoping') {\n      setActiveTabKey(tab);\n    },\n  }));\n\n  useBackendFormUpdate(form, filterId);\n\n  useEffect(() => {\n    if (hasDataset && hasFilledDataset && hasDefaultValue && isDataDirty) {\n      refreshHandler();\n    }\n  }, [\n    hasDataset,\n    hasFilledDataset,\n    hasDefaultValue,\n    isDataDirty,\n    refreshHandler,\n    showDataset,\n  ]);\n\n  const initiallyExcludedCharts = useMemo(() => {\n    const excluded: number[] = [];\n    if (formFilter?.dataset?.value === undefined) {\n      return [];\n    }\n\n    Object.values(charts).forEach((chart: Chart) => {\n      const chartDatasetUid = chart.form_data?.datasource;\n      if (chartDatasetUid === undefined) {\n        return;\n      }\n      if (loadedDatasets[chartDatasetUid]?.id !== formFilter?.dataset?.value) {\n        excluded.push(chart.id);\n      }\n    });\n    return excluded;\n  }, [\n    JSON.stringify(charts),\n    formFilter?.dataset?.value,\n    JSON.stringify(loadedDatasets),\n  ]);\n\n  useEffect(() => {\n    // just removed, saving current form items for eventual undo\n    if (isRemoved) {\n      setUndoFormValues(formValues);\n    }\n  }, [isRemoved]);\n\n  useEffect(() => {\n    // the filter was just restored after undo\n    if (undoFormValues && !isRemoved) {\n      setNativeFilterFieldValues(form, filterId, undoFormValues);\n      setUndoFormValues(null);\n    }\n  }, [formValues, filterId, form, isRemoved, undoFormValues]);\n\n  if (isRemoved) {\n    return <RemovedFilter onClick={() => restoreFilter(filterId)} />;\n  }\n\n  const timeColumn = (\n    <StyledRowFormItem\n      expanded={expanded}\n      name={['filters', filterId, 'granularity_sqla']}\n      label={\n        <>\n          <StyledLabel>{t('Time column')}</StyledLabel>&nbsp;\n          <InfoTooltipWithTrigger\n            placement=\"top\"\n            tooltip={\n              hasTimeDependency\n                ? t('Time column to apply dependent temporal filter to')\n                : t('Time column to apply time range to')\n            }\n          />\n        </>\n      }\n      initialValue={filterToEdit?.granularity_sqla}\n    >\n      <ColumnSelect\n        allowClear\n        form={form}\n        formField=\"granularity_sqla\"\n        filterId={filterId}\n        filterValues={(column: Column) => !!column.is_dttm}\n        datasetId={datasetId}\n        onChange={column => {\n          // We need reset default value when when column changed\n          setNativeFilterFieldValues(form, filterId, {\n            granularity_sqla: column,\n          });\n          forceUpdate();\n        }}\n      />\n    </StyledRowFormItem>\n  );\n\n  return (\n    <StyledTabs\n      activeKey={activeTabKey}\n      onChange={activeKey => setActiveTabKey(activeKey)}\n      centered\n    >\n      <TabPane\n        tab={FilterTabs.configuration.name}\n        key={FilterTabs.configuration.key}\n        forceRender\n      >\n        <StyledContainer>\n          <StyledFormItem\n            expanded={expanded}\n            name={['filters', filterId, 'type']}\n            hidden\n            initialValue={NativeFilterType.NativeFilter}\n          >\n            <Input />\n          </StyledFormItem>\n          <StyledFormItem\n            expanded={expanded}\n            name={['filters', filterId, 'name']}\n            label={<StyledLabel>{t('Filter name')}</StyledLabel>}\n            initialValue={filterToEdit?.name}\n            rules={[{ required: !isRemoved, message: t('Name is required') }]}\n          >\n            <Input {...getFiltersConfigModalTestId('name-input')} />\n          </StyledFormItem>\n          <StyledFormItem\n            expanded={expanded}\n            name={['filters', filterId, 'filterType']}\n            rules={[{ required: !isRemoved, message: t('Name is required') }]}\n            initialValue={filterToEdit?.filterType || 'filter_select'}\n            label={<StyledLabel>{t('Filter Type')}</StyledLabel>}\n            {...getFiltersConfigModalTestId('filter-type')}\n          >\n            <Select\n              ariaLabel={t('Filter type')}\n              options={nativeFilterVizTypes.map(filterType => {\n                // @ts-ignore\n                const name = nativeFilterItems[filterType]?.value.name;\n                const mappedName = name\n                  ? FILTER_TYPE_NAME_MAPPING[name]\n                  : undefined;\n                const isDisabled =\n                  FILTER_SUPPORTED_TYPES[filterType]?.length === 1 &&\n                  FILTER_SUPPORTED_TYPES[filterType]?.includes(\n                    GenericDataType.Temporal,\n                  ) &&\n                  !doLoadedDatasetsHaveTemporalColumns;\n                return {\n                  value: filterType,\n                  label: mappedName || name,\n                  customLabel: isDisabled ? (\n                    <Tooltip\n                      title={t('Datasets do not contain a temporal column')}\n                    >\n                      {mappedName || name}\n                    </Tooltip>\n                  ) : undefined,\n                  disabled: isDisabled,\n                };\n              })}\n              onChange={value => {\n                setNativeFilterFieldValues(form, filterId, {\n                  filterType: value,\n                  defaultDataMask: null,\n                  column: null,\n                });\n                forceUpdate();\n              }}\n            />\n          </StyledFormItem>\n        </StyledContainer>\n        {formFilter?.filterType === 'filter_time' && (\n          <FilterTypeInfo expanded={expanded}>\n            {t(`Dashboard time range filters apply to temporal columns defined in\n          the filter section of each chart. Add temporal columns to the chart\n          filters to have this dashboard filter impact those charts.`)}\n          </FilterTypeInfo>\n        )}\n        {hasDataset && (\n          <StyledRowContainer>\n            {showDataset ? (\n              <StyledFormItem\n                expanded={expanded}\n                name={['filters', filterId, 'dataset']}\n                label={<StyledLabel>{t('Dataset')}</StyledLabel>}\n                initialValue={\n                  datasetDetails\n                    ? {\n                        label: DatasetSelectLabel({\n                          id: datasetDetails.id,\n                          table_name: datasetDetails.table_name,\n                          schema: datasetDetails.schema,\n                          database: {\n                            database_name:\n                              datasetDetails.database.database_name,\n                          },\n                        }),\n                        value: datasetDetails.id,\n                      }\n                    : undefined\n                }\n                rules={[\n                  { required: !isRemoved, message: t('Dataset is required') },\n                ]}\n                {...getFiltersConfigModalTestId('datasource-input')}\n              >\n                <DatasetSelect\n                  onChange={(value: { label: string; value: number }) => {\n                    // We need to reset the column when the dataset has changed\n                    if (value.value !== datasetId) {\n                      setNativeFilterFieldValues(form, filterId, {\n                        dataset: value,\n                        defaultDataMask: null,\n                        column: null,\n                      });\n                    }\n                    forceUpdate();\n                  }}\n                />\n              </StyledFormItem>\n            ) : (\n              <StyledFormItem\n                expanded={expanded}\n                label={<StyledLabel>{t('Dataset')}</StyledLabel>}\n              >\n                <Loading position=\"inline-centered\" />\n              </StyledFormItem>\n            )}\n            {hasDataset &&\n              Object.keys(mainControlItems).map(\n                key => mainControlItems[key].element,\n              )}\n          </StyledRowContainer>\n        )}\n        <StyledCollapse\n          defaultActiveKey={activeFilterPanelKeys}\n          onChange={key => {\n            handleActiveFilterPanelChange(key);\n          }}\n          expandIconPosition=\"right\"\n          key={`native-filter-config-${filterId}`}\n        >\n          {formFilter?.filterType !== 'filter_time' && (\n            <Collapse.Panel\n              forceRender\n              header={FilterPanels.configuration.name}\n              key={`${filterId}-${FilterPanels.configuration.key}`}\n            >\n              {canDependOnOtherFilters && hasAvailableFilters && (\n                <StyledRowFormItem\n                  expanded={expanded}\n                  name={['filters', filterId, 'dependencies']}\n                  initialValue={dependencies}\n                >\n                  <DependencyList\n                    availableFilters={availableFilters}\n                    dependencies={dependencies}\n                    onDependenciesChange={dependencies => {\n                      setNativeFilterFieldValues(form, filterId, {\n                        dependencies,\n                      });\n                      forceUpdate();\n                      validateDependencies();\n                      formChanged();\n                    }}\n                    getDependencySuggestion={() =>\n                      getDependencySuggestion(filterId)\n                    }\n                  >\n                    {hasTimeDependency ? timeColumn : undefined}\n                  </DependencyList>\n                </StyledRowFormItem>\n              )}\n              {hasDataset && hasAdditionalFilters && (\n                <CleanFormItem name={['filters', filterId, 'preFilter']}>\n                  <CollapsibleControl\n                    initialValue={hasPreFilter}\n                    title={t('Pre-filter available values')}\n                    tooltip={t(`Add filter clauses to control the filter's source query,\n                    though only in the context of the autocomplete i.e., these conditions\n                    do not impact how the filter is applied to the dashboard. This is useful\n                    when you want to improve the query's performance by only scanning a subset\n                    of the underlying data or limit the available values displayed in the filter.`)}\n                    onChange={checked => {\n                      formChanged();\n                      if (checked) {\n                        validatePreFilter();\n                      }\n                    }}\n                  >\n                    <StyledRowSubFormItem\n                      expanded={expanded}\n                      name={['filters', filterId, 'adhoc_filters']}\n                      css={{ width: INPUT_WIDTH }}\n                      initialValue={filterToEdit?.adhoc_filters}\n                      required\n                      rules={[\n                        {\n                          validator: preFilterValidator,\n                        },\n                      ]}\n                    >\n                      <AdhocFilterControl\n                        columns={\n                          datasetDetails?.columns?.filter(\n                            (c: ColumnMeta) => c.filterable,\n                          ) || []\n                        }\n                        savedMetrics={datasetDetails?.metrics || []}\n                        datasource={datasetDetails}\n                        onChange={(filters: AdhocFilter[]) => {\n                          setNativeFilterFieldValues(form, filterId, {\n                            adhoc_filters: filters,\n                          });\n                          forceUpdate();\n                          validatePreFilter();\n                        }}\n                        label={\n                          <span>\n                            <StyledLabel>{t('Pre-filter')}</StyledLabel>\n                            {!hasTimeRange && <StyledAsterisk />}\n                          </span>\n                        }\n                      />\n                    </StyledRowSubFormItem>\n                    {showTimeRangePicker && (\n                      <StyledRowFormItem\n                        expanded={expanded}\n                        name={['filters', filterId, 'time_range']}\n                        label={<StyledLabel>{t('Time range')}</StyledLabel>}\n                        initialValue={\n                          filterToEdit?.time_range || t('No filter')\n                        }\n                        required={!hasAdhoc}\n                        rules={[\n                          {\n                            validator: preFilterValidator,\n                          },\n                        ]}\n                      >\n                        <DateFilterControl\n                          name=\"time_range\"\n                          onChange={timeRange => {\n                            setNativeFilterFieldValues(form, filterId, {\n                              time_range: timeRange,\n                            });\n                            forceUpdate();\n                            validatePreFilter();\n                          }}\n                        />\n                      </StyledRowFormItem>\n                    )}\n                    {hasTimeRange && !hasTimeDependency\n                      ? timeColumn\n                      : undefined}\n                  </CollapsibleControl>\n                </CleanFormItem>\n              )}\n              {formFilter?.filterType !== 'filter_range' ? (\n                <CleanFormItem name={['filters', filterId, 'sortFilter']}>\n                  <CollapsibleControl\n                    initialValue={hasSorting}\n                    title={t('Sort filter values')}\n                    onChange={checked => {\n                      onSortChanged(checked || undefined);\n                      formChanged();\n                    }}\n                  >\n                    <StyledRowFormItem\n                      expanded={expanded}\n                      name={[\n                        'filters',\n                        filterId,\n                        'controlValues',\n                        'sortAscending',\n                      ]}\n                      initialValue={sort}\n                      label={<StyledLabel>{t('Sort type')}</StyledLabel>}\n                    >\n                      <Radio.Group\n                        onChange={value => {\n                          onSortChanged(value.target.value);\n                        }}\n                      >\n                        <Radio value>{t('Sort ascending')}</Radio>\n                        <Radio value={false}>{t('Sort descending')}</Radio>\n                      </Radio.Group>\n                    </StyledRowFormItem>\n                    {hasMetrics && (\n                      <StyledRowSubFormItem\n                        expanded={expanded}\n                        name={['filters', filterId, 'sortMetric']}\n                        initialValue={filterToEdit?.sortMetric}\n                        label={\n                          <>\n                            <StyledLabel>{t('Sort Metric')}</StyledLabel>&nbsp;\n                            <InfoTooltipWithTrigger\n                              placement=\"top\"\n                              tooltip={t(\n                                'If a metric is specified, sorting will be done based on the metric value',\n                              )}\n                            />\n                          </>\n                        }\n                        data-test=\"field-input\"\n                      >\n                        <Select\n                          allowClear\n                          ariaLabel={t('Sort metric')}\n                          name=\"sortMetric\"\n                          options={metrics.map((metric: Metric) => ({\n                            value: metric.metric_name,\n                            label: metric.verbose_name ?? metric.metric_name,\n                          }))}\n                          onChange={value => {\n                            if (value !== undefined) {\n                              setNativeFilterFieldValues(form, filterId, {\n                                sortMetric: value,\n                              });\n                              forceUpdate();\n                            }\n                          }}\n                        />\n                      </StyledRowSubFormItem>\n                    )}\n                  </CollapsibleControl>\n                </CleanFormItem>\n              ) : (\n                <CleanFormItem name={['filters', filterId, 'rangeFilter']}>\n                  <CollapsibleControl\n                    initialValue={hasEnableSingleValue}\n                    title={t('Single Value')}\n                    onChange={checked => {\n                      onEnableSingleValueChanged(\n                        checked ? SingleValueType.Exact : undefined,\n                      );\n                      formChanged();\n                    }}\n                  >\n                    <StyledRowFormItem\n                      expanded={expanded}\n                      name={[\n                        'filters',\n                        filterId,\n                        'controlValues',\n                        'enableSingleValue',\n                      ]}\n                      initialValue={enableSingleValue}\n                      label={\n                        <StyledLabel>{t('Single value type')}</StyledLabel>\n                      }\n                    >\n                      <Radio.Group\n                        onChange={value =>\n                          onEnableSingleValueChanged(value.target.value)\n                        }\n                      >\n                        <Radio value={SingleValueType.Minimum}>\n                          {t('Minimum')}\n                        </Radio>\n                        <Radio value={SingleValueType.Exact}>\n                          {t('Exact')}\n                        </Radio>\n                        <Radio value={SingleValueType.Maximum}>\n                          {t('Maximum')}\n                        </Radio>\n                      </Radio.Group>\n                    </StyledRowFormItem>\n                  </CollapsibleControl>\n                </CleanFormItem>\n              )}\n            </Collapse.Panel>\n          )}\n          <Collapse.Panel\n            forceRender\n            header={FilterPanels.settings.name}\n            key={`${filterId}-${FilterPanels.settings.key}`}\n          >\n            <StyledFormItem\n              expanded={expanded}\n              name={['filters', filterId, 'description']}\n              initialValue={filterToEdit?.description}\n              label={<StyledLabel>{t('Description')}</StyledLabel>}\n            >\n              <TextArea />\n            </StyledFormItem>\n            <CleanFormItem\n              name={['filters', filterId, 'defaultValueQueriesData']}\n              hidden\n              initialValue={null}\n            />\n            <CleanFormItem name={['filters', filterId, 'defaultValue']}>\n              <CollapsibleControl\n                checked={hasDefaultValue}\n                disabled={isRequired || defaultToFirstItem}\n                initialValue={hasDefaultValue}\n                title={t('Filter has default value')}\n                tooltip={defaultValueTooltip}\n                onChange={value => {\n                  setHasDefaultValue(value);\n                  if (!value) {\n                    setNativeFilterFieldValues(form, filterId, {\n                      defaultDataMask: null,\n                    });\n                  }\n                  formChanged();\n                }}\n              >\n                {!isRemoved && (\n                  <StyledRowSubFormItem\n                    expanded={expanded}\n                    name={['filters', filterId, 'defaultDataMask']}\n                    initialValue={initialDefaultValue}\n                    data-test=\"default-input\"\n                    label={<StyledLabel>{t('Default Value')}</StyledLabel>}\n                    required={hasDefaultValue}\n                    rules={[\n                      {\n                        validator: () => {\n                          if (formFilter?.defaultDataMask?.filterState?.value) {\n                            // requires managing the error as the DefaultValue\n                            // component does not use an Antdesign compatible input\n                            const formValidationFields = form.getFieldsError();\n                            setErroredFilters(prevErroredFilters => {\n                              if (\n                                prevErroredFilters.length &&\n                                !formValidationFields.find(\n                                  f => f.errors.length > 0,\n                                )\n                              ) {\n                                return [];\n                              }\n                              return prevErroredFilters;\n                            });\n                            return Promise.resolve();\n                          }\n                          setErroredFilters(prevErroredFilters => {\n                            if (prevErroredFilters.includes(filterId)) {\n                              return prevErroredFilters;\n                            }\n                            return [...prevErroredFilters, filterId];\n                          });\n                          return Promise.reject(\n                            new Error(t('Default value is required')),\n                          );\n                        },\n                      },\n                    ]}\n                  >\n                    {error || showDefaultValue ? (\n                      <DefaultValueContainer>\n                        {error ? (\n                          <ErrorMessageWithStackTrace\n                            error={error.errors?.[0]}\n                            fallback={\n                              <BasicErrorAlert\n                                title={t('Cannot load filter')}\n                                body={error.error}\n                                level=\"error\"\n                              />\n                            }\n                          />\n                        ) : (\n                          <DefaultValue\n                            setDataMask={dataMask => {\n                              if (\n                                !isEqual(\n                                  initialDefaultValue?.filterState?.value,\n                                  dataMask?.filterState?.value,\n                                )\n                              ) {\n                                formChanged();\n                              }\n                              setNativeFilterFieldValues(form, filterId, {\n                                defaultDataMask: dataMask,\n                              });\n                              form.validateFields([\n                                ['filters', filterId, 'defaultDataMask'],\n                              ]);\n                              forceUpdate();\n                            }}\n                            hasDefaultValue={hasDefaultValue}\n                            filterId={filterId}\n                            hasDataset={hasDataset}\n                            form={form}\n                            formData={newFormData}\n                            enableNoResults={enableNoResults}\n                          />\n                        )}\n                        {hasDataset && datasetId && (\n                          <Tooltip title={t('Refresh the default values')}>\n                            <RefreshIcon onClick={() => refreshHandler(true)} />\n                          </Tooltip>\n                        )}\n                      </DefaultValueContainer>\n                    ) : (\n                      t('Fill all required fields to enable \"Default Value\"')\n                    )}\n                  </StyledRowSubFormItem>\n                )}\n              </CollapsibleControl>\n            </CleanFormItem>\n            {Object.keys(controlItems)\n              .sort(\n                (a, b) =>\n                  controlsOrder.indexOf(a as ControlKey) -\n                  controlsOrder.indexOf(b as ControlKey),\n              )\n              .map(key => controlItems[key].element)}\n          </Collapse.Panel>\n        </StyledCollapse>\n      </TabPane>\n      <TabPane\n        tab={FilterTabs.scoping.name}\n        key={FilterTabs.scoping.key}\n        forceRender\n      >\n        <FilterScope\n          updateFormValues={updateFormValues}\n          pathToFormValue={['filters', filterId]}\n          forceUpdate={forceUpdate}\n          filterScope={filterToEdit?.scope}\n          formFilterScope={formFilter?.scope}\n          formScopingType={formFilter?.scoping}\n          initiallyExcludedCharts={initiallyExcludedCharts}\n        />\n      </TabPane>\n    </StyledTabs>\n  );\n};\n\nexport default memo(\n  forwardRef<typeof FiltersConfigForm, FiltersConfigFormProps>(\n    FiltersConfigForm,\n  ),\n);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}