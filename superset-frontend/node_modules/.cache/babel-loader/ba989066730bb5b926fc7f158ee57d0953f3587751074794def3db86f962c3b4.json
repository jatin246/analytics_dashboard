{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useCallback, useState } from 'react';\nimport { css, t, getChartMetadataRegistry, styled } from '@superset-ui/core';\nimport { usePluginContext } from 'src/components/DynamicPlugins';\nimport Modal from 'src/components/Modal';\nimport { noOp } from 'src/utils/common';\nimport getBootstrapData from 'src/utils/getBootstrapData';\nimport { FilterPlugins } from 'src/constants';\nimport VizTypeGallery, { MAX_ADVISABLE_VIZ_GALLERY_WIDTH } from './VizTypeGallery';\nimport { FastVizSwitcher } from './FastVizSwitcher';import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"@emotion/react/jsx-runtime\";\nconst bootstrapData = getBootstrapData();\nconst denyList = (bootstrapData.common.conf.VIZ_TYPE_DENYLIST || []).concat(Object.values(FilterPlugins));\nconst metadataRegistry = getChartMetadataRegistry();\nexport const VIZ_TYPE_CONTROL_TEST_ID = 'viz-type-control';\nfunction VizSupportValidation({ vizType }) {\n  const state = usePluginContext();\n  if (state.loading || metadataRegistry.has(vizType)) {\n    return null;\n  }\n  return _jsxs(\"div\", { className: \"text-danger\", css: (theme) => css`\n        margin-top: ${theme.gridUnit}px;\n      `, children: [\n    _jsx(\"i\", { className: \"fa fa-exclamation-circle text-danger\" }), ' ',\n    _jsx(\"small\", { children: t('This visualization type is not supported.') })] }\n  );\n}__signature__(VizSupportValidation, \"usePluginContext{state}\", () => [usePluginContext]);\nconst UnpaddedModal = styled(Modal)`\n  .ant-modal-body {\n    padding: 0;\n  }\n`;\n/** Manages the viz type and the viz picker modal */\nconst VizTypeControl = ({ value: initialValue, onChange = noOp, isModalOpenInit }) => {\n  const [showModal, setShowModal] = useState(!!isModalOpenInit);\n  // a trick to force re-initialization of the gallery each time the modal opens,\n  // ensuring that the modal always opens to the correct category.\n  const [modalKey, setModalKey] = useState(0);\n  const [selectedViz, setSelectedViz] = useState(initialValue);\n  const openModal = useCallback(() => {\n    setShowModal(true);\n  }, []);\n  const onSubmit = useCallback(() => {\n    onChange(selectedViz);\n    setShowModal(false);\n  }, [selectedViz, onChange]);\n  const onCancel = useCallback(() => {\n    setShowModal(false);\n    setModalKey((key) => key + 1);\n    // make sure the modal re-opens to the last submitted viz\n    setSelectedViz(initialValue);\n  }, [initialValue]);\n  return _jsxs(_Fragment, { children: [\n    _jsxs(\"div\", { css: (theme) => css`\n          min-width: ${theme.gridUnit * 72}px;\n          max-width: fit-content;\n        `, children: [\n      _jsx(FastVizSwitcher, { onChange: onChange, currentSelection: initialValue }),\n      initialValue && _jsx(VizSupportValidation, { vizType: initialValue })] }\n    ),\n    _jsx(\"div\", { css: (theme) => css`\n          display: flex;\n          justify-content: flex-end;\n          margin-top: ${theme.gridUnit * 3}px;\n          color: ${theme.colors.grayscale.base};\n          text-decoration: underline;\n        `, children:\n      _jsx(\"span\", { role: \"button\", tabIndex: 0, onClick: openModal, children:\n        t('View all charts') }\n      ) }\n    ),\n    _jsx(UnpaddedModal, { show: showModal, onHide: onCancel, title: t('Select a visualization type'), primaryButtonName: t('Select'), disablePrimaryButton: !selectedViz, onHandledPrimaryAction: onSubmit, maxWidth: `${MAX_ADVISABLE_VIZ_GALLERY_WIDTH}px`, responsive: true, children:\n\n      _jsx(VizTypeGallery, { selectedViz: selectedViz, onChange: setSelectedViz, onDoubleClick: onSubmit, denyList: denyList }, modalKey) }\n    )] }\n  );\n};__signature__(VizTypeControl, \"useState{[showModal, setShowModal](!!isModalOpenInit)}\\nuseState{[modalKey, setModalKey](0)}\\nuseState{[selectedViz, setSelectedViz](initialValue)}\\nuseCallback{openModal}\\nuseCallback{onSubmit}\\nuseCallback{onCancel}\");const _default =\nVizTypeControl;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(bootstrapData, \"bootstrapData\", \"/app/superset-frontend/src/explore/components/controls/VizTypeControl/index.tsx\");reactHotLoader.register(denyList, \"denyList\", \"/app/superset-frontend/src/explore/components/controls/VizTypeControl/index.tsx\");reactHotLoader.register(metadataRegistry, \"metadataRegistry\", \"/app/superset-frontend/src/explore/components/controls/VizTypeControl/index.tsx\");reactHotLoader.register(VIZ_TYPE_CONTROL_TEST_ID, \"VIZ_TYPE_CONTROL_TEST_ID\", \"/app/superset-frontend/src/explore/components/controls/VizTypeControl/index.tsx\");reactHotLoader.register(VizSupportValidation, \"VizSupportValidation\", \"/app/superset-frontend/src/explore/components/controls/VizTypeControl/index.tsx\");reactHotLoader.register(UnpaddedModal, \"UnpaddedModal\", \"/app/superset-frontend/src/explore/components/controls/VizTypeControl/index.tsx\");reactHotLoader.register(VizTypeControl, \"VizTypeControl\", \"/app/superset-frontend/src/explore/components/controls/VizTypeControl/index.tsx\");reactHotLoader.register(_default, \"default\", \"/app/superset-frontend/src/explore/components/controls/VizTypeControl/index.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["useCallback","useState","css","t","getChartMetadataRegistry","styled","usePluginContext","Modal","noOp","getBootstrapData","FilterPlugins","VizTypeGallery","MAX_ADVISABLE_VIZ_GALLERY_WIDTH","FastVizSwitcher","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","bootstrapData","denyList","common","conf","VIZ_TYPE_DENYLIST","concat","Object","values","metadataRegistry","VIZ_TYPE_CONTROL_TEST_ID","VizSupportValidation","vizType","state","loading","has","className","theme","gridUnit","children","__signature__","UnpaddedModal","VizTypeControl","value","initialValue","onChange","isModalOpenInit","showModal","setShowModal","modalKey","setModalKey","selectedViz","setSelectedViz","openModal","onSubmit","onCancel","key","currentSelection","colors","grayscale","base","role","tabIndex","onClick","show","onHide","title","primaryButtonName","disablePrimaryButton","onHandledPrimaryAction","maxWidth","responsive","onDoubleClick","_default","reactHotLoader","reactHotLoaderGlobal","default","undefined","register","leaveModule","module"],"sources":["/app/superset-frontend/src/explore/components/controls/VizTypeControl/index.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useCallback, useState } from 'react';\nimport {\n  css,\n  t,\n  getChartMetadataRegistry,\n  styled,\n  SupersetTheme,\n} from '@superset-ui/core';\nimport { usePluginContext } from 'src/components/DynamicPlugins';\nimport Modal from 'src/components/Modal';\nimport { noOp } from 'src/utils/common';\nimport getBootstrapData from 'src/utils/getBootstrapData';\nimport { FilterPlugins } from 'src/constants';\nimport VizTypeGallery, {\n  MAX_ADVISABLE_VIZ_GALLERY_WIDTH,\n} from './VizTypeGallery';\nimport { FastVizSwitcher } from './FastVizSwitcher';\n\ninterface VizTypeControlProps {\n  description?: string;\n  label?: string;\n  name: string;\n  onChange: (vizType: string | null) => void;\n  value: string | null;\n  isModalOpenInit?: boolean;\n}\n\nconst bootstrapData = getBootstrapData();\nconst denyList: string[] = (\n  bootstrapData.common.conf.VIZ_TYPE_DENYLIST || []\n).concat(Object.values(FilterPlugins));\nconst metadataRegistry = getChartMetadataRegistry();\n\nexport const VIZ_TYPE_CONTROL_TEST_ID = 'viz-type-control';\n\nfunction VizSupportValidation({ vizType }: { vizType: string }) {\n  const state = usePluginContext();\n  if (state.loading || metadataRegistry.has(vizType)) {\n    return null;\n  }\n  return (\n    <div\n      className=\"text-danger\"\n      css={(theme: SupersetTheme) => css`\n        margin-top: ${theme.gridUnit}px;\n      `}\n    >\n      <i className=\"fa fa-exclamation-circle text-danger\" />{' '}\n      <small>{t('This visualization type is not supported.')}</small>\n    </div>\n  );\n}\n\nconst UnpaddedModal = styled(Modal)`\n  .ant-modal-body {\n    padding: 0;\n  }\n`;\n\n/** Manages the viz type and the viz picker modal */\nconst VizTypeControl = ({\n  value: initialValue,\n  onChange = noOp,\n  isModalOpenInit,\n}: VizTypeControlProps) => {\n  const [showModal, setShowModal] = useState(!!isModalOpenInit);\n  // a trick to force re-initialization of the gallery each time the modal opens,\n  // ensuring that the modal always opens to the correct category.\n  const [modalKey, setModalKey] = useState(0);\n  const [selectedViz, setSelectedViz] = useState<string | null>(initialValue);\n\n  const openModal = useCallback(() => {\n    setShowModal(true);\n  }, []);\n\n  const onSubmit = useCallback(() => {\n    onChange(selectedViz);\n    setShowModal(false);\n  }, [selectedViz, onChange]);\n\n  const onCancel = useCallback(() => {\n    setShowModal(false);\n    setModalKey(key => key + 1);\n    // make sure the modal re-opens to the last submitted viz\n    setSelectedViz(initialValue);\n  }, [initialValue]);\n\n  return (\n    <>\n      <div\n        css={(theme: SupersetTheme) => css`\n          min-width: ${theme.gridUnit * 72}px;\n          max-width: fit-content;\n        `}\n      >\n        <FastVizSwitcher onChange={onChange} currentSelection={initialValue} />\n        {initialValue && <VizSupportValidation vizType={initialValue} />}\n      </div>\n      <div\n        css={(theme: SupersetTheme) => css`\n          display: flex;\n          justify-content: flex-end;\n          margin-top: ${theme.gridUnit * 3}px;\n          color: ${theme.colors.grayscale.base};\n          text-decoration: underline;\n        `}\n      >\n        <span role=\"button\" tabIndex={0} onClick={openModal}>\n          {t('View all charts')}\n        </span>\n      </div>\n      <UnpaddedModal\n        show={showModal}\n        onHide={onCancel}\n        title={t('Select a visualization type')}\n        primaryButtonName={t('Select')}\n        disablePrimaryButton={!selectedViz}\n        onHandledPrimaryAction={onSubmit}\n        maxWidth={`${MAX_ADVISABLE_VIZ_GALLERY_WIDTH}px`}\n        responsive\n      >\n        {/* When the key increments, it forces react to re-init the gallery component */}\n        <VizTypeGallery\n          key={modalKey}\n          selectedViz={selectedViz}\n          onChange={setSelectedViz}\n          onDoubleClick={onSubmit}\n          denyList={denyList}\n        />\n      </UnpaddedModal>\n    </>\n  );\n};\n\nexport default VizTypeControl;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}