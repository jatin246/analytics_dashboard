{"ast":null,"code":"import _pick from \"lodash/pick\";import _omit from \"lodash/omit\";import _isObjectLike from \"lodash/isObjectLike\";import _isEqual from \"lodash/isEqual\";import _debounce from \"lodash/debounce\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport { memo, useCallback, useEffect, useMemo, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\nimport {\n  styled,\n  t,\n  css,\n  useTheme,\n  logging,\n  useChangeEffect,\n  useComponentDidMount,\n  usePrevious } from\n'@superset-ui/core';\n\nimport { Resizable } from 're-resizable';\nimport { usePluginContext } from 'src/components/DynamicPlugins';\nimport { Global } from '@emotion/react';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Icons from 'src/components/Icons';\nimport {\n  getItem,\n  setItem,\n  LocalStorageKeys } from\n'src/utils/localStorageHelpers';\nimport { RESERVED_CHART_URL_PARAMS, URL_PARAMS } from 'src/constants';\nimport { QUERY_MODE_REQUISITES } from 'src/explore/constants';\nimport { areObjectsEqual } from 'src/reduxUtils';\nimport * as logActions from 'src/logger/actions';\nimport {\n  LOG_ACTIONS_MOUNT_EXPLORER,\n  LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS } from\n'src/logger/LogUtils';\nimport { getUrlParam } from 'src/utils/urlUtils';\nimport cx from 'classnames';\nimport * as chartActions from 'src/components/Chart/chartAction';\nimport { fetchDatasourceMetadata } from 'src/dashboard/actions/datasources';\nimport { chartPropShape } from 'src/dashboard/util/propShapes';\nimport { mergeExtraFormData } from 'src/dashboard/components/nativeFilters/utils';\nimport { postFormData, putFormData } from 'src/explore/exploreUtils/formData';\nimport { datasourcesActions } from 'src/explore/actions/datasourcesActions';\nimport { mountExploreUrl } from 'src/explore/exploreUtils';\nimport { getFormDataFromControls } from 'src/explore/controlUtils';\nimport * as exploreActions from 'src/explore/actions/exploreActions';\nimport * as saveModalActions from 'src/explore/actions/saveModalActions';\nimport { useTabId } from 'src/hooks/useTabId';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport ExploreChartPanel from '../ExploreChartPanel';\nimport ConnectedControlPanelsContainer from '../ControlPanelsContainer';\nimport SaveModal from '../SaveModal';\nimport DataSourcePanel from '../DatasourcePanel';\nimport ConnectedExploreChartHeader from '../ExploreChartHeader';\nimport ExploreContainer from '../ExploreContainer';import { jsx as _jsx, jsxs as _jsxs } from \"@emotion/react/jsx-runtime\";\n\nconst propTypes = {\n  ...ExploreChartPanel.propTypes,\n  actions: PropTypes.object.isRequired,\n  datasource_type: PropTypes.string.isRequired,\n  dashboardId: PropTypes.number,\n  isDatasourceMetaLoading: PropTypes.bool.isRequired,\n  chart: chartPropShape.isRequired,\n  slice: PropTypes.object,\n  sliceName: PropTypes.string,\n  controls: PropTypes.object.isRequired,\n  forcedHeight: PropTypes.string,\n  form_data: PropTypes.object.isRequired,\n  standalone: PropTypes.bool.isRequired,\n  force: PropTypes.bool,\n  timeout: PropTypes.number,\n  impressionId: PropTypes.string,\n  vizType: PropTypes.string,\n  saveAction: PropTypes.string,\n  isSaveModalVisible: PropTypes.bool\n};\n\nconst ExplorePanelContainer = styled.div`\n  ${({ theme }) => css`\n    background: ${theme.colors.grayscale.light5};\n    text-align: left;\n    position: relative;\n    width: 100%;\n    max-height: 100%;\n    min-height: 0;\n    display: flex;\n    flex: 1;\n    flex-wrap: nowrap;\n    border-top: 1px solid ${theme.colors.grayscale.light2};\n    .explore-column {\n      display: flex;\n      flex-direction: column;\n      padding: ${theme.gridUnit * 2}px 0;\n      max-height: 100%;\n    }\n    .data-source-selection {\n      background-color: ${theme.colors.grayscale.light5};\n      padding: ${theme.gridUnit * 2}px 0;\n      border-right: 1px solid ${theme.colors.grayscale.light2};\n    }\n    .main-explore-content {\n      flex: 1;\n      min-width: ${theme.gridUnit * 128}px;\n      border-left: 1px solid ${theme.colors.grayscale.light2};\n      padding: 0 ${theme.gridUnit * 4}px;\n      .panel {\n        margin-bottom: 0;\n      }\n    }\n    .controls-column {\n      align-self: flex-start;\n      padding: 0;\n    }\n    .title-container {\n      position: relative;\n      display: flex;\n      flex-direction: row;\n      padding: 0 ${theme.gridUnit * 2}px 0 ${theme.gridUnit * 4}px;\n      justify-content: space-between;\n      .horizontal-text {\n        font-size: ${theme.typography.sizes.m}px;\n      }\n    }\n    .no-show {\n      display: none;\n    }\n    .vertical-text {\n      writing-mode: vertical-rl;\n      text-orientation: mixed;\n    }\n    .sidebar {\n      height: 100%;\n      background-color: ${theme.colors.grayscale.light4};\n      padding: ${theme.gridUnit * 2}px;\n      width: ${theme.gridUnit * 8}px;\n    }\n    .collapse-icon > svg {\n      color: ${theme.colors.primary.base};\n    }\n  `};\n`;\n\nconst updateHistory = _debounce(\n  async (\n  formData,\n  datasourceId,\n  datasourceType,\n  isReplace,\n  standalone,\n  force,\n  title,\n  tabId) =>\n  {\n    const payload = { ...formData };\n    const chartId = formData.slice_id;\n    const params = new URLSearchParams(window.location.search);\n    const additionalParam = Object.fromEntries(params);\n\n    if (chartId) {\n      additionalParam[URL_PARAMS.sliceId.name] = chartId;\n    } else {\n      additionalParam[URL_PARAMS.datasourceId.name] = datasourceId;\n      additionalParam[URL_PARAMS.datasourceType.name] = datasourceType;\n    }\n\n    const urlParams = (payload == null ? void 0 : payload.url_params) || {};\n    Object.entries(urlParams).forEach(([key, value]) => {\n      if (!RESERVED_CHART_URL_PARAMS.includes(key)) {\n        additionalParam[key] = value;\n      }\n    });\n\n    try {\n      let key;\n      let stateModifier;\n      if (isReplace) {\n        key = await postFormData(\n          datasourceId,\n          datasourceType,\n          formData,\n          chartId,\n          tabId\n        );\n        stateModifier = 'replaceState';\n      } else {\n        key = getUrlParam(URL_PARAMS.formDataKey);\n        await putFormData(\n          datasourceId,\n          datasourceType,\n          key,\n          formData,\n          chartId,\n          tabId\n        );\n        stateModifier = 'pushState';\n      }\n      // avoid race condition in case user changes route before explore updates the url\n      if (window.location.pathname.startsWith('/explore')) {\n        const url = mountExploreUrl(\n          standalone ? URL_PARAMS.standalone.name : null,\n          {\n            [URL_PARAMS.formDataKey.name]: key,\n            ...additionalParam\n          },\n          force\n        );\n        window.history[stateModifier](payload, title, url);\n      }\n    } catch (e) {\n      logging.warn('Failed at altering browser history', e);\n    }\n  },\n  1000\n);\n\nconst defaultSidebarsWidth = {\n  controls_width: 320,\n  datasource_width: 300\n};\n\nfunction getSidebarWidths(key) {\n  return getItem(key, defaultSidebarsWidth[key]);\n}\n\nfunction setSidebarWidths(key, dimension) {\n  const newDimension = Number(getSidebarWidths(key)) + dimension.width;\n  setItem(key, newDimension);\n}\n\nfunction ExploreViewContainer(props) {\n  const dynamicPluginContext = usePluginContext();\n  const dynamicPlugin = dynamicPluginContext.dynamicPlugins[props.vizType];\n  const isDynamicPluginLoading = dynamicPlugin && dynamicPlugin.mounting;\n  const wasDynamicPluginLoading = usePrevious(isDynamicPluginLoading);\n\n  /** the state of controls in the previous render */\n  const previousControls = usePrevious(props.controls);\n  /** the state of controls last time a query was triggered */\n  const [lastQueriedControls, setLastQueriedControls] = useState(\n    props.controls\n  );\n\n  const [isCollapsed, setIsCollapsed] = useState(false);\n  const [width, setWidth] = useState(\n    getSidebarWidths(LocalStorageKeys.DatasourceWidth)\n  );\n  const tabId = useTabId();\n\n  const theme = useTheme();\n\n  const addHistory = useCallback(\n    async ({ isReplace = false, title } = {}) => {\n      const formData = props.dashboardId ?\n      {\n        ...props.form_data,\n        dashboardId: props.dashboardId\n      } :\n      props.form_data;\n      const { id: datasourceId, type: datasourceType } = props.datasource;\n\n      updateHistory(\n        formData,\n        datasourceId,\n        datasourceType,\n        isReplace,\n        props.standalone,\n        props.force,\n        title,\n        tabId\n      );\n    },\n    [\n    props.dashboardId,\n    props.form_data,\n    props.datasource.id,\n    props.datasource.type,\n    props.standalone,\n    props.force,\n    tabId]\n\n  );\n\n  const handlePopstate = useCallback(() => {\n    const formData = window.history.state;\n    if (formData && Object.keys(formData).length) {\n      props.actions.setExploreControls(formData);\n      props.actions.postChartFormData(\n        formData,\n        props.force,\n        props.timeout,\n        props.chart.id\n      );\n    }\n  }, [props.actions, props.chart.id, props.timeout]);\n\n  const onQuery = useCallback(() => {\n    props.actions.setForceQuery(false);\n    props.actions.triggerQuery(true, props.chart.id);\n    addHistory();\n    setLastQueriedControls(props.controls);\n  }, [props.controls, addHistory, props.actions, props.chart.id]);\n\n  const handleKeydown = useCallback(\n    (event) => {\n      const controlOrCommand = event.ctrlKey || event.metaKey;\n      if (controlOrCommand) {\n        const isEnter = event.key === 'Enter' || event.keyCode === 13;\n        const isS = event.key === 's' || event.keyCode === 83;\n        if (isEnter) {\n          onQuery();\n        } else if (isS) {\n          if (props.slice) {\n            props.actions.\n            saveSlice(props.form_data, {\n              action: 'overwrite',\n              slice_id: props.slice.slice_id,\n              slice_name: props.slice.slice_name,\n              add_to_dash: 'noSave',\n              goto_dash: false\n            }).\n            then(({ data }) => {\n              window.location = data.slice.slice_url;\n            });\n          }\n        }\n      }\n    },\n    [onQuery, props.actions, props.form_data, props.slice]\n  );\n\n  function onStop() {\n    if (props.chart && props.chart.queryController) {\n      props.chart.queryController.abort();\n    }\n  }\n\n  function toggleCollapse() {\n    setIsCollapsed(!isCollapsed);\n  }\n\n  useComponentDidMount(() => {\n    props.actions.logEvent(LOG_ACTIONS_MOUNT_EXPLORER);\n  });\n\n  useChangeEffect(tabId, (previous, current) => {\n    if (current) {\n      addHistory({ isReplace: true });\n    }\n  });\n\n  const previousHandlePopstate = usePrevious(handlePopstate);\n  useEffect(() => {\n    if (previousHandlePopstate) {\n      window.removeEventListener('popstate', previousHandlePopstate);\n    }\n    window.addEventListener('popstate', handlePopstate);\n    return () => {\n      window.removeEventListener('popstate', handlePopstate);\n    };\n  }, [handlePopstate, previousHandlePopstate]);\n\n  const previousHandleKeyDown = usePrevious(handleKeydown);\n  useEffect(() => {\n    if (previousHandleKeyDown) {\n      window.removeEventListener('keydown', previousHandleKeyDown);\n    }\n    document.addEventListener('keydown', handleKeydown);\n    return () => {\n      document.removeEventListener('keydown', handleKeydown);\n    };\n  }, [handleKeydown, previousHandleKeyDown]);\n\n  useEffect(() => {\n    if (wasDynamicPluginLoading && !isDynamicPluginLoading) {\n      // reload the controls now that we actually have the control config\n      props.actions.dynamicPluginControlsReady();\n    }\n  }, [isDynamicPluginLoading]);\n\n  useEffect(() => {\n    const hasError = Object.values(props.controls).some(\n      (control) =>\n      control.validationErrors && control.validationErrors.length > 0\n    );\n    if (!hasError) {\n      props.actions.triggerQuery(true, props.chart.id);\n    }\n  }, []);\n\n  const reRenderChart = useCallback(\n    (controlsChanged) => {\n      const newQueryFormData = controlsChanged ?\n      {\n        ...props.chart.latestQueryFormData,\n        ...getFormDataFromControls(_pick(props.controls, controlsChanged))\n      } :\n      getFormDataFromControls(props.controls);\n      props.actions.updateQueryFormData(newQueryFormData, props.chart.id);\n      props.actions.renderTriggered(new Date().getTime(), props.chart.id);\n      addHistory();\n    },\n    [\n    addHistory,\n    props.actions,\n    props.chart.id,\n    props.chart.latestQueryFormData,\n    props.controls]\n\n  );\n\n  // effect to run when controls change\n  useEffect(() => {\n    if (\n    previousControls &&\n    props.chart.latestQueryFormData.viz_type === props.controls.viz_type.value)\n    {\n      if (\n      props.controls.datasource && (\n      previousControls.datasource == null ||\n      props.controls.datasource.value !== previousControls.datasource.value))\n      {\n        // this should really be handled by actions\n        fetchDatasourceMetadata(props.form_data.datasource, true);\n      }\n\n      const changedControlKeys = Object.keys(props.controls).filter(\n        (key) =>\n        typeof previousControls[key] !== 'undefined' &&\n        !areObjectsEqual(\n          props.controls[key].value,\n          previousControls[key].value\n        )\n      );\n\n      // this should also be handled by the actions that are actually changing the controls\n      const displayControlsChanged = changedControlKeys.filter(\n        (key) => props.controls[key].renderTrigger\n      );\n      if (displayControlsChanged.length > 0) {\n        reRenderChart(displayControlsChanged);\n      }\n    }\n  }, [props.controls, props.ownState]);\n\n  const chartIsStale = useMemo(() => {\n    if (lastQueriedControls) {\n      const { controls } = props;\n      const changedControlKeys = Object.keys(controls).filter((key) => {\n        const lastControl = lastQueriedControls[key];\n        if (typeof lastControl === 'undefined') {\n          return false;\n        }\n        const { value: value1 } = controls[key];\n        const { value: value2 } = lastControl;\n        if (_isObjectLike(value1) && _isObjectLike(value2)) {\n          return !areObjectsEqual(value1, value2, {\n            ignoreFields: ['datasourceWarning']\n          });\n        }\n        return !_isEqual(value1, value2);\n      });\n\n      return changedControlKeys.some(\n        (key) =>\n        !props.controls[key].renderTrigger &&\n        !props.controls[key].dontRefreshOnChange\n      );\n    }\n    return false;\n  }, [lastQueriedControls, props.controls]);\n\n  useChangeEffect(props.saveAction, () => {\n    if (['saveas', 'overwrite'].includes(props.saveAction)) {\n      onQuery();\n      addHistory({ isReplace: true });\n      props.actions.setSaveAction(null);\n    }\n  });\n\n  useEffect(() => {\n    if (props.ownState !== undefined) {\n      onQuery();\n      reRenderChart();\n    }\n  }, [props.ownState]);\n\n  if (chartIsStale) {\n    props.actions.logEvent(LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS);\n  }\n\n  const errorMessage = useMemo(() => {\n    const controlsWithErrors = Object.values(props.controls).filter(\n      (control) =>\n      control.validationErrors && control.validationErrors.length > 0\n    );\n    if (controlsWithErrors.length === 0) {\n      return null;\n    }\n\n    const errorMessages = controlsWithErrors.map(\n      (control) => control.validationErrors\n    );\n    const uniqueErrorMessages = [...new Set(errorMessages.flat())];\n\n    const errors = uniqueErrorMessages.\n    map((message) => {\n      const matchingLabels = controlsWithErrors.\n      filter((control) => {var _control$validationEr;return (_control$validationEr = control.validationErrors) == null ? void 0 : _control$validationEr.includes(message);}).\n      map((control) => control.label);\n      return [matchingLabels, message];\n    }).\n    map(([labels, message]) =>\n    _jsxs(\"div\", { children: [\n      labels.length > 1 ? t('Controls labeled ') : t('Control labeled '),\n      _jsx(\"strong\", { children: ` ${labels.join(', ')}` }),\n      _jsxs(\"span\", { children: [\": \", message] })] }, message\n    )\n    );\n\n    let errorMessage;\n    if (errors.length > 0) {\n      errorMessage = _jsx(\"div\", { style: { textAlign: 'left' }, children: errors });\n    }\n    return errorMessage;\n  }, [props.controls]);\n\n  function renderChartContainer() {\n    return (\n      _jsx(ExploreChartPanel, { ...\n        props,\n        errorMessage: errorMessage,\n        chartIsStale: chartIsStale,\n        onQuery: onQuery }\n      ));\n\n  }\n\n  if (props.standalone) {\n    return renderChartContainer();\n  }\n\n  return (\n    _jsxs(ExploreContainer, { children: [\n      _jsx(ConnectedExploreChartHeader, {\n        actions: props.actions,\n        canOverwrite: props.can_overwrite,\n        canDownload: props.can_download,\n        dashboardId: props.dashboardId,\n        isStarred: props.isStarred,\n        slice: props.slice,\n        sliceName: props.sliceName,\n        table_name: props.table_name,\n        formData: props.form_data,\n        chart: props.chart,\n        ownState: props.ownState,\n        user: props.user,\n        reports: props.reports,\n        saveDisabled: errorMessage || props.chart.chartStatus === 'loading',\n        metadata: props.metadata }\n      ),\n      _jsxs(ExplorePanelContainer, { id: \"explore-container\", children: [\n        _jsx(Global, {\n          styles: css`\n            .navbar {\n              margin-bottom: 0;\n            }\n            body {\n              height: 100vh;\n              max-height: 100vh;\n              overflow: hidden;\n            }\n            #app-menu,\n            #app {\n              flex: 1 1 auto;\n            }\n            #app {\n              flex-basis: 100%;\n              overflow: hidden;\n              height: 100%;\n            }\n            #app-menu {\n              flex-shrink: 0;\n            }\n          ` }\n        ),\n        _jsxs(Resizable, {\n          onResizeStop: (evt, direction, ref, d) => {\n            setWidth(ref.getBoundingClientRect().width);\n            setSidebarWidths(LocalStorageKeys.DatasourceWidth, d);\n          },\n          defaultSize: {\n            width: getSidebarWidths(LocalStorageKeys.DatasourceWidth),\n            height: '100%'\n          },\n          minWidth: defaultSidebarsWidth[LocalStorageKeys.DatasourceWidth],\n          maxWidth: \"33%\",\n          enable: { right: true },\n          className:\n          isCollapsed ? 'no-show' : 'explore-column data-source-selection', children: [\n\n\n          _jsxs(\"div\", { className: \"title-container\", children: [\n            _jsx(\"span\", { className: \"horizontal-text\", children: t('Chart Source') }),\n            _jsx(\"span\", {\n              role: \"button\",\n              tabIndex: 0,\n              className: \"action-button\",\n              onClick: toggleCollapse, children:\n\n              _jsx(Icons.Expand, {\n                className: \"collapse-icon\",\n                iconColor: theme.colors.primary.base,\n                iconSize: \"l\" }\n              ) }\n            )] }\n          ),\n          _jsx(DataSourcePanel, {\n            formData: props.form_data,\n            datasource: props.datasource,\n            controls: props.controls,\n            actions: props.actions,\n            width: width,\n            user: props.user }\n          )] }\n        ),\n        isCollapsed ?\n        _jsx(\"div\", {\n          className: \"sidebar\",\n          onClick: toggleCollapse,\n          \"data-test\": \"open-datasource-tab\",\n          role: \"button\",\n          tabIndex: 0, children:\n\n          _jsx(\"span\", { role: \"button\", tabIndex: 0, className: \"action-button\", children:\n            _jsx(Tooltip, { title: t('Open Datasource tab'), children:\n              _jsx(Icons.Collapse, {\n                className: \"collapse-icon\",\n                iconColor: theme.colors.primary.base,\n                iconSize: \"l\" }\n              ) }\n            ) }\n          ) }\n        ) :\n        null,\n        _jsx(Resizable, {\n          onResizeStop: (evt, direction, ref, d) =>\n          setSidebarWidths(LocalStorageKeys.ControlsWidth, d),\n\n          defaultSize: {\n            width: getSidebarWidths(LocalStorageKeys.ControlsWidth),\n            height: '100%'\n          },\n          minWidth: defaultSidebarsWidth[LocalStorageKeys.ControlsWidth],\n          maxWidth: \"33%\",\n          enable: { right: true },\n          className: \"col-sm-3 explore-column controls-column\", children:\n\n          _jsx(ConnectedControlPanelsContainer, {\n            exploreState: props.exploreState,\n            actions: props.actions,\n            form_data: props.form_data,\n            controls: props.controls,\n            chart: props.chart,\n            datasource_type: props.datasource_type,\n            isDatasourceMetaLoading: props.isDatasourceMetaLoading,\n            onQuery: onQuery,\n            onStop: onStop,\n            canStopQuery: props.can_add || props.can_overwrite,\n            errorMessage: errorMessage,\n            chartIsStale: chartIsStale }\n          ) }\n        ),\n        _jsx(\"div\", {\n          className: cx(\n            'main-explore-content',\n            isCollapsed ? 'col-sm-9' : 'col-sm-7'\n          ), children:\n\n          renderChartContainer() }\n        )] }\n      ),\n      props.isSaveModalVisible &&\n      _jsx(SaveModal, {\n        addDangerToast: props.addDangerToast,\n        actions: props.actions,\n        form_data: props.form_data,\n        sliceName: props.sliceName,\n        dashboardId: props.dashboardId }\n      )] }\n\n    ));\n\n}__signature__(ExploreViewContainer, \"usePluginContext{dynamicPluginContext}\\nusePrevious{wasDynamicPluginLoading}\\nusePrevious{previousControls}\\nuseState{[lastQueriedControls, setLastQueriedControls](props.controls)}\\nuseState{[isCollapsed, setIsCollapsed](false)}\\nuseState{[width, setWidth](getSidebarWidths(LocalStorageKeys.DatasourceWidth))}\\nuseTabId{tabId}\\nuseTheme{theme}\\nuseCallback{addHistory}\\nuseCallback{handlePopstate}\\nuseCallback{onQuery}\\nuseCallback{handleKeydown}\\nuseComponentDidMount{}\\nuseChangeEffect{}\\nusePrevious{previousHandlePopstate}\\nuseEffect{}\\nusePrevious{previousHandleKeyDown}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseCallback{reRenderChart}\\nuseEffect{}\\nuseMemo{chartIsStale}\\nuseChangeEffect{}\\nuseEffect{}\\nuseMemo{errorMessage}\", () => [usePluginContext, usePrevious, usePrevious, useTabId, useTheme, useComponentDidMount, useChangeEffect, usePrevious, usePrevious, useChangeEffect]);\n\nExploreViewContainer.propTypes = propTypes;\n\nconst retainQueryModeRequirements = (hiddenFormData) =>\nObject.keys(hiddenFormData != null ? hiddenFormData : {}).filter(\n  (key) => !QUERY_MODE_REQUISITES.has(key)\n);\n\nfunction mapStateToProps(state) {var _controls$query_mode, _ref, _form_data$slice_id, _dataMask$slice_id, _explore$form_data, _datasource$column_fo, _ref2, _explore$sliceName, _dataMask$slice_id2;\n  const {\n    explore,\n    charts,\n    common,\n    impressionId,\n    dataMask,\n    reports,\n    user,\n    saveModal\n  } = state;\n  const { controls, slice, datasource, metadata, hiddenFormData } = explore;\n  const hasQueryMode = !!((_controls$query_mode = controls.query_mode) != null && _controls$query_mode.value);\n  const fieldsToOmit = hasQueryMode ?\n  retainQueryModeRequirements(hiddenFormData) :\n  Object.keys(hiddenFormData != null ? hiddenFormData : {});\n  const form_data = _omit(getFormDataFromControls(controls), fieldsToOmit);\n  const slice_id = (_ref = (_form_data$slice_id = form_data.slice_id) != null ? _form_data$slice_id : slice == null ? void 0 : slice.slice_id) != null ? _ref : 0; // 0 - unsaved chart\n  form_data.extra_form_data = mergeExtraFormData(\n    { ...form_data.extra_form_data },\n    {\n      ...((_dataMask$slice_id = dataMask[slice_id]) == null ? void 0 : _dataMask$slice_id.ownState)\n    }\n  );\n  const chart = charts[slice_id];\n\n  let dashboardId = Number((_explore$form_data = explore.form_data) == null ? void 0 : _explore$form_data.dashboardId);\n  if (Number.isNaN(dashboardId)) {\n    dashboardId = undefined;\n  }\n\n  return {\n    isDatasourceMetaLoading: explore.isDatasourceMetaLoading,\n    datasource,\n    datasource_type: datasource.type,\n    datasourceId: datasource.datasource_id,\n    dashboardId,\n    controls: explore.controls,\n    can_add: !!explore.can_add,\n    can_download: !!explore.can_download,\n    can_overwrite: !!explore.can_overwrite,\n    column_formats: (_datasource$column_fo = datasource == null ? void 0 : datasource.column_formats) != null ? _datasource$column_fo : null,\n    containerId: slice ?\n    `slice-container-${slice.slice_id}` :\n    'slice-container',\n    isStarred: explore.isStarred,\n    slice,\n    sliceName: (_ref2 = (_explore$sliceName = explore.sliceName) != null ? _explore$sliceName : slice == null ? void 0 : slice.slice_name) != null ? _ref2 : null,\n    triggerRender: explore.triggerRender,\n    form_data,\n    table_name: datasource.table_name,\n    vizType: form_data.viz_type,\n    standalone: !!explore.standalone,\n    force: !!explore.force,\n    chart,\n    timeout: common.conf.SUPERSET_WEBSERVER_TIMEOUT,\n    ownState: (_dataMask$slice_id2 = dataMask[slice_id]) == null ? void 0 : _dataMask$slice_id2.ownState,\n    impressionId,\n    user,\n    exploreState: explore,\n    reports,\n    metadata,\n    saveAction: explore.saveAction,\n    isSaveModalVisible: saveModal.isVisible\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  const actions = {\n    ...exploreActions,\n    ...datasourcesActions,\n    ...saveModalActions,\n    ...chartActions,\n    ...logActions\n  };\n  return {\n    actions: bindActionCreators(actions, dispatch)\n  };\n}const _default =\n\nconnect(\n  mapStateToProps,\n  mapDispatchToProps\n)(withToasts( /*#__PURE__*/memo(ExploreViewContainer)));export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer/index.jsx\");reactHotLoader.register(ExplorePanelContainer, \"ExplorePanelContainer\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer/index.jsx\");reactHotLoader.register(updateHistory, \"updateHistory\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer/index.jsx\");reactHotLoader.register(defaultSidebarsWidth, \"defaultSidebarsWidth\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer/index.jsx\");reactHotLoader.register(getSidebarWidths, \"getSidebarWidths\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer/index.jsx\");reactHotLoader.register(setSidebarWidths, \"setSidebarWidths\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer/index.jsx\");reactHotLoader.register(ExploreViewContainer, \"ExploreViewContainer\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer/index.jsx\");reactHotLoader.register(retainQueryModeRequirements, \"retainQueryModeRequirements\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer/index.jsx\");reactHotLoader.register(mapStateToProps, \"mapStateToProps\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer/index.jsx\");reactHotLoader.register(mapDispatchToProps, \"mapDispatchToProps\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer/index.jsx\");reactHotLoader.register(_default, \"default\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer/index.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["memo","useCallback","useEffect","useMemo","useState","PropTypes","bindActionCreators","connect","styled","t","css","useTheme","logging","useChangeEffect","useComponentDidMount","usePrevious","Resizable","usePluginContext","Global","Tooltip","Icons","getItem","setItem","LocalStorageKeys","RESERVED_CHART_URL_PARAMS","URL_PARAMS","QUERY_MODE_REQUISITES","areObjectsEqual","logActions","LOG_ACTIONS_MOUNT_EXPLORER","LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS","getUrlParam","cx","chartActions","fetchDatasourceMetadata","chartPropShape","mergeExtraFormData","postFormData","putFormData","datasourcesActions","mountExploreUrl","getFormDataFromControls","exploreActions","saveModalActions","useTabId","withToasts","ExploreChartPanel","ConnectedControlPanelsContainer","SaveModal","DataSourcePanel","ConnectedExploreChartHeader","ExploreContainer","jsx","_jsx","jsxs","_jsxs","propTypes","actions","object","isRequired","datasource_type","string","dashboardId","number","isDatasourceMetaLoading","bool","chart","slice","sliceName","controls","forcedHeight","form_data","standalone","force","timeout","impressionId","vizType","saveAction","isSaveModalVisible","ExplorePanelContainer","div","theme","colors","grayscale","light5","light2","gridUnit","typography","sizes","m","light4","primary","base","updateHistory","_debounce","formData","datasourceId","datasourceType","isReplace","title","tabId","payload","chartId","slice_id","params","URLSearchParams","window","location","search","additionalParam","Object","fromEntries","sliceId","name","urlParams","url_params","entries","forEach","key","value","includes","stateModifier","formDataKey","pathname","startsWith","url","history","e","warn","defaultSidebarsWidth","controls_width","datasource_width","getSidebarWidths","setSidebarWidths","dimension","newDimension","Number","width","ExploreViewContainer","props","dynamicPluginContext","dynamicPlugin","dynamicPlugins","isDynamicPluginLoading","mounting","wasDynamicPluginLoading","previousControls","lastQueriedControls","setLastQueriedControls","isCollapsed","setIsCollapsed","setWidth","DatasourceWidth","addHistory","id","type","datasource","handlePopstate","state","keys","length","setExploreControls","postChartFormData","onQuery","setForceQuery","triggerQuery","handleKeydown","event","controlOrCommand","ctrlKey","metaKey","isEnter","keyCode","isS","saveSlice","action","slice_name","add_to_dash","goto_dash","then","data","slice_url","onStop","queryController","abort","toggleCollapse","logEvent","previous","current","previousHandlePopstate","removeEventListener","addEventListener","previousHandleKeyDown","document","dynamicPluginControlsReady","hasError","values","some","control","validationErrors","reRenderChart","controlsChanged","newQueryFormData","latestQueryFormData","_pick","updateQueryFormData","renderTriggered","Date","getTime","viz_type","changedControlKeys","filter","displayControlsChanged","renderTrigger","ownState","chartIsStale","lastControl","value1","value2","_isObjectLike","ignoreFields","_isEqual","dontRefreshOnChange","setSaveAction","undefined","errorMessage","controlsWithErrors","errorMessages","map","uniqueErrorMessages","Set","flat","errors","message","matchingLabels","_control$validationEr","label","labels","children","join","style","textAlign","renderChartContainer","canOverwrite","can_overwrite","canDownload","can_download","isStarred","table_name","user","reports","saveDisabled","chartStatus","metadata","styles","onResizeStop","evt","direction","ref","d","getBoundingClientRect","defaultSize","height","minWidth","maxWidth","enable","right","className","role","tabIndex","onClick","Expand","iconColor","iconSize","Collapse","ControlsWidth","exploreState","canStopQuery","can_add","addDangerToast","__signature__","retainQueryModeRequirements","hiddenFormData","has","mapStateToProps","_controls$query_mode","_ref","_form_data$slice_id","_dataMask$slice_id","_explore$form_data","_datasource$column_fo","_ref2","_explore$sliceName","_dataMask$slice_id2","explore","charts","common","dataMask","saveModal","hasQueryMode","query_mode","fieldsToOmit","_omit","extra_form_data","isNaN","datasource_id","column_formats","containerId","triggerRender","conf","SUPERSET_WEBSERVER_TIMEOUT","isVisible","mapDispatchToProps","dispatch","_default","reactHotLoader","reactHotLoaderGlobal","default","register","leaveModule","module"],"sources":["/app/superset-frontend/src/explore/components/ExploreViewContainer/index.jsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport { memo, useCallback, useEffect, useMemo, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\nimport {\n  styled,\n  t,\n  css,\n  useTheme,\n  logging,\n  useChangeEffect,\n  useComponentDidMount,\n  usePrevious,\n} from '@superset-ui/core';\nimport { debounce, isEqual, isObjectLike, omit, pick } from 'lodash';\nimport { Resizable } from 're-resizable';\nimport { usePluginContext } from 'src/components/DynamicPlugins';\nimport { Global } from '@emotion/react';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Icons from 'src/components/Icons';\nimport {\n  getItem,\n  setItem,\n  LocalStorageKeys,\n} from 'src/utils/localStorageHelpers';\nimport { RESERVED_CHART_URL_PARAMS, URL_PARAMS } from 'src/constants';\nimport { QUERY_MODE_REQUISITES } from 'src/explore/constants';\nimport { areObjectsEqual } from 'src/reduxUtils';\nimport * as logActions from 'src/logger/actions';\nimport {\n  LOG_ACTIONS_MOUNT_EXPLORER,\n  LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS,\n} from 'src/logger/LogUtils';\nimport { getUrlParam } from 'src/utils/urlUtils';\nimport cx from 'classnames';\nimport * as chartActions from 'src/components/Chart/chartAction';\nimport { fetchDatasourceMetadata } from 'src/dashboard/actions/datasources';\nimport { chartPropShape } from 'src/dashboard/util/propShapes';\nimport { mergeExtraFormData } from 'src/dashboard/components/nativeFilters/utils';\nimport { postFormData, putFormData } from 'src/explore/exploreUtils/formData';\nimport { datasourcesActions } from 'src/explore/actions/datasourcesActions';\nimport { mountExploreUrl } from 'src/explore/exploreUtils';\nimport { getFormDataFromControls } from 'src/explore/controlUtils';\nimport * as exploreActions from 'src/explore/actions/exploreActions';\nimport * as saveModalActions from 'src/explore/actions/saveModalActions';\nimport { useTabId } from 'src/hooks/useTabId';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport ExploreChartPanel from '../ExploreChartPanel';\nimport ConnectedControlPanelsContainer from '../ControlPanelsContainer';\nimport SaveModal from '../SaveModal';\nimport DataSourcePanel from '../DatasourcePanel';\nimport ConnectedExploreChartHeader from '../ExploreChartHeader';\nimport ExploreContainer from '../ExploreContainer';\n\nconst propTypes = {\n  ...ExploreChartPanel.propTypes,\n  actions: PropTypes.object.isRequired,\n  datasource_type: PropTypes.string.isRequired,\n  dashboardId: PropTypes.number,\n  isDatasourceMetaLoading: PropTypes.bool.isRequired,\n  chart: chartPropShape.isRequired,\n  slice: PropTypes.object,\n  sliceName: PropTypes.string,\n  controls: PropTypes.object.isRequired,\n  forcedHeight: PropTypes.string,\n  form_data: PropTypes.object.isRequired,\n  standalone: PropTypes.bool.isRequired,\n  force: PropTypes.bool,\n  timeout: PropTypes.number,\n  impressionId: PropTypes.string,\n  vizType: PropTypes.string,\n  saveAction: PropTypes.string,\n  isSaveModalVisible: PropTypes.bool,\n};\n\nconst ExplorePanelContainer = styled.div`\n  ${({ theme }) => css`\n    background: ${theme.colors.grayscale.light5};\n    text-align: left;\n    position: relative;\n    width: 100%;\n    max-height: 100%;\n    min-height: 0;\n    display: flex;\n    flex: 1;\n    flex-wrap: nowrap;\n    border-top: 1px solid ${theme.colors.grayscale.light2};\n    .explore-column {\n      display: flex;\n      flex-direction: column;\n      padding: ${theme.gridUnit * 2}px 0;\n      max-height: 100%;\n    }\n    .data-source-selection {\n      background-color: ${theme.colors.grayscale.light5};\n      padding: ${theme.gridUnit * 2}px 0;\n      border-right: 1px solid ${theme.colors.grayscale.light2};\n    }\n    .main-explore-content {\n      flex: 1;\n      min-width: ${theme.gridUnit * 128}px;\n      border-left: 1px solid ${theme.colors.grayscale.light2};\n      padding: 0 ${theme.gridUnit * 4}px;\n      .panel {\n        margin-bottom: 0;\n      }\n    }\n    .controls-column {\n      align-self: flex-start;\n      padding: 0;\n    }\n    .title-container {\n      position: relative;\n      display: flex;\n      flex-direction: row;\n      padding: 0 ${theme.gridUnit * 2}px 0 ${theme.gridUnit * 4}px;\n      justify-content: space-between;\n      .horizontal-text {\n        font-size: ${theme.typography.sizes.m}px;\n      }\n    }\n    .no-show {\n      display: none;\n    }\n    .vertical-text {\n      writing-mode: vertical-rl;\n      text-orientation: mixed;\n    }\n    .sidebar {\n      height: 100%;\n      background-color: ${theme.colors.grayscale.light4};\n      padding: ${theme.gridUnit * 2}px;\n      width: ${theme.gridUnit * 8}px;\n    }\n    .collapse-icon > svg {\n      color: ${theme.colors.primary.base};\n    }\n  `};\n`;\n\nconst updateHistory = debounce(\n  async (\n    formData,\n    datasourceId,\n    datasourceType,\n    isReplace,\n    standalone,\n    force,\n    title,\n    tabId,\n  ) => {\n    const payload = { ...formData };\n    const chartId = formData.slice_id;\n    const params = new URLSearchParams(window.location.search);\n    const additionalParam = Object.fromEntries(params);\n\n    if (chartId) {\n      additionalParam[URL_PARAMS.sliceId.name] = chartId;\n    } else {\n      additionalParam[URL_PARAMS.datasourceId.name] = datasourceId;\n      additionalParam[URL_PARAMS.datasourceType.name] = datasourceType;\n    }\n\n    const urlParams = payload?.url_params || {};\n    Object.entries(urlParams).forEach(([key, value]) => {\n      if (!RESERVED_CHART_URL_PARAMS.includes(key)) {\n        additionalParam[key] = value;\n      }\n    });\n\n    try {\n      let key;\n      let stateModifier;\n      if (isReplace) {\n        key = await postFormData(\n          datasourceId,\n          datasourceType,\n          formData,\n          chartId,\n          tabId,\n        );\n        stateModifier = 'replaceState';\n      } else {\n        key = getUrlParam(URL_PARAMS.formDataKey);\n        await putFormData(\n          datasourceId,\n          datasourceType,\n          key,\n          formData,\n          chartId,\n          tabId,\n        );\n        stateModifier = 'pushState';\n      }\n      // avoid race condition in case user changes route before explore updates the url\n      if (window.location.pathname.startsWith('/explore')) {\n        const url = mountExploreUrl(\n          standalone ? URL_PARAMS.standalone.name : null,\n          {\n            [URL_PARAMS.formDataKey.name]: key,\n            ...additionalParam,\n          },\n          force,\n        );\n        window.history[stateModifier](payload, title, url);\n      }\n    } catch (e) {\n      logging.warn('Failed at altering browser history', e);\n    }\n  },\n  1000,\n);\n\nconst defaultSidebarsWidth = {\n  controls_width: 320,\n  datasource_width: 300,\n};\n\nfunction getSidebarWidths(key) {\n  return getItem(key, defaultSidebarsWidth[key]);\n}\n\nfunction setSidebarWidths(key, dimension) {\n  const newDimension = Number(getSidebarWidths(key)) + dimension.width;\n  setItem(key, newDimension);\n}\n\nfunction ExploreViewContainer(props) {\n  const dynamicPluginContext = usePluginContext();\n  const dynamicPlugin = dynamicPluginContext.dynamicPlugins[props.vizType];\n  const isDynamicPluginLoading = dynamicPlugin && dynamicPlugin.mounting;\n  const wasDynamicPluginLoading = usePrevious(isDynamicPluginLoading);\n\n  /** the state of controls in the previous render */\n  const previousControls = usePrevious(props.controls);\n  /** the state of controls last time a query was triggered */\n  const [lastQueriedControls, setLastQueriedControls] = useState(\n    props.controls,\n  );\n\n  const [isCollapsed, setIsCollapsed] = useState(false);\n  const [width, setWidth] = useState(\n    getSidebarWidths(LocalStorageKeys.DatasourceWidth),\n  );\n  const tabId = useTabId();\n\n  const theme = useTheme();\n\n  const addHistory = useCallback(\n    async ({ isReplace = false, title } = {}) => {\n      const formData = props.dashboardId\n        ? {\n            ...props.form_data,\n            dashboardId: props.dashboardId,\n          }\n        : props.form_data;\n      const { id: datasourceId, type: datasourceType } = props.datasource;\n\n      updateHistory(\n        formData,\n        datasourceId,\n        datasourceType,\n        isReplace,\n        props.standalone,\n        props.force,\n        title,\n        tabId,\n      );\n    },\n    [\n      props.dashboardId,\n      props.form_data,\n      props.datasource.id,\n      props.datasource.type,\n      props.standalone,\n      props.force,\n      tabId,\n    ],\n  );\n\n  const handlePopstate = useCallback(() => {\n    const formData = window.history.state;\n    if (formData && Object.keys(formData).length) {\n      props.actions.setExploreControls(formData);\n      props.actions.postChartFormData(\n        formData,\n        props.force,\n        props.timeout,\n        props.chart.id,\n      );\n    }\n  }, [props.actions, props.chart.id, props.timeout]);\n\n  const onQuery = useCallback(() => {\n    props.actions.setForceQuery(false);\n    props.actions.triggerQuery(true, props.chart.id);\n    addHistory();\n    setLastQueriedControls(props.controls);\n  }, [props.controls, addHistory, props.actions, props.chart.id]);\n\n  const handleKeydown = useCallback(\n    event => {\n      const controlOrCommand = event.ctrlKey || event.metaKey;\n      if (controlOrCommand) {\n        const isEnter = event.key === 'Enter' || event.keyCode === 13;\n        const isS = event.key === 's' || event.keyCode === 83;\n        if (isEnter) {\n          onQuery();\n        } else if (isS) {\n          if (props.slice) {\n            props.actions\n              .saveSlice(props.form_data, {\n                action: 'overwrite',\n                slice_id: props.slice.slice_id,\n                slice_name: props.slice.slice_name,\n                add_to_dash: 'noSave',\n                goto_dash: false,\n              })\n              .then(({ data }) => {\n                window.location = data.slice.slice_url;\n              });\n          }\n        }\n      }\n    },\n    [onQuery, props.actions, props.form_data, props.slice],\n  );\n\n  function onStop() {\n    if (props.chart && props.chart.queryController) {\n      props.chart.queryController.abort();\n    }\n  }\n\n  function toggleCollapse() {\n    setIsCollapsed(!isCollapsed);\n  }\n\n  useComponentDidMount(() => {\n    props.actions.logEvent(LOG_ACTIONS_MOUNT_EXPLORER);\n  });\n\n  useChangeEffect(tabId, (previous, current) => {\n    if (current) {\n      addHistory({ isReplace: true });\n    }\n  });\n\n  const previousHandlePopstate = usePrevious(handlePopstate);\n  useEffect(() => {\n    if (previousHandlePopstate) {\n      window.removeEventListener('popstate', previousHandlePopstate);\n    }\n    window.addEventListener('popstate', handlePopstate);\n    return () => {\n      window.removeEventListener('popstate', handlePopstate);\n    };\n  }, [handlePopstate, previousHandlePopstate]);\n\n  const previousHandleKeyDown = usePrevious(handleKeydown);\n  useEffect(() => {\n    if (previousHandleKeyDown) {\n      window.removeEventListener('keydown', previousHandleKeyDown);\n    }\n    document.addEventListener('keydown', handleKeydown);\n    return () => {\n      document.removeEventListener('keydown', handleKeydown);\n    };\n  }, [handleKeydown, previousHandleKeyDown]);\n\n  useEffect(() => {\n    if (wasDynamicPluginLoading && !isDynamicPluginLoading) {\n      // reload the controls now that we actually have the control config\n      props.actions.dynamicPluginControlsReady();\n    }\n  }, [isDynamicPluginLoading]);\n\n  useEffect(() => {\n    const hasError = Object.values(props.controls).some(\n      control =>\n        control.validationErrors && control.validationErrors.length > 0,\n    );\n    if (!hasError) {\n      props.actions.triggerQuery(true, props.chart.id);\n    }\n  }, []);\n\n  const reRenderChart = useCallback(\n    controlsChanged => {\n      const newQueryFormData = controlsChanged\n        ? {\n            ...props.chart.latestQueryFormData,\n            ...getFormDataFromControls(pick(props.controls, controlsChanged)),\n          }\n        : getFormDataFromControls(props.controls);\n      props.actions.updateQueryFormData(newQueryFormData, props.chart.id);\n      props.actions.renderTriggered(new Date().getTime(), props.chart.id);\n      addHistory();\n    },\n    [\n      addHistory,\n      props.actions,\n      props.chart.id,\n      props.chart.latestQueryFormData,\n      props.controls,\n    ],\n  );\n\n  // effect to run when controls change\n  useEffect(() => {\n    if (\n      previousControls &&\n      props.chart.latestQueryFormData.viz_type === props.controls.viz_type.value\n    ) {\n      if (\n        props.controls.datasource &&\n        (previousControls.datasource == null ||\n          props.controls.datasource.value !== previousControls.datasource.value)\n      ) {\n        // this should really be handled by actions\n        fetchDatasourceMetadata(props.form_data.datasource, true);\n      }\n\n      const changedControlKeys = Object.keys(props.controls).filter(\n        key =>\n          typeof previousControls[key] !== 'undefined' &&\n          !areObjectsEqual(\n            props.controls[key].value,\n            previousControls[key].value,\n          ),\n      );\n\n      // this should also be handled by the actions that are actually changing the controls\n      const displayControlsChanged = changedControlKeys.filter(\n        key => props.controls[key].renderTrigger,\n      );\n      if (displayControlsChanged.length > 0) {\n        reRenderChart(displayControlsChanged);\n      }\n    }\n  }, [props.controls, props.ownState]);\n\n  const chartIsStale = useMemo(() => {\n    if (lastQueriedControls) {\n      const { controls } = props;\n      const changedControlKeys = Object.keys(controls).filter(key => {\n        const lastControl = lastQueriedControls[key];\n        if (typeof lastControl === 'undefined') {\n          return false;\n        }\n        const { value: value1 } = controls[key];\n        const { value: value2 } = lastControl;\n        if (isObjectLike(value1) && isObjectLike(value2)) {\n          return !areObjectsEqual(value1, value2, {\n            ignoreFields: ['datasourceWarning'],\n          });\n        }\n        return !isEqual(value1, value2);\n      });\n\n      return changedControlKeys.some(\n        key =>\n          !props.controls[key].renderTrigger &&\n          !props.controls[key].dontRefreshOnChange,\n      );\n    }\n    return false;\n  }, [lastQueriedControls, props.controls]);\n\n  useChangeEffect(props.saveAction, () => {\n    if (['saveas', 'overwrite'].includes(props.saveAction)) {\n      onQuery();\n      addHistory({ isReplace: true });\n      props.actions.setSaveAction(null);\n    }\n  });\n\n  useEffect(() => {\n    if (props.ownState !== undefined) {\n      onQuery();\n      reRenderChart();\n    }\n  }, [props.ownState]);\n\n  if (chartIsStale) {\n    props.actions.logEvent(LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS);\n  }\n\n  const errorMessage = useMemo(() => {\n    const controlsWithErrors = Object.values(props.controls).filter(\n      control =>\n        control.validationErrors && control.validationErrors.length > 0,\n    );\n    if (controlsWithErrors.length === 0) {\n      return null;\n    }\n\n    const errorMessages = controlsWithErrors.map(\n      control => control.validationErrors,\n    );\n    const uniqueErrorMessages = [...new Set(errorMessages.flat())];\n\n    const errors = uniqueErrorMessages\n      .map(message => {\n        const matchingLabels = controlsWithErrors\n          .filter(control => control.validationErrors?.includes(message))\n          .map(control => control.label);\n        return [matchingLabels, message];\n      })\n      .map(([labels, message]) => (\n        <div key={message}>\n          {labels.length > 1 ? t('Controls labeled ') : t('Control labeled ')}\n          <strong>{` ${labels.join(', ')}`}</strong>\n          <span>: {message}</span>\n        </div>\n      ));\n\n    let errorMessage;\n    if (errors.length > 0) {\n      errorMessage = <div style={{ textAlign: 'left' }}>{errors}</div>;\n    }\n    return errorMessage;\n  }, [props.controls]);\n\n  function renderChartContainer() {\n    return (\n      <ExploreChartPanel\n        {...props}\n        errorMessage={errorMessage}\n        chartIsStale={chartIsStale}\n        onQuery={onQuery}\n      />\n    );\n  }\n\n  if (props.standalone) {\n    return renderChartContainer();\n  }\n\n  return (\n    <ExploreContainer>\n      <ConnectedExploreChartHeader\n        actions={props.actions}\n        canOverwrite={props.can_overwrite}\n        canDownload={props.can_download}\n        dashboardId={props.dashboardId}\n        isStarred={props.isStarred}\n        slice={props.slice}\n        sliceName={props.sliceName}\n        table_name={props.table_name}\n        formData={props.form_data}\n        chart={props.chart}\n        ownState={props.ownState}\n        user={props.user}\n        reports={props.reports}\n        saveDisabled={errorMessage || props.chart.chartStatus === 'loading'}\n        metadata={props.metadata}\n      />\n      <ExplorePanelContainer id=\"explore-container\">\n        <Global\n          styles={css`\n            .navbar {\n              margin-bottom: 0;\n            }\n            body {\n              height: 100vh;\n              max-height: 100vh;\n              overflow: hidden;\n            }\n            #app-menu,\n            #app {\n              flex: 1 1 auto;\n            }\n            #app {\n              flex-basis: 100%;\n              overflow: hidden;\n              height: 100%;\n            }\n            #app-menu {\n              flex-shrink: 0;\n            }\n          `}\n        />\n        <Resizable\n          onResizeStop={(evt, direction, ref, d) => {\n            setWidth(ref.getBoundingClientRect().width);\n            setSidebarWidths(LocalStorageKeys.DatasourceWidth, d);\n          }}\n          defaultSize={{\n            width: getSidebarWidths(LocalStorageKeys.DatasourceWidth),\n            height: '100%',\n          }}\n          minWidth={defaultSidebarsWidth[LocalStorageKeys.DatasourceWidth]}\n          maxWidth=\"33%\"\n          enable={{ right: true }}\n          className={\n            isCollapsed ? 'no-show' : 'explore-column data-source-selection'\n          }\n        >\n          <div className=\"title-container\">\n            <span className=\"horizontal-text\">{t('Chart Source')}</span>\n            <span\n              role=\"button\"\n              tabIndex={0}\n              className=\"action-button\"\n              onClick={toggleCollapse}\n            >\n              <Icons.Expand\n                className=\"collapse-icon\"\n                iconColor={theme.colors.primary.base}\n                iconSize=\"l\"\n              />\n            </span>\n          </div>\n          <DataSourcePanel\n            formData={props.form_data}\n            datasource={props.datasource}\n            controls={props.controls}\n            actions={props.actions}\n            width={width}\n            user={props.user}\n          />\n        </Resizable>\n        {isCollapsed ? (\n          <div\n            className=\"sidebar\"\n            onClick={toggleCollapse}\n            data-test=\"open-datasource-tab\"\n            role=\"button\"\n            tabIndex={0}\n          >\n            <span role=\"button\" tabIndex={0} className=\"action-button\">\n              <Tooltip title={t('Open Datasource tab')}>\n                <Icons.Collapse\n                  className=\"collapse-icon\"\n                  iconColor={theme.colors.primary.base}\n                  iconSize=\"l\"\n                />\n              </Tooltip>\n            </span>\n          </div>\n        ) : null}\n        <Resizable\n          onResizeStop={(evt, direction, ref, d) =>\n            setSidebarWidths(LocalStorageKeys.ControlsWidth, d)\n          }\n          defaultSize={{\n            width: getSidebarWidths(LocalStorageKeys.ControlsWidth),\n            height: '100%',\n          }}\n          minWidth={defaultSidebarsWidth[LocalStorageKeys.ControlsWidth]}\n          maxWidth=\"33%\"\n          enable={{ right: true }}\n          className=\"col-sm-3 explore-column controls-column\"\n        >\n          <ConnectedControlPanelsContainer\n            exploreState={props.exploreState}\n            actions={props.actions}\n            form_data={props.form_data}\n            controls={props.controls}\n            chart={props.chart}\n            datasource_type={props.datasource_type}\n            isDatasourceMetaLoading={props.isDatasourceMetaLoading}\n            onQuery={onQuery}\n            onStop={onStop}\n            canStopQuery={props.can_add || props.can_overwrite}\n            errorMessage={errorMessage}\n            chartIsStale={chartIsStale}\n          />\n        </Resizable>\n        <div\n          className={cx(\n            'main-explore-content',\n            isCollapsed ? 'col-sm-9' : 'col-sm-7',\n          )}\n        >\n          {renderChartContainer()}\n        </div>\n      </ExplorePanelContainer>\n      {props.isSaveModalVisible && (\n        <SaveModal\n          addDangerToast={props.addDangerToast}\n          actions={props.actions}\n          form_data={props.form_data}\n          sliceName={props.sliceName}\n          dashboardId={props.dashboardId}\n        />\n      )}\n    </ExploreContainer>\n  );\n}\n\nExploreViewContainer.propTypes = propTypes;\n\nconst retainQueryModeRequirements = hiddenFormData =>\n  Object.keys(hiddenFormData ?? {}).filter(\n    key => !QUERY_MODE_REQUISITES.has(key),\n  );\n\nfunction mapStateToProps(state) {\n  const {\n    explore,\n    charts,\n    common,\n    impressionId,\n    dataMask,\n    reports,\n    user,\n    saveModal,\n  } = state;\n  const { controls, slice, datasource, metadata, hiddenFormData } = explore;\n  const hasQueryMode = !!controls.query_mode?.value;\n  const fieldsToOmit = hasQueryMode\n    ? retainQueryModeRequirements(hiddenFormData)\n    : Object.keys(hiddenFormData ?? {});\n  const form_data = omit(getFormDataFromControls(controls), fieldsToOmit);\n  const slice_id = form_data.slice_id ?? slice?.slice_id ?? 0; // 0 - unsaved chart\n  form_data.extra_form_data = mergeExtraFormData(\n    { ...form_data.extra_form_data },\n    {\n      ...dataMask[slice_id]?.ownState,\n    },\n  );\n  const chart = charts[slice_id];\n\n  let dashboardId = Number(explore.form_data?.dashboardId);\n  if (Number.isNaN(dashboardId)) {\n    dashboardId = undefined;\n  }\n\n  return {\n    isDatasourceMetaLoading: explore.isDatasourceMetaLoading,\n    datasource,\n    datasource_type: datasource.type,\n    datasourceId: datasource.datasource_id,\n    dashboardId,\n    controls: explore.controls,\n    can_add: !!explore.can_add,\n    can_download: !!explore.can_download,\n    can_overwrite: !!explore.can_overwrite,\n    column_formats: datasource?.column_formats ?? null,\n    containerId: slice\n      ? `slice-container-${slice.slice_id}`\n      : 'slice-container',\n    isStarred: explore.isStarred,\n    slice,\n    sliceName: explore.sliceName ?? slice?.slice_name ?? null,\n    triggerRender: explore.triggerRender,\n    form_data,\n    table_name: datasource.table_name,\n    vizType: form_data.viz_type,\n    standalone: !!explore.standalone,\n    force: !!explore.force,\n    chart,\n    timeout: common.conf.SUPERSET_WEBSERVER_TIMEOUT,\n    ownState: dataMask[slice_id]?.ownState,\n    impressionId,\n    user,\n    exploreState: explore,\n    reports,\n    metadata,\n    saveAction: explore.saveAction,\n    isSaveModalVisible: saveModal.isVisible,\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  const actions = {\n    ...exploreActions,\n    ...datasourcesActions,\n    ...saveModalActions,\n    ...chartActions,\n    ...logActions,\n  };\n  return {\n    actions: bindActionCreators(actions, dispatch),\n  };\n}\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps,\n)(withToasts(memo(ExploreViewContainer)));\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}