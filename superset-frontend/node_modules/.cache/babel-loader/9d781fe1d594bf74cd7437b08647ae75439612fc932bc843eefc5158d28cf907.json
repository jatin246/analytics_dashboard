{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Component } from 'react';\nimport { t } from '@superset-ui/core';\nimport PropTypes from 'prop-types';\nimport { PivotData, flatKey } from './utilities';\nimport { Styles } from './Styles';import { jsx as _jsx, jsxs as _jsxs } from \"@emotion/react/jsx-runtime\";\n\nconst parseLabel = (value) => {\n  if (typeof value === 'string') {\n    if (value === 'metric') return t('metric');\n    return value;\n  }\n  if (typeof value === 'number') {\n    return value;\n  }\n  return String(value);\n};\n\nfunction displayHeaderCell(\nneedToggle,\nArrowIcon,\nonArrowClick,\nvalue,\nnamesMapping)\n{\n  const name = namesMapping[value] || value;\n  return needToggle ?\n  _jsxs(\"span\", { className: \"toggle-wrapper\", children: [\n    _jsx(\"span\", {\n      role: \"button\",\n      tabIndex: \"0\",\n      className: \"toggle\",\n      onClick: onArrowClick, children:\n\n      ArrowIcon }\n    ),\n    _jsx(\"span\", { className: \"toggle-val\", children: parseLabel(name) })] }\n  ) :\n\n  parseLabel(name);\n\n}\n\nexport class TableRenderer extends Component {\n  constructor(props) {\n    super(props);\n\n    // We need state to record which entries are collapsed and which aren't.\n    // This is an object with flat-keys indicating if the corresponding rows\n    // should be collapsed.\n    this.state = { collapsedRows: {}, collapsedCols: {} };\n\n    this.clickHeaderHandler = this.clickHeaderHandler.bind(this);\n    this.clickHandler = this.clickHandler.bind(this);\n  }\n\n  getBasePivotSettings() {\n    // One-time extraction of pivot settings that we'll use throughout the render.\n\n    const { props } = this;\n    const colAttrs = props.cols;\n    const rowAttrs = props.rows;\n\n    const tableOptions = {\n      rowTotals: true,\n      colTotals: true,\n      ...props.tableOptions\n    };\n    const rowTotals = tableOptions.rowTotals || colAttrs.length === 0;\n    const colTotals = tableOptions.colTotals || rowAttrs.length === 0;\n\n    const namesMapping = props.namesMapping || {};\n    const subtotalOptions = {\n      arrowCollapsed: '\\u25B2',\n      arrowExpanded: '\\u25BC',\n      ...props.subtotalOptions\n    };\n\n    const colSubtotalDisplay = {\n      displayOnTop: false,\n      enabled: tableOptions.colSubTotals,\n      hideOnExpand: false,\n      ...subtotalOptions.colSubtotalDisplay\n    };\n\n    const rowSubtotalDisplay = {\n      displayOnTop: false,\n      enabled: tableOptions.rowSubTotals,\n      hideOnExpand: false,\n      ...subtotalOptions.rowSubtotalDisplay\n    };\n\n    const pivotData = new PivotData(props, {\n      rowEnabled: rowSubtotalDisplay.enabled,\n      colEnabled: colSubtotalDisplay.enabled,\n      rowPartialOnTop: rowSubtotalDisplay.displayOnTop,\n      colPartialOnTop: colSubtotalDisplay.displayOnTop\n    });\n    const rowKeys = pivotData.getRowKeys();\n    const colKeys = pivotData.getColKeys();\n\n    // Also pre-calculate all the callbacks for cells, etc... This is nice to have to\n    // avoid re-calculations of the call-backs on cell expansions, etc...\n    const cellCallbacks = {};\n    const rowTotalCallbacks = {};\n    const colTotalCallbacks = {};\n    let grandTotalCallback = null;\n    if (tableOptions.clickCallback) {\n      rowKeys.forEach((rowKey) => {\n        const flatRowKey = flatKey(rowKey);\n        if (!(flatRowKey in cellCallbacks)) {\n          cellCallbacks[flatRowKey] = {};\n        }\n        colKeys.forEach((colKey) => {\n          cellCallbacks[flatRowKey][flatKey(colKey)] = this.clickHandler(\n            pivotData,\n            rowKey,\n            colKey\n          );\n        });\n      });\n\n      // Add in totals as well.\n      if (rowTotals) {\n        rowKeys.forEach((rowKey) => {\n          rowTotalCallbacks[flatKey(rowKey)] = this.clickHandler(\n            pivotData,\n            rowKey,\n            []\n          );\n        });\n      }\n      if (colTotals) {\n        colKeys.forEach((colKey) => {\n          colTotalCallbacks[flatKey(colKey)] = this.clickHandler(\n            pivotData,\n            [],\n            colKey\n          );\n        });\n      }\n      if (rowTotals && colTotals) {\n        grandTotalCallback = this.clickHandler(pivotData, [], []);\n      }\n    }\n\n    return {\n      pivotData,\n      colAttrs,\n      rowAttrs,\n      colKeys,\n      rowKeys,\n      rowTotals,\n      colTotals,\n      arrowCollapsed: subtotalOptions.arrowCollapsed,\n      arrowExpanded: subtotalOptions.arrowExpanded,\n      colSubtotalDisplay,\n      rowSubtotalDisplay,\n      cellCallbacks,\n      rowTotalCallbacks,\n      colTotalCallbacks,\n      grandTotalCallback,\n      namesMapping\n    };\n  }\n\n  clickHandler(pivotData, rowValues, colValues) {\n    const colAttrs = this.props.cols;\n    const rowAttrs = this.props.rows;\n    const value = pivotData.getAggregator(rowValues, colValues).value();\n    const filters = {};\n    const colLimit = Math.min(colAttrs.length, colValues.length);\n    for (let i = 0; i < colLimit; i += 1) {\n      const attr = colAttrs[i];\n      if (colValues[i] !== null) {\n        filters[attr] = colValues[i];\n      }\n    }\n    const rowLimit = Math.min(rowAttrs.length, rowValues.length);\n    for (let i = 0; i < rowLimit; i += 1) {\n      const attr = rowAttrs[i];\n      if (rowValues[i] !== null) {\n        filters[attr] = rowValues[i];\n      }\n    }\n    return (e) =>\n    this.props.tableOptions.clickCallback(e, value, filters, pivotData);\n  }\n\n  clickHeaderHandler(\n  pivotData,\n  values,\n  attrs,\n  attrIdx,\n  callback,\n  isSubtotal = false,\n  isGrandTotal = false)\n  {\n    const filters = {};\n    for (let i = 0; i <= attrIdx; i += 1) {\n      const attr = attrs[i];\n      filters[attr] = values[i];\n    }\n    return (e) =>\n    callback(\n      e,\n      values[attrIdx],\n      filters,\n      pivotData,\n      isSubtotal,\n      isGrandTotal\n    );\n  }\n\n  collapseAttr(rowOrCol, attrIdx, allKeys) {\n    return (e) => {\n      // Collapse an entire attribute.\n      e.stopPropagation();\n      const keyLen = attrIdx + 1;\n      const collapsed = allKeys.filter((k) => k.length === keyLen).map(flatKey);\n\n      const updates = {};\n      collapsed.forEach((k) => {\n        updates[k] = true;\n      });\n\n      if (rowOrCol) {\n        this.setState((state) => ({\n          collapsedRows: { ...state.collapsedRows, ...updates }\n        }));\n      } else {\n        this.setState((state) => ({\n          collapsedCols: { ...state.collapsedCols, ...updates }\n        }));\n      }\n    };\n  }\n\n  expandAttr(rowOrCol, attrIdx, allKeys) {\n    return (e) => {\n      // Expand an entire attribute. This implicitly implies expanding all of the\n      // parents as well. It's a bit inefficient but ah well...\n      e.stopPropagation();\n      const updates = {};\n      allKeys.forEach((k) => {\n        for (let i = 0; i <= attrIdx; i += 1) {\n          updates[flatKey(k.slice(0, i + 1))] = false;\n        }\n      });\n\n      if (rowOrCol) {\n        this.setState((state) => ({\n          collapsedRows: { ...state.collapsedRows, ...updates }\n        }));\n      } else {\n        this.setState((state) => ({\n          collapsedCols: { ...state.collapsedCols, ...updates }\n        }));\n      }\n    };\n  }\n\n  toggleRowKey(flatRowKey) {\n    return (e) => {\n      e.stopPropagation();\n      this.setState((state) => ({\n        collapsedRows: {\n          ...state.collapsedRows,\n          [flatRowKey]: !state.collapsedRows[flatRowKey]\n        }\n      }));\n    };\n  }\n\n  toggleColKey(flatColKey) {\n    return (e) => {\n      e.stopPropagation();\n      this.setState((state) => ({\n        collapsedCols: {\n          ...state.collapsedCols,\n          [flatColKey]: !state.collapsedCols[flatColKey]\n        }\n      }));\n    };\n  }\n\n  calcAttrSpans(attrArr, numAttrs) {\n    // Given an array of attribute values (i.e. each element is another array with\n    // the value at every level), compute the spans for every attribute value at\n    // every level. The return value is a nested array of the same shape. It has\n    // -1's for repeated values and the span number otherwise.\n\n    const spans = [];\n    // Index of the last new value\n    const li = Array(numAttrs).map(() => 0);\n    let lv = Array(numAttrs).map(() => null);\n    for (let i = 0; i < attrArr.length; i += 1) {\n      // Keep increasing span values as long as the last keys are the same. For\n      // the rest, record spans of 1. Update the indices too.\n      const cv = attrArr[i];\n      const ent = [];\n      let depth = 0;\n      const limit = Math.min(lv.length, cv.length);\n      while (depth < limit && lv[depth] === cv[depth]) {\n        ent.push(-1);\n        spans[li[depth]][depth] += 1;\n        depth += 1;\n      }\n      while (depth < cv.length) {\n        li[depth] = i;\n        ent.push(1);\n        depth += 1;\n      }\n      spans.push(ent);\n      lv = cv;\n    }\n    return spans;\n  }\n\n  renderColHeaderRow(attrName, attrIdx, pivotSettings) {\n    // Render a single row in the column header at the top of the pivot table.\n\n    const {\n      rowAttrs,\n      colAttrs,\n      colKeys,\n      visibleColKeys,\n      colAttrSpans,\n      rowTotals,\n      arrowExpanded,\n      arrowCollapsed,\n      colSubtotalDisplay,\n      maxColVisible,\n      pivotData,\n      namesMapping\n    } = pivotSettings;\n    const {\n      highlightHeaderCellsOnHover,\n      omittedHighlightHeaderGroups = [],\n      highlightedHeaderCells,\n      dateFormatters\n    } = this.props.tableOptions;\n\n    const spaceCell =\n    attrIdx === 0 && rowAttrs.length !== 0 ?\n    _jsx(\"th\", {\n\n      colSpan: rowAttrs.length,\n      rowSpan: colAttrs.length,\n      \"aria-hidden\": \"true\" }, \"padding\"\n    ) :\n    null;\n\n    const needToggle =\n    colSubtotalDisplay.enabled && attrIdx !== colAttrs.length - 1;\n    let arrowClickHandle = null;\n    let subArrow = null;\n    if (needToggle) {\n      arrowClickHandle =\n      attrIdx + 1 < maxColVisible ?\n      this.collapseAttr(false, attrIdx, colKeys) :\n      this.expandAttr(false, attrIdx, colKeys);\n      subArrow = attrIdx + 1 < maxColVisible ? arrowExpanded : arrowCollapsed;\n    }\n    const attrNameCell =\n    _jsx(\"th\", { className: \"pvtAxisLabel\", children:\n      displayHeaderCell(\n        needToggle,\n        subArrow,\n        arrowClickHandle,\n        attrName,\n        namesMapping\n      ) }, \"label\"\n    );\n\n\n    const attrValueCells = [];\n    const rowIncrSpan = rowAttrs.length !== 0 ? 1 : 0;\n    // Iterate through columns. Jump over duplicate values.\n    let i = 0;\n    while (i < visibleColKeys.length) {\n      let handleContextMenu;\n      const colKey = visibleColKeys[i];\n      const colSpan = attrIdx < colKey.length ? colAttrSpans[i][attrIdx] : 1;\n      let colLabelClass = 'pvtColLabel';\n      if (attrIdx < colKey.length) {\n        if (!omittedHighlightHeaderGroups.includes(colAttrs[attrIdx])) {\n          if (highlightHeaderCellsOnHover) {\n            colLabelClass += ' hoverable';\n          }\n          handleContextMenu = (e) =>\n          this.props.onContextMenu(e, colKey, undefined, {\n            [attrName]: colKey[attrIdx]\n          });\n        }\n        if (\n        highlightedHeaderCells &&\n        Array.isArray(highlightedHeaderCells[colAttrs[attrIdx]]) &&\n        highlightedHeaderCells[colAttrs[attrIdx]].includes(colKey[attrIdx]))\n        {\n          colLabelClass += ' active';\n        }\n\n        const rowSpan = 1 + (attrIdx === colAttrs.length - 1 ? rowIncrSpan : 0);\n        const flatColKey = flatKey(colKey.slice(0, attrIdx + 1));\n        const onArrowClick = needToggle ? this.toggleColKey(flatColKey) : null;\n\n        const headerCellFormattedValue =\n        dateFormatters &&\n        dateFormatters[attrName] &&\n        typeof dateFormatters[attrName] === 'function' ?\n        dateFormatters[attrName](colKey[attrIdx]) :\n        colKey[attrIdx];\n        attrValueCells.push(\n          _jsx(\"th\", {\n            className: colLabelClass,\n\n            colSpan: colSpan,\n            rowSpan: rowSpan,\n            role: \"columnheader button\",\n            onClick: this.clickHeaderHandler(\n              pivotData,\n              colKey,\n              this.props.cols,\n              attrIdx,\n              this.props.tableOptions.clickColumnHeaderCallback\n            ),\n            onContextMenu: handleContextMenu, children:\n\n            displayHeaderCell(\n              needToggle,\n              this.state.collapsedCols[flatColKey] ?\n              arrowCollapsed :\n              arrowExpanded,\n              onArrowClick,\n              headerCellFormattedValue,\n              namesMapping\n            ) }, `colKey-${flatColKey}`\n          )\n        );\n      } else if (attrIdx === colKey.length) {\n        const rowSpan = colAttrs.length - colKey.length + rowIncrSpan;\n        attrValueCells.push(\n          _jsx(\"th\", {\n            className: `${colLabelClass} pvtSubtotalLabel`,\n\n            colSpan: colSpan,\n            rowSpan: rowSpan,\n            role: \"columnheader button\",\n            onClick: this.clickHeaderHandler(\n              pivotData,\n              colKey,\n              this.props.cols,\n              attrIdx,\n              this.props.tableOptions.clickColumnHeaderCallback,\n              true\n            ), children:\n\n            t('Subtotal') }, `colKeyBuffer-${flatKey(colKey)}`\n          )\n        );\n      }\n      // The next colSpan columns will have the same value anyway...\n      i += colSpan;\n    }\n\n    const totalCell =\n    attrIdx === 0 && rowTotals ?\n    _jsx(\"th\", {\n\n      className: \"pvtTotalLabel\",\n      rowSpan: colAttrs.length + Math.min(rowAttrs.length, 1),\n      role: \"columnheader button\",\n      onClick: this.clickHeaderHandler(\n        pivotData,\n        [],\n        this.props.cols,\n        attrIdx,\n        this.props.tableOptions.clickColumnHeaderCallback,\n        false,\n        true\n      ), children:\n\n      t('Total (%(aggregatorName)s)', {\n        aggregatorName: t(this.props.aggregatorName)\n      }) }, \"total\"\n    ) :\n    null;\n\n    const cells = [spaceCell, attrNameCell, ...attrValueCells, totalCell];\n    return _jsx(\"tr\", { children: cells }, `colAttr-${attrIdx}`);\n  }\n\n  renderRowHeaderRow(pivotSettings) {\n    // Render just the attribute names of the rows (the actual attribute values\n    // will show up in the individual rows).\n\n    const {\n      rowAttrs,\n      colAttrs,\n      rowKeys,\n      arrowCollapsed,\n      arrowExpanded,\n      rowSubtotalDisplay,\n      maxRowVisible,\n      pivotData,\n      namesMapping\n    } = pivotSettings;\n    return (\n      _jsxs(\"tr\", { children: [\n        rowAttrs.map((r, i) => {\n          const needLabelToggle =\n          rowSubtotalDisplay.enabled && i !== rowAttrs.length - 1;\n          let arrowClickHandle = null;\n          let subArrow = null;\n          if (needLabelToggle) {\n            arrowClickHandle =\n            i + 1 < maxRowVisible ?\n            this.collapseAttr(true, i, rowKeys) :\n            this.expandAttr(true, i, rowKeys);\n            subArrow = i + 1 < maxRowVisible ? arrowExpanded : arrowCollapsed;\n          }\n          return (\n            _jsx(\"th\", { className: \"pvtAxisLabel\", children:\n              displayHeaderCell(\n                needLabelToggle,\n                subArrow,\n                arrowClickHandle,\n                r,\n                namesMapping\n              ) }, `rowAttr-${i}`\n            ));\n\n        }),\n        _jsx(\"th\", {\n          className: \"pvtTotalLabel\",\n\n          role: \"columnheader button\",\n          onClick: this.clickHeaderHandler(\n            pivotData,\n            [],\n            this.props.rows,\n            0,\n            this.props.tableOptions.clickRowHeaderCallback,\n            false,\n            true\n          ), children:\n\n          colAttrs.length === 0 ?\n          t('Total (%(aggregatorName)s)', {\n            aggregatorName: t(this.props.aggregatorName)\n          }) :\n          null }, \"padding\"\n        )] }, \"rowHdr\"\n      ));\n\n  }\n\n  renderTableRow(rowKey, rowIdx, pivotSettings) {\n    // Render a single row in the pivot table.\n\n    const {\n      rowAttrs,\n      colAttrs,\n      rowAttrSpans,\n      visibleColKeys,\n      pivotData,\n      rowTotals,\n      rowSubtotalDisplay,\n      arrowExpanded,\n      arrowCollapsed,\n      cellCallbacks,\n      rowTotalCallbacks,\n      namesMapping\n    } = pivotSettings;\n\n    const {\n      highlightHeaderCellsOnHover,\n      omittedHighlightHeaderGroups = [],\n      highlightedHeaderCells,\n      cellColorFormatters,\n      dateFormatters\n    } = this.props.tableOptions;\n    const flatRowKey = flatKey(rowKey);\n\n    const colIncrSpan = colAttrs.length !== 0 ? 1 : 0;\n    const attrValueCells = rowKey.map((r, i) => {\n      let handleContextMenu;\n      let valueCellClassName = 'pvtRowLabel';\n      if (!omittedHighlightHeaderGroups.includes(rowAttrs[i])) {\n        if (highlightHeaderCellsOnHover) {\n          valueCellClassName += ' hoverable';\n        }\n        handleContextMenu = (e) =>\n        this.props.onContextMenu(e, undefined, rowKey, {\n          [rowAttrs[i]]: r\n        });\n      }\n      if (\n      highlightedHeaderCells &&\n      Array.isArray(highlightedHeaderCells[rowAttrs[i]]) &&\n      highlightedHeaderCells[rowAttrs[i]].includes(r))\n      {\n        valueCellClassName += ' active';\n      }\n      const rowSpan = rowAttrSpans[rowIdx][i];\n      if (rowSpan > 0) {\n        const flatRowKey = flatKey(rowKey.slice(0, i + 1));\n        const colSpan = 1 + (i === rowAttrs.length - 1 ? colIncrSpan : 0);\n        const needRowToggle =\n        rowSubtotalDisplay.enabled && i !== rowAttrs.length - 1;\n        const onArrowClick = needRowToggle ?\n        this.toggleRowKey(flatRowKey) :\n        null;\n\n        const headerCellFormattedValue =\n        dateFormatters && dateFormatters[rowAttrs[i]] ?\n        dateFormatters[rowAttrs[i]](r) :\n        r;\n        return (\n          _jsx(\"th\", {\n\n            className: valueCellClassName,\n            rowSpan: rowSpan,\n            colSpan: colSpan,\n            role: \"columnheader button\",\n            onClick: this.clickHeaderHandler(\n              pivotData,\n              rowKey,\n              this.props.rows,\n              i,\n              this.props.tableOptions.clickRowHeaderCallback\n            ),\n            onContextMenu: handleContextMenu, children:\n\n            displayHeaderCell(\n              needRowToggle,\n              this.state.collapsedRows[flatRowKey] ?\n              arrowCollapsed :\n              arrowExpanded,\n              onArrowClick,\n              headerCellFormattedValue,\n              namesMapping\n            ) }, `rowKeyLabel-${i}`\n          ));\n\n      }\n      return null;\n    });\n\n    const attrValuePaddingCell =\n    rowKey.length < rowAttrs.length ?\n    _jsx(\"th\", {\n      className: \"pvtRowLabel pvtSubtotalLabel\",\n\n      colSpan: rowAttrs.length - rowKey.length + colIncrSpan,\n      rowSpan: 1,\n      role: \"columnheader button\",\n      onClick: this.clickHeaderHandler(\n        pivotData,\n        rowKey,\n        this.props.rows,\n        rowKey.length,\n        this.props.tableOptions.clickRowHeaderCallback,\n        true\n      ), children:\n\n      t('Subtotal') }, \"rowKeyBuffer\"\n    ) :\n    null;\n\n    const rowClickHandlers = cellCallbacks[flatRowKey] || {};\n    const valueCells = visibleColKeys.map((colKey) => {\n      const flatColKey = flatKey(colKey);\n      const agg = pivotData.getAggregator(rowKey, colKey);\n      const aggValue = agg.value();\n\n      const keys = [...rowKey, ...colKey];\n      let backgroundColor;\n      if (cellColorFormatters) {\n        Object.values(cellColorFormatters).forEach((cellColorFormatter) => {\n          if (Array.isArray(cellColorFormatter)) {\n            keys.forEach((key) => {\n              if (backgroundColor) {\n                return;\n              }\n              cellColorFormatter.\n              filter((formatter) => formatter.column === key).\n              forEach((formatter) => {\n                const formatterResult = formatter.getColorFromValue(aggValue);\n                if (formatterResult) {\n                  backgroundColor = formatterResult;\n                }\n              });\n            });\n          }\n        });\n      }\n\n      const style = agg.isSubtotal ?\n      { fontWeight: 'bold' } :\n      { backgroundColor };\n\n      return (\n        _jsx(\"td\", {\n          role: \"gridcell\",\n          className: \"pvtVal\",\n\n          onClick: rowClickHandlers[flatColKey],\n          onContextMenu: (e) => this.props.onContextMenu(e, colKey, rowKey),\n          style: style, children:\n\n          agg.format(aggValue) }, `pvtVal-${flatColKey}`\n        ));\n\n    });\n\n    let totalCell = null;\n    if (rowTotals) {\n      const agg = pivotData.getAggregator(rowKey, []);\n      const aggValue = agg.value();\n      totalCell =\n      _jsx(\"td\", {\n        role: \"gridcell\",\n\n        className: \"pvtTotal\",\n        onClick: rowTotalCallbacks[flatRowKey],\n        onContextMenu: (e) => this.props.onContextMenu(e, undefined, rowKey), children:\n\n        agg.format(aggValue) }, \"total\"\n      );\n\n    }\n\n    const rowCells = [\n    ...attrValueCells,\n    attrValuePaddingCell,\n    ...valueCells,\n    totalCell];\n\n\n    return _jsx(\"tr\", { children: rowCells }, `keyRow-${flatRowKey}`);\n  }\n\n  renderTotalsRow(pivotSettings) {\n    // Render the final totals rows that has the totals for all the columns.\n\n    const {\n      rowAttrs,\n      colAttrs,\n      visibleColKeys,\n      rowTotals,\n      pivotData,\n      colTotalCallbacks,\n      grandTotalCallback\n    } = pivotSettings;\n\n    const totalLabelCell =\n    _jsx(\"th\", {\n\n      className: \"pvtTotalLabel pvtRowTotalLabel\",\n      colSpan: rowAttrs.length + Math.min(colAttrs.length, 1),\n      role: \"columnheader button\",\n      onClick: this.clickHeaderHandler(\n        pivotData,\n        [],\n        this.props.rows,\n        0,\n        this.props.tableOptions.clickRowHeaderCallback,\n        false,\n        true\n      ), children:\n\n      t('Total (%(aggregatorName)s)', {\n        aggregatorName: t(this.props.aggregatorName)\n      }) }, \"label\"\n    );\n\n\n    const totalValueCells = visibleColKeys.map((colKey) => {\n      const flatColKey = flatKey(colKey);\n      const agg = pivotData.getAggregator([], colKey);\n      const aggValue = agg.value();\n\n      return (\n        _jsx(\"td\", {\n          role: \"gridcell\",\n          className: \"pvtTotal pvtRowTotal\",\n\n          onClick: colTotalCallbacks[flatColKey],\n          onContextMenu: (e) => this.props.onContextMenu(e, colKey, undefined),\n          style: { padding: '5px' }, children:\n\n          agg.format(aggValue) }, `total-${flatColKey}`\n        ));\n\n    });\n\n    let grandTotalCell = null;\n    if (rowTotals) {\n      const agg = pivotData.getAggregator([], []);\n      const aggValue = agg.value();\n      grandTotalCell =\n      _jsx(\"td\", {\n        role: \"gridcell\",\n\n        className: \"pvtGrandTotal pvtRowTotal\",\n        onClick: grandTotalCallback,\n        onContextMenu: (e) => this.props.onContextMenu(e, undefined, undefined), children:\n\n        agg.format(aggValue) }, \"total\"\n      );\n\n    }\n\n    const totalCells = [totalLabelCell, ...totalValueCells, grandTotalCell];\n\n    return (\n      _jsx(\"tr\", { className: \"pvtRowTotals\", children:\n        totalCells }, \"total\"\n      ));\n\n  }\n\n  visibleKeys(keys, collapsed, numAttrs, subtotalDisplay) {\n    return keys.filter(\n      (key) =>\n      // Is the key hidden by one of its parents?\n      !key.some((k, j) => collapsed[flatKey(key.slice(0, j))]) && (\n      // Leaf key.\n      key.length === numAttrs ||\n      // Children hidden. Must show total.\n      flatKey(key) in collapsed ||\n      // Don't hide totals.\n      !subtotalDisplay.hideOnExpand)\n    );\n  }\n\n  isDashboardEditMode() {\n    return document.contains(document.querySelector('.dashboard--editing'));\n  }\n\n  render() {\n    if (this.cachedProps !== this.props) {\n      this.cachedProps = this.props;\n      this.cachedBasePivotSettings = this.getBasePivotSettings();\n    }\n    const {\n      colAttrs,\n      rowAttrs,\n      rowKeys,\n      colKeys,\n      colTotals,\n      rowSubtotalDisplay,\n      colSubtotalDisplay\n    } = this.cachedBasePivotSettings;\n\n    // Need to account for exclusions to compute the effective row\n    // and column keys.\n    const visibleRowKeys = this.visibleKeys(\n      rowKeys,\n      this.state.collapsedRows,\n      rowAttrs.length,\n      rowSubtotalDisplay\n    );\n    const visibleColKeys = this.visibleKeys(\n      colKeys,\n      this.state.collapsedCols,\n      colAttrs.length,\n      colSubtotalDisplay\n    );\n\n    const pivotSettings = {\n      visibleRowKeys,\n      maxRowVisible: Math.max(...visibleRowKeys.map((k) => k.length)),\n      visibleColKeys,\n      maxColVisible: Math.max(...visibleColKeys.map((k) => k.length)),\n      rowAttrSpans: this.calcAttrSpans(visibleRowKeys, rowAttrs.length),\n      colAttrSpans: this.calcAttrSpans(visibleColKeys, colAttrs.length),\n      ...this.cachedBasePivotSettings\n    };\n\n    return (\n      _jsx(Styles, { isDashboardEditMode: this.isDashboardEditMode(), children:\n        _jsxs(\"table\", { className: \"pvtTable\", role: \"grid\", children: [\n          _jsxs(\"thead\", { children: [\n            colAttrs.map((c, j) =>\n            this.renderColHeaderRow(c, j, pivotSettings)\n            ),\n            rowAttrs.length !== 0 && this.renderRowHeaderRow(pivotSettings)] }\n          ),\n          _jsxs(\"tbody\", { children: [\n            visibleRowKeys.map((r, i) =>\n            this.renderTableRow(r, i, pivotSettings)\n            ),\n            colTotals && this.renderTotalsRow(pivotSettings)] }\n          )] }\n        ) }\n      ));\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nTableRenderer.propTypes = {\n  ...PivotData.propTypes,\n  tableOptions: PropTypes.object,\n  onContextMenu: PropTypes.func\n};\nTableRenderer.defaultProps = { ...PivotData.defaultProps, tableOptions: {} };;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(parseLabel, \"parseLabel\", \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\");reactHotLoader.register(displayHeaderCell, \"displayHeaderCell\", \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\");reactHotLoader.register(TableRenderer, \"TableRenderer\", \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["Component","t","PropTypes","PivotData","flatKey","Styles","jsx","_jsx","jsxs","_jsxs","parseLabel","value","String","displayHeaderCell","needToggle","ArrowIcon","onArrowClick","namesMapping","name","className","children","role","tabIndex","onClick","TableRenderer","constructor","props","state","collapsedRows","collapsedCols","clickHeaderHandler","bind","clickHandler","getBasePivotSettings","colAttrs","cols","rowAttrs","rows","tableOptions","rowTotals","colTotals","length","subtotalOptions","arrowCollapsed","arrowExpanded","colSubtotalDisplay","displayOnTop","enabled","colSubTotals","hideOnExpand","rowSubtotalDisplay","rowSubTotals","pivotData","rowEnabled","colEnabled","rowPartialOnTop","colPartialOnTop","rowKeys","getRowKeys","colKeys","getColKeys","cellCallbacks","rowTotalCallbacks","colTotalCallbacks","grandTotalCallback","clickCallback","forEach","rowKey","flatRowKey","colKey","rowValues","colValues","getAggregator","filters","colLimit","Math","min","i","attr","rowLimit","e","values","attrs","attrIdx","callback","isSubtotal","isGrandTotal","collapseAttr","rowOrCol","allKeys","stopPropagation","keyLen","collapsed","filter","k","map","updates","setState","expandAttr","slice","toggleRowKey","toggleColKey","flatColKey","calcAttrSpans","attrArr","numAttrs","spans","li","Array","lv","cv","ent","depth","limit","push","renderColHeaderRow","attrName","pivotSettings","visibleColKeys","colAttrSpans","maxColVisible","highlightHeaderCellsOnHover","omittedHighlightHeaderGroups","highlightedHeaderCells","dateFormatters","spaceCell","colSpan","rowSpan","arrowClickHandle","subArrow","attrNameCell","attrValueCells","rowIncrSpan","handleContextMenu","colLabelClass","includes","onContextMenu","undefined","isArray","headerCellFormattedValue","clickColumnHeaderCallback","totalCell","aggregatorName","cells","renderRowHeaderRow","maxRowVisible","r","needLabelToggle","clickRowHeaderCallback","renderTableRow","rowIdx","rowAttrSpans","cellColorFormatters","colIncrSpan","valueCellClassName","needRowToggle","attrValuePaddingCell","rowClickHandlers","valueCells","agg","aggValue","keys","backgroundColor","Object","cellColorFormatter","key","formatter","column","formatterResult","getColorFromValue","style","fontWeight","format","rowCells","renderTotalsRow","totalLabelCell","totalValueCells","padding","grandTotalCell","totalCells","visibleKeys","subtotalDisplay","some","j","isDashboardEditMode","document","contains","querySelector","render","cachedProps","cachedBasePivotSettings","visibleRowKeys","max","c","__reactstandin__regenerateByEval","code","eval","propTypes","object","func","defaultProps","reactHotLoader","reactHotLoaderGlobal","default","register","leaveModule","module"],"sources":["/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Component } from 'react';\nimport { t } from '@superset-ui/core';\nimport PropTypes from 'prop-types';\nimport { PivotData, flatKey } from './utilities';\nimport { Styles } from './Styles';\n\nconst parseLabel = value => {\n  if (typeof value === 'string') {\n    if (value === 'metric') return t('metric');\n    return value;\n  }\n  if (typeof value === 'number') {\n    return value;\n  }\n  return String(value);\n};\n\nfunction displayHeaderCell(\n  needToggle,\n  ArrowIcon,\n  onArrowClick,\n  value,\n  namesMapping,\n) {\n  const name = namesMapping[value] || value;\n  return needToggle ? (\n    <span className=\"toggle-wrapper\">\n      <span\n        role=\"button\"\n        tabIndex=\"0\"\n        className=\"toggle\"\n        onClick={onArrowClick}\n      >\n        {ArrowIcon}\n      </span>\n      <span className=\"toggle-val\">{parseLabel(name)}</span>\n    </span>\n  ) : (\n    parseLabel(name)\n  );\n}\n\nexport class TableRenderer extends Component {\n  constructor(props) {\n    super(props);\n\n    // We need state to record which entries are collapsed and which aren't.\n    // This is an object with flat-keys indicating if the corresponding rows\n    // should be collapsed.\n    this.state = { collapsedRows: {}, collapsedCols: {} };\n\n    this.clickHeaderHandler = this.clickHeaderHandler.bind(this);\n    this.clickHandler = this.clickHandler.bind(this);\n  }\n\n  getBasePivotSettings() {\n    // One-time extraction of pivot settings that we'll use throughout the render.\n\n    const { props } = this;\n    const colAttrs = props.cols;\n    const rowAttrs = props.rows;\n\n    const tableOptions = {\n      rowTotals: true,\n      colTotals: true,\n      ...props.tableOptions,\n    };\n    const rowTotals = tableOptions.rowTotals || colAttrs.length === 0;\n    const colTotals = tableOptions.colTotals || rowAttrs.length === 0;\n\n    const namesMapping = props.namesMapping || {};\n    const subtotalOptions = {\n      arrowCollapsed: '\\u25B2',\n      arrowExpanded: '\\u25BC',\n      ...props.subtotalOptions,\n    };\n\n    const colSubtotalDisplay = {\n      displayOnTop: false,\n      enabled: tableOptions.colSubTotals,\n      hideOnExpand: false,\n      ...subtotalOptions.colSubtotalDisplay,\n    };\n\n    const rowSubtotalDisplay = {\n      displayOnTop: false,\n      enabled: tableOptions.rowSubTotals,\n      hideOnExpand: false,\n      ...subtotalOptions.rowSubtotalDisplay,\n    };\n\n    const pivotData = new PivotData(props, {\n      rowEnabled: rowSubtotalDisplay.enabled,\n      colEnabled: colSubtotalDisplay.enabled,\n      rowPartialOnTop: rowSubtotalDisplay.displayOnTop,\n      colPartialOnTop: colSubtotalDisplay.displayOnTop,\n    });\n    const rowKeys = pivotData.getRowKeys();\n    const colKeys = pivotData.getColKeys();\n\n    // Also pre-calculate all the callbacks for cells, etc... This is nice to have to\n    // avoid re-calculations of the call-backs on cell expansions, etc...\n    const cellCallbacks = {};\n    const rowTotalCallbacks = {};\n    const colTotalCallbacks = {};\n    let grandTotalCallback = null;\n    if (tableOptions.clickCallback) {\n      rowKeys.forEach(rowKey => {\n        const flatRowKey = flatKey(rowKey);\n        if (!(flatRowKey in cellCallbacks)) {\n          cellCallbacks[flatRowKey] = {};\n        }\n        colKeys.forEach(colKey => {\n          cellCallbacks[flatRowKey][flatKey(colKey)] = this.clickHandler(\n            pivotData,\n            rowKey,\n            colKey,\n          );\n        });\n      });\n\n      // Add in totals as well.\n      if (rowTotals) {\n        rowKeys.forEach(rowKey => {\n          rowTotalCallbacks[flatKey(rowKey)] = this.clickHandler(\n            pivotData,\n            rowKey,\n            [],\n          );\n        });\n      }\n      if (colTotals) {\n        colKeys.forEach(colKey => {\n          colTotalCallbacks[flatKey(colKey)] = this.clickHandler(\n            pivotData,\n            [],\n            colKey,\n          );\n        });\n      }\n      if (rowTotals && colTotals) {\n        grandTotalCallback = this.clickHandler(pivotData, [], []);\n      }\n    }\n\n    return {\n      pivotData,\n      colAttrs,\n      rowAttrs,\n      colKeys,\n      rowKeys,\n      rowTotals,\n      colTotals,\n      arrowCollapsed: subtotalOptions.arrowCollapsed,\n      arrowExpanded: subtotalOptions.arrowExpanded,\n      colSubtotalDisplay,\n      rowSubtotalDisplay,\n      cellCallbacks,\n      rowTotalCallbacks,\n      colTotalCallbacks,\n      grandTotalCallback,\n      namesMapping,\n    };\n  }\n\n  clickHandler(pivotData, rowValues, colValues) {\n    const colAttrs = this.props.cols;\n    const rowAttrs = this.props.rows;\n    const value = pivotData.getAggregator(rowValues, colValues).value();\n    const filters = {};\n    const colLimit = Math.min(colAttrs.length, colValues.length);\n    for (let i = 0; i < colLimit; i += 1) {\n      const attr = colAttrs[i];\n      if (colValues[i] !== null) {\n        filters[attr] = colValues[i];\n      }\n    }\n    const rowLimit = Math.min(rowAttrs.length, rowValues.length);\n    for (let i = 0; i < rowLimit; i += 1) {\n      const attr = rowAttrs[i];\n      if (rowValues[i] !== null) {\n        filters[attr] = rowValues[i];\n      }\n    }\n    return e =>\n      this.props.tableOptions.clickCallback(e, value, filters, pivotData);\n  }\n\n  clickHeaderHandler(\n    pivotData,\n    values,\n    attrs,\n    attrIdx,\n    callback,\n    isSubtotal = false,\n    isGrandTotal = false,\n  ) {\n    const filters = {};\n    for (let i = 0; i <= attrIdx; i += 1) {\n      const attr = attrs[i];\n      filters[attr] = values[i];\n    }\n    return e =>\n      callback(\n        e,\n        values[attrIdx],\n        filters,\n        pivotData,\n        isSubtotal,\n        isGrandTotal,\n      );\n  }\n\n  collapseAttr(rowOrCol, attrIdx, allKeys) {\n    return e => {\n      // Collapse an entire attribute.\n      e.stopPropagation();\n      const keyLen = attrIdx + 1;\n      const collapsed = allKeys.filter(k => k.length === keyLen).map(flatKey);\n\n      const updates = {};\n      collapsed.forEach(k => {\n        updates[k] = true;\n      });\n\n      if (rowOrCol) {\n        this.setState(state => ({\n          collapsedRows: { ...state.collapsedRows, ...updates },\n        }));\n      } else {\n        this.setState(state => ({\n          collapsedCols: { ...state.collapsedCols, ...updates },\n        }));\n      }\n    };\n  }\n\n  expandAttr(rowOrCol, attrIdx, allKeys) {\n    return e => {\n      // Expand an entire attribute. This implicitly implies expanding all of the\n      // parents as well. It's a bit inefficient but ah well...\n      e.stopPropagation();\n      const updates = {};\n      allKeys.forEach(k => {\n        for (let i = 0; i <= attrIdx; i += 1) {\n          updates[flatKey(k.slice(0, i + 1))] = false;\n        }\n      });\n\n      if (rowOrCol) {\n        this.setState(state => ({\n          collapsedRows: { ...state.collapsedRows, ...updates },\n        }));\n      } else {\n        this.setState(state => ({\n          collapsedCols: { ...state.collapsedCols, ...updates },\n        }));\n      }\n    };\n  }\n\n  toggleRowKey(flatRowKey) {\n    return e => {\n      e.stopPropagation();\n      this.setState(state => ({\n        collapsedRows: {\n          ...state.collapsedRows,\n          [flatRowKey]: !state.collapsedRows[flatRowKey],\n        },\n      }));\n    };\n  }\n\n  toggleColKey(flatColKey) {\n    return e => {\n      e.stopPropagation();\n      this.setState(state => ({\n        collapsedCols: {\n          ...state.collapsedCols,\n          [flatColKey]: !state.collapsedCols[flatColKey],\n        },\n      }));\n    };\n  }\n\n  calcAttrSpans(attrArr, numAttrs) {\n    // Given an array of attribute values (i.e. each element is another array with\n    // the value at every level), compute the spans for every attribute value at\n    // every level. The return value is a nested array of the same shape. It has\n    // -1's for repeated values and the span number otherwise.\n\n    const spans = [];\n    // Index of the last new value\n    const li = Array(numAttrs).map(() => 0);\n    let lv = Array(numAttrs).map(() => null);\n    for (let i = 0; i < attrArr.length; i += 1) {\n      // Keep increasing span values as long as the last keys are the same. For\n      // the rest, record spans of 1. Update the indices too.\n      const cv = attrArr[i];\n      const ent = [];\n      let depth = 0;\n      const limit = Math.min(lv.length, cv.length);\n      while (depth < limit && lv[depth] === cv[depth]) {\n        ent.push(-1);\n        spans[li[depth]][depth] += 1;\n        depth += 1;\n      }\n      while (depth < cv.length) {\n        li[depth] = i;\n        ent.push(1);\n        depth += 1;\n      }\n      spans.push(ent);\n      lv = cv;\n    }\n    return spans;\n  }\n\n  renderColHeaderRow(attrName, attrIdx, pivotSettings) {\n    // Render a single row in the column header at the top of the pivot table.\n\n    const {\n      rowAttrs,\n      colAttrs,\n      colKeys,\n      visibleColKeys,\n      colAttrSpans,\n      rowTotals,\n      arrowExpanded,\n      arrowCollapsed,\n      colSubtotalDisplay,\n      maxColVisible,\n      pivotData,\n      namesMapping,\n    } = pivotSettings;\n    const {\n      highlightHeaderCellsOnHover,\n      omittedHighlightHeaderGroups = [],\n      highlightedHeaderCells,\n      dateFormatters,\n    } = this.props.tableOptions;\n\n    const spaceCell =\n      attrIdx === 0 && rowAttrs.length !== 0 ? (\n        <th\n          key=\"padding\"\n          colSpan={rowAttrs.length}\n          rowSpan={colAttrs.length}\n          aria-hidden=\"true\"\n        />\n      ) : null;\n\n    const needToggle =\n      colSubtotalDisplay.enabled && attrIdx !== colAttrs.length - 1;\n    let arrowClickHandle = null;\n    let subArrow = null;\n    if (needToggle) {\n      arrowClickHandle =\n        attrIdx + 1 < maxColVisible\n          ? this.collapseAttr(false, attrIdx, colKeys)\n          : this.expandAttr(false, attrIdx, colKeys);\n      subArrow = attrIdx + 1 < maxColVisible ? arrowExpanded : arrowCollapsed;\n    }\n    const attrNameCell = (\n      <th key=\"label\" className=\"pvtAxisLabel\">\n        {displayHeaderCell(\n          needToggle,\n          subArrow,\n          arrowClickHandle,\n          attrName,\n          namesMapping,\n        )}\n      </th>\n    );\n\n    const attrValueCells = [];\n    const rowIncrSpan = rowAttrs.length !== 0 ? 1 : 0;\n    // Iterate through columns. Jump over duplicate values.\n    let i = 0;\n    while (i < visibleColKeys.length) {\n      let handleContextMenu;\n      const colKey = visibleColKeys[i];\n      const colSpan = attrIdx < colKey.length ? colAttrSpans[i][attrIdx] : 1;\n      let colLabelClass = 'pvtColLabel';\n      if (attrIdx < colKey.length) {\n        if (!omittedHighlightHeaderGroups.includes(colAttrs[attrIdx])) {\n          if (highlightHeaderCellsOnHover) {\n            colLabelClass += ' hoverable';\n          }\n          handleContextMenu = e =>\n            this.props.onContextMenu(e, colKey, undefined, {\n              [attrName]: colKey[attrIdx],\n            });\n        }\n        if (\n          highlightedHeaderCells &&\n          Array.isArray(highlightedHeaderCells[colAttrs[attrIdx]]) &&\n          highlightedHeaderCells[colAttrs[attrIdx]].includes(colKey[attrIdx])\n        ) {\n          colLabelClass += ' active';\n        }\n\n        const rowSpan = 1 + (attrIdx === colAttrs.length - 1 ? rowIncrSpan : 0);\n        const flatColKey = flatKey(colKey.slice(0, attrIdx + 1));\n        const onArrowClick = needToggle ? this.toggleColKey(flatColKey) : null;\n\n        const headerCellFormattedValue =\n          dateFormatters &&\n          dateFormatters[attrName] &&\n          typeof dateFormatters[attrName] === 'function'\n            ? dateFormatters[attrName](colKey[attrIdx])\n            : colKey[attrIdx];\n        attrValueCells.push(\n          <th\n            className={colLabelClass}\n            key={`colKey-${flatColKey}`}\n            colSpan={colSpan}\n            rowSpan={rowSpan}\n            role=\"columnheader button\"\n            onClick={this.clickHeaderHandler(\n              pivotData,\n              colKey,\n              this.props.cols,\n              attrIdx,\n              this.props.tableOptions.clickColumnHeaderCallback,\n            )}\n            onContextMenu={handleContextMenu}\n          >\n            {displayHeaderCell(\n              needToggle,\n              this.state.collapsedCols[flatColKey]\n                ? arrowCollapsed\n                : arrowExpanded,\n              onArrowClick,\n              headerCellFormattedValue,\n              namesMapping,\n            )}\n          </th>,\n        );\n      } else if (attrIdx === colKey.length) {\n        const rowSpan = colAttrs.length - colKey.length + rowIncrSpan;\n        attrValueCells.push(\n          <th\n            className={`${colLabelClass} pvtSubtotalLabel`}\n            key={`colKeyBuffer-${flatKey(colKey)}`}\n            colSpan={colSpan}\n            rowSpan={rowSpan}\n            role=\"columnheader button\"\n            onClick={this.clickHeaderHandler(\n              pivotData,\n              colKey,\n              this.props.cols,\n              attrIdx,\n              this.props.tableOptions.clickColumnHeaderCallback,\n              true,\n            )}\n          >\n            {t('Subtotal')}\n          </th>,\n        );\n      }\n      // The next colSpan columns will have the same value anyway...\n      i += colSpan;\n    }\n\n    const totalCell =\n      attrIdx === 0 && rowTotals ? (\n        <th\n          key=\"total\"\n          className=\"pvtTotalLabel\"\n          rowSpan={colAttrs.length + Math.min(rowAttrs.length, 1)}\n          role=\"columnheader button\"\n          onClick={this.clickHeaderHandler(\n            pivotData,\n            [],\n            this.props.cols,\n            attrIdx,\n            this.props.tableOptions.clickColumnHeaderCallback,\n            false,\n            true,\n          )}\n        >\n          {t('Total (%(aggregatorName)s)', {\n            aggregatorName: t(this.props.aggregatorName),\n          })}\n        </th>\n      ) : null;\n\n    const cells = [spaceCell, attrNameCell, ...attrValueCells, totalCell];\n    return <tr key={`colAttr-${attrIdx}`}>{cells}</tr>;\n  }\n\n  renderRowHeaderRow(pivotSettings) {\n    // Render just the attribute names of the rows (the actual attribute values\n    // will show up in the individual rows).\n\n    const {\n      rowAttrs,\n      colAttrs,\n      rowKeys,\n      arrowCollapsed,\n      arrowExpanded,\n      rowSubtotalDisplay,\n      maxRowVisible,\n      pivotData,\n      namesMapping,\n    } = pivotSettings;\n    return (\n      <tr key=\"rowHdr\">\n        {rowAttrs.map((r, i) => {\n          const needLabelToggle =\n            rowSubtotalDisplay.enabled && i !== rowAttrs.length - 1;\n          let arrowClickHandle = null;\n          let subArrow = null;\n          if (needLabelToggle) {\n            arrowClickHandle =\n              i + 1 < maxRowVisible\n                ? this.collapseAttr(true, i, rowKeys)\n                : this.expandAttr(true, i, rowKeys);\n            subArrow = i + 1 < maxRowVisible ? arrowExpanded : arrowCollapsed;\n          }\n          return (\n            <th className=\"pvtAxisLabel\" key={`rowAttr-${i}`}>\n              {displayHeaderCell(\n                needLabelToggle,\n                subArrow,\n                arrowClickHandle,\n                r,\n                namesMapping,\n              )}\n            </th>\n          );\n        })}\n        <th\n          className=\"pvtTotalLabel\"\n          key=\"padding\"\n          role=\"columnheader button\"\n          onClick={this.clickHeaderHandler(\n            pivotData,\n            [],\n            this.props.rows,\n            0,\n            this.props.tableOptions.clickRowHeaderCallback,\n            false,\n            true,\n          )}\n        >\n          {colAttrs.length === 0\n            ? t('Total (%(aggregatorName)s)', {\n                aggregatorName: t(this.props.aggregatorName),\n              })\n            : null}\n        </th>\n      </tr>\n    );\n  }\n\n  renderTableRow(rowKey, rowIdx, pivotSettings) {\n    // Render a single row in the pivot table.\n\n    const {\n      rowAttrs,\n      colAttrs,\n      rowAttrSpans,\n      visibleColKeys,\n      pivotData,\n      rowTotals,\n      rowSubtotalDisplay,\n      arrowExpanded,\n      arrowCollapsed,\n      cellCallbacks,\n      rowTotalCallbacks,\n      namesMapping,\n    } = pivotSettings;\n\n    const {\n      highlightHeaderCellsOnHover,\n      omittedHighlightHeaderGroups = [],\n      highlightedHeaderCells,\n      cellColorFormatters,\n      dateFormatters,\n    } = this.props.tableOptions;\n    const flatRowKey = flatKey(rowKey);\n\n    const colIncrSpan = colAttrs.length !== 0 ? 1 : 0;\n    const attrValueCells = rowKey.map((r, i) => {\n      let handleContextMenu;\n      let valueCellClassName = 'pvtRowLabel';\n      if (!omittedHighlightHeaderGroups.includes(rowAttrs[i])) {\n        if (highlightHeaderCellsOnHover) {\n          valueCellClassName += ' hoverable';\n        }\n        handleContextMenu = e =>\n          this.props.onContextMenu(e, undefined, rowKey, {\n            [rowAttrs[i]]: r,\n          });\n      }\n      if (\n        highlightedHeaderCells &&\n        Array.isArray(highlightedHeaderCells[rowAttrs[i]]) &&\n        highlightedHeaderCells[rowAttrs[i]].includes(r)\n      ) {\n        valueCellClassName += ' active';\n      }\n      const rowSpan = rowAttrSpans[rowIdx][i];\n      if (rowSpan > 0) {\n        const flatRowKey = flatKey(rowKey.slice(0, i + 1));\n        const colSpan = 1 + (i === rowAttrs.length - 1 ? colIncrSpan : 0);\n        const needRowToggle =\n          rowSubtotalDisplay.enabled && i !== rowAttrs.length - 1;\n        const onArrowClick = needRowToggle\n          ? this.toggleRowKey(flatRowKey)\n          : null;\n\n        const headerCellFormattedValue =\n          dateFormatters && dateFormatters[rowAttrs[i]]\n            ? dateFormatters[rowAttrs[i]](r)\n            : r;\n        return (\n          <th\n            key={`rowKeyLabel-${i}`}\n            className={valueCellClassName}\n            rowSpan={rowSpan}\n            colSpan={colSpan}\n            role=\"columnheader button\"\n            onClick={this.clickHeaderHandler(\n              pivotData,\n              rowKey,\n              this.props.rows,\n              i,\n              this.props.tableOptions.clickRowHeaderCallback,\n            )}\n            onContextMenu={handleContextMenu}\n          >\n            {displayHeaderCell(\n              needRowToggle,\n              this.state.collapsedRows[flatRowKey]\n                ? arrowCollapsed\n                : arrowExpanded,\n              onArrowClick,\n              headerCellFormattedValue,\n              namesMapping,\n            )}\n          </th>\n        );\n      }\n      return null;\n    });\n\n    const attrValuePaddingCell =\n      rowKey.length < rowAttrs.length ? (\n        <th\n          className=\"pvtRowLabel pvtSubtotalLabel\"\n          key=\"rowKeyBuffer\"\n          colSpan={rowAttrs.length - rowKey.length + colIncrSpan}\n          rowSpan={1}\n          role=\"columnheader button\"\n          onClick={this.clickHeaderHandler(\n            pivotData,\n            rowKey,\n            this.props.rows,\n            rowKey.length,\n            this.props.tableOptions.clickRowHeaderCallback,\n            true,\n          )}\n        >\n          {t('Subtotal')}\n        </th>\n      ) : null;\n\n    const rowClickHandlers = cellCallbacks[flatRowKey] || {};\n    const valueCells = visibleColKeys.map(colKey => {\n      const flatColKey = flatKey(colKey);\n      const agg = pivotData.getAggregator(rowKey, colKey);\n      const aggValue = agg.value();\n\n      const keys = [...rowKey, ...colKey];\n      let backgroundColor;\n      if (cellColorFormatters) {\n        Object.values(cellColorFormatters).forEach(cellColorFormatter => {\n          if (Array.isArray(cellColorFormatter)) {\n            keys.forEach(key => {\n              if (backgroundColor) {\n                return;\n              }\n              cellColorFormatter\n                .filter(formatter => formatter.column === key)\n                .forEach(formatter => {\n                  const formatterResult = formatter.getColorFromValue(aggValue);\n                  if (formatterResult) {\n                    backgroundColor = formatterResult;\n                  }\n                });\n            });\n          }\n        });\n      }\n\n      const style = agg.isSubtotal\n        ? { fontWeight: 'bold' }\n        : { backgroundColor };\n\n      return (\n        <td\n          role=\"gridcell\"\n          className=\"pvtVal\"\n          key={`pvtVal-${flatColKey}`}\n          onClick={rowClickHandlers[flatColKey]}\n          onContextMenu={e => this.props.onContextMenu(e, colKey, rowKey)}\n          style={style}\n        >\n          {agg.format(aggValue)}\n        </td>\n      );\n    });\n\n    let totalCell = null;\n    if (rowTotals) {\n      const agg = pivotData.getAggregator(rowKey, []);\n      const aggValue = agg.value();\n      totalCell = (\n        <td\n          role=\"gridcell\"\n          key=\"total\"\n          className=\"pvtTotal\"\n          onClick={rowTotalCallbacks[flatRowKey]}\n          onContextMenu={e => this.props.onContextMenu(e, undefined, rowKey)}\n        >\n          {agg.format(aggValue)}\n        </td>\n      );\n    }\n\n    const rowCells = [\n      ...attrValueCells,\n      attrValuePaddingCell,\n      ...valueCells,\n      totalCell,\n    ];\n\n    return <tr key={`keyRow-${flatRowKey}`}>{rowCells}</tr>;\n  }\n\n  renderTotalsRow(pivotSettings) {\n    // Render the final totals rows that has the totals for all the columns.\n\n    const {\n      rowAttrs,\n      colAttrs,\n      visibleColKeys,\n      rowTotals,\n      pivotData,\n      colTotalCallbacks,\n      grandTotalCallback,\n    } = pivotSettings;\n\n    const totalLabelCell = (\n      <th\n        key=\"label\"\n        className=\"pvtTotalLabel pvtRowTotalLabel\"\n        colSpan={rowAttrs.length + Math.min(colAttrs.length, 1)}\n        role=\"columnheader button\"\n        onClick={this.clickHeaderHandler(\n          pivotData,\n          [],\n          this.props.rows,\n          0,\n          this.props.tableOptions.clickRowHeaderCallback,\n          false,\n          true,\n        )}\n      >\n        {t('Total (%(aggregatorName)s)', {\n          aggregatorName: t(this.props.aggregatorName),\n        })}\n      </th>\n    );\n\n    const totalValueCells = visibleColKeys.map(colKey => {\n      const flatColKey = flatKey(colKey);\n      const agg = pivotData.getAggregator([], colKey);\n      const aggValue = agg.value();\n\n      return (\n        <td\n          role=\"gridcell\"\n          className=\"pvtTotal pvtRowTotal\"\n          key={`total-${flatColKey}`}\n          onClick={colTotalCallbacks[flatColKey]}\n          onContextMenu={e => this.props.onContextMenu(e, colKey, undefined)}\n          style={{ padding: '5px' }}\n        >\n          {agg.format(aggValue)}\n        </td>\n      );\n    });\n\n    let grandTotalCell = null;\n    if (rowTotals) {\n      const agg = pivotData.getAggregator([], []);\n      const aggValue = agg.value();\n      grandTotalCell = (\n        <td\n          role=\"gridcell\"\n          key=\"total\"\n          className=\"pvtGrandTotal pvtRowTotal\"\n          onClick={grandTotalCallback}\n          onContextMenu={e => this.props.onContextMenu(e, undefined, undefined)}\n        >\n          {agg.format(aggValue)}\n        </td>\n      );\n    }\n\n    const totalCells = [totalLabelCell, ...totalValueCells, grandTotalCell];\n\n    return (\n      <tr key=\"total\" className=\"pvtRowTotals\">\n        {totalCells}\n      </tr>\n    );\n  }\n\n  visibleKeys(keys, collapsed, numAttrs, subtotalDisplay) {\n    return keys.filter(\n      key =>\n        // Is the key hidden by one of its parents?\n        !key.some((k, j) => collapsed[flatKey(key.slice(0, j))]) &&\n        // Leaf key.\n        (key.length === numAttrs ||\n          // Children hidden. Must show total.\n          flatKey(key) in collapsed ||\n          // Don't hide totals.\n          !subtotalDisplay.hideOnExpand),\n    );\n  }\n\n  isDashboardEditMode() {\n    return document.contains(document.querySelector('.dashboard--editing'));\n  }\n\n  render() {\n    if (this.cachedProps !== this.props) {\n      this.cachedProps = this.props;\n      this.cachedBasePivotSettings = this.getBasePivotSettings();\n    }\n    const {\n      colAttrs,\n      rowAttrs,\n      rowKeys,\n      colKeys,\n      colTotals,\n      rowSubtotalDisplay,\n      colSubtotalDisplay,\n    } = this.cachedBasePivotSettings;\n\n    // Need to account for exclusions to compute the effective row\n    // and column keys.\n    const visibleRowKeys = this.visibleKeys(\n      rowKeys,\n      this.state.collapsedRows,\n      rowAttrs.length,\n      rowSubtotalDisplay,\n    );\n    const visibleColKeys = this.visibleKeys(\n      colKeys,\n      this.state.collapsedCols,\n      colAttrs.length,\n      colSubtotalDisplay,\n    );\n\n    const pivotSettings = {\n      visibleRowKeys,\n      maxRowVisible: Math.max(...visibleRowKeys.map(k => k.length)),\n      visibleColKeys,\n      maxColVisible: Math.max(...visibleColKeys.map(k => k.length)),\n      rowAttrSpans: this.calcAttrSpans(visibleRowKeys, rowAttrs.length),\n      colAttrSpans: this.calcAttrSpans(visibleColKeys, colAttrs.length),\n      ...this.cachedBasePivotSettings,\n    };\n\n    return (\n      <Styles isDashboardEditMode={this.isDashboardEditMode()}>\n        <table className=\"pvtTable\" role=\"grid\">\n          <thead>\n            {colAttrs.map((c, j) =>\n              this.renderColHeaderRow(c, j, pivotSettings),\n            )}\n            {rowAttrs.length !== 0 && this.renderRowHeaderRow(pivotSettings)}\n          </thead>\n          <tbody>\n            {visibleRowKeys.map((r, i) =>\n              this.renderTableRow(r, i, pivotSettings),\n            )}\n            {colTotals && this.renderTotalsRow(pivotSettings)}\n          </tbody>\n        </table>\n      </Styles>\n    );\n  }\n}\n\nTableRenderer.propTypes = {\n  ...PivotData.propTypes,\n  tableOptions: PropTypes.object,\n  onContextMenu: PropTypes.func,\n};\nTableRenderer.defaultProps = { ...PivotData.defaultProps, tableOptions: {} };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}