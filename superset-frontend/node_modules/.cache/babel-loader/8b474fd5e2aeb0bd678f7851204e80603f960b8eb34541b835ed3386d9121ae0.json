{"ast":null,"code":"import _isEmpty from \"lodash/isEmpty\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;};\nimport { CategoricalColorNamespace, NumberFormats, getColumnLabel, getNumberFormatter, tooltipHtml } from '@superset-ui/core';\nimport { LegendOrientation, LegendType } from '../types';\nimport { defaultGrid, defaultYAxis } from '../defaults';\nimport { getLegendProps } from '../utils/series';\nimport { getDefaultTooltip } from '../utils/tooltip';\nimport { getPercentFormatter } from '../utils/formatters';\nexport default function transformProps(chartProps) {\n  const refs = {};\n  let focusedSeries;\n  const { formData, height, hooks, legendState = {}, queriesData, theme, width } = chartProps;\n  const { onLegendStateChanged } = hooks;\n  const { colorScheme, column, groupby = [], normalize, showLegend, showValue, sliceId, xAxisTitle, yAxisTitle } = formData;\n  const { data } = queriesData[0];\n  const colorFn = CategoricalColorNamespace.getScale(colorScheme);\n  const formatter = getNumberFormatter(normalize ? NumberFormats.FLOAT_2_POINT : NumberFormats.INTEGER);\n  const percentFormatter = getPercentFormatter(NumberFormats.PERCENT_2_POINT);\n  const groupbySet = new Set(groupby);\n  const xAxisData = Object.keys(data[0]).filter((key) => !groupbySet.has(key));\n  const barSeries = data.map((datum) => {\n    const seriesName = groupby.length > 0 ?\n    groupby.map((key) => datum[getColumnLabel(key)]).join(', ') :\n    getColumnLabel(column);\n    const seriesData = Object.keys(datum).\n    filter((key) => groupbySet.has(key) === false).\n    map((key) => datum[key]);\n    return {\n      name: seriesName,\n      type: 'bar',\n      data: seriesData,\n      itemStyle: {\n        color: colorFn(seriesName, sliceId)\n      },\n      label: {\n        show: showValue,\n        position: 'top',\n        formatter: (params) => {\n          const { value } = params;\n          return formatter.format(value);\n        }\n      }\n    };\n  });\n  const legendOptions = barSeries.map((series) => series.name);\n  if (_isEmpty(legendState)) {\n    legendOptions.forEach((legend) => {\n      legendState[legend] = true;\n    });\n  }\n  const tooltipFormatter = (params) => {\n    const title = params[0].name;\n    const rows = params.map((param) => {\n      const { marker, seriesName, value } = param;\n      return [`${marker}${seriesName}`, formatter.format(value)];\n    });\n    if (groupby.length > 0) {\n      const total = params.reduce((acc, param) => acc + param.value, 0);\n      if (!normalize) {\n        rows.forEach((row, i) => row.push(percentFormatter.format(params[i].value / (total || 1))));\n      }\n      const totalRow = ['Total', formatter.format(total)];\n      if (!normalize) {\n        totalRow.push(percentFormatter.format(1));\n      }\n      rows.push(totalRow);\n    }\n    return tooltipHtml(rows, title, focusedSeries);\n  };\n  const onFocusedSeries = (index) => {\n    focusedSeries = index;\n  };\n  const echartOptions = {\n    grid: {\n      ...defaultGrid,\n      left: '5%',\n      right: '5%',\n      top: '10%',\n      bottom: '10%'\n    },\n    xAxis: {\n      data: xAxisData,\n      name: xAxisTitle,\n      nameGap: 35,\n      type: 'category',\n      nameLocation: 'middle'\n    },\n    yAxis: {\n      ...defaultYAxis,\n      name: yAxisTitle,\n      nameGap: normalize ? 55 : 40,\n      type: 'value',\n      nameLocation: 'middle',\n      axisLabel: {\n        formatter: (value) => formatter.format(value)\n      }\n    },\n    series: barSeries,\n    legend: {\n      ...getLegendProps(LegendType.Scroll, LegendOrientation.Top, showLegend, theme, false, legendState),\n      data: legendOptions\n    },\n    tooltip: {\n      ...getDefaultTooltip(refs),\n      trigger: 'axis',\n      formatter: tooltipFormatter\n    }\n  };\n  return {\n    refs,\n    formData,\n    width,\n    height,\n    echartOptions,\n    onFocusedSeries,\n    onLegendStateChanged\n  };\n};(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(transformProps, \"transformProps\", \"/app/superset-frontend/plugins/plugin-chart-echarts/src/Histogram/transformProps.ts\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["CategoricalColorNamespace","NumberFormats","getColumnLabel","getNumberFormatter","tooltipHtml","LegendOrientation","LegendType","defaultGrid","defaultYAxis","getLegendProps","getDefaultTooltip","getPercentFormatter","transformProps","chartProps","refs","focusedSeries","formData","height","hooks","legendState","queriesData","theme","width","onLegendStateChanged","colorScheme","column","groupby","normalize","showLegend","showValue","sliceId","xAxisTitle","yAxisTitle","data","colorFn","getScale","formatter","FLOAT_2_POINT","INTEGER","percentFormatter","PERCENT_2_POINT","groupbySet","Set","xAxisData","Object","keys","filter","key","has","barSeries","map","datum","seriesName","length","join","seriesData","name","type","itemStyle","color","label","show","position","params","value","format","legendOptions","series","_isEmpty","forEach","legend","tooltipFormatter","title","rows","param","marker","total","reduce","acc","row","i","push","totalRow","onFocusedSeries","index","echartOptions","grid","left","right","top","bottom","xAxis","nameGap","nameLocation","yAxis","axisLabel","Scroll","Top","tooltip","trigger","reactHotLoader","reactHotLoaderGlobal","default","undefined","register","leaveModule","module"],"sources":["/app/superset-frontend/plugins/plugin-chart-echarts/src/Histogram/transformProps.ts"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { BarSeriesOption, EChartsOption } from 'echarts';\nimport { CallbackDataParams } from 'echarts/types/src/util/types';\nimport { isEmpty } from 'lodash';\nimport {\n  CategoricalColorNamespace,\n  NumberFormats,\n  getColumnLabel,\n  getNumberFormatter,\n  tooltipHtml,\n} from '@superset-ui/core';\nimport { HistogramChartProps, HistogramTransformedProps } from './types';\nimport { LegendOrientation, LegendType, Refs } from '../types';\nimport { defaultGrid, defaultYAxis } from '../defaults';\nimport { getLegendProps } from '../utils/series';\nimport { getDefaultTooltip } from '../utils/tooltip';\nimport { getPercentFormatter } from '../utils/formatters';\n\nexport default function transformProps(\n  chartProps: HistogramChartProps,\n): HistogramTransformedProps {\n  const refs: Refs = {};\n  let focusedSeries: number | undefined;\n  const {\n    formData,\n    height,\n    hooks,\n    legendState = {},\n    queriesData,\n    theme,\n    width,\n  } = chartProps;\n  const { onLegendStateChanged } = hooks;\n  const {\n    colorScheme,\n    column,\n    groupby = [],\n    normalize,\n    showLegend,\n    showValue,\n    sliceId,\n    xAxisTitle,\n    yAxisTitle,\n  } = formData;\n  const { data } = queriesData[0];\n  const colorFn = CategoricalColorNamespace.getScale(colorScheme);\n  const formatter = getNumberFormatter(\n    normalize ? NumberFormats.FLOAT_2_POINT : NumberFormats.INTEGER,\n  );\n  const percentFormatter = getPercentFormatter(NumberFormats.PERCENT_2_POINT);\n  const groupbySet = new Set(groupby);\n  const xAxisData: string[] = Object.keys(data[0]).filter(\n    key => !groupbySet.has(key),\n  );\n  const barSeries: BarSeriesOption[] = data.map(datum => {\n    const seriesName =\n      groupby.length > 0\n        ? groupby.map(key => datum[getColumnLabel(key)]).join(', ')\n        : getColumnLabel(column);\n    const seriesData = Object.keys(datum)\n      .filter(key => groupbySet.has(key) === false)\n      .map(key => datum[key] as number);\n    return {\n      name: seriesName,\n      type: 'bar',\n      data: seriesData,\n      itemStyle: {\n        color: colorFn(seriesName, sliceId),\n      },\n      label: {\n        show: showValue,\n        position: 'top',\n        formatter: params => {\n          const { value } = params;\n          return formatter.format(value as number);\n        },\n      },\n    };\n  });\n\n  const legendOptions = barSeries.map(series => series.name as string);\n  if (isEmpty(legendState)) {\n    legendOptions.forEach(legend => {\n      legendState[legend] = true;\n    });\n  }\n\n  const tooltipFormatter = (params: CallbackDataParams[]) => {\n    const title = params[0].name;\n    const rows = params.map(param => {\n      const { marker, seriesName, value } = param;\n      return [`${marker}${seriesName}`, formatter.format(value as number)];\n    });\n    if (groupby.length > 0) {\n      const total = params.reduce(\n        (acc, param) => acc + (param.value as number),\n        0,\n      );\n      if (!normalize) {\n        rows.forEach((row, i) =>\n          row.push(\n            percentFormatter.format((params[i].value as number) / (total || 1)),\n          ),\n        );\n      }\n      const totalRow = ['Total', formatter.format(total)];\n      if (!normalize) {\n        totalRow.push(percentFormatter.format(1));\n      }\n      rows.push(totalRow);\n    }\n    return tooltipHtml(rows, title, focusedSeries);\n  };\n\n  const onFocusedSeries = (index?: number | undefined) => {\n    focusedSeries = index;\n  };\n\n  const echartOptions: EChartsOption = {\n    grid: {\n      ...defaultGrid,\n      left: '5%',\n      right: '5%',\n      top: '10%',\n      bottom: '10%',\n    },\n    xAxis: {\n      data: xAxisData,\n      name: xAxisTitle,\n      nameGap: 35,\n      type: 'category',\n      nameLocation: 'middle',\n    },\n    yAxis: {\n      ...defaultYAxis,\n      name: yAxisTitle,\n      nameGap: normalize ? 55 : 40,\n      type: 'value',\n      nameLocation: 'middle',\n      axisLabel: {\n        formatter: (value: number) => formatter.format(value),\n      },\n    },\n    series: barSeries,\n    legend: {\n      ...getLegendProps(\n        LegendType.Scroll,\n        LegendOrientation.Top,\n        showLegend,\n        theme,\n        false,\n        legendState,\n      ),\n      data: legendOptions,\n    },\n    tooltip: {\n      ...getDefaultTooltip(refs),\n      trigger: 'axis',\n      formatter: tooltipFormatter,\n    },\n  };\n\n  return {\n    refs,\n    formData,\n    width,\n    height,\n    echartOptions,\n    onFocusedSeries,\n    onLegendStateChanged,\n  };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}