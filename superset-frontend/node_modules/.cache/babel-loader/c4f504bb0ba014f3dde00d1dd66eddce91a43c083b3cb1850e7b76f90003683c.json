{"ast":null,"code":"import { css as _css } from \"@emotion/react\";import _pick from \"lodash/pick\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useCallback, useEffect, useState, memo } from 'react';\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\nimport { useHistory } from 'react-router-dom';\n\nimport ButtonGroup from 'src/components/ButtonGroup';\nimport Alert from 'src/components/Alert';\nimport Button from 'src/components/Button';\nimport { nanoid } from 'nanoid';\nimport { QueryState, styled, t, tn, useTheme, usePrevious, css, getNumberFormatter, getExtensionsRegistry } from '@superset-ui/core';\nimport ErrorMessageWithStackTrace from 'src/components/ErrorMessage/ErrorMessageWithStackTrace';\nimport { SaveDatasetModal } from 'src/SqlLab/components/SaveDatasetModal';\nimport { EXPLORE_CHART_DEFAULT } from 'src/SqlLab/types';\nimport { mountExploreUrl } from 'src/explore/exploreUtils';\nimport { postFormData } from 'src/explore/exploreUtils/formData';\nimport ProgressBar from 'src/components/ProgressBar';\nimport Loading from 'src/components/Loading';\nimport Card from 'src/components/Card';\nimport Label from 'src/components/Label';\nimport { Tooltip } from 'src/components/Tooltip';\nimport FilterableTable from 'src/components/FilterableTable';\nimport CopyToClipboard from 'src/components/CopyToClipboard';\nimport { addDangerToast } from 'src/components/MessageToasts/actions';\nimport { prepareCopyToClipboardTabularData } from 'src/utils/common';\nimport { getItem, LocalStorageKeys } from 'src/utils/localStorageHelpers';\nimport { addQueryEditor, clearQueryResults, CtasEnum, fetchQueryResults, reFetchQueryResults, reRunQuery } from 'src/SqlLab/actions/sqlLab';\nimport { URL_PARAMS } from 'src/constants';\nimport useLogAction from 'src/logger/useLogAction';\nimport { LOG_ACTIONS_SQLLAB_COPY_RESULT_TO_CLIPBOARD, LOG_ACTIONS_SQLLAB_CREATE_CHART, LOG_ACTIONS_SQLLAB_DOWNLOAD_CSV } from 'src/logger/LogUtils';\nimport Icons from 'src/components/Icons';\nimport { findPermission } from 'src/utils/findPermission';\nimport ExploreCtasResultsButton from '../ExploreCtasResultsButton';\nimport ExploreResultsButton from '../ExploreResultsButton';\nimport HighlightedSql from '../HighlightedSql';\nimport QueryStateLabel from '../QueryStateLabel';import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"@emotion/react/jsx-runtime\";\nvar LimitingFactor;\n(function (LimitingFactor) {\n  LimitingFactor[\"Query\"] = \"QUERY\";\n  LimitingFactor[\"QueryAndDropdown\"] = \"QUERY_AND_DROPDOWN\";\n  LimitingFactor[\"Dropdown\"] = \"DROPDOWN\";\n  LimitingFactor[\"NotLimited\"] = \"NOT_LIMITED\";\n})(LimitingFactor || (LimitingFactor = {}));\nconst ResultContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  row-gap: ${({ theme }) => theme.gridUnit * 2}px;\n`;\nconst ResultlessStyles = styled.div`\n  position: relative;\n  min-height: ${({ theme }) => theme.gridUnit * 25}px;\n  [role='alert'] {\n    margin-top: ${({ theme }) => theme.gridUnit * 2}px;\n  }\n  .sql-result-track-job {\n    margin-top: ${({ theme }) => theme.gridUnit * 2}px;\n  }\n`;\n// Making text render line breaks/tabs as is as monospace,\n// but wrapping text too so text doesn't overflow\nconst MonospaceDiv = styled.div`\n  font-family: ${({ theme }) => theme.typography.families.monospace};\n  white-space: pre;\n  word-break: break-word;\n  overflow-x: auto;\n  white-space: pre-wrap;\n`;\nconst ReturnedRows = styled.div`\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  line-height: 1;\n`;\nconst ResultSetControls = styled.div`\n  display: flex;\n  justify-content: space-between;\n`;\nconst ResultSetButtons = styled.div`\n  display: grid;\n  grid-auto-flow: column;\n  padding-right: ${({ theme }) => 2 * theme.gridUnit}px;\n`;\nconst ROWS_CHIP_WIDTH = 100;\nconst GAP = 8;\nconst extensionsRegistry = getExtensionsRegistry();\nconst ResultSet = ({ cache = false, csv = true, database = {}, displayLimit, height, queryId, search = true, showSql = false, showSqlInline = false, visualize = true, defaultQueryLimit }) => {var _extensionsRegistry$g, _query$results2, _query$extra$progress, _query$extra2;\n  const user = useSelector(({ user }) => user, shallowEqual);\n  const query = useSelector(({ sqlLab: { queries } }) => _pick(queries[queryId], [\n  'id',\n  'errorMessage',\n  'cached',\n  'results',\n  'resultsKey',\n  'dbId',\n  'tab',\n  'sql',\n  'sqlEditorId',\n  'templateParams',\n  'schema',\n  'rows',\n  'queryLimit',\n  'limitingFactor',\n  'trackingUrl',\n  'state',\n  'errors',\n  'link',\n  'ctas',\n  'ctas_method',\n  'tempSchema',\n  'tempTable',\n  'isDataPreview',\n  'progress',\n  'extra']\n  ), shallowEqual);\n  const ResultTable = (_extensionsRegistry$g = extensionsRegistry.get('sqleditor.extension.resultTable')) != null ? _extensionsRegistry$g :\n  FilterableTable;\n  const theme = useTheme();\n  const [searchText, setSearchText] = useState('');\n  const [cachedData, setCachedData] = useState([]);\n  const [showSaveDatasetModal, setShowSaveDatasetModal] = useState(false);\n  const [alertIsOpen, setAlertIsOpen] = useState(false);\n  const history = useHistory();\n  const dispatch = useDispatch();\n  const logAction = useLogAction({ queryId, sqlEditorId: query.sqlEditorId });\n  const reRunQueryIfSessionTimeoutErrorOnMount = useCallback(() => {\n    if (query.errorMessage &&\n    query.errorMessage.indexOf('session timed out') > 0) {\n      dispatch(reRunQuery(query));\n    }\n  }, []);\n  useEffect(() => {\n    // only do this the first time the component is rendered/mounted\n    reRunQueryIfSessionTimeoutErrorOnMount();\n  }, [reRunQueryIfSessionTimeoutErrorOnMount]);\n  const fetchResults = (q) => {\n    dispatch(fetchQueryResults(q, displayLimit));\n  };\n  const prevQuery = usePrevious(query);\n  useEffect(() => {var _query$results, _query$results$data;\n    if (cache && query.cached && (query == null ? void 0 : (_query$results = query.results) == null ? void 0 : (_query$results$data = _query$results.data) == null ? void 0 : _query$results$data.length) > 0) {\n      setCachedData(query.results.data);\n      dispatch(clearQueryResults(query));\n    }\n    if (query.resultsKey && query.resultsKey !== (prevQuery == null ? void 0 : prevQuery.resultsKey)) {\n      fetchResults(query);\n    }\n  }, [query, cache]);\n  const calculateAlertRefHeight = (alertElement) => {\n    if (alertElement) {\n      setAlertIsOpen(true);\n    } else\n    {\n      setAlertIsOpen(false);\n    }\n  };\n  const popSelectStar = (tempSchema, tempTable) => {\n    const qe = {\n      id: nanoid(11),\n      name: tempTable,\n      autorun: false,\n      dbId: query.dbId,\n      sql: `SELECT * FROM ${tempSchema ? `${tempSchema}.` : ''}${tempTable}`\n    };\n    dispatch(addQueryEditor(qe));\n  };\n  const changeSearch = (event) => {\n    setSearchText(event.target.value);\n  };\n  const createExploreResultsOnClick = async (clickEvent) => {\n    const { results } = query;\n    const openInNewWindow = clickEvent.metaKey;\n    logAction(LOG_ACTIONS_SQLLAB_CREATE_CHART, {});\n    if (results != null && results.query_id) {\n      const key = await postFormData(results.query_id, 'query', {\n        ...EXPLORE_CHART_DEFAULT,\n        datasource: `${results.query_id}__query`,\n        ...{\n          all_columns: results.columns.map((column) => column.column_name)\n        }\n      });\n      const url = mountExploreUrl(null, {\n        [URL_PARAMS.formDataKey.name]: key\n      });\n      if (openInNewWindow) {\n        window.open(url, '_blank', 'noreferrer');\n      } else\n      {\n        history.push(url);\n      }\n    } else\n    {\n      addDangerToast(t('Unable to create chart without a query id.'));\n    }\n  };\n  const getExportCsvUrl = (clientId) => `/api/v1/sqllab/export/${clientId}/`;\n  const renderControls = () => {\n    if (search || visualize || csv) {\n      let { data } = query.results;\n      if (cache && query.cached) {\n        data = cachedData;\n      }\n      const { columns } = query.results;\n      // Added compute logic to stop user from being able to Save & Explore\n      const datasource = {\n        columns: query.results.columns,\n        name: (query == null ? void 0 : query.tab) || 'Untitled',\n        dbId: query == null ? void 0 : query.dbId,\n        sql: query == null ? void 0 : query.sql,\n        templateParams: query == null ? void 0 : query.templateParams,\n        schema: query == null ? void 0 : query.schema\n      };\n      const canExportData = findPermission('can_export_csv', 'SQLLab', user == null ? void 0 : user.roles);\n      return _jsxs(ResultSetControls, { children: [\n        _jsx(SaveDatasetModal, { visible: showSaveDatasetModal, onHide: () => setShowSaveDatasetModal(false), buttonTextOnSave: t('Save & Explore'), buttonTextOnOverwrite: t('Overwrite & Explore'), modalDescription: t('Save this query as a virtual dataset to continue exploring'), datasource: datasource }),\n        _jsxs(ResultSetButtons, { children: [\n          visualize && (database == null ? void 0 : database.allows_virtual_table_explore) && _jsx(ExploreResultsButton, { database: database, onClick: createExploreResultsOnClick }),\n          csv && canExportData && _jsxs(Button, { buttonSize: \"small\", href: getExportCsvUrl(query.id), \"data-test\": \"export-csv-button\", onClick: () => logAction(LOG_ACTIONS_SQLLAB_DOWNLOAD_CSV, {}), children: [\n            _jsx(\"i\", { className: \"fa fa-file-text-o\" }), \" \", t('Download to CSV')] }\n          ),\n\n          canExportData && _jsx(CopyToClipboard, { text: prepareCopyToClipboardTabularData(data, columns), wrapped: false, copyNode: _jsxs(Button, { buttonSize: \"small\", \"data-test\": \"copy-to-clipboard-button\", children: [\n              _jsx(\"i\", { className: \"fa fa-clipboard\" }), \" \", t('Copy to Clipboard')] }\n            ), hideTooltip: true, onCopyEnd: () => logAction(LOG_ACTIONS_SQLLAB_COPY_RESULT_TO_CLIPBOARD, {}) })] }\n        ),\n        search && _jsx(\"input\", { type: \"text\", onChange: changeSearch, value: searchText, className: \"form-control input-sm\", placeholder: t('Filter results') })] }\n      );\n    }\n    return _jsx(\"div\", {});\n  };\n  const renderRowsReturned = (alertMessage) => {var _user$roles, _results$data;\n    const { results, rows, queryLimit, limitingFactor } = query;\n    let limitMessage = '';\n    const limitReached = results == null ? void 0 : results.displayLimitReached;\n    const limit = queryLimit || results.query.limit;\n    const isAdmin = !!(user != null && (_user$roles = user.roles) != null && _user$roles.Admin);\n    const rowsCount = Math.min(rows || 0, (results == null ? void 0 : (_results$data = results.data) == null ? void 0 : _results$data.length) || 0);\n    const displayMaxRowsReachedMessage = {\n      withAdmin: t('The number of results displayed is limited to %(rows)d by the configuration DISPLAY_MAX_ROW. ' +\n      'Please add additional limits/filters or download to csv to see more rows up to ' +\n      'the %(limit)d limit.', { rows: rowsCount, limit }),\n      withoutAdmin: t('The number of results displayed is limited to %(rows)d. ' +\n      'Please add additional limits/filters, download to csv, or contact an admin ' +\n      'to see more rows up to the %(limit)d limit.', { rows: rowsCount, limit })\n    };\n    const shouldUseDefaultDropdownAlert = limit === defaultQueryLimit && limitingFactor === LimitingFactor.Dropdown;\n    if (limitingFactor === LimitingFactor.Query && csv) {\n      limitMessage = t('The number of rows displayed is limited to %(rows)d by the query', { rows });\n    } else\n    if (limitingFactor === LimitingFactor.Dropdown &&\n    !shouldUseDefaultDropdownAlert) {\n      limitMessage = t('The number of rows displayed is limited to %(rows)d by the limit dropdown.', { rows });\n    } else\n    if (limitingFactor === LimitingFactor.QueryAndDropdown) {\n      limitMessage = t('The number of rows displayed is limited to %(rows)d by the query and limit dropdown.', { rows });\n    }\n    const formattedRowCount = getNumberFormatter()(rows);\n    const rowsReturnedMessage = t('%(rows)d rows returned', {\n      rows\n    });\n    const tooltipText = `${rowsReturnedMessage}. ${limitMessage}`;\n    if (alertMessage) {\n      return _jsxs(_Fragment, { children: [\n        !limitReached && shouldUseDefaultDropdownAlert && _jsx(\"div\", { ref: calculateAlertRefHeight, children:\n          _jsx(Alert, { type: \"warning\", message: t('%(rows)d rows returned', { rows }), onClose: () => setAlertIsOpen(false), description: t('The number of rows displayed is limited to %(rows)d by the dropdown.', { rows }) }) }\n        ),\n        limitReached && _jsx(\"div\", { ref: calculateAlertRefHeight, children:\n          _jsx(Alert, { type: \"warning\", onClose: () => setAlertIsOpen(false), message: t('%(rows)d rows returned', { rows: rowsCount }), description: isAdmin ?\n            displayMaxRowsReachedMessage.withAdmin :\n            displayMaxRowsReachedMessage.withoutAdmin }) }\n        )] }\n      );\n    }\n    const showRowsReturned = showSqlInline || !limitReached && !shouldUseDefaultDropdownAlert;\n    return _jsx(_Fragment, { children:\n      showRowsReturned && _jsx(ReturnedRows, { children:\n        _jsx(Tooltip, { id: \"sqllab-rowcount-tooltip\", title: tooltipText, placement: \"left\", children:\n          _jsxs(Label, { css: css`\n                  line-height: ${theme.typography.sizes.l}px;\n                `, children: [\n            limitMessage && _jsx(Icons.ExclamationCircleOutlined, { css: css`\n                      font-size: ${theme.typography.sizes.m}px;\n                      margin-right: ${theme.gridUnit}px;\n                    ` }),\n            tn('%s row', '%s rows', rows, formattedRowCount)] }\n          ) }\n        ) }\n      ) }\n    );\n  };\n  const limitReached = query == null ? void 0 : (_query$results2 = query.results) == null ? void 0 : _query$results2.displayLimitReached;\n  let sql;\n  let exploreDBId = query.dbId;\n  if (database != null && database.explore_database_id) {\n    exploreDBId = database.explore_database_id;\n  }\n  let trackingUrl;\n  if (query.trackingUrl &&\n  query.state !== QueryState.Success &&\n  query.state !== QueryState.Fetching) {\n    trackingUrl = _jsx(Button, { className: \"sql-result-track-job\", buttonSize: \"small\", href: query.trackingUrl, target: \"_blank\", children:\n      query.state === QueryState.Running ?\n      t('Track job') :\n      t('See query details') }\n    );\n  }\n  if (showSql) {\n    sql = _jsx(HighlightedSql, { sql: query.sql, ...(showSqlInline && { maxLines: 1, maxWidth: 60 }) });\n  }\n  if (query.state === QueryState.Stopped) {\n    return _jsx(Alert, { type: \"warning\", message: t('Query was stopped') });\n  }\n  if (query.state === QueryState.Failed) {var _query$extra, _query$extra$errors, _query$errors;\n    return _jsxs(ResultlessStyles, { children: [\n      _jsx(ErrorMessageWithStackTrace, { title: t('Database error'), error: (query == null ? void 0 : (_query$extra = query.extra) == null ? void 0 : (_query$extra$errors = _query$extra.errors) == null ? void 0 : _query$extra$errors[0]) || (query == null ? void 0 : (_query$errors = query.errors) == null ? void 0 : _query$errors[0]), subtitle: _jsx(MonospaceDiv, { children: query.errorMessage }), copyText: query.errorMessage || undefined, link: query.link, source: \"sqllab\" }),\n      trackingUrl] }\n    );\n  }\n  if (query.state === QueryState.Success && query.ctas) {\n    const { tempSchema, tempTable } = query;\n    let object = 'Table';\n    if (query.ctas_method === CtasEnum.View) {\n      object = 'View';\n    }\n    return _jsx(\"div\", { children:\n      _jsx(Alert, { type: \"info\", message: _jsxs(_Fragment, { children: [\n          t(object), \" [\",\n          _jsxs(\"strong\", { children: [\n            tempSchema ? `${tempSchema}.` : '',\n            tempTable] }\n          ), \"] \",\n          t('was created'), \" \\xA0\",\n          _jsxs(ButtonGroup, { children: [\n            _jsx(Button, { buttonSize: \"small\", css: /*#__PURE__*/_css({ marginRight: theme.gridUnit }, process.env.NODE_ENV === \"production\" ? \"\" : \";label:ResultSet;\", process.env.NODE_ENV === \"production\" ? \"\" : \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9hcHAvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL1NxbExhYi9jb21wb25lbnRzL1Jlc3VsdFNldC9pbmRleC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBMFYyQyIsImZpbGUiOiIvYXBwL3N1cGVyc2V0LWZyb250ZW5kL3NyYy9TcWxMYWIvY29tcG9uZW50cy9SZXN1bHRTZXQvaW5kZXgudHN4Iiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4gKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbiAqIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4gKiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4gKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4gKiBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4gKiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4gKiBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4gKiB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuaW1wb3J0IHsgdXNlQ2FsbGJhY2ssIHVzZUVmZmVjdCwgdXNlU3RhdGUsIG1lbW8sIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgc2hhbGxvd0VxdWFsLCB1c2VEaXNwYXRjaCwgdXNlU2VsZWN0b3IgfSBmcm9tICdyZWFjdC1yZWR1eCc7XG5pbXBvcnQgeyB1c2VIaXN0b3J5IH0gZnJvbSAncmVhY3Qtcm91dGVyLWRvbSc7XG5pbXBvcnQgeyBwaWNrIH0gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBCdXR0b25Hcm91cCBmcm9tICdzcmMvY29tcG9uZW50cy9CdXR0b25Hcm91cCc7XG5pbXBvcnQgQWxlcnQgZnJvbSAnc3JjL2NvbXBvbmVudHMvQWxlcnQnO1xuaW1wb3J0IEJ1dHRvbiBmcm9tICdzcmMvY29tcG9uZW50cy9CdXR0b24nO1xuaW1wb3J0IHsgbmFub2lkIH0gZnJvbSAnbmFub2lkJztcbmltcG9ydCB7IFF1ZXJ5U3RhdGUsIHN0eWxlZCwgdCwgdG4sIHVzZVRoZW1lLCB1c2VQcmV2aW91cywgY3NzLCBnZXROdW1iZXJGb3JtYXR0ZXIsIGdldEV4dGVuc2lvbnNSZWdpc3RyeSwgfSBmcm9tICdAc3VwZXJzZXQtdWkvY29yZSc7XG5pbXBvcnQgRXJyb3JNZXNzYWdlV2l0aFN0YWNrVHJhY2UgZnJvbSAnc3JjL2NvbXBvbmVudHMvRXJyb3JNZXNzYWdlL0Vycm9yTWVzc2FnZVdpdGhTdGFja1RyYWNlJztcbmltcG9ydCB7IFNhdmVEYXRhc2V0TW9kYWwsIH0gZnJvbSAnc3JjL1NxbExhYi9jb21wb25lbnRzL1NhdmVEYXRhc2V0TW9kYWwnO1xuaW1wb3J0IHsgRVhQTE9SRV9DSEFSVF9ERUZBVUxUIH0gZnJvbSAnc3JjL1NxbExhYi90eXBlcyc7XG5pbXBvcnQgeyBtb3VudEV4cGxvcmVVcmwgfSBmcm9tICdzcmMvZXhwbG9yZS9leHBsb3JlVXRpbHMnO1xuaW1wb3J0IHsgcG9zdEZvcm1EYXRhIH0gZnJvbSAnc3JjL2V4cGxvcmUvZXhwbG9yZVV0aWxzL2Zvcm1EYXRhJztcbmltcG9ydCBQcm9ncmVzc0JhciBmcm9tICdzcmMvY29tcG9uZW50cy9Qcm9ncmVzc0Jhcic7XG5pbXBvcnQgTG9hZGluZyBmcm9tICdzcmMvY29tcG9uZW50cy9Mb2FkaW5nJztcbmltcG9ydCBDYXJkIGZyb20gJ3NyYy9jb21wb25lbnRzL0NhcmQnO1xuaW1wb3J0IExhYmVsIGZyb20gJ3NyYy9jb21wb25lbnRzL0xhYmVsJztcbmltcG9ydCB7IFRvb2x0aXAgfSBmcm9tICdzcmMvY29tcG9uZW50cy9Ub29sdGlwJztcbmltcG9ydCBGaWx0ZXJhYmxlVGFibGUgZnJvbSAnc3JjL2NvbXBvbmVudHMvRmlsdGVyYWJsZVRhYmxlJztcbmltcG9ydCBDb3B5VG9DbGlwYm9hcmQgZnJvbSAnc3JjL2NvbXBvbmVudHMvQ29weVRvQ2xpcGJvYXJkJztcbmltcG9ydCB7IGFkZERhbmdlclRvYXN0IH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvTWVzc2FnZVRvYXN0cy9hY3Rpb25zJztcbmltcG9ydCB7IHByZXBhcmVDb3B5VG9DbGlwYm9hcmRUYWJ1bGFyRGF0YSB9IGZyb20gJ3NyYy91dGlscy9jb21tb24nO1xuaW1wb3J0IHsgZ2V0SXRlbSwgTG9jYWxTdG9yYWdlS2V5cyB9IGZyb20gJ3NyYy91dGlscy9sb2NhbFN0b3JhZ2VIZWxwZXJzJztcbmltcG9ydCB7IGFkZFF1ZXJ5RWRpdG9yLCBjbGVhclF1ZXJ5UmVzdWx0cywgQ3Rhc0VudW0sIGZldGNoUXVlcnlSZXN1bHRzLCByZUZldGNoUXVlcnlSZXN1bHRzLCByZVJ1blF1ZXJ5LCB9IGZyb20gJ3NyYy9TcWxMYWIvYWN0aW9ucy9zcWxMYWInO1xuaW1wb3J0IHsgVVJMX1BBUkFNUyB9IGZyb20gJ3NyYy9jb25zdGFudHMnO1xuaW1wb3J0IHVzZUxvZ0FjdGlvbiBmcm9tICdzcmMvbG9nZ2VyL3VzZUxvZ0FjdGlvbic7XG5pbXBvcnQgeyBMT0dfQUNUSU9OU19TUUxMQUJfQ09QWV9SRVNVTFRfVE9fQ0xJUEJPQVJELCBMT0dfQUNUSU9OU19TUUxMQUJfQ1JFQVRFX0NIQVJULCBMT0dfQUNUSU9OU19TUUxMQUJfRE9XTkxPQURfQ1NWLCB9IGZyb20gJ3NyYy9sb2dnZXIvTG9nVXRpbHMnO1xuaW1wb3J0IEljb25zIGZyb20gJ3NyYy9jb21wb25lbnRzL0ljb25zJztcbmltcG9ydCB7IGZpbmRQZXJtaXNzaW9uIH0gZnJvbSAnc3JjL3V0aWxzL2ZpbmRQZXJtaXNzaW9uJztcbmltcG9ydCBFeHBsb3JlQ3Rhc1Jlc3VsdHNCdXR0b24gZnJvbSAnLi4vRXhwbG9yZUN0YXNSZXN1bHRzQnV0dG9uJztcbmltcG9ydCBFeHBsb3JlUmVzdWx0c0J1dHRvbiBmcm9tICcuLi9FeHBsb3JlUmVzdWx0c0J1dHRvbic7XG5pbXBvcnQgSGlnaGxpZ2h0ZWRTcWwgZnJvbSAnLi4vSGlnaGxpZ2h0ZWRTcWwnO1xuaW1wb3J0IFF1ZXJ5U3RhdGVMYWJlbCBmcm9tICcuLi9RdWVyeVN0YXRlTGFiZWwnO1xudmFyIExpbWl0aW5nRmFjdG9yO1xuKGZ1bmN0aW9uIChMaW1pdGluZ0ZhY3Rvcikge1xuICAgIExpbWl0aW5nRmFjdG9yW1wiUXVlcnlcIl0gPSBcIlFVRVJZXCI7XG4gICAgTGltaXRpbmdGYWN0b3JbXCJRdWVyeUFuZERyb3Bkb3duXCJdID0gXCJRVUVSWV9BTkRfRFJPUERPV05cIjtcbiAgICBMaW1pdGluZ0ZhY3RvcltcIkRyb3Bkb3duXCJdID0gXCJEUk9QRE9XTlwiO1xuICAgIExpbWl0aW5nRmFjdG9yW1wiTm90TGltaXRlZFwiXSA9IFwiTk9UX0xJTUlURURcIjtcbn0pKExpbWl0aW5nRmFjdG9yIHx8IChMaW1pdGluZ0ZhY3RvciA9IHt9KSk7XG5jb25zdCBSZXN1bHRDb250YWluZXIgPSBzdHlsZWQuZGl2IGBcbiAgZGlzcGxheTogZmxleDtcbiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAgcm93LWdhcDogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5ncmlkVW5pdCAqIDJ9cHg7XG5gO1xuY29uc3QgUmVzdWx0bGVzc1N0eWxlcyA9IHN0eWxlZC5kaXYgYFxuICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gIG1pbi1oZWlnaHQ6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuZ3JpZFVuaXQgKiAyNX1weDtcbiAgW3JvbGU9J2FsZXJ0J10ge1xuICAgIG1hcmdpbi10b3A6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuZ3JpZFVuaXQgKiAyfXB4O1xuICB9XG4gIC5zcWwtcmVzdWx0LXRyYWNrLWpvYiB7XG4gICAgbWFyZ2luLXRvcDogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5ncmlkVW5pdCAqIDJ9cHg7XG4gIH1cbmA7XG4vLyBNYWtpbmcgdGV4dCByZW5kZXIgbGluZSBicmVha3MvdGFicyBhcyBpcyBhcyBtb25vc3BhY2UsXG4vLyBidXQgd3JhcHBpbmcgdGV4dCB0b28gc28gdGV4dCBkb2Vzbid0IG92ZXJmbG93XG5jb25zdCBNb25vc3BhY2VEaXYgPSBzdHlsZWQuZGl2IGBcbiAgZm9udC1mYW1pbHk6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUudHlwb2dyYXBoeS5mYW1pbGllcy5tb25vc3BhY2V9O1xuICB3aGl0ZS1zcGFjZTogcHJlO1xuICB3b3JkLWJyZWFrOiBicmVhay13b3JkO1xuICBvdmVyZmxvdy14OiBhdXRvO1xuICB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7XG5gO1xuY29uc3QgUmV0dXJuZWRSb3dzID0gc3R5bGVkLmRpdiBgXG4gIGZvbnQtc2l6ZTogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS50eXBvZ3JhcGh5LnNpemVzLnN9cHg7XG4gIGxpbmUtaGVpZ2h0OiAxO1xuYDtcbmNvbnN0IFJlc3VsdFNldENvbnRyb2xzID0gc3R5bGVkLmRpdiBgXG4gIGRpc3BsYXk6IGZsZXg7XG4gIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjtcbmA7XG5jb25zdCBSZXN1bHRTZXRCdXR0b25zID0gc3R5bGVkLmRpdiBgXG4gIGRpc3BsYXk6IGdyaWQ7XG4gIGdyaWQtYXV0by1mbG93OiBjb2x1bW47XG4gIHBhZGRpbmctcmlnaHQ6ICR7KHsgdGhlbWUgfSkgPT4gMiAqIHRoZW1lLmdyaWRVbml0fXB4O1xuYDtcbmNvbnN0IFJPV1NfQ0hJUF9XSURUSCA9IDEwMDtcbmNvbnN0IEdBUCA9IDg7XG5jb25zdCBleHRlbnNpb25zUmVnaXN0cnkgPSBnZXRFeHRlbnNpb25zUmVnaXN0cnkoKTtcbmNvbnN0IFJlc3VsdFNldCA9ICh7IGNhY2hlID0gZmFsc2UsIGNzdiA9IHRydWUsIGRhdGFiYXNlID0ge30sIGRpc3BsYXlMaW1pdCwgaGVpZ2h0LCBxdWVyeUlkLCBzZWFyY2ggPSB0cnVlLCBzaG93U3FsID0gZmFsc2UsIHNob3dTcWxJbmxpbmUgPSBmYWxzZSwgdmlzdWFsaXplID0gdHJ1ZSwgZGVmYXVsdFF1ZXJ5TGltaXQsIH0pID0+IHtcbiAgICBjb25zdCB1c2VyID0gdXNlU2VsZWN0b3IoKHsgdXNlciB9KSA9PiB1c2VyLCBzaGFsbG93RXF1YWwpO1xuICAgIGNvbnN0IHF1ZXJ5ID0gdXNlU2VsZWN0b3IoKHsgc3FsTGFiOiB7IHF1ZXJpZXMgfSB9KSA9PiBwaWNrKHF1ZXJpZXNbcXVlcnlJZF0sIFtcbiAgICAgICAgJ2lkJyxcbiAgICAgICAgJ2Vycm9yTWVzc2FnZScsXG4gICAgICAgICdjYWNoZWQnLFxuICAgICAgICAncmVzdWx0cycsXG4gICAgICAgICdyZXN1bHRzS2V5JyxcbiAgICAgICAgJ2RiSWQnLFxuICAgICAgICAndGFiJyxcbiAgICAgICAgJ3NxbCcsXG4gICAgICAgICdzcWxFZGl0b3JJZCcsXG4gICAgICAgICd0ZW1wbGF0ZVBhcmFtcycsXG4gICAgICAgICdzY2hlbWEnLFxuICAgICAgICAncm93cycsXG4gICAgICAgICdxdWVyeUxpbWl0JyxcbiAgICAgICAgJ2xpbWl0aW5nRmFjdG9yJyxcbiAgICAgICAgJ3RyYWNraW5nVXJsJyxcbiAgICAgICAgJ3N0YXRlJyxcbiAgICAgICAgJ2Vycm9ycycsXG4gICAgICAgICdsaW5rJyxcbiAgICAgICAgJ2N0YXMnLFxuICAgICAgICAnY3Rhc19tZXRob2QnLFxuICAgICAgICAndGVtcFNjaGVtYScsXG4gICAgICAgICd0ZW1wVGFibGUnLFxuICAgICAgICAnaXNEYXRhUHJldmlldycsXG4gICAgICAgICdwcm9ncmVzcycsXG4gICAgICAgICdleHRyYScsXG4gICAgXSksIHNoYWxsb3dFcXVhbCk7XG4gICAgY29uc3QgUmVzdWx0VGFibGUgPSBleHRlbnNpb25zUmVnaXN0cnkuZ2V0KCdzcWxlZGl0b3IuZXh0ZW5zaW9uLnJlc3VsdFRhYmxlJykgPz9cbiAgICAgICAgRmlsdGVyYWJsZVRhYmxlO1xuICAgIGNvbnN0IHRoZW1lID0gdXNlVGhlbWUoKTtcbiAgICBjb25zdCBbc2VhcmNoVGV4dCwgc2V0U2VhcmNoVGV4dF0gPSB1c2VTdGF0ZSgnJyk7XG4gICAgY29uc3QgW2NhY2hlZERhdGEsIHNldENhY2hlZERhdGFdID0gdXNlU3RhdGUoW10pO1xuICAgIGNvbnN0IFtzaG93U2F2ZURhdGFzZXRNb2RhbCwgc2V0U2hvd1NhdmVEYXRhc2V0TW9kYWxdID0gdXNlU3RhdGUoZmFsc2UpO1xuICAgIGNvbnN0IFthbGVydElzT3Blbiwgc2V0QWxlcnRJc09wZW5dID0gdXNlU3RhdGUoZmFsc2UpO1xuICAgIGNvbnN0IGhpc3RvcnkgPSB1c2VIaXN0b3J5KCk7XG4gICAgY29uc3QgZGlzcGF0Y2ggPSB1c2VEaXNwYXRjaCgpO1xuICAgIGNvbnN0IGxvZ0FjdGlvbiA9IHVzZUxvZ0FjdGlvbih7IHF1ZXJ5SWQsIHNxbEVkaXRvcklkOiBxdWVyeS5zcWxFZGl0b3JJZCB9KTtcbiAgICBjb25zdCByZVJ1blF1ZXJ5SWZTZXNzaW9uVGltZW91dEVycm9yT25Nb3VudCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgICAgaWYgKHF1ZXJ5LmVycm9yTWVzc2FnZSAmJlxuICAgICAgICAgICAgcXVlcnkuZXJyb3JNZXNzYWdlLmluZGV4T2YoJ3Nlc3Npb24gdGltZWQgb3V0JykgPiAwKSB7XG4gICAgICAgICAgICBkaXNwYXRjaChyZVJ1blF1ZXJ5KHF1ZXJ5KSk7XG4gICAgICAgIH1cbiAgICB9LCBbXSk7XG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgLy8gb25seSBkbyB0aGlzIHRoZSBmaXJzdCB0aW1lIHRoZSBjb21wb25lbnQgaXMgcmVuZGVyZWQvbW91bnRlZFxuICAgICAgICByZVJ1blF1ZXJ5SWZTZXNzaW9uVGltZW91dEVycm9yT25Nb3VudCgpO1xuICAgIH0sIFtyZVJ1blF1ZXJ5SWZTZXNzaW9uVGltZW91dEVycm9yT25Nb3VudF0pO1xuICAgIGNvbnN0IGZldGNoUmVzdWx0cyA9IChxKSA9PiB7XG4gICAgICAgIGRpc3BhdGNoKGZldGNoUXVlcnlSZXN1bHRzKHEsIGRpc3BsYXlMaW1pdCkpO1xuICAgIH07XG4gICAgY29uc3QgcHJldlF1ZXJ5ID0gdXNlUHJldmlvdXMocXVlcnkpO1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIGlmIChjYWNoZSAmJiBxdWVyeS5jYWNoZWQgJiYgcXVlcnk/LnJlc3VsdHM/LmRhdGE/Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHNldENhY2hlZERhdGEocXVlcnkucmVzdWx0cy5kYXRhKTtcbiAgICAgICAgICAgIGRpc3BhdGNoKGNsZWFyUXVlcnlSZXN1bHRzKHF1ZXJ5KSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHF1ZXJ5LnJlc3VsdHNLZXkgJiYgcXVlcnkucmVzdWx0c0tleSAhPT0gcHJldlF1ZXJ5Py5yZXN1bHRzS2V5KSB7XG4gICAgICAgICAgICBmZXRjaFJlc3VsdHMocXVlcnkpO1xuICAgICAgICB9XG4gICAgfSwgW3F1ZXJ5LCBjYWNoZV0pO1xuICAgIGNvbnN0IGNhbGN1bGF0ZUFsZXJ0UmVmSGVpZ2h0ID0gKGFsZXJ0RWxlbWVudCkgPT4ge1xuICAgICAgICBpZiAoYWxlcnRFbGVtZW50KSB7XG4gICAgICAgICAgICBzZXRBbGVydElzT3Blbih0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHNldEFsZXJ0SXNPcGVuKGZhbHNlKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgY29uc3QgcG9wU2VsZWN0U3RhciA9ICh0ZW1wU2NoZW1hLCB0ZW1wVGFibGUpID0+IHtcbiAgICAgICAgY29uc3QgcWUgPSB7XG4gICAgICAgICAgICBpZDogbmFub2lkKDExKSxcbiAgICAgICAgICAgIG5hbWU6IHRlbXBUYWJsZSxcbiAgICAgICAgICAgIGF1dG9ydW46IGZhbHNlLFxuICAgICAgICAgICAgZGJJZDogcXVlcnkuZGJJZCxcbiAgICAgICAgICAgIHNxbDogYFNFTEVDVCAqIEZST00gJHt0ZW1wU2NoZW1hID8gYCR7dGVtcFNjaGVtYX0uYCA6ICcnfSR7dGVtcFRhYmxlfWAsXG4gICAgICAgIH07XG4gICAgICAgIGRpc3BhdGNoKGFkZFF1ZXJ5RWRpdG9yKHFlKSk7XG4gICAgfTtcbiAgICBjb25zdCBjaGFuZ2VTZWFyY2ggPSAoZXZlbnQpID0+IHtcbiAgICAgICAgc2V0U2VhcmNoVGV4dChldmVudC50YXJnZXQudmFsdWUpO1xuICAgIH07XG4gICAgY29uc3QgY3JlYXRlRXhwbG9yZVJlc3VsdHNPbkNsaWNrID0gYXN5bmMgKGNsaWNrRXZlbnQpID0+IHtcbiAgICAgICAgY29uc3QgeyByZXN1bHRzIH0gPSBxdWVyeTtcbiAgICAgICAgY29uc3Qgb3BlbkluTmV3V2luZG93ID0gY2xpY2tFdmVudC5tZXRhS2V5O1xuICAgICAgICBsb2dBY3Rpb24oTE9HX0FDVElPTlNfU1FMTEFCX0NSRUFURV9DSEFSVCwge30pO1xuICAgICAgICBpZiAocmVzdWx0cz8ucXVlcnlfaWQpIHtcbiAgICAgICAgICAgIGNvbnN0IGtleSA9IGF3YWl0IHBvc3RGb3JtRGF0YShyZXN1bHRzLnF1ZXJ5X2lkLCAncXVlcnknLCB7XG4gICAgICAgICAgICAgICAgLi4uRVhQTE9SRV9DSEFSVF9ERUZBVUxULFxuICAgICAgICAgICAgICAgIGRhdGFzb3VyY2U6IGAke3Jlc3VsdHMucXVlcnlfaWR9X19xdWVyeWAsXG4gICAgICAgICAgICAgICAgLi4ue1xuICAgICAgICAgICAgICAgICAgICBhbGxfY29sdW1uczogcmVzdWx0cy5jb2x1bW5zLm1hcChjb2x1bW4gPT4gY29sdW1uLmNvbHVtbl9uYW1lKSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zdCB1cmwgPSBtb3VudEV4cGxvcmVVcmwobnVsbCwge1xuICAgICAgICAgICAgICAgIFtVUkxfUEFSQU1TLmZvcm1EYXRhS2V5Lm5hbWVdOiBrZXksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChvcGVuSW5OZXdXaW5kb3cpIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cub3Blbih1cmwsICdfYmxhbmsnLCAnbm9yZWZlcnJlcicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaGlzdG9yeS5wdXNoKHVybCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBhZGREYW5nZXJUb2FzdCh0KCdVbmFibGUgdG8gY3JlYXRlIGNoYXJ0IHdpdGhvdXQgYSBxdWVyeSBpZC4nKSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IGdldEV4cG9ydENzdlVybCA9IChjbGllbnRJZCkgPT4gYC9hcGkvdjEvc3FsbGFiL2V4cG9ydC8ke2NsaWVudElkfS9gO1xuICAgIGNvbnN0IHJlbmRlckNvbnRyb2xzID0gKCkgPT4ge1xuICAgICAgICBpZiAoc2VhcmNoIHx8IHZpc3VhbGl6ZSB8fCBjc3YpIHtcbiAgICAgICAgICAgIGxldCB7IGRhdGEgfSA9IHF1ZXJ5LnJlc3VsdHM7XG4gICAgICAgICAgICBpZiAoY2FjaGUgJiYgcXVlcnkuY2FjaGVkKSB7XG4gICAgICAgICAgICAgICAgZGF0YSA9IGNhY2hlZERhdGE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB7IGNvbHVtbnMgfSA9IHF1ZXJ5LnJlc3VsdHM7XG4gICAgICAgICAgICAvLyBBZGRlZCBjb21wdXRlIGxvZ2ljIHRvIHN0b3AgdXNlciBmcm9tIGJlaW5nIGFibGUgdG8gU2F2ZSAmIEV4cGxvcmVcbiAgICAgICAgICAgIGNvbnN0IGRhdGFzb3VyY2UgPSB7XG4gICAgICAgICAgICAgICAgY29sdW1uczogcXVlcnkucmVzdWx0cy5jb2x1bW5zLFxuICAgICAgICAgICAgICAgIG5hbWU6IHF1ZXJ5Py50YWIgfHwgJ1VudGl0bGVkJyxcbiAgICAgICAgICAgICAgICBkYklkOiBxdWVyeT8uZGJJZCxcbiAgICAgICAgICAgICAgICBzcWw6IHF1ZXJ5Py5zcWwsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVQYXJhbXM6IHF1ZXJ5Py50ZW1wbGF0ZVBhcmFtcyxcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHF1ZXJ5Py5zY2hlbWEsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29uc3QgY2FuRXhwb3J0RGF0YSA9IGZpbmRQZXJtaXNzaW9uKCdjYW5fZXhwb3J0X2NzdicsICdTUUxMYWInLCB1c2VyPy5yb2xlcyk7XG4gICAgICAgICAgICByZXR1cm4gKDxSZXN1bHRTZXRDb250cm9scz5cbiAgICAgICAgICA8U2F2ZURhdGFzZXRNb2RhbCB2aXNpYmxlPXtzaG93U2F2ZURhdGFzZXRNb2RhbH0gb25IaWRlPXsoKSA9PiBzZXRTaG93U2F2ZURhdGFzZXRNb2RhbChmYWxzZSl9IGJ1dHRvblRleHRPblNhdmU9e3QoJ1NhdmUgJiBFeHBsb3JlJyl9IGJ1dHRvblRleHRPbk92ZXJ3cml0ZT17dCgnT3ZlcndyaXRlICYgRXhwbG9yZScpfSBtb2RhbERlc2NyaXB0aW9uPXt0KCdTYXZlIHRoaXMgcXVlcnkgYXMgYSB2aXJ0dWFsIGRhdGFzZXQgdG8gY29udGludWUgZXhwbG9yaW5nJyl9IGRhdGFzb3VyY2U9e2RhdGFzb3VyY2V9Lz5cbiAgICAgICAgICA8UmVzdWx0U2V0QnV0dG9ucz5cbiAgICAgICAgICAgIHt2aXN1YWxpemUgJiYgZGF0YWJhc2U/LmFsbG93c192aXJ0dWFsX3RhYmxlX2V4cGxvcmUgJiYgKDxFeHBsb3JlUmVzdWx0c0J1dHRvbiBkYXRhYmFzZT17ZGF0YWJhc2V9IG9uQ2xpY2s9e2NyZWF0ZUV4cGxvcmVSZXN1bHRzT25DbGlja30vPil9XG4gICAgICAgICAgICB7Y3N2ICYmIGNhbkV4cG9ydERhdGEgJiYgKDxCdXR0b24gYnV0dG9uU2l6ZT1cInNtYWxsXCIgaHJlZj17Z2V0RXhwb3J0Q3N2VXJsKHF1ZXJ5LmlkKX0gZGF0YS10ZXN0PVwiZXhwb3J0LWNzdi1idXR0b25cIiBvbkNsaWNrPXsoKSA9PiBsb2dBY3Rpb24oTE9HX0FDVElPTlNfU1FMTEFCX0RPV05MT0FEX0NTViwge30pfT5cbiAgICAgICAgICAgICAgICA8aSBjbGFzc05hbWU9XCJmYSBmYS1maWxlLXRleHQtb1wiLz4ge3QoJ0Rvd25sb2FkIHRvIENTVicpfVxuICAgICAgICAgICAgICA8L0J1dHRvbj4pfVxuXG4gICAgICAgICAgICB7Y2FuRXhwb3J0RGF0YSAmJiAoPENvcHlUb0NsaXBib2FyZCB0ZXh0PXtwcmVwYXJlQ29weVRvQ2xpcGJvYXJkVGFidWxhckRhdGEoZGF0YSwgY29sdW1ucyl9IHdyYXBwZWQ9e2ZhbHNlfSBjb3B5Tm9kZT17PEJ1dHRvbiBidXR0b25TaXplPVwic21hbGxcIiBkYXRhLXRlc3Q9XCJjb3B5LXRvLWNsaXBib2FyZC1idXR0b25cIj5cbiAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3NOYW1lPVwiZmEgZmEtY2xpcGJvYXJkXCIvPiB7dCgnQ29weSB0byBDbGlwYm9hcmQnKX1cbiAgICAgICAgICAgICAgICAgIDwvQnV0dG9uPn0gaGlkZVRvb2x0aXAgb25Db3B5RW5kPXsoKSA9PiBsb2dBY3Rpb24oTE9HX0FDVElPTlNfU1FMTEFCX0NPUFlfUkVTVUxUX1RPX0NMSVBCT0FSRCwge30pfS8+KX1cbiAgICAgICAgICA8L1Jlc3VsdFNldEJ1dHRvbnM+XG4gICAgICAgICAge3NlYXJjaCAmJiAoPGlucHV0IHR5cGU9XCJ0ZXh0XCIgb25DaGFuZ2U9e2NoYW5nZVNlYXJjaH0gdmFsdWU9e3NlYXJjaFRleHR9IGNsYXNzTmFtZT1cImZvcm0tY29udHJvbCBpbnB1dC1zbVwiIHBsYWNlaG9sZGVyPXt0KCdGaWx0ZXIgcmVzdWx0cycpfS8+KX1cbiAgICAgICAgPC9SZXN1bHRTZXRDb250cm9scz4pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiA8ZGl2IC8+O1xuICAgIH07XG4gICAgY29uc3QgcmVuZGVyUm93c1JldHVybmVkID0gKGFsZXJ0TWVzc2FnZSkgPT4ge1xuICAgICAgICBjb25zdCB7IHJlc3VsdHMsIHJvd3MsIHF1ZXJ5TGltaXQsIGxpbWl0aW5nRmFjdG9yIH0gPSBxdWVyeTtcbiAgICAgICAgbGV0IGxpbWl0TWVzc2FnZSA9ICcnO1xuICAgICAgICBjb25zdCBsaW1pdFJlYWNoZWQgPSByZXN1bHRzPy5kaXNwbGF5TGltaXRSZWFjaGVkO1xuICAgICAgICBjb25zdCBsaW1pdCA9IHF1ZXJ5TGltaXQgfHwgcmVzdWx0cy5xdWVyeS5saW1pdDtcbiAgICAgICAgY29uc3QgaXNBZG1pbiA9ICEhdXNlcj8ucm9sZXM/LkFkbWluO1xuICAgICAgICBjb25zdCByb3dzQ291bnQgPSBNYXRoLm1pbihyb3dzIHx8IDAsIHJlc3VsdHM/LmRhdGE/Lmxlbmd0aCB8fCAwKTtcbiAgICAgICAgY29uc3QgZGlzcGxheU1heFJvd3NSZWFjaGVkTWVzc2FnZSA9IHtcbiAgICAgICAgICAgIHdpdGhBZG1pbjogdCgnVGhlIG51bWJlciBvZiByZXN1bHRzIGRpc3BsYXllZCBpcyBsaW1pdGVkIHRvICUocm93cylkIGJ5IHRoZSBjb25maWd1cmF0aW9uIERJU1BMQVlfTUFYX1JPVy4gJyArXG4gICAgICAgICAgICAgICAgJ1BsZWFzZSBhZGQgYWRkaXRpb25hbCBsaW1pdHMvZmlsdGVycyBvciBkb3dubG9hZCB0byBjc3YgdG8gc2VlIG1vcmUgcm93cyB1cCB0byAnICtcbiAgICAgICAgICAgICAgICAndGhlICUobGltaXQpZCBsaW1pdC4nLCB7IHJvd3M6IHJvd3NDb3VudCwgbGltaXQgfSksXG4gICAgICAgICAgICB3aXRob3V0QWRtaW46IHQoJ1RoZSBudW1iZXIgb2YgcmVzdWx0cyBkaXNwbGF5ZWQgaXMgbGltaXRlZCB0byAlKHJvd3MpZC4gJyArXG4gICAgICAgICAgICAgICAgJ1BsZWFzZSBhZGQgYWRkaXRpb25hbCBsaW1pdHMvZmlsdGVycywgZG93bmxvYWQgdG8gY3N2LCBvciBjb250YWN0IGFuIGFkbWluICcgK1xuICAgICAgICAgICAgICAgICd0byBzZWUgbW9yZSByb3dzIHVwIHRvIHRoZSAlKGxpbWl0KWQgbGltaXQuJywgeyByb3dzOiByb3dzQ291bnQsIGxpbWl0IH0pLFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBzaG91bGRVc2VEZWZhdWx0RHJvcGRvd25BbGVydCA9IGxpbWl0ID09PSBkZWZhdWx0UXVlcnlMaW1pdCAmJiBsaW1pdGluZ0ZhY3RvciA9PT0gTGltaXRpbmdGYWN0b3IuRHJvcGRvd247XG4gICAgICAgIGlmIChsaW1pdGluZ0ZhY3RvciA9PT0gTGltaXRpbmdGYWN0b3IuUXVlcnkgJiYgY3N2KSB7XG4gICAgICAgICAgICBsaW1pdE1lc3NhZ2UgPSB0KCdUaGUgbnVtYmVyIG9mIHJvd3MgZGlzcGxheWVkIGlzIGxpbWl0ZWQgdG8gJShyb3dzKWQgYnkgdGhlIHF1ZXJ5JywgeyByb3dzIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGxpbWl0aW5nRmFjdG9yID09PSBMaW1pdGluZ0ZhY3Rvci5Ecm9wZG93biAmJlxuICAgICAgICAgICAgIXNob3VsZFVzZURlZmF1bHREcm9wZG93bkFsZXJ0KSB7XG4gICAgICAgICAgICBsaW1pdE1lc3NhZ2UgPSB0KCdUaGUgbnVtYmVyIG9mIHJvd3MgZGlzcGxheWVkIGlzIGxpbWl0ZWQgdG8gJShyb3dzKWQgYnkgdGhlIGxpbWl0IGRyb3Bkb3duLicsIHsgcm93cyB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChsaW1pdGluZ0ZhY3RvciA9PT0gTGltaXRpbmdGYWN0b3IuUXVlcnlBbmREcm9wZG93bikge1xuICAgICAgICAgICAgbGltaXRNZXNzYWdlID0gdCgnVGhlIG51bWJlciBvZiByb3dzIGRpc3BsYXllZCBpcyBsaW1pdGVkIHRvICUocm93cylkIGJ5IHRoZSBxdWVyeSBhbmQgbGltaXQgZHJvcGRvd24uJywgeyByb3dzIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGZvcm1hdHRlZFJvd0NvdW50ID0gZ2V0TnVtYmVyRm9ybWF0dGVyKCkocm93cyk7XG4gICAgICAgIGNvbnN0IHJvd3NSZXR1cm5lZE1lc3NhZ2UgPSB0KCclKHJvd3MpZCByb3dzIHJldHVybmVkJywge1xuICAgICAgICAgICAgcm93cyxcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHRvb2x0aXBUZXh0ID0gYCR7cm93c1JldHVybmVkTWVzc2FnZX0uICR7bGltaXRNZXNzYWdlfWA7XG4gICAgICAgIGlmIChhbGVydE1lc3NhZ2UpIHtcbiAgICAgICAgICAgIHJldHVybiAoPD5cbiAgICAgICAgICB7IWxpbWl0UmVhY2hlZCAmJiBzaG91bGRVc2VEZWZhdWx0RHJvcGRvd25BbGVydCAmJiAoPGRpdiByZWY9e2NhbGN1bGF0ZUFsZXJ0UmVmSGVpZ2h0fT5cbiAgICAgICAgICAgICAgPEFsZXJ0IHR5cGU9XCJ3YXJuaW5nXCIgbWVzc2FnZT17dCgnJShyb3dzKWQgcm93cyByZXR1cm5lZCcsIHsgcm93cyB9KX0gb25DbG9zZT17KCkgPT4gc2V0QWxlcnRJc09wZW4oZmFsc2UpfSBkZXNjcmlwdGlvbj17dCgnVGhlIG51bWJlciBvZiByb3dzIGRpc3BsYXllZCBpcyBsaW1pdGVkIHRvICUocm93cylkIGJ5IHRoZSBkcm9wZG93bi4nLCB7IHJvd3MgfSl9Lz5cbiAgICAgICAgICAgIDwvZGl2Pil9XG4gICAgICAgICAge2xpbWl0UmVhY2hlZCAmJiAoPGRpdiByZWY9e2NhbGN1bGF0ZUFsZXJ0UmVmSGVpZ2h0fT5cbiAgICAgICAgICAgICAgPEFsZXJ0IHR5cGU9XCJ3YXJuaW5nXCIgb25DbG9zZT17KCkgPT4gc2V0QWxlcnRJc09wZW4oZmFsc2UpfSBtZXNzYWdlPXt0KCclKHJvd3MpZCByb3dzIHJldHVybmVkJywgeyByb3dzOiByb3dzQ291bnQgfSl9IGRlc2NyaXB0aW9uPXtpc0FkbWluXG4gICAgICAgICAgICAgICAgICAgICAgICA/IGRpc3BsYXlNYXhSb3dzUmVhY2hlZE1lc3NhZ2Uud2l0aEFkbWluXG4gICAgICAgICAgICAgICAgICAgICAgICA6IGRpc3BsYXlNYXhSb3dzUmVhY2hlZE1lc3NhZ2Uud2l0aG91dEFkbWlufS8+XG4gICAgICAgICAgICA8L2Rpdj4pfVxuICAgICAgICA8Lz4pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNob3dSb3dzUmV0dXJuZWQgPSBzaG93U3FsSW5saW5lIHx8ICghbGltaXRSZWFjaGVkICYmICFzaG91bGRVc2VEZWZhdWx0RHJvcGRvd25BbGVydCk7XG4gICAgICAgIHJldHVybiAoPD5cbiAgICAgICAge3Nob3dSb3dzUmV0dXJuZWQgJiYgKDxSZXR1cm5lZFJvd3M+XG4gICAgICAgICAgICA8VG9vbHRpcCBpZD1cInNxbGxhYi1yb3djb3VudC10b29sdGlwXCIgdGl0bGU9e3Rvb2x0aXBUZXh0fSBwbGFjZW1lbnQ9XCJsZWZ0XCI+XG4gICAgICAgICAgICAgIDxMYWJlbCBjc3M9e2NzcyBgXG4gICAgICAgICAgICAgICAgICBsaW5lLWhlaWdodDogJHt0aGVtZS50eXBvZ3JhcGh5LnNpemVzLmx9cHg7XG4gICAgICAgICAgICAgICAgYH0+XG4gICAgICAgICAgICAgICAge2xpbWl0TWVzc2FnZSAmJiAoPEljb25zLkV4Y2xhbWF0aW9uQ2lyY2xlT3V0bGluZWQgY3NzPXtjc3MgYFxuICAgICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogJHt0aGVtZS50eXBvZ3JhcGh5LnNpemVzLm19cHg7XG4gICAgICAgICAgICAgICAgICAgICAgbWFyZ2luLXJpZ2h0OiAke3RoZW1lLmdyaWRVbml0fXB4O1xuICAgICAgICAgICAgICAgICAgICBgfS8+KX1cbiAgICAgICAgICAgICAgICB7dG4oJyVzIHJvdycsICclcyByb3dzJywgcm93cywgZm9ybWF0dGVkUm93Q291bnQpfVxuICAgICAgICAgICAgICA8L0xhYmVsPlxuICAgICAgICAgICAgPC9Ub29sdGlwPlxuICAgICAgICAgIDwvUmV0dXJuZWRSb3dzPil9XG4gICAgICA8Lz4pO1xuICAgIH07XG4gICAgY29uc3QgbGltaXRSZWFjaGVkID0gcXVlcnk/LnJlc3VsdHM/LmRpc3BsYXlMaW1pdFJlYWNoZWQ7XG4gICAgbGV0IHNxbDtcbiAgICBsZXQgZXhwbG9yZURCSWQgPSBxdWVyeS5kYklkO1xuICAgIGlmIChkYXRhYmFzZT8uZXhwbG9yZV9kYXRhYmFzZV9pZCkge1xuICAgICAgICBleHBsb3JlREJJZCA9IGRhdGFiYXNlLmV4cGxvcmVfZGF0YWJhc2VfaWQ7XG4gICAgfVxuICAgIGxldCB0cmFja2luZ1VybDtcbiAgICBpZiAocXVlcnkudHJhY2tpbmdVcmwgJiZcbiAgICAgICAgcXVlcnkuc3RhdGUgIT09IFF1ZXJ5U3RhdGUuU3VjY2VzcyAmJlxuICAgICAgICBxdWVyeS5zdGF0ZSAhPT0gUXVlcnlTdGF0ZS5GZXRjaGluZykge1xuICAgICAgICB0cmFja2luZ1VybCA9ICg8QnV0dG9uIGNsYXNzTmFtZT1cInNxbC1yZXN1bHQtdHJhY2stam9iXCIgYnV0dG9uU2l6ZT1cInNtYWxsXCIgaHJlZj17cXVlcnkudHJhY2tpbmdVcmx9IHRhcmdldD1cIl9ibGFua1wiPlxuICAgICAgICB7cXVlcnkuc3RhdGUgPT09IFF1ZXJ5U3RhdGUuUnVubmluZ1xuICAgICAgICAgICAgICAgID8gdCgnVHJhY2sgam9iJylcbiAgICAgICAgICAgICAgICA6IHQoJ1NlZSBxdWVyeSBkZXRhaWxzJyl9XG4gICAgICA8L0J1dHRvbj4pO1xuICAgIH1cbiAgICBpZiAoc2hvd1NxbCkge1xuICAgICAgICBzcWwgPSAoPEhpZ2hsaWdodGVkU3FsIHNxbD17cXVlcnkuc3FsfSB7Li4uKHNob3dTcWxJbmxpbmUgJiYgeyBtYXhMaW5lczogMSwgbWF4V2lkdGg6IDYwIH0pfS8+KTtcbiAgICB9XG4gICAgaWYgKHF1ZXJ5LnN0YXRlID09PSBRdWVyeVN0YXRlLlN0b3BwZWQpIHtcbiAgICAgICAgcmV0dXJuIDxBbGVydCB0eXBlPVwid2FybmluZ1wiIG1lc3NhZ2U9e3QoJ1F1ZXJ5IHdhcyBzdG9wcGVkJyl9Lz47XG4gICAgfVxuICAgIGlmIChxdWVyeS5zdGF0ZSA9PT0gUXVlcnlTdGF0ZS5GYWlsZWQpIHtcbiAgICAgICAgcmV0dXJuICg8UmVzdWx0bGVzc1N0eWxlcz5cbiAgICAgICAgPEVycm9yTWVzc2FnZVdpdGhTdGFja1RyYWNlIHRpdGxlPXt0KCdEYXRhYmFzZSBlcnJvcicpfSBlcnJvcj17cXVlcnk/LmV4dHJhPy5lcnJvcnM/LlswXSB8fCBxdWVyeT8uZXJyb3JzPy5bMF19IHN1YnRpdGxlPXs8TW9ub3NwYWNlRGl2PntxdWVyeS5lcnJvck1lc3NhZ2V9PC9Nb25vc3BhY2VEaXY+fSBjb3B5VGV4dD17cXVlcnkuZXJyb3JNZXNzYWdlIHx8IHVuZGVmaW5lZH0gbGluaz17cXVlcnkubGlua30gc291cmNlPVwic3FsbGFiXCIvPlxuICAgICAgICB7dHJhY2tpbmdVcmx9XG4gICAgICA8L1Jlc3VsdGxlc3NTdHlsZXM+KTtcbiAgICB9XG4gICAgaWYgKHF1ZXJ5LnN0YXRlID09PSBRdWVyeVN0YXRlLlN1Y2Nlc3MgJiYgcXVlcnkuY3Rhcykge1xuICAgICAgICBjb25zdCB7IHRlbXBTY2hlbWEsIHRlbXBUYWJsZSB9ID0gcXVlcnk7XG4gICAgICAgIGxldCBvYmplY3QgPSAnVGFibGUnO1xuICAgICAgICBpZiAocXVlcnkuY3Rhc19tZXRob2QgPT09IEN0YXNFbnVtLlZpZXcpIHtcbiAgICAgICAgICAgIG9iamVjdCA9ICdWaWV3JztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKDxkaXY+XG4gICAgICAgIDxBbGVydCB0eXBlPVwiaW5mb1wiIG1lc3NhZ2U9ezw+XG4gICAgICAgICAgICAgIHt0KG9iamVjdCl9IFtcbiAgICAgICAgICAgICAgPHN0cm9uZz5cbiAgICAgICAgICAgICAgICB7dGVtcFNjaGVtYSA/IGAke3RlbXBTY2hlbWF9LmAgOiAnJ31cbiAgICAgICAgICAgICAgICB7dGVtcFRhYmxlfVxuICAgICAgICAgICAgICA8L3N0cm9uZz5cbiAgICAgICAgICAgICAgXSB7dCgnd2FzIGNyZWF0ZWQnKX0gJm5ic3A7XG4gICAgICAgICAgICAgIDxCdXR0b25Hcm91cD5cbiAgICAgICAgICAgICAgICA8QnV0dG9uIGJ1dHRvblNpemU9XCJzbWFsbFwiIGNzcz17eyBtYXJnaW5SaWdodDogdGhlbWUuZ3JpZFVuaXQgfX0gb25DbGljaz17KCkgPT4gcG9wU2VsZWN0U3Rhcih0ZW1wU2NoZW1hLCB0ZW1wVGFibGUpfT5cbiAgICAgICAgICAgICAgICAgIHt0KCdRdWVyeSBpbiBhIG5ldyB0YWInKX1cbiAgICAgICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICAgICAgICA8RXhwbG9yZUN0YXNSZXN1bHRzQnV0dG9uIHRhYmxlPXt0ZW1wVGFibGV9IHNjaGVtYT17dGVtcFNjaGVtYX0gZGJJZD17ZXhwbG9yZURCSWR9Lz5cbiAgICAgICAgICAgICAgPC9CdXR0b25Hcm91cD5cbiAgICAgICAgICAgIDwvPn0vPlxuICAgICAgPC9kaXY+KTtcbiAgICB9XG4gICAgaWYgKHF1ZXJ5LnN0YXRlID09PSBRdWVyeVN0YXRlLlN1Y2Nlc3MgJiYgcXVlcnkucmVzdWx0cykge1xuICAgICAgICBjb25zdCB7IHJlc3VsdHMgfSA9IHF1ZXJ5O1xuICAgICAgICAvLyBBY2NvdW50cyBmb3Igb2Zmc2V0IG5lZWRlZCBmb3IgaGVpZ2h0IG9mIFJlc3VsdFNldFJvd3NSZXR1cm5lZCBjb21wb25lbnQgaWYgIWxpbWl0UmVhY2hlZFxuICAgICAgICBjb25zdCByb3dNZXNzYWdlSGVpZ2h0ID0gIWxpbWl0UmVhY2hlZCA/IDMyIDogMDtcbiAgICAgICAgLy8gQWNjb3VudHMgZm9yIG9mZnNldCBuZWVkZWQgZm9yIGhlaWdodCBvZiBBbGVydCBpZiB0aGlzLnN0YXRlLmFsZXJ0SXNPcGVuXG4gICAgICAgIGNvbnN0IGFsZXJ0Q29udGFpbmVySGVpZ2h0ID0gNzA7XG4gICAgICAgIC8vIFdlIG5lZWQgdG8gY2FsY3VsYXRlIHRoZSBoZWlnaHQgb2YgdGhpcy5yZW5kZXJSb3dzUmV0dXJuZWQoKVxuICAgICAgICAvLyBpZiB3ZSB3YW50IHJlc3VsdHMgcGFuZWwgdG8gYmUgcHJvcGVyIGhlaWdodCBiZWNhdXNlIHRoZVxuICAgICAgICAvLyBGaWx0ZXJUYWJsZSBjb21wb25lbnQgbmVlZHMgYW4gZXhwbGljaXQgaGVpZ2h0IHRvIHJlbmRlclxuICAgICAgICAvLyB0aGUgVGFibGUgY29tcG9uZW50XG4gICAgICAgIGNvbnN0IHJvd3NIZWlnaHQgPSBhbGVydElzT3BlblxuICAgICAgICAgICAgPyBoZWlnaHQgLSBhbGVydENvbnRhaW5lckhlaWdodFxuICAgICAgICAgICAgOiBoZWlnaHQgLSByb3dNZXNzYWdlSGVpZ2h0O1xuICAgICAgICBsZXQgZGF0YTtcbiAgICAgICAgaWYgKGNhY2hlICYmIHF1ZXJ5LmNhY2hlZCkge1xuICAgICAgICAgICAgZGF0YSA9IGNhY2hlZERhdGE7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocmVzdWx0cz8uZGF0YSkge1xuICAgICAgICAgICAgKHsgZGF0YSB9ID0gcmVzdWx0cyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCBleHBhbmRlZENvbHVtbnMgPSByZXN1bHRzLmV4cGFuZGVkX2NvbHVtbnNcbiAgICAgICAgICAgICAgICA/IHJlc3VsdHMuZXhwYW5kZWRfY29sdW1ucy5tYXAoY29sID0+IGNvbC5jb2x1bW5fbmFtZSlcbiAgICAgICAgICAgICAgICA6IFtdO1xuICAgICAgICAgICAgY29uc3QgYWxsb3dIVE1MID0gZ2V0SXRlbShMb2NhbFN0b3JhZ2VLZXlzLlNxbGxhYklzUmVuZGVySHRtbEVuYWJsZWQsIGZhbHNlKTtcbiAgICAgICAgICAgIHJldHVybiAoPFJlc3VsdENvbnRhaW5lcj5cbiAgICAgICAgICB7cmVuZGVyQ29udHJvbHMoKX1cbiAgICAgICAgICB7c2hvd1NxbCAmJiBzaG93U3FsSW5saW5lID8gKDw+XG4gICAgICAgICAgICAgIDxkaXYgY3NzPXtjc3MgYFxuICAgICAgICAgICAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjtcbiAgICAgICAgICAgICAgICAgIGdhcDogJHtHQVB9cHg7XG4gICAgICAgICAgICAgICAgYH0+XG4gICAgICAgICAgICAgICAgPENhcmQgY3NzPXtbXG4gICAgICAgICAgICAgICAgICAgICAgICBjc3MgYFxuICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMjhweDtcbiAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogY2FsYygxMDAlIC0gJHtST1dTX0NISVBfV0lEVEggKyBHQVB9cHgpO1xuICAgICAgICAgICAgICAgICAgICAgIGNvZGUge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDEwMCU7XG4gICAgICAgICAgICAgICAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuO1xuICAgICAgICAgICAgICAgICAgICAgICAgd2hpdGUtc3BhY2U6IG5vd3JhcCAhaW1wb3J0YW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBibG9jaztcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGAsXG4gICAgICAgICAgICAgICAgICAgIF19PlxuICAgICAgICAgICAgICAgICAge3NxbH1cbiAgICAgICAgICAgICAgICA8L0NhcmQ+XG4gICAgICAgICAgICAgICAge3JlbmRlclJvd3NSZXR1cm5lZChmYWxzZSl9XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICB7cmVuZGVyUm93c1JldHVybmVkKHRydWUpfVxuICAgICAgICAgICAgPC8+KSA6ICg8PlxuICAgICAgICAgICAgICB7cmVuZGVyUm93c1JldHVybmVkKGZhbHNlKX1cbiAgICAgICAgICAgICAge3JlbmRlclJvd3NSZXR1cm5lZCh0cnVlKX1cbiAgICAgICAgICAgICAge3NxbH1cbiAgICAgICAgICAgIDwvPil9XG4gICAgICAgICAgPFJlc3VsdFRhYmxlIGRhdGE9e2RhdGF9IHF1ZXJ5SWQ9e3F1ZXJ5LmlkfSBvcmRlcmVkQ29sdW1uS2V5cz17cmVzdWx0cy5jb2x1bW5zLm1hcChjb2wgPT4gY29sLmNvbHVtbl9uYW1lKX0gaGVpZ2h0PXtyb3dzSGVpZ2h0fSBmaWx0ZXJUZXh0PXtzZWFyY2hUZXh0fSBleHBhbmRlZENvbHVtbnM9e2V4cGFuZGVkQ29sdW1uc30gYWxsb3dIVE1MPXthbGxvd0hUTUx9Lz5cbiAgICAgICAgPC9SZXN1bHRDb250YWluZXI+KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIDxBbGVydCB0eXBlPVwid2FybmluZ1wiIG1lc3NhZ2U9e3QoJ1RoZSBxdWVyeSByZXR1cm5lZCBubyBkYXRhJyl9Lz47XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKHF1ZXJ5LmNhY2hlZCB8fCAocXVlcnkuc3RhdGUgPT09IFF1ZXJ5U3RhdGUuU3VjY2VzcyAmJiAhcXVlcnkucmVzdWx0cykpIHtcbiAgICAgICAgaWYgKHF1ZXJ5LmlzRGF0YVByZXZpZXcpIHtcbiAgICAgICAgICAgIHJldHVybiAoPEJ1dHRvbiBidXR0b25TaXplPVwic21hbGxcIiBidXR0b25TdHlsZT1cInByaW1hcnlcIiBvbkNsaWNrPXsoKSA9PiBkaXNwYXRjaChyZUZldGNoUXVlcnlSZXN1bHRzKHtcbiAgICAgICAgICAgICAgICAgICAgLi4ucXVlcnksXG4gICAgICAgICAgICAgICAgICAgIGlzRGF0YVByZXZpZXc6IHRydWUsXG4gICAgICAgICAgICAgICAgfSkpfT5cbiAgICAgICAgICB7dCgnRmV0Y2ggZGF0YSBwcmV2aWV3Jyl9XG4gICAgICAgIDwvQnV0dG9uPik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHF1ZXJ5LnJlc3VsdHNLZXkpIHtcbiAgICAgICAgICAgIHJldHVybiAoPEJ1dHRvbiBidXR0b25TaXplPVwic21hbGxcIiBidXR0b25TdHlsZT1cInByaW1hcnlcIiBvbkNsaWNrPXsoKSA9PiBmZXRjaFJlc3VsdHMocXVlcnkpfT5cbiAgICAgICAgICB7dCgnUmVmZXRjaCByZXN1bHRzJyl9XG4gICAgICAgIDwvQnV0dG9uPik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgbGV0IHByb2dyZXNzQmFyO1xuICAgIGlmIChxdWVyeS5wcm9ncmVzcyA+IDApIHtcbiAgICAgICAgcHJvZ3Jlc3NCYXIgPSAoPFByb2dyZXNzQmFyIHBlcmNlbnQ9e3BhcnNlSW50KHF1ZXJ5LnByb2dyZXNzLnRvRml4ZWQoMCksIDEwKX0gc3RyaXBlZC8+KTtcbiAgICB9XG4gICAgY29uc3QgcHJvZ3Jlc3NNc2cgPSBxdWVyeT8uZXh0cmE/LnByb2dyZXNzID8/IG51bGw7XG4gICAgcmV0dXJuICg8UmVzdWx0bGVzc1N0eWxlcz5cbiAgICAgIDxkaXY+eyFwcm9ncmVzc0JhciAmJiA8TG9hZGluZyBwb3NpdGlvbj1cIm5vcm1hbFwiLz59PC9kaXY+XG4gICAgICB7Lyogc2hvdyBsb2FkaW5nIGJhciB3aGVuZXZlciBwcm9ncmVzcyBiYXIgaXMgY29tcGxldGVkIGJ1dCBuZWVkcyB0aW1lIHRvIHJlbmRlciAqL31cbiAgICAgIDxkaXY+e3F1ZXJ5LnByb2dyZXNzID09PSAxMDAgJiYgPExvYWRpbmcgcG9zaXRpb249XCJub3JtYWxcIi8+fTwvZGl2PlxuICAgICAgPFF1ZXJ5U3RhdGVMYWJlbCBxdWVyeT17cXVlcnl9Lz5cbiAgICAgIDxkaXY+e3Byb2dyZXNzTXNnICYmIDxBbGVydCB0eXBlPVwic3VjY2Vzc1wiIG1lc3NhZ2U9e3Byb2dyZXNzTXNnfS8+fTwvZGl2PlxuICAgICAgPGRpdj57cXVlcnkucHJvZ3Jlc3MgIT09IDEwMCAmJiBwcm9ncmVzc0Jhcn08L2Rpdj5cbiAgICAgIHt0cmFja2luZ1VybCAmJiA8ZGl2Pnt0cmFja2luZ1VybH08L2Rpdj59XG4gICAgPC9SZXN1bHRsZXNzU3R5bGVzPik7XG59O1xuZXhwb3J0IGRlZmF1bHQgbWVtbyhSZXN1bHRTZXQpO1xuIl19 */\"), onClick: () => popSelectStar(tempSchema, tempTable), children:\n              t('Query in a new tab') }\n            ),\n            _jsx(ExploreCtasResultsButton, { table: tempTable, schema: tempSchema, dbId: exploreDBId })] }\n          )] }\n        ) }) }\n    );\n  }\n  if (query.state === QueryState.Success && query.results) {\n    const { results } = query;\n    // Accounts for offset needed for height of ResultSetRowsReturned component if !limitReached\n    const rowMessageHeight = !limitReached ? 32 : 0;\n    // Accounts for offset needed for height of Alert if this.state.alertIsOpen\n    const alertContainerHeight = 70;\n    // We need to calculate the height of this.renderRowsReturned()\n    // if we want results panel to be proper height because the\n    // FilterTable component needs an explicit height to render\n    // the Table component\n    const rowsHeight = alertIsOpen ?\n    height - alertContainerHeight :\n    height - rowMessageHeight;\n    let data;\n    if (cache && query.cached) {\n      data = cachedData;\n    } else\n    if (results != null && results.data) {\n      ({ data } = results);\n    }\n    if (data && data.length > 0) {\n      const expandedColumns = results.expanded_columns ?\n      results.expanded_columns.map((col) => col.column_name) :\n      [];\n      const allowHTML = getItem(LocalStorageKeys.SqllabIsRenderHtmlEnabled, false);\n      return _jsxs(ResultContainer, { children: [\n        renderControls(),\n        showSql && showSqlInline ? _jsxs(_Fragment, { children: [\n          _jsxs(\"div\", { css: css`\n                  display: flex;\n                  justify-content: space-between;\n                  gap: ${GAP}px;\n                `, children: [\n            _jsx(Card, { css: [\n              css`\n                      height: 28px;\n                      width: calc(100% - ${ROWS_CHIP_WIDTH + GAP}px);\n                      code {\n                        width: 100%;\n                        overflow: hidden;\n                        white-space: nowrap !important;\n                        text-overflow: ellipsis;\n                        display: block;\n                      }\n                    `, process.env.NODE_ENV === \"production\" ? \"\" : \";label:ResultSet;\", process.env.NODE_ENV === \"production\" ? \"\" : \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9hcHAvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL1NxbExhYi9jb21wb25lbnRzL1Jlc3VsdFNldC9pbmRleC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBbVlzQiIsImZpbGUiOiIvYXBwL3N1cGVyc2V0LWZyb250ZW5kL3NyYy9TcWxMYWIvY29tcG9uZW50cy9SZXN1bHRTZXQvaW5kZXgudHN4Iiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4gKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbiAqIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4gKiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4gKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4gKiBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4gKiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4gKiBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4gKiB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuaW1wb3J0IHsgdXNlQ2FsbGJhY2ssIHVzZUVmZmVjdCwgdXNlU3RhdGUsIG1lbW8sIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgc2hhbGxvd0VxdWFsLCB1c2VEaXNwYXRjaCwgdXNlU2VsZWN0b3IgfSBmcm9tICdyZWFjdC1yZWR1eCc7XG5pbXBvcnQgeyB1c2VIaXN0b3J5IH0gZnJvbSAncmVhY3Qtcm91dGVyLWRvbSc7XG5pbXBvcnQgeyBwaWNrIH0gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBCdXR0b25Hcm91cCBmcm9tICdzcmMvY29tcG9uZW50cy9CdXR0b25Hcm91cCc7XG5pbXBvcnQgQWxlcnQgZnJvbSAnc3JjL2NvbXBvbmVudHMvQWxlcnQnO1xuaW1wb3J0IEJ1dHRvbiBmcm9tICdzcmMvY29tcG9uZW50cy9CdXR0b24nO1xuaW1wb3J0IHsgbmFub2lkIH0gZnJvbSAnbmFub2lkJztcbmltcG9ydCB7IFF1ZXJ5U3RhdGUsIHN0eWxlZCwgdCwgdG4sIHVzZVRoZW1lLCB1c2VQcmV2aW91cywgY3NzLCBnZXROdW1iZXJGb3JtYXR0ZXIsIGdldEV4dGVuc2lvbnNSZWdpc3RyeSwgfSBmcm9tICdAc3VwZXJzZXQtdWkvY29yZSc7XG5pbXBvcnQgRXJyb3JNZXNzYWdlV2l0aFN0YWNrVHJhY2UgZnJvbSAnc3JjL2NvbXBvbmVudHMvRXJyb3JNZXNzYWdlL0Vycm9yTWVzc2FnZVdpdGhTdGFja1RyYWNlJztcbmltcG9ydCB7IFNhdmVEYXRhc2V0TW9kYWwsIH0gZnJvbSAnc3JjL1NxbExhYi9jb21wb25lbnRzL1NhdmVEYXRhc2V0TW9kYWwnO1xuaW1wb3J0IHsgRVhQTE9SRV9DSEFSVF9ERUZBVUxUIH0gZnJvbSAnc3JjL1NxbExhYi90eXBlcyc7XG5pbXBvcnQgeyBtb3VudEV4cGxvcmVVcmwgfSBmcm9tICdzcmMvZXhwbG9yZS9leHBsb3JlVXRpbHMnO1xuaW1wb3J0IHsgcG9zdEZvcm1EYXRhIH0gZnJvbSAnc3JjL2V4cGxvcmUvZXhwbG9yZVV0aWxzL2Zvcm1EYXRhJztcbmltcG9ydCBQcm9ncmVzc0JhciBmcm9tICdzcmMvY29tcG9uZW50cy9Qcm9ncmVzc0Jhcic7XG5pbXBvcnQgTG9hZGluZyBmcm9tICdzcmMvY29tcG9uZW50cy9Mb2FkaW5nJztcbmltcG9ydCBDYXJkIGZyb20gJ3NyYy9jb21wb25lbnRzL0NhcmQnO1xuaW1wb3J0IExhYmVsIGZyb20gJ3NyYy9jb21wb25lbnRzL0xhYmVsJztcbmltcG9ydCB7IFRvb2x0aXAgfSBmcm9tICdzcmMvY29tcG9uZW50cy9Ub29sdGlwJztcbmltcG9ydCBGaWx0ZXJhYmxlVGFibGUgZnJvbSAnc3JjL2NvbXBvbmVudHMvRmlsdGVyYWJsZVRhYmxlJztcbmltcG9ydCBDb3B5VG9DbGlwYm9hcmQgZnJvbSAnc3JjL2NvbXBvbmVudHMvQ29weVRvQ2xpcGJvYXJkJztcbmltcG9ydCB7IGFkZERhbmdlclRvYXN0IH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvTWVzc2FnZVRvYXN0cy9hY3Rpb25zJztcbmltcG9ydCB7IHByZXBhcmVDb3B5VG9DbGlwYm9hcmRUYWJ1bGFyRGF0YSB9IGZyb20gJ3NyYy91dGlscy9jb21tb24nO1xuaW1wb3J0IHsgZ2V0SXRlbSwgTG9jYWxTdG9yYWdlS2V5cyB9IGZyb20gJ3NyYy91dGlscy9sb2NhbFN0b3JhZ2VIZWxwZXJzJztcbmltcG9ydCB7IGFkZFF1ZXJ5RWRpdG9yLCBjbGVhclF1ZXJ5UmVzdWx0cywgQ3Rhc0VudW0sIGZldGNoUXVlcnlSZXN1bHRzLCByZUZldGNoUXVlcnlSZXN1bHRzLCByZVJ1blF1ZXJ5LCB9IGZyb20gJ3NyYy9TcWxMYWIvYWN0aW9ucy9zcWxMYWInO1xuaW1wb3J0IHsgVVJMX1BBUkFNUyB9IGZyb20gJ3NyYy9jb25zdGFudHMnO1xuaW1wb3J0IHVzZUxvZ0FjdGlvbiBmcm9tICdzcmMvbG9nZ2VyL3VzZUxvZ0FjdGlvbic7XG5pbXBvcnQgeyBMT0dfQUNUSU9OU19TUUxMQUJfQ09QWV9SRVNVTFRfVE9fQ0xJUEJPQVJELCBMT0dfQUNUSU9OU19TUUxMQUJfQ1JFQVRFX0NIQVJULCBMT0dfQUNUSU9OU19TUUxMQUJfRE9XTkxPQURfQ1NWLCB9IGZyb20gJ3NyYy9sb2dnZXIvTG9nVXRpbHMnO1xuaW1wb3J0IEljb25zIGZyb20gJ3NyYy9jb21wb25lbnRzL0ljb25zJztcbmltcG9ydCB7IGZpbmRQZXJtaXNzaW9uIH0gZnJvbSAnc3JjL3V0aWxzL2ZpbmRQZXJtaXNzaW9uJztcbmltcG9ydCBFeHBsb3JlQ3Rhc1Jlc3VsdHNCdXR0b24gZnJvbSAnLi4vRXhwbG9yZUN0YXNSZXN1bHRzQnV0dG9uJztcbmltcG9ydCBFeHBsb3JlUmVzdWx0c0J1dHRvbiBmcm9tICcuLi9FeHBsb3JlUmVzdWx0c0J1dHRvbic7XG5pbXBvcnQgSGlnaGxpZ2h0ZWRTcWwgZnJvbSAnLi4vSGlnaGxpZ2h0ZWRTcWwnO1xuaW1wb3J0IFF1ZXJ5U3RhdGVMYWJlbCBmcm9tICcuLi9RdWVyeVN0YXRlTGFiZWwnO1xudmFyIExpbWl0aW5nRmFjdG9yO1xuKGZ1bmN0aW9uIChMaW1pdGluZ0ZhY3Rvcikge1xuICAgIExpbWl0aW5nRmFjdG9yW1wiUXVlcnlcIl0gPSBcIlFVRVJZXCI7XG4gICAgTGltaXRpbmdGYWN0b3JbXCJRdWVyeUFuZERyb3Bkb3duXCJdID0gXCJRVUVSWV9BTkRfRFJPUERPV05cIjtcbiAgICBMaW1pdGluZ0ZhY3RvcltcIkRyb3Bkb3duXCJdID0gXCJEUk9QRE9XTlwiO1xuICAgIExpbWl0aW5nRmFjdG9yW1wiTm90TGltaXRlZFwiXSA9IFwiTk9UX0xJTUlURURcIjtcbn0pKExpbWl0aW5nRmFjdG9yIHx8IChMaW1pdGluZ0ZhY3RvciA9IHt9KSk7XG5jb25zdCBSZXN1bHRDb250YWluZXIgPSBzdHlsZWQuZGl2IGBcbiAgZGlzcGxheTogZmxleDtcbiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAgcm93LWdhcDogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5ncmlkVW5pdCAqIDJ9cHg7XG5gO1xuY29uc3QgUmVzdWx0bGVzc1N0eWxlcyA9IHN0eWxlZC5kaXYgYFxuICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gIG1pbi1oZWlnaHQ6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuZ3JpZFVuaXQgKiAyNX1weDtcbiAgW3JvbGU9J2FsZXJ0J10ge1xuICAgIG1hcmdpbi10b3A6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuZ3JpZFVuaXQgKiAyfXB4O1xuICB9XG4gIC5zcWwtcmVzdWx0LXRyYWNrLWpvYiB7XG4gICAgbWFyZ2luLXRvcDogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5ncmlkVW5pdCAqIDJ9cHg7XG4gIH1cbmA7XG4vLyBNYWtpbmcgdGV4dCByZW5kZXIgbGluZSBicmVha3MvdGFicyBhcyBpcyBhcyBtb25vc3BhY2UsXG4vLyBidXQgd3JhcHBpbmcgdGV4dCB0b28gc28gdGV4dCBkb2Vzbid0IG92ZXJmbG93XG5jb25zdCBNb25vc3BhY2VEaXYgPSBzdHlsZWQuZGl2IGBcbiAgZm9udC1mYW1pbHk6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUudHlwb2dyYXBoeS5mYW1pbGllcy5tb25vc3BhY2V9O1xuICB3aGl0ZS1zcGFjZTogcHJlO1xuICB3b3JkLWJyZWFrOiBicmVhay13b3JkO1xuICBvdmVyZmxvdy14OiBhdXRvO1xuICB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7XG5gO1xuY29uc3QgUmV0dXJuZWRSb3dzID0gc3R5bGVkLmRpdiBgXG4gIGZvbnQtc2l6ZTogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS50eXBvZ3JhcGh5LnNpemVzLnN9cHg7XG4gIGxpbmUtaGVpZ2h0OiAxO1xuYDtcbmNvbnN0IFJlc3VsdFNldENvbnRyb2xzID0gc3R5bGVkLmRpdiBgXG4gIGRpc3BsYXk6IGZsZXg7XG4gIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjtcbmA7XG5jb25zdCBSZXN1bHRTZXRCdXR0b25zID0gc3R5bGVkLmRpdiBgXG4gIGRpc3BsYXk6IGdyaWQ7XG4gIGdyaWQtYXV0by1mbG93OiBjb2x1bW47XG4gIHBhZGRpbmctcmlnaHQ6ICR7KHsgdGhlbWUgfSkgPT4gMiAqIHRoZW1lLmdyaWRVbml0fXB4O1xuYDtcbmNvbnN0IFJPV1NfQ0hJUF9XSURUSCA9IDEwMDtcbmNvbnN0IEdBUCA9IDg7XG5jb25zdCBleHRlbnNpb25zUmVnaXN0cnkgPSBnZXRFeHRlbnNpb25zUmVnaXN0cnkoKTtcbmNvbnN0IFJlc3VsdFNldCA9ICh7IGNhY2hlID0gZmFsc2UsIGNzdiA9IHRydWUsIGRhdGFiYXNlID0ge30sIGRpc3BsYXlMaW1pdCwgaGVpZ2h0LCBxdWVyeUlkLCBzZWFyY2ggPSB0cnVlLCBzaG93U3FsID0gZmFsc2UsIHNob3dTcWxJbmxpbmUgPSBmYWxzZSwgdmlzdWFsaXplID0gdHJ1ZSwgZGVmYXVsdFF1ZXJ5TGltaXQsIH0pID0+IHtcbiAgICBjb25zdCB1c2VyID0gdXNlU2VsZWN0b3IoKHsgdXNlciB9KSA9PiB1c2VyLCBzaGFsbG93RXF1YWwpO1xuICAgIGNvbnN0IHF1ZXJ5ID0gdXNlU2VsZWN0b3IoKHsgc3FsTGFiOiB7IHF1ZXJpZXMgfSB9KSA9PiBwaWNrKHF1ZXJpZXNbcXVlcnlJZF0sIFtcbiAgICAgICAgJ2lkJyxcbiAgICAgICAgJ2Vycm9yTWVzc2FnZScsXG4gICAgICAgICdjYWNoZWQnLFxuICAgICAgICAncmVzdWx0cycsXG4gICAgICAgICdyZXN1bHRzS2V5JyxcbiAgICAgICAgJ2RiSWQnLFxuICAgICAgICAndGFiJyxcbiAgICAgICAgJ3NxbCcsXG4gICAgICAgICdzcWxFZGl0b3JJZCcsXG4gICAgICAgICd0ZW1wbGF0ZVBhcmFtcycsXG4gICAgICAgICdzY2hlbWEnLFxuICAgICAgICAncm93cycsXG4gICAgICAgICdxdWVyeUxpbWl0JyxcbiAgICAgICAgJ2xpbWl0aW5nRmFjdG9yJyxcbiAgICAgICAgJ3RyYWNraW5nVXJsJyxcbiAgICAgICAgJ3N0YXRlJyxcbiAgICAgICAgJ2Vycm9ycycsXG4gICAgICAgICdsaW5rJyxcbiAgICAgICAgJ2N0YXMnLFxuICAgICAgICAnY3Rhc19tZXRob2QnLFxuICAgICAgICAndGVtcFNjaGVtYScsXG4gICAgICAgICd0ZW1wVGFibGUnLFxuICAgICAgICAnaXNEYXRhUHJldmlldycsXG4gICAgICAgICdwcm9ncmVzcycsXG4gICAgICAgICdleHRyYScsXG4gICAgXSksIHNoYWxsb3dFcXVhbCk7XG4gICAgY29uc3QgUmVzdWx0VGFibGUgPSBleHRlbnNpb25zUmVnaXN0cnkuZ2V0KCdzcWxlZGl0b3IuZXh0ZW5zaW9uLnJlc3VsdFRhYmxlJykgPz9cbiAgICAgICAgRmlsdGVyYWJsZVRhYmxlO1xuICAgIGNvbnN0IHRoZW1lID0gdXNlVGhlbWUoKTtcbiAgICBjb25zdCBbc2VhcmNoVGV4dCwgc2V0U2VhcmNoVGV4dF0gPSB1c2VTdGF0ZSgnJyk7XG4gICAgY29uc3QgW2NhY2hlZERhdGEsIHNldENhY2hlZERhdGFdID0gdXNlU3RhdGUoW10pO1xuICAgIGNvbnN0IFtzaG93U2F2ZURhdGFzZXRNb2RhbCwgc2V0U2hvd1NhdmVEYXRhc2V0TW9kYWxdID0gdXNlU3RhdGUoZmFsc2UpO1xuICAgIGNvbnN0IFthbGVydElzT3Blbiwgc2V0QWxlcnRJc09wZW5dID0gdXNlU3RhdGUoZmFsc2UpO1xuICAgIGNvbnN0IGhpc3RvcnkgPSB1c2VIaXN0b3J5KCk7XG4gICAgY29uc3QgZGlzcGF0Y2ggPSB1c2VEaXNwYXRjaCgpO1xuICAgIGNvbnN0IGxvZ0FjdGlvbiA9IHVzZUxvZ0FjdGlvbih7IHF1ZXJ5SWQsIHNxbEVkaXRvcklkOiBxdWVyeS5zcWxFZGl0b3JJZCB9KTtcbiAgICBjb25zdCByZVJ1blF1ZXJ5SWZTZXNzaW9uVGltZW91dEVycm9yT25Nb3VudCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgICAgaWYgKHF1ZXJ5LmVycm9yTWVzc2FnZSAmJlxuICAgICAgICAgICAgcXVlcnkuZXJyb3JNZXNzYWdlLmluZGV4T2YoJ3Nlc3Npb24gdGltZWQgb3V0JykgPiAwKSB7XG4gICAgICAgICAgICBkaXNwYXRjaChyZVJ1blF1ZXJ5KHF1ZXJ5KSk7XG4gICAgICAgIH1cbiAgICB9LCBbXSk7XG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgLy8gb25seSBkbyB0aGlzIHRoZSBmaXJzdCB0aW1lIHRoZSBjb21wb25lbnQgaXMgcmVuZGVyZWQvbW91bnRlZFxuICAgICAgICByZVJ1blF1ZXJ5SWZTZXNzaW9uVGltZW91dEVycm9yT25Nb3VudCgpO1xuICAgIH0sIFtyZVJ1blF1ZXJ5SWZTZXNzaW9uVGltZW91dEVycm9yT25Nb3VudF0pO1xuICAgIGNvbnN0IGZldGNoUmVzdWx0cyA9IChxKSA9PiB7XG4gICAgICAgIGRpc3BhdGNoKGZldGNoUXVlcnlSZXN1bHRzKHEsIGRpc3BsYXlMaW1pdCkpO1xuICAgIH07XG4gICAgY29uc3QgcHJldlF1ZXJ5ID0gdXNlUHJldmlvdXMocXVlcnkpO1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIGlmIChjYWNoZSAmJiBxdWVyeS5jYWNoZWQgJiYgcXVlcnk/LnJlc3VsdHM/LmRhdGE/Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHNldENhY2hlZERhdGEocXVlcnkucmVzdWx0cy5kYXRhKTtcbiAgICAgICAgICAgIGRpc3BhdGNoKGNsZWFyUXVlcnlSZXN1bHRzKHF1ZXJ5KSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHF1ZXJ5LnJlc3VsdHNLZXkgJiYgcXVlcnkucmVzdWx0c0tleSAhPT0gcHJldlF1ZXJ5Py5yZXN1bHRzS2V5KSB7XG4gICAgICAgICAgICBmZXRjaFJlc3VsdHMocXVlcnkpO1xuICAgICAgICB9XG4gICAgfSwgW3F1ZXJ5LCBjYWNoZV0pO1xuICAgIGNvbnN0IGNhbGN1bGF0ZUFsZXJ0UmVmSGVpZ2h0ID0gKGFsZXJ0RWxlbWVudCkgPT4ge1xuICAgICAgICBpZiAoYWxlcnRFbGVtZW50KSB7XG4gICAgICAgICAgICBzZXRBbGVydElzT3Blbih0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHNldEFsZXJ0SXNPcGVuKGZhbHNlKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgY29uc3QgcG9wU2VsZWN0U3RhciA9ICh0ZW1wU2NoZW1hLCB0ZW1wVGFibGUpID0+IHtcbiAgICAgICAgY29uc3QgcWUgPSB7XG4gICAgICAgICAgICBpZDogbmFub2lkKDExKSxcbiAgICAgICAgICAgIG5hbWU6IHRlbXBUYWJsZSxcbiAgICAgICAgICAgIGF1dG9ydW46IGZhbHNlLFxuICAgICAgICAgICAgZGJJZDogcXVlcnkuZGJJZCxcbiAgICAgICAgICAgIHNxbDogYFNFTEVDVCAqIEZST00gJHt0ZW1wU2NoZW1hID8gYCR7dGVtcFNjaGVtYX0uYCA6ICcnfSR7dGVtcFRhYmxlfWAsXG4gICAgICAgIH07XG4gICAgICAgIGRpc3BhdGNoKGFkZFF1ZXJ5RWRpdG9yKHFlKSk7XG4gICAgfTtcbiAgICBjb25zdCBjaGFuZ2VTZWFyY2ggPSAoZXZlbnQpID0+IHtcbiAgICAgICAgc2V0U2VhcmNoVGV4dChldmVudC50YXJnZXQudmFsdWUpO1xuICAgIH07XG4gICAgY29uc3QgY3JlYXRlRXhwbG9yZVJlc3VsdHNPbkNsaWNrID0gYXN5bmMgKGNsaWNrRXZlbnQpID0+IHtcbiAgICAgICAgY29uc3QgeyByZXN1bHRzIH0gPSBxdWVyeTtcbiAgICAgICAgY29uc3Qgb3BlbkluTmV3V2luZG93ID0gY2xpY2tFdmVudC5tZXRhS2V5O1xuICAgICAgICBsb2dBY3Rpb24oTE9HX0FDVElPTlNfU1FMTEFCX0NSRUFURV9DSEFSVCwge30pO1xuICAgICAgICBpZiAocmVzdWx0cz8ucXVlcnlfaWQpIHtcbiAgICAgICAgICAgIGNvbnN0IGtleSA9IGF3YWl0IHBvc3RGb3JtRGF0YShyZXN1bHRzLnF1ZXJ5X2lkLCAncXVlcnknLCB7XG4gICAgICAgICAgICAgICAgLi4uRVhQTE9SRV9DSEFSVF9ERUZBVUxULFxuICAgICAgICAgICAgICAgIGRhdGFzb3VyY2U6IGAke3Jlc3VsdHMucXVlcnlfaWR9X19xdWVyeWAsXG4gICAgICAgICAgICAgICAgLi4ue1xuICAgICAgICAgICAgICAgICAgICBhbGxfY29sdW1uczogcmVzdWx0cy5jb2x1bW5zLm1hcChjb2x1bW4gPT4gY29sdW1uLmNvbHVtbl9uYW1lKSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zdCB1cmwgPSBtb3VudEV4cGxvcmVVcmwobnVsbCwge1xuICAgICAgICAgICAgICAgIFtVUkxfUEFSQU1TLmZvcm1EYXRhS2V5Lm5hbWVdOiBrZXksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChvcGVuSW5OZXdXaW5kb3cpIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cub3Blbih1cmwsICdfYmxhbmsnLCAnbm9yZWZlcnJlcicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaGlzdG9yeS5wdXNoKHVybCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBhZGREYW5nZXJUb2FzdCh0KCdVbmFibGUgdG8gY3JlYXRlIGNoYXJ0IHdpdGhvdXQgYSBxdWVyeSBpZC4nKSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IGdldEV4cG9ydENzdlVybCA9IChjbGllbnRJZCkgPT4gYC9hcGkvdjEvc3FsbGFiL2V4cG9ydC8ke2NsaWVudElkfS9gO1xuICAgIGNvbnN0IHJlbmRlckNvbnRyb2xzID0gKCkgPT4ge1xuICAgICAgICBpZiAoc2VhcmNoIHx8IHZpc3VhbGl6ZSB8fCBjc3YpIHtcbiAgICAgICAgICAgIGxldCB7IGRhdGEgfSA9IHF1ZXJ5LnJlc3VsdHM7XG4gICAgICAgICAgICBpZiAoY2FjaGUgJiYgcXVlcnkuY2FjaGVkKSB7XG4gICAgICAgICAgICAgICAgZGF0YSA9IGNhY2hlZERhdGE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB7IGNvbHVtbnMgfSA9IHF1ZXJ5LnJlc3VsdHM7XG4gICAgICAgICAgICAvLyBBZGRlZCBjb21wdXRlIGxvZ2ljIHRvIHN0b3AgdXNlciBmcm9tIGJlaW5nIGFibGUgdG8gU2F2ZSAmIEV4cGxvcmVcbiAgICAgICAgICAgIGNvbnN0IGRhdGFzb3VyY2UgPSB7XG4gICAgICAgICAgICAgICAgY29sdW1uczogcXVlcnkucmVzdWx0cy5jb2x1bW5zLFxuICAgICAgICAgICAgICAgIG5hbWU6IHF1ZXJ5Py50YWIgfHwgJ1VudGl0bGVkJyxcbiAgICAgICAgICAgICAgICBkYklkOiBxdWVyeT8uZGJJZCxcbiAgICAgICAgICAgICAgICBzcWw6IHF1ZXJ5Py5zcWwsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVQYXJhbXM6IHF1ZXJ5Py50ZW1wbGF0ZVBhcmFtcyxcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHF1ZXJ5Py5zY2hlbWEsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29uc3QgY2FuRXhwb3J0RGF0YSA9IGZpbmRQZXJtaXNzaW9uKCdjYW5fZXhwb3J0X2NzdicsICdTUUxMYWInLCB1c2VyPy5yb2xlcyk7XG4gICAgICAgICAgICByZXR1cm4gKDxSZXN1bHRTZXRDb250cm9scz5cbiAgICAgICAgICA8U2F2ZURhdGFzZXRNb2RhbCB2aXNpYmxlPXtzaG93U2F2ZURhdGFzZXRNb2RhbH0gb25IaWRlPXsoKSA9PiBzZXRTaG93U2F2ZURhdGFzZXRNb2RhbChmYWxzZSl9IGJ1dHRvblRleHRPblNhdmU9e3QoJ1NhdmUgJiBFeHBsb3JlJyl9IGJ1dHRvblRleHRPbk92ZXJ3cml0ZT17dCgnT3ZlcndyaXRlICYgRXhwbG9yZScpfSBtb2RhbERlc2NyaXB0aW9uPXt0KCdTYXZlIHRoaXMgcXVlcnkgYXMgYSB2aXJ0dWFsIGRhdGFzZXQgdG8gY29udGludWUgZXhwbG9yaW5nJyl9IGRhdGFzb3VyY2U9e2RhdGFzb3VyY2V9Lz5cbiAgICAgICAgICA8UmVzdWx0U2V0QnV0dG9ucz5cbiAgICAgICAgICAgIHt2aXN1YWxpemUgJiYgZGF0YWJhc2U/LmFsbG93c192aXJ0dWFsX3RhYmxlX2V4cGxvcmUgJiYgKDxFeHBsb3JlUmVzdWx0c0J1dHRvbiBkYXRhYmFzZT17ZGF0YWJhc2V9IG9uQ2xpY2s9e2NyZWF0ZUV4cGxvcmVSZXN1bHRzT25DbGlja30vPil9XG4gICAgICAgICAgICB7Y3N2ICYmIGNhbkV4cG9ydERhdGEgJiYgKDxCdXR0b24gYnV0dG9uU2l6ZT1cInNtYWxsXCIgaHJlZj17Z2V0RXhwb3J0Q3N2VXJsKHF1ZXJ5LmlkKX0gZGF0YS10ZXN0PVwiZXhwb3J0LWNzdi1idXR0b25cIiBvbkNsaWNrPXsoKSA9PiBsb2dBY3Rpb24oTE9HX0FDVElPTlNfU1FMTEFCX0RPV05MT0FEX0NTViwge30pfT5cbiAgICAgICAgICAgICAgICA8aSBjbGFzc05hbWU9XCJmYSBmYS1maWxlLXRleHQtb1wiLz4ge3QoJ0Rvd25sb2FkIHRvIENTVicpfVxuICAgICAgICAgICAgICA8L0J1dHRvbj4pfVxuXG4gICAgICAgICAgICB7Y2FuRXhwb3J0RGF0YSAmJiAoPENvcHlUb0NsaXBib2FyZCB0ZXh0PXtwcmVwYXJlQ29weVRvQ2xpcGJvYXJkVGFidWxhckRhdGEoZGF0YSwgY29sdW1ucyl9IHdyYXBwZWQ9e2ZhbHNlfSBjb3B5Tm9kZT17PEJ1dHRvbiBidXR0b25TaXplPVwic21hbGxcIiBkYXRhLXRlc3Q9XCJjb3B5LXRvLWNsaXBib2FyZC1idXR0b25cIj5cbiAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3NOYW1lPVwiZmEgZmEtY2xpcGJvYXJkXCIvPiB7dCgnQ29weSB0byBDbGlwYm9hcmQnKX1cbiAgICAgICAgICAgICAgICAgIDwvQnV0dG9uPn0gaGlkZVRvb2x0aXAgb25Db3B5RW5kPXsoKSA9PiBsb2dBY3Rpb24oTE9HX0FDVElPTlNfU1FMTEFCX0NPUFlfUkVTVUxUX1RPX0NMSVBCT0FSRCwge30pfS8+KX1cbiAgICAgICAgICA8L1Jlc3VsdFNldEJ1dHRvbnM+XG4gICAgICAgICAge3NlYXJjaCAmJiAoPGlucHV0IHR5cGU9XCJ0ZXh0XCIgb25DaGFuZ2U9e2NoYW5nZVNlYXJjaH0gdmFsdWU9e3NlYXJjaFRleHR9IGNsYXNzTmFtZT1cImZvcm0tY29udHJvbCBpbnB1dC1zbVwiIHBsYWNlaG9sZGVyPXt0KCdGaWx0ZXIgcmVzdWx0cycpfS8+KX1cbiAgICAgICAgPC9SZXN1bHRTZXRDb250cm9scz4pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiA8ZGl2IC8+O1xuICAgIH07XG4gICAgY29uc3QgcmVuZGVyUm93c1JldHVybmVkID0gKGFsZXJ0TWVzc2FnZSkgPT4ge1xuICAgICAgICBjb25zdCB7IHJlc3VsdHMsIHJvd3MsIHF1ZXJ5TGltaXQsIGxpbWl0aW5nRmFjdG9yIH0gPSBxdWVyeTtcbiAgICAgICAgbGV0IGxpbWl0TWVzc2FnZSA9ICcnO1xuICAgICAgICBjb25zdCBsaW1pdFJlYWNoZWQgPSByZXN1bHRzPy5kaXNwbGF5TGltaXRSZWFjaGVkO1xuICAgICAgICBjb25zdCBsaW1pdCA9IHF1ZXJ5TGltaXQgfHwgcmVzdWx0cy5xdWVyeS5saW1pdDtcbiAgICAgICAgY29uc3QgaXNBZG1pbiA9ICEhdXNlcj8ucm9sZXM/LkFkbWluO1xuICAgICAgICBjb25zdCByb3dzQ291bnQgPSBNYXRoLm1pbihyb3dzIHx8IDAsIHJlc3VsdHM/LmRhdGE/Lmxlbmd0aCB8fCAwKTtcbiAgICAgICAgY29uc3QgZGlzcGxheU1heFJvd3NSZWFjaGVkTWVzc2FnZSA9IHtcbiAgICAgICAgICAgIHdpdGhBZG1pbjogdCgnVGhlIG51bWJlciBvZiByZXN1bHRzIGRpc3BsYXllZCBpcyBsaW1pdGVkIHRvICUocm93cylkIGJ5IHRoZSBjb25maWd1cmF0aW9uIERJU1BMQVlfTUFYX1JPVy4gJyArXG4gICAgICAgICAgICAgICAgJ1BsZWFzZSBhZGQgYWRkaXRpb25hbCBsaW1pdHMvZmlsdGVycyBvciBkb3dubG9hZCB0byBjc3YgdG8gc2VlIG1vcmUgcm93cyB1cCB0byAnICtcbiAgICAgICAgICAgICAgICAndGhlICUobGltaXQpZCBsaW1pdC4nLCB7IHJvd3M6IHJvd3NDb3VudCwgbGltaXQgfSksXG4gICAgICAgICAgICB3aXRob3V0QWRtaW46IHQoJ1RoZSBudW1iZXIgb2YgcmVzdWx0cyBkaXNwbGF5ZWQgaXMgbGltaXRlZCB0byAlKHJvd3MpZC4gJyArXG4gICAgICAgICAgICAgICAgJ1BsZWFzZSBhZGQgYWRkaXRpb25hbCBsaW1pdHMvZmlsdGVycywgZG93bmxvYWQgdG8gY3N2LCBvciBjb250YWN0IGFuIGFkbWluICcgK1xuICAgICAgICAgICAgICAgICd0byBzZWUgbW9yZSByb3dzIHVwIHRvIHRoZSAlKGxpbWl0KWQgbGltaXQuJywgeyByb3dzOiByb3dzQ291bnQsIGxpbWl0IH0pLFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBzaG91bGRVc2VEZWZhdWx0RHJvcGRvd25BbGVydCA9IGxpbWl0ID09PSBkZWZhdWx0UXVlcnlMaW1pdCAmJiBsaW1pdGluZ0ZhY3RvciA9PT0gTGltaXRpbmdGYWN0b3IuRHJvcGRvd247XG4gICAgICAgIGlmIChsaW1pdGluZ0ZhY3RvciA9PT0gTGltaXRpbmdGYWN0b3IuUXVlcnkgJiYgY3N2KSB7XG4gICAgICAgICAgICBsaW1pdE1lc3NhZ2UgPSB0KCdUaGUgbnVtYmVyIG9mIHJvd3MgZGlzcGxheWVkIGlzIGxpbWl0ZWQgdG8gJShyb3dzKWQgYnkgdGhlIHF1ZXJ5JywgeyByb3dzIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGxpbWl0aW5nRmFjdG9yID09PSBMaW1pdGluZ0ZhY3Rvci5Ecm9wZG93biAmJlxuICAgICAgICAgICAgIXNob3VsZFVzZURlZmF1bHREcm9wZG93bkFsZXJ0KSB7XG4gICAgICAgICAgICBsaW1pdE1lc3NhZ2UgPSB0KCdUaGUgbnVtYmVyIG9mIHJvd3MgZGlzcGxheWVkIGlzIGxpbWl0ZWQgdG8gJShyb3dzKWQgYnkgdGhlIGxpbWl0IGRyb3Bkb3duLicsIHsgcm93cyB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChsaW1pdGluZ0ZhY3RvciA9PT0gTGltaXRpbmdGYWN0b3IuUXVlcnlBbmREcm9wZG93bikge1xuICAgICAgICAgICAgbGltaXRNZXNzYWdlID0gdCgnVGhlIG51bWJlciBvZiByb3dzIGRpc3BsYXllZCBpcyBsaW1pdGVkIHRvICUocm93cylkIGJ5IHRoZSBxdWVyeSBhbmQgbGltaXQgZHJvcGRvd24uJywgeyByb3dzIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGZvcm1hdHRlZFJvd0NvdW50ID0gZ2V0TnVtYmVyRm9ybWF0dGVyKCkocm93cyk7XG4gICAgICAgIGNvbnN0IHJvd3NSZXR1cm5lZE1lc3NhZ2UgPSB0KCclKHJvd3MpZCByb3dzIHJldHVybmVkJywge1xuICAgICAgICAgICAgcm93cyxcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHRvb2x0aXBUZXh0ID0gYCR7cm93c1JldHVybmVkTWVzc2FnZX0uICR7bGltaXRNZXNzYWdlfWA7XG4gICAgICAgIGlmIChhbGVydE1lc3NhZ2UpIHtcbiAgICAgICAgICAgIHJldHVybiAoPD5cbiAgICAgICAgICB7IWxpbWl0UmVhY2hlZCAmJiBzaG91bGRVc2VEZWZhdWx0RHJvcGRvd25BbGVydCAmJiAoPGRpdiByZWY9e2NhbGN1bGF0ZUFsZXJ0UmVmSGVpZ2h0fT5cbiAgICAgICAgICAgICAgPEFsZXJ0IHR5cGU9XCJ3YXJuaW5nXCIgbWVzc2FnZT17dCgnJShyb3dzKWQgcm93cyByZXR1cm5lZCcsIHsgcm93cyB9KX0gb25DbG9zZT17KCkgPT4gc2V0QWxlcnRJc09wZW4oZmFsc2UpfSBkZXNjcmlwdGlvbj17dCgnVGhlIG51bWJlciBvZiByb3dzIGRpc3BsYXllZCBpcyBsaW1pdGVkIHRvICUocm93cylkIGJ5IHRoZSBkcm9wZG93bi4nLCB7IHJvd3MgfSl9Lz5cbiAgICAgICAgICAgIDwvZGl2Pil9XG4gICAgICAgICAge2xpbWl0UmVhY2hlZCAmJiAoPGRpdiByZWY9e2NhbGN1bGF0ZUFsZXJ0UmVmSGVpZ2h0fT5cbiAgICAgICAgICAgICAgPEFsZXJ0IHR5cGU9XCJ3YXJuaW5nXCIgb25DbG9zZT17KCkgPT4gc2V0QWxlcnRJc09wZW4oZmFsc2UpfSBtZXNzYWdlPXt0KCclKHJvd3MpZCByb3dzIHJldHVybmVkJywgeyByb3dzOiByb3dzQ291bnQgfSl9IGRlc2NyaXB0aW9uPXtpc0FkbWluXG4gICAgICAgICAgICAgICAgICAgICAgICA/IGRpc3BsYXlNYXhSb3dzUmVhY2hlZE1lc3NhZ2Uud2l0aEFkbWluXG4gICAgICAgICAgICAgICAgICAgICAgICA6IGRpc3BsYXlNYXhSb3dzUmVhY2hlZE1lc3NhZ2Uud2l0aG91dEFkbWlufS8+XG4gICAgICAgICAgICA8L2Rpdj4pfVxuICAgICAgICA8Lz4pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNob3dSb3dzUmV0dXJuZWQgPSBzaG93U3FsSW5saW5lIHx8ICghbGltaXRSZWFjaGVkICYmICFzaG91bGRVc2VEZWZhdWx0RHJvcGRvd25BbGVydCk7XG4gICAgICAgIHJldHVybiAoPD5cbiAgICAgICAge3Nob3dSb3dzUmV0dXJuZWQgJiYgKDxSZXR1cm5lZFJvd3M+XG4gICAgICAgICAgICA8VG9vbHRpcCBpZD1cInNxbGxhYi1yb3djb3VudC10b29sdGlwXCIgdGl0bGU9e3Rvb2x0aXBUZXh0fSBwbGFjZW1lbnQ9XCJsZWZ0XCI+XG4gICAgICAgICAgICAgIDxMYWJlbCBjc3M9e2NzcyBgXG4gICAgICAgICAgICAgICAgICBsaW5lLWhlaWdodDogJHt0aGVtZS50eXBvZ3JhcGh5LnNpemVzLmx9cHg7XG4gICAgICAgICAgICAgICAgYH0+XG4gICAgICAgICAgICAgICAge2xpbWl0TWVzc2FnZSAmJiAoPEljb25zLkV4Y2xhbWF0aW9uQ2lyY2xlT3V0bGluZWQgY3NzPXtjc3MgYFxuICAgICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogJHt0aGVtZS50eXBvZ3JhcGh5LnNpemVzLm19cHg7XG4gICAgICAgICAgICAgICAgICAgICAgbWFyZ2luLXJpZ2h0OiAke3RoZW1lLmdyaWRVbml0fXB4O1xuICAgICAgICAgICAgICAgICAgICBgfS8+KX1cbiAgICAgICAgICAgICAgICB7dG4oJyVzIHJvdycsICclcyByb3dzJywgcm93cywgZm9ybWF0dGVkUm93Q291bnQpfVxuICAgICAgICAgICAgICA8L0xhYmVsPlxuICAgICAgICAgICAgPC9Ub29sdGlwPlxuICAgICAgICAgIDwvUmV0dXJuZWRSb3dzPil9XG4gICAgICA8Lz4pO1xuICAgIH07XG4gICAgY29uc3QgbGltaXRSZWFjaGVkID0gcXVlcnk/LnJlc3VsdHM/LmRpc3BsYXlMaW1pdFJlYWNoZWQ7XG4gICAgbGV0IHNxbDtcbiAgICBsZXQgZXhwbG9yZURCSWQgPSBxdWVyeS5kYklkO1xuICAgIGlmIChkYXRhYmFzZT8uZXhwbG9yZV9kYXRhYmFzZV9pZCkge1xuICAgICAgICBleHBsb3JlREJJZCA9IGRhdGFiYXNlLmV4cGxvcmVfZGF0YWJhc2VfaWQ7XG4gICAgfVxuICAgIGxldCB0cmFja2luZ1VybDtcbiAgICBpZiAocXVlcnkudHJhY2tpbmdVcmwgJiZcbiAgICAgICAgcXVlcnkuc3RhdGUgIT09IFF1ZXJ5U3RhdGUuU3VjY2VzcyAmJlxuICAgICAgICBxdWVyeS5zdGF0ZSAhPT0gUXVlcnlTdGF0ZS5GZXRjaGluZykge1xuICAgICAgICB0cmFja2luZ1VybCA9ICg8QnV0dG9uIGNsYXNzTmFtZT1cInNxbC1yZXN1bHQtdHJhY2stam9iXCIgYnV0dG9uU2l6ZT1cInNtYWxsXCIgaHJlZj17cXVlcnkudHJhY2tpbmdVcmx9IHRhcmdldD1cIl9ibGFua1wiPlxuICAgICAgICB7cXVlcnkuc3RhdGUgPT09IFF1ZXJ5U3RhdGUuUnVubmluZ1xuICAgICAgICAgICAgICAgID8gdCgnVHJhY2sgam9iJylcbiAgICAgICAgICAgICAgICA6IHQoJ1NlZSBxdWVyeSBkZXRhaWxzJyl9XG4gICAgICA8L0J1dHRvbj4pO1xuICAgIH1cbiAgICBpZiAoc2hvd1NxbCkge1xuICAgICAgICBzcWwgPSAoPEhpZ2hsaWdodGVkU3FsIHNxbD17cXVlcnkuc3FsfSB7Li4uKHNob3dTcWxJbmxpbmUgJiYgeyBtYXhMaW5lczogMSwgbWF4V2lkdGg6IDYwIH0pfS8+KTtcbiAgICB9XG4gICAgaWYgKHF1ZXJ5LnN0YXRlID09PSBRdWVyeVN0YXRlLlN0b3BwZWQpIHtcbiAgICAgICAgcmV0dXJuIDxBbGVydCB0eXBlPVwid2FybmluZ1wiIG1lc3NhZ2U9e3QoJ1F1ZXJ5IHdhcyBzdG9wcGVkJyl9Lz47XG4gICAgfVxuICAgIGlmIChxdWVyeS5zdGF0ZSA9PT0gUXVlcnlTdGF0ZS5GYWlsZWQpIHtcbiAgICAgICAgcmV0dXJuICg8UmVzdWx0bGVzc1N0eWxlcz5cbiAgICAgICAgPEVycm9yTWVzc2FnZVdpdGhTdGFja1RyYWNlIHRpdGxlPXt0KCdEYXRhYmFzZSBlcnJvcicpfSBlcnJvcj17cXVlcnk/LmV4dHJhPy5lcnJvcnM/LlswXSB8fCBxdWVyeT8uZXJyb3JzPy5bMF19IHN1YnRpdGxlPXs8TW9ub3NwYWNlRGl2PntxdWVyeS5lcnJvck1lc3NhZ2V9PC9Nb25vc3BhY2VEaXY+fSBjb3B5VGV4dD17cXVlcnkuZXJyb3JNZXNzYWdlIHx8IHVuZGVmaW5lZH0gbGluaz17cXVlcnkubGlua30gc291cmNlPVwic3FsbGFiXCIvPlxuICAgICAgICB7dHJhY2tpbmdVcmx9XG4gICAgICA8L1Jlc3VsdGxlc3NTdHlsZXM+KTtcbiAgICB9XG4gICAgaWYgKHF1ZXJ5LnN0YXRlID09PSBRdWVyeVN0YXRlLlN1Y2Nlc3MgJiYgcXVlcnkuY3Rhcykge1xuICAgICAgICBjb25zdCB7IHRlbXBTY2hlbWEsIHRlbXBUYWJsZSB9ID0gcXVlcnk7XG4gICAgICAgIGxldCBvYmplY3QgPSAnVGFibGUnO1xuICAgICAgICBpZiAocXVlcnkuY3Rhc19tZXRob2QgPT09IEN0YXNFbnVtLlZpZXcpIHtcbiAgICAgICAgICAgIG9iamVjdCA9ICdWaWV3JztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKDxkaXY+XG4gICAgICAgIDxBbGVydCB0eXBlPVwiaW5mb1wiIG1lc3NhZ2U9ezw+XG4gICAgICAgICAgICAgIHt0KG9iamVjdCl9IFtcbiAgICAgICAgICAgICAgPHN0cm9uZz5cbiAgICAgICAgICAgICAgICB7dGVtcFNjaGVtYSA/IGAke3RlbXBTY2hlbWF9LmAgOiAnJ31cbiAgICAgICAgICAgICAgICB7dGVtcFRhYmxlfVxuICAgICAgICAgICAgICA8L3N0cm9uZz5cbiAgICAgICAgICAgICAgXSB7dCgnd2FzIGNyZWF0ZWQnKX0gJm5ic3A7XG4gICAgICAgICAgICAgIDxCdXR0b25Hcm91cD5cbiAgICAgICAgICAgICAgICA8QnV0dG9uIGJ1dHRvblNpemU9XCJzbWFsbFwiIGNzcz17eyBtYXJnaW5SaWdodDogdGhlbWUuZ3JpZFVuaXQgfX0gb25DbGljaz17KCkgPT4gcG9wU2VsZWN0U3Rhcih0ZW1wU2NoZW1hLCB0ZW1wVGFibGUpfT5cbiAgICAgICAgICAgICAgICAgIHt0KCdRdWVyeSBpbiBhIG5ldyB0YWInKX1cbiAgICAgICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICAgICAgICA8RXhwbG9yZUN0YXNSZXN1bHRzQnV0dG9uIHRhYmxlPXt0ZW1wVGFibGV9IHNjaGVtYT17dGVtcFNjaGVtYX0gZGJJZD17ZXhwbG9yZURCSWR9Lz5cbiAgICAgICAgICAgICAgPC9CdXR0b25Hcm91cD5cbiAgICAgICAgICAgIDwvPn0vPlxuICAgICAgPC9kaXY+KTtcbiAgICB9XG4gICAgaWYgKHF1ZXJ5LnN0YXRlID09PSBRdWVyeVN0YXRlLlN1Y2Nlc3MgJiYgcXVlcnkucmVzdWx0cykge1xuICAgICAgICBjb25zdCB7IHJlc3VsdHMgfSA9IHF1ZXJ5O1xuICAgICAgICAvLyBBY2NvdW50cyBmb3Igb2Zmc2V0IG5lZWRlZCBmb3IgaGVpZ2h0IG9mIFJlc3VsdFNldFJvd3NSZXR1cm5lZCBjb21wb25lbnQgaWYgIWxpbWl0UmVhY2hlZFxuICAgICAgICBjb25zdCByb3dNZXNzYWdlSGVpZ2h0ID0gIWxpbWl0UmVhY2hlZCA/IDMyIDogMDtcbiAgICAgICAgLy8gQWNjb3VudHMgZm9yIG9mZnNldCBuZWVkZWQgZm9yIGhlaWdodCBvZiBBbGVydCBpZiB0aGlzLnN0YXRlLmFsZXJ0SXNPcGVuXG4gICAgICAgIGNvbnN0IGFsZXJ0Q29udGFpbmVySGVpZ2h0ID0gNzA7XG4gICAgICAgIC8vIFdlIG5lZWQgdG8gY2FsY3VsYXRlIHRoZSBoZWlnaHQgb2YgdGhpcy5yZW5kZXJSb3dzUmV0dXJuZWQoKVxuICAgICAgICAvLyBpZiB3ZSB3YW50IHJlc3VsdHMgcGFuZWwgdG8gYmUgcHJvcGVyIGhlaWdodCBiZWNhdXNlIHRoZVxuICAgICAgICAvLyBGaWx0ZXJUYWJsZSBjb21wb25lbnQgbmVlZHMgYW4gZXhwbGljaXQgaGVpZ2h0IHRvIHJlbmRlclxuICAgICAgICAvLyB0aGUgVGFibGUgY29tcG9uZW50XG4gICAgICAgIGNvbnN0IHJvd3NIZWlnaHQgPSBhbGVydElzT3BlblxuICAgICAgICAgICAgPyBoZWlnaHQgLSBhbGVydENvbnRhaW5lckhlaWdodFxuICAgICAgICAgICAgOiBoZWlnaHQgLSByb3dNZXNzYWdlSGVpZ2h0O1xuICAgICAgICBsZXQgZGF0YTtcbiAgICAgICAgaWYgKGNhY2hlICYmIHF1ZXJ5LmNhY2hlZCkge1xuICAgICAgICAgICAgZGF0YSA9IGNhY2hlZERhdGE7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocmVzdWx0cz8uZGF0YSkge1xuICAgICAgICAgICAgKHsgZGF0YSB9ID0gcmVzdWx0cyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCBleHBhbmRlZENvbHVtbnMgPSByZXN1bHRzLmV4cGFuZGVkX2NvbHVtbnNcbiAgICAgICAgICAgICAgICA/IHJlc3VsdHMuZXhwYW5kZWRfY29sdW1ucy5tYXAoY29sID0+IGNvbC5jb2x1bW5fbmFtZSlcbiAgICAgICAgICAgICAgICA6IFtdO1xuICAgICAgICAgICAgY29uc3QgYWxsb3dIVE1MID0gZ2V0SXRlbShMb2NhbFN0b3JhZ2VLZXlzLlNxbGxhYklzUmVuZGVySHRtbEVuYWJsZWQsIGZhbHNlKTtcbiAgICAgICAgICAgIHJldHVybiAoPFJlc3VsdENvbnRhaW5lcj5cbiAgICAgICAgICB7cmVuZGVyQ29udHJvbHMoKX1cbiAgICAgICAgICB7c2hvd1NxbCAmJiBzaG93U3FsSW5saW5lID8gKDw+XG4gICAgICAgICAgICAgIDxkaXYgY3NzPXtjc3MgYFxuICAgICAgICAgICAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjtcbiAgICAgICAgICAgICAgICAgIGdhcDogJHtHQVB9cHg7XG4gICAgICAgICAgICAgICAgYH0+XG4gICAgICAgICAgICAgICAgPENhcmQgY3NzPXtbXG4gICAgICAgICAgICAgICAgICAgICAgICBjc3MgYFxuICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMjhweDtcbiAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogY2FsYygxMDAlIC0gJHtST1dTX0NISVBfV0lEVEggKyBHQVB9cHgpO1xuICAgICAgICAgICAgICAgICAgICAgIGNvZGUge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDEwMCU7XG4gICAgICAgICAgICAgICAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuO1xuICAgICAgICAgICAgICAgICAgICAgICAgd2hpdGUtc3BhY2U6IG5vd3JhcCAhaW1wb3J0YW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBibG9jaztcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGAsXG4gICAgICAgICAgICAgICAgICAgIF19PlxuICAgICAgICAgICAgICAgICAge3NxbH1cbiAgICAgICAgICAgICAgICA8L0NhcmQ+XG4gICAgICAgICAgICAgICAge3JlbmRlclJvd3NSZXR1cm5lZChmYWxzZSl9XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICB7cmVuZGVyUm93c1JldHVybmVkKHRydWUpfVxuICAgICAgICAgICAgPC8+KSA6ICg8PlxuICAgICAgICAgICAgICB7cmVuZGVyUm93c1JldHVybmVkKGZhbHNlKX1cbiAgICAgICAgICAgICAge3JlbmRlclJvd3NSZXR1cm5lZCh0cnVlKX1cbiAgICAgICAgICAgICAge3NxbH1cbiAgICAgICAgICAgIDwvPil9XG4gICAgICAgICAgPFJlc3VsdFRhYmxlIGRhdGE9e2RhdGF9IHF1ZXJ5SWQ9e3F1ZXJ5LmlkfSBvcmRlcmVkQ29sdW1uS2V5cz17cmVzdWx0cy5jb2x1bW5zLm1hcChjb2wgPT4gY29sLmNvbHVtbl9uYW1lKX0gaGVpZ2h0PXtyb3dzSGVpZ2h0fSBmaWx0ZXJUZXh0PXtzZWFyY2hUZXh0fSBleHBhbmRlZENvbHVtbnM9e2V4cGFuZGVkQ29sdW1uc30gYWxsb3dIVE1MPXthbGxvd0hUTUx9Lz5cbiAgICAgICAgPC9SZXN1bHRDb250YWluZXI+KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIDxBbGVydCB0eXBlPVwid2FybmluZ1wiIG1lc3NhZ2U9e3QoJ1RoZSBxdWVyeSByZXR1cm5lZCBubyBkYXRhJyl9Lz47XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKHF1ZXJ5LmNhY2hlZCB8fCAocXVlcnkuc3RhdGUgPT09IFF1ZXJ5U3RhdGUuU3VjY2VzcyAmJiAhcXVlcnkucmVzdWx0cykpIHtcbiAgICAgICAgaWYgKHF1ZXJ5LmlzRGF0YVByZXZpZXcpIHtcbiAgICAgICAgICAgIHJldHVybiAoPEJ1dHRvbiBidXR0b25TaXplPVwic21hbGxcIiBidXR0b25TdHlsZT1cInByaW1hcnlcIiBvbkNsaWNrPXsoKSA9PiBkaXNwYXRjaChyZUZldGNoUXVlcnlSZXN1bHRzKHtcbiAgICAgICAgICAgICAgICAgICAgLi4ucXVlcnksXG4gICAgICAgICAgICAgICAgICAgIGlzRGF0YVByZXZpZXc6IHRydWUsXG4gICAgICAgICAgICAgICAgfSkpfT5cbiAgICAgICAgICB7dCgnRmV0Y2ggZGF0YSBwcmV2aWV3Jyl9XG4gICAgICAgIDwvQnV0dG9uPik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHF1ZXJ5LnJlc3VsdHNLZXkpIHtcbiAgICAgICAgICAgIHJldHVybiAoPEJ1dHRvbiBidXR0b25TaXplPVwic21hbGxcIiBidXR0b25TdHlsZT1cInByaW1hcnlcIiBvbkNsaWNrPXsoKSA9PiBmZXRjaFJlc3VsdHMocXVlcnkpfT5cbiAgICAgICAgICB7dCgnUmVmZXRjaCByZXN1bHRzJyl9XG4gICAgICAgIDwvQnV0dG9uPik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgbGV0IHByb2dyZXNzQmFyO1xuICAgIGlmIChxdWVyeS5wcm9ncmVzcyA+IDApIHtcbiAgICAgICAgcHJvZ3Jlc3NCYXIgPSAoPFByb2dyZXNzQmFyIHBlcmNlbnQ9e3BhcnNlSW50KHF1ZXJ5LnByb2dyZXNzLnRvRml4ZWQoMCksIDEwKX0gc3RyaXBlZC8+KTtcbiAgICB9XG4gICAgY29uc3QgcHJvZ3Jlc3NNc2cgPSBxdWVyeT8uZXh0cmE/LnByb2dyZXNzID8/IG51bGw7XG4gICAgcmV0dXJuICg8UmVzdWx0bGVzc1N0eWxlcz5cbiAgICAgIDxkaXY+eyFwcm9ncmVzc0JhciAmJiA8TG9hZGluZyBwb3NpdGlvbj1cIm5vcm1hbFwiLz59PC9kaXY+XG4gICAgICB7Lyogc2hvdyBsb2FkaW5nIGJhciB3aGVuZXZlciBwcm9ncmVzcyBiYXIgaXMgY29tcGxldGVkIGJ1dCBuZWVkcyB0aW1lIHRvIHJlbmRlciAqL31cbiAgICAgIDxkaXY+e3F1ZXJ5LnByb2dyZXNzID09PSAxMDAgJiYgPExvYWRpbmcgcG9zaXRpb249XCJub3JtYWxcIi8+fTwvZGl2PlxuICAgICAgPFF1ZXJ5U3RhdGVMYWJlbCBxdWVyeT17cXVlcnl9Lz5cbiAgICAgIDxkaXY+e3Byb2dyZXNzTXNnICYmIDxBbGVydCB0eXBlPVwic3VjY2Vzc1wiIG1lc3NhZ2U9e3Byb2dyZXNzTXNnfS8+fTwvZGl2PlxuICAgICAgPGRpdj57cXVlcnkucHJvZ3Jlc3MgIT09IDEwMCAmJiBwcm9ncmVzc0Jhcn08L2Rpdj5cbiAgICAgIHt0cmFja2luZ1VybCAmJiA8ZGl2Pnt0cmFja2luZ1VybH08L2Rpdj59XG4gICAgPC9SZXN1bHRsZXNzU3R5bGVzPik7XG59O1xuZXhwb3J0IGRlZmF1bHQgbWVtbyhSZXN1bHRTZXQpO1xuIl19 */\"], children:\n\n              sql }\n            ),\n            renderRowsReturned(false)] }\n          ),\n          renderRowsReturned(true)] }\n        ) : _jsxs(_Fragment, { children: [\n          renderRowsReturned(false),\n          renderRowsReturned(true),\n          sql] }\n        ),\n        _jsx(ResultTable, { data: data, queryId: query.id, orderedColumnKeys: results.columns.map((col) => col.column_name), height: rowsHeight, filterText: searchText, expandedColumns: expandedColumns, allowHTML: allowHTML })] }\n      );\n    }\n    if (data && data.length === 0) {\n      return _jsx(Alert, { type: \"warning\", message: t('The query returned no data') });\n    }\n  }\n  if (query.cached || query.state === QueryState.Success && !query.results) {\n    if (query.isDataPreview) {\n      return _jsx(Button, { buttonSize: \"small\", buttonStyle: \"primary\", onClick: () => dispatch(reFetchQueryResults({\n          ...query,\n          isDataPreview: true\n        })), children:\n        t('Fetch data preview') }\n      );\n    }\n    if (query.resultsKey) {\n      return _jsx(Button, { buttonSize: \"small\", buttonStyle: \"primary\", onClick: () => fetchResults(query), children:\n        t('Refetch results') }\n      );\n    }\n  }\n  let progressBar;\n  if (query.progress > 0) {\n    progressBar = _jsx(ProgressBar, { percent: parseInt(query.progress.toFixed(0), 10), striped: true });\n  }\n  const progressMsg = (_query$extra$progress = query == null ? void 0 : (_query$extra2 = query.extra) == null ? void 0 : _query$extra2.progress) != null ? _query$extra$progress : null;\n  return _jsxs(ResultlessStyles, { children: [\n    _jsx(\"div\", { children: !progressBar && _jsx(Loading, { position: \"normal\" }) }),\n\n    _jsx(\"div\", { children: query.progress === 100 && _jsx(Loading, { position: \"normal\" }) }),\n    _jsx(QueryStateLabel, { query: query }),\n    _jsx(\"div\", { children: progressMsg && _jsx(Alert, { type: \"success\", message: progressMsg }) }),\n    _jsx(\"div\", { children: query.progress !== 100 && progressBar }),\n    trackingUrl && _jsx(\"div\", { children: trackingUrl })] }\n  );\n};__signature__(ResultSet, \"useSelector{user}\\nuseSelector{query}\\nuseTheme{theme}\\nuseState{[searchText, setSearchText]('')}\\nuseState{[cachedData, setCachedData]([])}\\nuseState{[showSaveDatasetModal, setShowSaveDatasetModal](false)}\\nuseState{[alertIsOpen, setAlertIsOpen](false)}\\nuseHistory{history}\\nuseDispatch{dispatch}\\nuseLogAction{logAction}\\nuseCallback{reRunQueryIfSessionTimeoutErrorOnMount}\\nuseEffect{}\\nusePrevious{prevQuery}\\nuseEffect{}\", () => [useSelector, useSelector, useTheme, useHistory, useDispatch, useLogAction, usePrevious]);const _default = /*#__PURE__*/\nmemo(ResultSet);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(LimitingFactor, \"LimitingFactor\", \"/app/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(ResultContainer, \"ResultContainer\", \"/app/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(ResultlessStyles, \"ResultlessStyles\", \"/app/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(MonospaceDiv, \"MonospaceDiv\", \"/app/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(ReturnedRows, \"ReturnedRows\", \"/app/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(ResultSetControls, \"ResultSetControls\", \"/app/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(ResultSetButtons, \"ResultSetButtons\", \"/app/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(ROWS_CHIP_WIDTH, \"ROWS_CHIP_WIDTH\", \"/app/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(GAP, \"GAP\", \"/app/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(extensionsRegistry, \"extensionsRegistry\", \"/app/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(ResultSet, \"ResultSet\", \"/app/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(_default, \"default\", \"/app/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["useCallback","useEffect","useState","memo","shallowEqual","useDispatch","useSelector","useHistory","ButtonGroup","Alert","Button","nanoid","QueryState","styled","t","tn","useTheme","usePrevious","css","getNumberFormatter","getExtensionsRegistry","ErrorMessageWithStackTrace","SaveDatasetModal","EXPLORE_CHART_DEFAULT","mountExploreUrl","postFormData","ProgressBar","Loading","Card","Label","Tooltip","FilterableTable","CopyToClipboard","addDangerToast","prepareCopyToClipboardTabularData","getItem","LocalStorageKeys","addQueryEditor","clearQueryResults","CtasEnum","fetchQueryResults","reFetchQueryResults","reRunQuery","URL_PARAMS","useLogAction","LOG_ACTIONS_SQLLAB_COPY_RESULT_TO_CLIPBOARD","LOG_ACTIONS_SQLLAB_CREATE_CHART","LOG_ACTIONS_SQLLAB_DOWNLOAD_CSV","Icons","findPermission","ExploreCtasResultsButton","ExploreResultsButton","HighlightedSql","QueryStateLabel","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","LimitingFactor","ResultContainer","div","theme","gridUnit","ResultlessStyles","MonospaceDiv","typography","families","monospace","ReturnedRows","sizes","s","ResultSetControls","ResultSetButtons","ROWS_CHIP_WIDTH","GAP","extensionsRegistry","ResultSet","cache","csv","database","displayLimit","height","queryId","search","showSql","showSqlInline","visualize","defaultQueryLimit","_extensionsRegistry$g","_query$results2","_query$extra$progress","_query$extra2","user","query","sqlLab","queries","_pick","ResultTable","get","searchText","setSearchText","cachedData","setCachedData","showSaveDatasetModal","setShowSaveDatasetModal","alertIsOpen","setAlertIsOpen","history","dispatch","logAction","sqlEditorId","reRunQueryIfSessionTimeoutErrorOnMount","errorMessage","indexOf","fetchResults","q","prevQuery","_query$results","_query$results$data","cached","results","data","length","resultsKey","calculateAlertRefHeight","alertElement","popSelectStar","tempSchema","tempTable","qe","id","name","autorun","dbId","sql","changeSearch","event","target","value","createExploreResultsOnClick","clickEvent","openInNewWindow","metaKey","query_id","key","datasource","all_columns","columns","map","column","column_name","url","formDataKey","window","open","push","getExportCsvUrl","clientId","renderControls","tab","templateParams","schema","canExportData","roles","children","visible","onHide","buttonTextOnSave","buttonTextOnOverwrite","modalDescription","allows_virtual_table_explore","onClick","buttonSize","href","className","text","wrapped","copyNode","hideTooltip","onCopyEnd","type","onChange","placeholder","renderRowsReturned","alertMessage","_user$roles","_results$data","rows","queryLimit","limitingFactor","limitMessage","limitReached","displayLimitReached","limit","isAdmin","Admin","rowsCount","Math","min","displayMaxRowsReachedMessage","withAdmin","withoutAdmin","shouldUseDefaultDropdownAlert","Dropdown","Query","QueryAndDropdown","formattedRowCount","rowsReturnedMessage","tooltipText","ref","message","onClose","description","showRowsReturned","title","placement","l","ExclamationCircleOutlined","m","exploreDBId","explore_database_id","trackingUrl","state","Success","Fetching","Running","maxLines","maxWidth","Stopped","Failed","_query$extra","_query$extra$errors","_query$errors","error","extra","errors","subtitle","copyText","undefined","link","source","ctas","object","ctas_method","View","_css","marginRight","process","env","NODE_ENV","table","rowMessageHeight","alertContainerHeight","rowsHeight","expandedColumns","expanded_columns","col","allowHTML","SqllabIsRenderHtmlEnabled","orderedColumnKeys","filterText","isDataPreview","buttonStyle","progressBar","progress","percent","parseInt","toFixed","striped","progressMsg","position","__signature__","_default","reactHotLoader","reactHotLoaderGlobal","default","register","leaveModule","module"],"sources":["/app/superset-frontend/src/SqlLab/components/ResultSet/index.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  useCallback,\n  useEffect,\n  useState,\n  memo,\n  ChangeEvent,\n  MouseEvent,\n} from 'react';\n\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\nimport { useHistory } from 'react-router-dom';\nimport { pick } from 'lodash';\nimport ButtonGroup from 'src/components/ButtonGroup';\nimport Alert from 'src/components/Alert';\nimport Button from 'src/components/Button';\nimport { nanoid } from 'nanoid';\nimport {\n  QueryState,\n  styled,\n  t,\n  tn,\n  useTheme,\n  usePrevious,\n  css,\n  getNumberFormatter,\n  getExtensionsRegistry,\n} from '@superset-ui/core';\nimport ErrorMessageWithStackTrace from 'src/components/ErrorMessage/ErrorMessageWithStackTrace';\nimport {\n  ISaveableDatasource,\n  ISimpleColumn,\n  SaveDatasetModal,\n} from 'src/SqlLab/components/SaveDatasetModal';\nimport { EXPLORE_CHART_DEFAULT, SqlLabRootState } from 'src/SqlLab/types';\nimport { mountExploreUrl } from 'src/explore/exploreUtils';\nimport { postFormData } from 'src/explore/exploreUtils/formData';\nimport ProgressBar from 'src/components/ProgressBar';\nimport Loading from 'src/components/Loading';\nimport Card from 'src/components/Card';\nimport Label from 'src/components/Label';\nimport { Tooltip } from 'src/components/Tooltip';\nimport FilterableTable from 'src/components/FilterableTable';\nimport CopyToClipboard from 'src/components/CopyToClipboard';\nimport { addDangerToast } from 'src/components/MessageToasts/actions';\nimport { prepareCopyToClipboardTabularData } from 'src/utils/common';\nimport { getItem, LocalStorageKeys } from 'src/utils/localStorageHelpers';\nimport {\n  addQueryEditor,\n  clearQueryResults,\n  CtasEnum,\n  fetchQueryResults,\n  reFetchQueryResults,\n  reRunQuery,\n} from 'src/SqlLab/actions/sqlLab';\nimport { URL_PARAMS } from 'src/constants';\nimport useLogAction from 'src/logger/useLogAction';\nimport {\n  LOG_ACTIONS_SQLLAB_COPY_RESULT_TO_CLIPBOARD,\n  LOG_ACTIONS_SQLLAB_CREATE_CHART,\n  LOG_ACTIONS_SQLLAB_DOWNLOAD_CSV,\n} from 'src/logger/LogUtils';\nimport Icons from 'src/components/Icons';\nimport { findPermission } from 'src/utils/findPermission';\nimport ExploreCtasResultsButton from '../ExploreCtasResultsButton';\nimport ExploreResultsButton from '../ExploreResultsButton';\nimport HighlightedSql from '../HighlightedSql';\nimport QueryStateLabel from '../QueryStateLabel';\n\nenum LimitingFactor {\n  Query = 'QUERY',\n  QueryAndDropdown = 'QUERY_AND_DROPDOWN',\n  Dropdown = 'DROPDOWN',\n  NotLimited = 'NOT_LIMITED',\n}\n\nexport interface ResultSetProps {\n  cache?: boolean;\n  csv?: boolean;\n  database?: Record<string, any>;\n  displayLimit: number;\n  height: number;\n  queryId: string;\n  search?: boolean;\n  showSql?: boolean;\n  showSqlInline?: boolean;\n  visualize?: boolean;\n  defaultQueryLimit: number;\n}\n\nconst ResultContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  row-gap: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nconst ResultlessStyles = styled.div`\n  position: relative;\n  min-height: ${({ theme }) => theme.gridUnit * 25}px;\n  [role='alert'] {\n    margin-top: ${({ theme }) => theme.gridUnit * 2}px;\n  }\n  .sql-result-track-job {\n    margin-top: ${({ theme }) => theme.gridUnit * 2}px;\n  }\n`;\n\n// Making text render line breaks/tabs as is as monospace,\n// but wrapping text too so text doesn't overflow\nconst MonospaceDiv = styled.div`\n  font-family: ${({ theme }) => theme.typography.families.monospace};\n  white-space: pre;\n  word-break: break-word;\n  overflow-x: auto;\n  white-space: pre-wrap;\n`;\n\nconst ReturnedRows = styled.div`\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  line-height: 1;\n`;\n\nconst ResultSetControls = styled.div`\n  display: flex;\n  justify-content: space-between;\n`;\n\nconst ResultSetButtons = styled.div`\n  display: grid;\n  grid-auto-flow: column;\n  padding-right: ${({ theme }) => 2 * theme.gridUnit}px;\n`;\n\nconst ROWS_CHIP_WIDTH = 100;\nconst GAP = 8;\n\nconst extensionsRegistry = getExtensionsRegistry();\n\nconst ResultSet = ({\n  cache = false,\n  csv = true,\n  database = {},\n  displayLimit,\n  height,\n  queryId,\n  search = true,\n  showSql = false,\n  showSqlInline = false,\n  visualize = true,\n  defaultQueryLimit,\n}: ResultSetProps) => {\n  const user = useSelector(({ user }: SqlLabRootState) => user, shallowEqual);\n  const query = useSelector(\n    ({ sqlLab: { queries } }: SqlLabRootState) =>\n      pick(queries[queryId], [\n        'id',\n        'errorMessage',\n        'cached',\n        'results',\n        'resultsKey',\n        'dbId',\n        'tab',\n        'sql',\n        'sqlEditorId',\n        'templateParams',\n        'schema',\n        'rows',\n        'queryLimit',\n        'limitingFactor',\n        'trackingUrl',\n        'state',\n        'errors',\n        'link',\n        'ctas',\n        'ctas_method',\n        'tempSchema',\n        'tempTable',\n        'isDataPreview',\n        'progress',\n        'extra',\n      ]),\n    shallowEqual,\n  );\n  const ResultTable =\n    extensionsRegistry.get('sqleditor.extension.resultTable') ??\n    FilterableTable;\n  const theme = useTheme();\n  const [searchText, setSearchText] = useState('');\n  const [cachedData, setCachedData] = useState<Record<string, unknown>[]>([]);\n  const [showSaveDatasetModal, setShowSaveDatasetModal] = useState(false);\n  const [alertIsOpen, setAlertIsOpen] = useState(false);\n\n  const history = useHistory();\n  const dispatch = useDispatch();\n  const logAction = useLogAction({ queryId, sqlEditorId: query.sqlEditorId });\n\n  const reRunQueryIfSessionTimeoutErrorOnMount = useCallback(() => {\n    if (\n      query.errorMessage &&\n      query.errorMessage.indexOf('session timed out') > 0\n    ) {\n      dispatch(reRunQuery(query));\n    }\n  }, []);\n\n  useEffect(() => {\n    // only do this the first time the component is rendered/mounted\n    reRunQueryIfSessionTimeoutErrorOnMount();\n  }, [reRunQueryIfSessionTimeoutErrorOnMount]);\n\n  const fetchResults = (q: typeof query) => {\n    dispatch(fetchQueryResults(q, displayLimit));\n  };\n\n  const prevQuery = usePrevious(query);\n  useEffect(() => {\n    if (cache && query.cached && query?.results?.data?.length > 0) {\n      setCachedData(query.results.data);\n      dispatch(clearQueryResults(query));\n    }\n    if (query.resultsKey && query.resultsKey !== prevQuery?.resultsKey) {\n      fetchResults(query);\n    }\n  }, [query, cache]);\n\n  const calculateAlertRefHeight = (alertElement: HTMLElement | null) => {\n    if (alertElement) {\n      setAlertIsOpen(true);\n    } else {\n      setAlertIsOpen(false);\n    }\n  };\n\n  const popSelectStar = (tempSchema: string | null, tempTable: string) => {\n    const qe = {\n      id: nanoid(11),\n      name: tempTable,\n      autorun: false,\n      dbId: query.dbId,\n      sql: `SELECT * FROM ${tempSchema ? `${tempSchema}.` : ''}${tempTable}`,\n    };\n    dispatch(addQueryEditor(qe));\n  };\n\n  const changeSearch = (event: ChangeEvent<HTMLInputElement>) => {\n    setSearchText(event.target.value);\n  };\n\n  const createExploreResultsOnClick = async (clickEvent: MouseEvent) => {\n    const { results } = query;\n\n    const openInNewWindow = clickEvent.metaKey;\n    logAction(LOG_ACTIONS_SQLLAB_CREATE_CHART, {});\n    if (results?.query_id) {\n      const key = await postFormData(results.query_id, 'query', {\n        ...EXPLORE_CHART_DEFAULT,\n        datasource: `${results.query_id}__query`,\n        ...{\n          all_columns: results.columns.map(column => column.column_name),\n        },\n      });\n      const url = mountExploreUrl(null, {\n        [URL_PARAMS.formDataKey.name]: key,\n      });\n      if (openInNewWindow) {\n        window.open(url, '_blank', 'noreferrer');\n      } else {\n        history.push(url);\n      }\n    } else {\n      addDangerToast(t('Unable to create chart without a query id.'));\n    }\n  };\n\n  const getExportCsvUrl = (clientId: string) =>\n    `/api/v1/sqllab/export/${clientId}/`;\n\n  const renderControls = () => {\n    if (search || visualize || csv) {\n      let { data } = query.results;\n      if (cache && query.cached) {\n        data = cachedData;\n      }\n      const { columns } = query.results;\n      // Added compute logic to stop user from being able to Save & Explore\n\n      const datasource: ISaveableDatasource = {\n        columns: query.results.columns as ISimpleColumn[],\n        name: query?.tab || 'Untitled',\n        dbId: query?.dbId,\n        sql: query?.sql,\n        templateParams: query?.templateParams,\n        schema: query?.schema,\n      };\n\n      const canExportData = findPermission(\n        'can_export_csv',\n        'SQLLab',\n        user?.roles,\n      );\n\n      return (\n        <ResultSetControls>\n          <SaveDatasetModal\n            visible={showSaveDatasetModal}\n            onHide={() => setShowSaveDatasetModal(false)}\n            buttonTextOnSave={t('Save & Explore')}\n            buttonTextOnOverwrite={t('Overwrite & Explore')}\n            modalDescription={t(\n              'Save this query as a virtual dataset to continue exploring',\n            )}\n            datasource={datasource}\n          />\n          <ResultSetButtons>\n            {visualize && database?.allows_virtual_table_explore && (\n              <ExploreResultsButton\n                database={database}\n                onClick={createExploreResultsOnClick}\n              />\n            )}\n            {csv && canExportData && (\n              <Button\n                buttonSize=\"small\"\n                href={getExportCsvUrl(query.id)}\n                data-test=\"export-csv-button\"\n                onClick={() => logAction(LOG_ACTIONS_SQLLAB_DOWNLOAD_CSV, {})}\n              >\n                <i className=\"fa fa-file-text-o\" /> {t('Download to CSV')}\n              </Button>\n            )}\n\n            {canExportData && (\n              <CopyToClipboard\n                text={prepareCopyToClipboardTabularData(data, columns)}\n                wrapped={false}\n                copyNode={\n                  <Button\n                    buttonSize=\"small\"\n                    data-test=\"copy-to-clipboard-button\"\n                  >\n                    <i className=\"fa fa-clipboard\" /> {t('Copy to Clipboard')}\n                  </Button>\n                }\n                hideTooltip\n                onCopyEnd={() =>\n                  logAction(LOG_ACTIONS_SQLLAB_COPY_RESULT_TO_CLIPBOARD, {})\n                }\n              />\n            )}\n          </ResultSetButtons>\n          {search && (\n            <input\n              type=\"text\"\n              onChange={changeSearch}\n              value={searchText}\n              className=\"form-control input-sm\"\n              placeholder={t('Filter results')}\n            />\n          )}\n        </ResultSetControls>\n      );\n    }\n    return <div />;\n  };\n\n  const renderRowsReturned = (alertMessage: boolean) => {\n    const { results, rows, queryLimit, limitingFactor } = query;\n    let limitMessage = '';\n    const limitReached = results?.displayLimitReached;\n    const limit = queryLimit || results.query.limit;\n    const isAdmin = !!user?.roles?.Admin;\n    const rowsCount = Math.min(rows || 0, results?.data?.length || 0);\n\n    const displayMaxRowsReachedMessage = {\n      withAdmin: t(\n        'The number of results displayed is limited to %(rows)d by the configuration DISPLAY_MAX_ROW. ' +\n          'Please add additional limits/filters or download to csv to see more rows up to ' +\n          'the %(limit)d limit.',\n        { rows: rowsCount, limit },\n      ),\n      withoutAdmin: t(\n        'The number of results displayed is limited to %(rows)d. ' +\n          'Please add additional limits/filters, download to csv, or contact an admin ' +\n          'to see more rows up to the %(limit)d limit.',\n        { rows: rowsCount, limit },\n      ),\n    };\n    const shouldUseDefaultDropdownAlert =\n      limit === defaultQueryLimit && limitingFactor === LimitingFactor.Dropdown;\n\n    if (limitingFactor === LimitingFactor.Query && csv) {\n      limitMessage = t(\n        'The number of rows displayed is limited to %(rows)d by the query',\n        { rows },\n      );\n    } else if (\n      limitingFactor === LimitingFactor.Dropdown &&\n      !shouldUseDefaultDropdownAlert\n    ) {\n      limitMessage = t(\n        'The number of rows displayed is limited to %(rows)d by the limit dropdown.',\n        { rows },\n      );\n    } else if (limitingFactor === LimitingFactor.QueryAndDropdown) {\n      limitMessage = t(\n        'The number of rows displayed is limited to %(rows)d by the query and limit dropdown.',\n        { rows },\n      );\n    }\n    const formattedRowCount = getNumberFormatter()(rows);\n    const rowsReturnedMessage = t('%(rows)d rows returned', {\n      rows,\n    });\n\n    const tooltipText = `${rowsReturnedMessage}. ${limitMessage}`;\n\n    if (alertMessage) {\n      return (\n        <>\n          {!limitReached && shouldUseDefaultDropdownAlert && (\n            <div ref={calculateAlertRefHeight}>\n              <Alert\n                type=\"warning\"\n                message={t('%(rows)d rows returned', { rows })}\n                onClose={() => setAlertIsOpen(false)}\n                description={t(\n                  'The number of rows displayed is limited to %(rows)d by the dropdown.',\n                  { rows },\n                )}\n              />\n            </div>\n          )}\n          {limitReached && (\n            <div ref={calculateAlertRefHeight}>\n              <Alert\n                type=\"warning\"\n                onClose={() => setAlertIsOpen(false)}\n                message={t('%(rows)d rows returned', { rows: rowsCount })}\n                description={\n                  isAdmin\n                    ? displayMaxRowsReachedMessage.withAdmin\n                    : displayMaxRowsReachedMessage.withoutAdmin\n                }\n              />\n            </div>\n          )}\n        </>\n      );\n    }\n    const showRowsReturned =\n      showSqlInline || (!limitReached && !shouldUseDefaultDropdownAlert);\n\n    return (\n      <>\n        {showRowsReturned && (\n          <ReturnedRows>\n            <Tooltip\n              id=\"sqllab-rowcount-tooltip\"\n              title={tooltipText}\n              placement=\"left\"\n            >\n              <Label\n                css={css`\n                  line-height: ${theme.typography.sizes.l}px;\n                `}\n              >\n                {limitMessage && (\n                  <Icons.ExclamationCircleOutlined\n                    css={css`\n                      font-size: ${theme.typography.sizes.m}px;\n                      margin-right: ${theme.gridUnit}px;\n                    `}\n                  />\n                )}\n                {tn('%s row', '%s rows', rows, formattedRowCount)}\n              </Label>\n            </Tooltip>\n          </ReturnedRows>\n        )}\n      </>\n    );\n  };\n\n  const limitReached = query?.results?.displayLimitReached;\n  let sql;\n  let exploreDBId = query.dbId;\n  if (database?.explore_database_id) {\n    exploreDBId = database.explore_database_id;\n  }\n\n  let trackingUrl;\n  if (\n    query.trackingUrl &&\n    query.state !== QueryState.Success &&\n    query.state !== QueryState.Fetching\n  ) {\n    trackingUrl = (\n      <Button\n        className=\"sql-result-track-job\"\n        buttonSize=\"small\"\n        href={query.trackingUrl}\n        target=\"_blank\"\n      >\n        {query.state === QueryState.Running\n          ? t('Track job')\n          : t('See query details')}\n      </Button>\n    );\n  }\n\n  if (showSql) {\n    sql = (\n      <HighlightedSql\n        sql={query.sql}\n        {...(showSqlInline && { maxLines: 1, maxWidth: 60 })}\n      />\n    );\n  }\n\n  if (query.state === QueryState.Stopped) {\n    return <Alert type=\"warning\" message={t('Query was stopped')} />;\n  }\n\n  if (query.state === QueryState.Failed) {\n    return (\n      <ResultlessStyles>\n        <ErrorMessageWithStackTrace\n          title={t('Database error')}\n          error={query?.extra?.errors?.[0] || query?.errors?.[0]}\n          subtitle={<MonospaceDiv>{query.errorMessage}</MonospaceDiv>}\n          copyText={query.errorMessage || undefined}\n          link={query.link}\n          source=\"sqllab\"\n        />\n        {trackingUrl}\n      </ResultlessStyles>\n    );\n  }\n\n  if (query.state === QueryState.Success && query.ctas) {\n    const { tempSchema, tempTable } = query;\n    let object = 'Table';\n    if (query.ctas_method === CtasEnum.View) {\n      object = 'View';\n    }\n    return (\n      <div>\n        <Alert\n          type=\"info\"\n          message={\n            <>\n              {t(object)} [\n              <strong>\n                {tempSchema ? `${tempSchema}.` : ''}\n                {tempTable}\n              </strong>\n              ] {t('was created')} &nbsp;\n              <ButtonGroup>\n                <Button\n                  buttonSize=\"small\"\n                  css={{ marginRight: theme.gridUnit }}\n                  onClick={() => popSelectStar(tempSchema, tempTable)}\n                >\n                  {t('Query in a new tab')}\n                </Button>\n                <ExploreCtasResultsButton\n                  table={tempTable}\n                  schema={tempSchema}\n                  dbId={exploreDBId}\n                />\n              </ButtonGroup>\n            </>\n          }\n        />\n      </div>\n    );\n  }\n\n  if (query.state === QueryState.Success && query.results) {\n    const { results } = query;\n    // Accounts for offset needed for height of ResultSetRowsReturned component if !limitReached\n    const rowMessageHeight = !limitReached ? 32 : 0;\n    // Accounts for offset needed for height of Alert if this.state.alertIsOpen\n    const alertContainerHeight = 70;\n    // We need to calculate the height of this.renderRowsReturned()\n    // if we want results panel to be proper height because the\n    // FilterTable component needs an explicit height to render\n    // the Table component\n    const rowsHeight = alertIsOpen\n      ? height - alertContainerHeight\n      : height - rowMessageHeight;\n    let data;\n    if (cache && query.cached) {\n      data = cachedData;\n    } else if (results?.data) {\n      ({ data } = results);\n    }\n    if (data && data.length > 0) {\n      const expandedColumns = results.expanded_columns\n        ? results.expanded_columns.map(col => col.column_name)\n        : [];\n      const allowHTML = getItem(\n        LocalStorageKeys.SqllabIsRenderHtmlEnabled,\n        false,\n      );\n      return (\n        <ResultContainer>\n          {renderControls()}\n          {showSql && showSqlInline ? (\n            <>\n              <div\n                css={css`\n                  display: flex;\n                  justify-content: space-between;\n                  gap: ${GAP}px;\n                `}\n              >\n                <Card\n                  css={[\n                    css`\n                      height: 28px;\n                      width: calc(100% - ${ROWS_CHIP_WIDTH + GAP}px);\n                      code {\n                        width: 100%;\n                        overflow: hidden;\n                        white-space: nowrap !important;\n                        text-overflow: ellipsis;\n                        display: block;\n                      }\n                    `,\n                  ]}\n                >\n                  {sql}\n                </Card>\n                {renderRowsReturned(false)}\n              </div>\n              {renderRowsReturned(true)}\n            </>\n          ) : (\n            <>\n              {renderRowsReturned(false)}\n              {renderRowsReturned(true)}\n              {sql}\n            </>\n          )}\n          <ResultTable\n            data={data}\n            queryId={query.id}\n            orderedColumnKeys={results.columns.map(col => col.column_name)}\n            height={rowsHeight}\n            filterText={searchText}\n            expandedColumns={expandedColumns}\n            allowHTML={allowHTML}\n          />\n        </ResultContainer>\n      );\n    }\n    if (data && data.length === 0) {\n      return <Alert type=\"warning\" message={t('The query returned no data')} />;\n    }\n  }\n\n  if (query.cached || (query.state === QueryState.Success && !query.results)) {\n    if (query.isDataPreview) {\n      return (\n        <Button\n          buttonSize=\"small\"\n          buttonStyle=\"primary\"\n          onClick={() =>\n            dispatch(\n              reFetchQueryResults({\n                ...query,\n                isDataPreview: true,\n              }),\n            )\n          }\n        >\n          {t('Fetch data preview')}\n        </Button>\n      );\n    }\n    if (query.resultsKey) {\n      return (\n        <Button\n          buttonSize=\"small\"\n          buttonStyle=\"primary\"\n          onClick={() => fetchResults(query)}\n        >\n          {t('Refetch results')}\n        </Button>\n      );\n    }\n  }\n\n  let progressBar;\n  if (query.progress > 0) {\n    progressBar = (\n      <ProgressBar percent={parseInt(query.progress.toFixed(0), 10)} striped />\n    );\n  }\n\n  const progressMsg = query?.extra?.progress ?? null;\n\n  return (\n    <ResultlessStyles>\n      <div>{!progressBar && <Loading position=\"normal\" />}</div>\n      {/* show loading bar whenever progress bar is completed but needs time to render */}\n      <div>{query.progress === 100 && <Loading position=\"normal\" />}</div>\n      <QueryStateLabel query={query} />\n      <div>{progressMsg && <Alert type=\"success\" message={progressMsg} />}</div>\n      <div>{query.progress !== 100 && progressBar}</div>\n      {trackingUrl && <div>{trackingUrl}</div>}\n    </ResultlessStyles>\n  );\n};\n\nexport default memo(ResultSet);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}