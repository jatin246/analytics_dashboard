{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { FeatureFlag, styled, t, useTheme, isFeatureEnabled, getClientErrorObject } from '@superset-ui/core';\nimport Button from 'src/components/Button';\nimport Icons from 'src/components/Icons';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport CopyToClipboard from 'src/components/CopyToClipboard';\nimport { storeQuery } from 'src/utils/common';\nimport useQueryEditor from 'src/SqlLab/hooks/useQueryEditor';\nimport { LOG_ACTIONS_SQLLAB_COPY_LINK } from 'src/logger/LogUtils';\nimport useLogAction from 'src/logger/useLogAction';import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"@emotion/react/jsx-runtime\";\nconst StyledIcon = styled(Icons.Link)`\n  &:first-of-type {\n    margin: 0;\n    display: flex;\n    svg {\n      margin: 0;\n    }\n  }\n`;\nconst ShareSqlLabQuery = ({ queryEditorId, addDangerToast }) => {\n  const theme = useTheme();\n  const logAction = useLogAction({ queryEditorId });\n  const { dbId, name, schema, autorun, sql, remoteId, templateParams } = useQueryEditor(queryEditorId, [\n  'dbId',\n  'name',\n  'schema',\n  'autorun',\n  'sql',\n  'remoteId',\n  'templateParams']\n  );\n  const getCopyUrlForKvStore = (callback) => {\n    const sharedQuery = { dbId, name, schema, autorun, sql, templateParams };\n    return storeQuery(sharedQuery).\n    then((shortUrl) => {\n      callback(shortUrl);\n    }).\n    catch((response) => {\n      getClientErrorObject(response).then(() => {\n        addDangerToast(t('There was an error with your request'));\n      });\n    });\n  };\n  const getCopyUrlForSavedQuery = (callback) => {\n    let savedQueryToastContent;\n    if (remoteId) {\n      savedQueryToastContent = `${window.location.origin + window.location.pathname}?savedQueryId=${remoteId}`;\n      callback(savedQueryToastContent);\n    } else\n    {\n      savedQueryToastContent = t('Please save the query to enable sharing');\n      callback(savedQueryToastContent);\n    }\n  };\n  const getCopyUrl = (callback) => {\n    logAction(LOG_ACTIONS_SQLLAB_COPY_LINK, {\n      shortcut: false\n    });\n    if (isFeatureEnabled(FeatureFlag.ShareQueriesViaKvStore)) {\n      return getCopyUrlForKvStore(callback);\n    }\n    return getCopyUrlForSavedQuery(callback);\n  };\n  const buildButton = (canShare) => {\n    const tooltip = canShare ?\n    t('Copy query link to your clipboard') :\n    t('Save the query to enable this feature');\n    return _jsxs(Button, { buttonSize: \"small\", tooltip: tooltip, disabled: !canShare, children: [\n      _jsx(StyledIcon, { iconColor: canShare ? theme.colors.primary.base : theme.colors.grayscale.base, iconSize: \"xl\" }),\n      t('Copy link')] }\n    );\n  };\n  const canShare = !!remoteId || isFeatureEnabled(FeatureFlag.ShareQueriesViaKvStore);\n  return _jsx(_Fragment, { children:\n    canShare ? _jsx(CopyToClipboard, { getText: getCopyUrl, wrapped: false, copyNode: buildButton(canShare) }) : buildButton(canShare) }\n  );\n};__signature__(ShareSqlLabQuery, \"useTheme{theme}\\nuseLogAction{logAction}\\nuseQueryEditor{{ dbId, name, schema, autorun, sql, remoteId, templateParams }}\", () => [useTheme, useLogAction, useQueryEditor]);const _default =\nwithToasts(ShareSqlLabQuery);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(StyledIcon, \"StyledIcon\", \"/app/superset-frontend/src/SqlLab/components/ShareSqlLabQuery/index.tsx\");reactHotLoader.register(ShareSqlLabQuery, \"ShareSqlLabQuery\", \"/app/superset-frontend/src/SqlLab/components/ShareSqlLabQuery/index.tsx\");reactHotLoader.register(_default, \"default\", \"/app/superset-frontend/src/SqlLab/components/ShareSqlLabQuery/index.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["FeatureFlag","styled","t","useTheme","isFeatureEnabled","getClientErrorObject","Button","Icons","withToasts","CopyToClipboard","storeQuery","useQueryEditor","LOG_ACTIONS_SQLLAB_COPY_LINK","useLogAction","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","StyledIcon","Link","ShareSqlLabQuery","queryEditorId","addDangerToast","theme","logAction","dbId","name","schema","autorun","sql","remoteId","templateParams","getCopyUrlForKvStore","callback","sharedQuery","then","shortUrl","catch","response","getCopyUrlForSavedQuery","savedQueryToastContent","window","location","origin","pathname","getCopyUrl","shortcut","ShareQueriesViaKvStore","buildButton","canShare","tooltip","buttonSize","disabled","children","iconColor","colors","primary","base","grayscale","iconSize","getText","wrapped","copyNode","__signature__","_default","reactHotLoader","reactHotLoaderGlobal","default","undefined","register","leaveModule","module"],"sources":["/app/superset-frontend/src/SqlLab/components/ShareSqlLabQuery/index.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  FeatureFlag,\n  styled,\n  t,\n  useTheme,\n  isFeatureEnabled,\n  getClientErrorObject,\n} from '@superset-ui/core';\nimport Button from 'src/components/Button';\nimport Icons from 'src/components/Icons';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport CopyToClipboard from 'src/components/CopyToClipboard';\nimport { storeQuery } from 'src/utils/common';\nimport useQueryEditor from 'src/SqlLab/hooks/useQueryEditor';\nimport { LOG_ACTIONS_SQLLAB_COPY_LINK } from 'src/logger/LogUtils';\nimport useLogAction from 'src/logger/useLogAction';\n\ninterface ShareSqlLabQueryProps {\n  queryEditorId: string;\n  addDangerToast: (msg: string) => void;\n}\n\nconst StyledIcon = styled(Icons.Link)`\n  &:first-of-type {\n    margin: 0;\n    display: flex;\n    svg {\n      margin: 0;\n    }\n  }\n`;\n\nconst ShareSqlLabQuery = ({\n  queryEditorId,\n  addDangerToast,\n}: ShareSqlLabQueryProps) => {\n  const theme = useTheme();\n  const logAction = useLogAction({ queryEditorId });\n  const { dbId, name, schema, autorun, sql, remoteId, templateParams } =\n    useQueryEditor(queryEditorId, [\n      'dbId',\n      'name',\n      'schema',\n      'autorun',\n      'sql',\n      'remoteId',\n      'templateParams',\n    ]);\n\n  const getCopyUrlForKvStore = (callback: Function) => {\n    const sharedQuery = { dbId, name, schema, autorun, sql, templateParams };\n\n    return storeQuery(sharedQuery)\n      .then(shortUrl => {\n        callback(shortUrl);\n      })\n      .catch(response => {\n        getClientErrorObject(response).then(() => {\n          addDangerToast(t('There was an error with your request'));\n        });\n      });\n  };\n\n  const getCopyUrlForSavedQuery = (callback: Function) => {\n    let savedQueryToastContent;\n\n    if (remoteId) {\n      savedQueryToastContent = `${\n        window.location.origin + window.location.pathname\n      }?savedQueryId=${remoteId}`;\n      callback(savedQueryToastContent);\n    } else {\n      savedQueryToastContent = t('Please save the query to enable sharing');\n      callback(savedQueryToastContent);\n    }\n  };\n  const getCopyUrl = (callback: Function) => {\n    logAction(LOG_ACTIONS_SQLLAB_COPY_LINK, {\n      shortcut: false,\n    });\n    if (isFeatureEnabled(FeatureFlag.ShareQueriesViaKvStore)) {\n      return getCopyUrlForKvStore(callback);\n    }\n    return getCopyUrlForSavedQuery(callback);\n  };\n\n  const buildButton = (canShare: boolean) => {\n    const tooltip = canShare\n      ? t('Copy query link to your clipboard')\n      : t('Save the query to enable this feature');\n    return (\n      <Button buttonSize=\"small\" tooltip={tooltip} disabled={!canShare}>\n        <StyledIcon\n          iconColor={\n            canShare ? theme.colors.primary.base : theme.colors.grayscale.base\n          }\n          iconSize=\"xl\"\n        />\n        {t('Copy link')}\n      </Button>\n    );\n  };\n\n  const canShare =\n    !!remoteId || isFeatureEnabled(FeatureFlag.ShareQueriesViaKvStore);\n\n  return (\n    <>\n      {canShare ? (\n        <CopyToClipboard\n          getText={getCopyUrl}\n          wrapped={false}\n          copyNode={buildButton(canShare)}\n        />\n      ) : (\n        buildButton(canShare)\n      )}\n    </>\n  );\n};\n\nexport default withToasts(ShareSqlLabQuery);\n"],"mappings":"wSAAA;;;;;;;;;;;;;;;;;;AAkBA,SACEA,WAAW,EACXC,MAAM,EACNC,CAAC,EACDC,QAAQ,EACRC,gBAAgB,EAChBC,oBAAoB,QACf,mBAAmB;AAC1B,OAAOC,MAAM,MAAM,uBAAuB;AAC1C,OAAOC,KAAK,MAAM,sBAAsB;AACxC,OAAOC,UAAU,MAAM,yCAAyC;AAChE,OAAOC,eAAe,MAAM,gCAAgC;AAC5D,SAASC,UAAU,QAAQ,kBAAkB;AAC7C,OAAOC,cAAc,MAAM,iCAAiC;AAC5D,SAASC,4BAA4B,QAAQ,qBAAqB;AAClE,OAAOC,YAAY,MAAM,yBAAyB,CAAC,SAAAC,GAAA,IAAAC,IAAA,EAAAC,IAAA,IAAAC,KAAA,EAAAC,QAAA,IAAAC,SAAA;AAOnD,MAAMC,UAAU,GAAGnB,MAAM,CAACM,KAAK,CAACc,IAAI,CAAC;;;;;;;;CAQpC;AAED,MAAMC,gBAAgB,GAAGA,CAAC,EACxBC,aAAa,EACbC,cAAc,EACQ,KAAI;EAC1B,MAAMC,KAAK,GAAGtB,QAAQ,EAAE;EACxB,MAAMuB,SAAS,GAAGb,YAAY,CAAC,EAAEU,aAAa,EAAE,CAAC;EACjD,MAAM,EAAEI,IAAI,EAAEC,IAAI,EAAEC,MAAM,EAAEC,OAAO,EAAEC,GAAG,EAAEC,QAAQ,EAAEC,cAAc,EAAE,GAClEtB,cAAc,CAACY,aAAa,EAAE;EAC5B,MAAM;EACN,MAAM;EACN,QAAQ;EACR,SAAS;EACT,KAAK;EACL,UAAU;EACV,gBAAgB;EACjB,CAAC;EAEJ,MAAMW,oBAAoB,GAAGA,CAACC,QAAkB,KAAI;IAClD,MAAMC,WAAW,GAAG,EAAET,IAAI,EAAEC,IAAI,EAAEC,MAAM,EAAEC,OAAO,EAAEC,GAAG,EAAEE,cAAc,EAAE;IAExE,OAAOvB,UAAU,CAAC0B,WAAW,CAAC;IAC3BC,IAAI,CAAC,CAAAC,QAAQ,KAAG;MACfH,QAAQ,CAACG,QAAQ,CAAC;IACpB,CAAC,CAAC;IACDC,KAAK,CAAC,CAAAC,QAAQ,KAAG;MAChBnC,oBAAoB,CAACmC,QAAQ,CAAC,CAACH,IAAI,CAAC,MAAK;QACvCb,cAAc,CAACtB,CAAC,CAAC,sCAAsC,CAAC,CAAC;MAC3D,CAAC,CAAC;IACJ,CAAC,CAAC;EACN,CAAC;EAED,MAAMuC,uBAAuB,GAAGA,CAACN,QAAkB,KAAI;IACrD,IAAIO,sBAAsB;IAE1B,IAAIV,QAAQ,EAAE;MACZU,sBAAsB,GAAG,GACvBC,MAAM,CAACC,QAAQ,CAACC,MAAM,GAAGF,MAAM,CAACC,QAAQ,CAACE,QAC3C,iBAAiBd,QAAQ,EAAE;MAC3BG,QAAQ,CAACO,sBAAsB,CAAC;KACjC;IAAM;MACLA,sBAAsB,GAAGxC,CAAC,CAAC,yCAAyC,CAAC;MACrEiC,QAAQ,CAACO,sBAAsB,CAAC;;EAEpC,CAAC;EACD,MAAMK,UAAU,GAAGA,CAACZ,QAAkB,KAAI;IACxCT,SAAS,CAACd,4BAA4B,EAAE;MACtCoC,QAAQ,EAAE;KACX,CAAC;IACF,IAAI5C,gBAAgB,CAACJ,WAAW,CAACiD,sBAAsB,CAAC,EAAE;MACxD,OAAOf,oBAAoB,CAACC,QAAQ,CAAC;;IAEvC,OAAOM,uBAAuB,CAACN,QAAQ,CAAC;EAC1C,CAAC;EAED,MAAMe,WAAW,GAAGA,CAACC,QAAiB,KAAI;IACxC,MAAMC,OAAO,GAAGD,QAAQ;IACpBjD,CAAC,CAAC,mCAAmC,CAAC;IACtCA,CAAC,CAAC,uCAAuC,CAAC;IAC9C,OACEe,KAAA,CAACX,MAAM,IAAC+C,UAAU,EAAC,OAAO,EAACD,OAAO,EAAEA,OAAQ,EAACE,QAAQ,EAAE,CAACH,QAAS,EAAAI,QAAA;MAC/DxC,IAAA,CAACK,UAAU,IACToC,SAAS,EACPL,QAAQ,GAAG1B,KAAK,CAACgC,MAAM,CAACC,OAAO,CAACC,IAAI,GAAGlC,KAAK,CAACgC,MAAM,CAACG,SAAS,CAACD,IAC/D,EACDE,QAAQ,EAAC,IAAI,GAEf;MAAC3D,CAAC,CAAC,WAAW,CAAC;IACT,CAAC;EAEb,CAAC;EAED,MAAMiD,QAAQ,GACZ,CAAC,CAACnB,QAAQ,IAAI5B,gBAAgB,CAACJ,WAAW,CAACiD,sBAAsB,CAAC;EAEpE,OACElC,IAAA,CAAAI,SAAA,IAAAoC,QAAA;IACGJ,QAAQ,GACPpC,IAAA,CAACN,eAAe,IACdqD,OAAO,EAAEf,UAAW,EACpBgB,OAAO,EAAE,KAAM,EACfC,QAAQ,EAAEd,WAAW,CAACC,QAAQ,CAAE,GAChC,GAEFD,WAAW,CAACC,QAAQ,CACrB;EACH,CAAG;AAEP,CAAC,CAACc,aAAA,CAvFI3C,gBAAgB,qIAINnB,QAAQ,EACJU,YAAY,EAE5BF,cAAc,SAAAuD,QAAA;AAkFH1D,UAAU,CAACc,gBAAgB,CAAC,CAA3C,eAAA4C,QAAA,CAA4C,mBAAAC,cAAA,UAAAC,oBAAA,mBAAAA,oBAAA,CAAAC,OAAA,GAAAC,SAAA,MAAAH,cAAA,WAAAA,cAAA,CAAAI,QAAA,CAnGtCnD,UAAU,2FAAA+C,cAAA,CAAAI,QAAA,CAUVjD,gBAAgB,iGAAA6C,cAAA,CAAAI,QAAA,CAAAL,QAAA,gHAAAM,WAAA,UAAAJ,oBAAA,mBAAAA,oBAAA,CAAAI,WAAA,GAAAF,SAAA,CAAAE,WAAA,IAAAA,WAAA,CAAAC,MAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}