{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { Select } from 'src/components';\nimport { styled, t } from '@superset-ui/core';\nimport { SQLEditor } from 'src/components/AsyncAceEditor';\nimport sqlKeywords from 'src/SqlLab/utils/sqlKeywords';\n\nimport adhocMetricType from 'src/explore/components/controls/MetricControl/adhocMetricType';\nimport columnType from 'src/explore/components/controls/FilterControl/columnType';\nimport AdhocFilter from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport { Clauses, ExpressionTypes } from '../types';import { jsx as _jsx, jsxs as _jsxs } from \"@emotion/react/jsx-runtime\";\n\nconst propTypes = {\n  adhocFilter: PropTypes.instanceOf(AdhocFilter).isRequired,\n  onChange: PropTypes.func.isRequired,\n  options: PropTypes.arrayOf(\n    PropTypes.oneOfType([\n    columnType,\n    PropTypes.shape({ saved_metric_name: PropTypes.string.isRequired }),\n    adhocMetricType]\n    )\n  ).isRequired,\n  height: PropTypes.number.isRequired\n};\n\nconst StyledSelect = styled(Select)`\n  ${({ theme }) => `\n    width: ${theme.gridUnit * 30}px;\n    marginRight: ${theme.gridUnit}px;\n  `}\n`;\n\nexport default class AdhocFilterEditPopoverSqlTabContent extends Component {\n  constructor(props) {\n    super(props);\n    this.onSqlExpressionChange = this.onSqlExpressionChange.bind(this);\n    this.onSqlExpressionClauseChange =\n    this.onSqlExpressionClauseChange.bind(this);\n    this.handleAceEditorRef = this.handleAceEditorRef.bind(this);\n  }\n\n  componentDidUpdate() {\n    if (this.aceEditorRef) {\n      this.aceEditorRef.editor.resize();\n    }\n  }\n\n  onSqlExpressionClauseChange(clause) {\n    this.props.onChange(\n      this.props.adhocFilter.duplicateWith({\n        clause,\n        expressionType: ExpressionTypes.Sql\n      })\n    );\n  }\n\n  onSqlExpressionChange(sqlExpression) {\n    this.props.onChange(\n      this.props.adhocFilter.duplicateWith({\n        sqlExpression,\n        expressionType: ExpressionTypes.Sql\n      })\n    );\n  }\n\n  handleAceEditorRef(ref) {\n    if (ref) {\n      this.aceEditorRef = ref;\n    }\n  }\n\n  render() {\n    const { adhocFilter, height, options } = this.props;\n\n    const keywords = sqlKeywords.concat(\n      options.\n      map((option) => {\n        if (option.column_name) {\n          return {\n            name: option.column_name,\n            value: option.column_name,\n            score: 50,\n            meta: 'option'\n          };\n        }\n        return null;\n      }).\n      filter(Boolean)\n    );\n    const selectOptions = Object.values(Clauses).map((clause) => ({\n      label: clause,\n      value: clause\n    }));\n\n    return (\n      _jsxs(\"span\", { children: [\n        _jsxs(\"div\", { className: \"filter-edit-clause-section\", children: [\n          _jsx(\"div\", { children:\n            _jsx(StyledSelect, {\n              options: selectOptions,\n              ariaLabel: t('Select column'),\n              placeholder: t('choose WHERE or HAVING...'),\n              value: adhocFilter.clause,\n              onChange: this.onSqlExpressionClauseChange }\n            ) }\n          ),\n          _jsxs(\"span\", { className: \"filter-edit-clause-info\", children: [\n            _jsx(\"strong\", { children: \"WHERE\" }), \" \", t('Filters by columns'),\n            _jsx(\"br\", {}),\n            _jsx(\"strong\", { children: \"HAVING\" }), \" \", t('Filters by metrics')] }\n          )] }\n        ),\n        _jsx(\"div\", { css: (theme) => ({ marginTop: theme.gridUnit * 4 }), children:\n          _jsx(SQLEditor, {\n            ref: this.handleAceEditorRef,\n            keywords: keywords,\n            height: `${height - 130}px`,\n            onChange: this.onSqlExpressionChange,\n            width: \"100%\",\n            showGutter: false,\n            value: adhocFilter.sqlExpression || adhocFilter.translateToSql(),\n            editorProps: { $blockScrolling: true },\n            enableLiveAutocompletion: true,\n            className: \"filter-sql-editor\",\n            wrapEnabled: true }\n          ) }\n        )] }\n      ));\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}AdhocFilterEditPopoverSqlTabContent.propTypes = propTypes;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/app/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSqlTabContent/index.jsx\");reactHotLoader.register(StyledSelect, \"StyledSelect\", \"/app/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSqlTabContent/index.jsx\");reactHotLoader.register(AdhocFilterEditPopoverSqlTabContent, \"AdhocFilterEditPopoverSqlTabContent\", \"/app/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSqlTabContent/index.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["Component","PropTypes","Select","styled","t","SQLEditor","sqlKeywords","adhocMetricType","columnType","AdhocFilter","Clauses","ExpressionTypes","jsx","_jsx","jsxs","_jsxs","propTypes","adhocFilter","instanceOf","isRequired","onChange","func","options","arrayOf","oneOfType","shape","saved_metric_name","string","height","number","StyledSelect","theme","gridUnit","AdhocFilterEditPopoverSqlTabContent","constructor","props","onSqlExpressionChange","bind","onSqlExpressionClauseChange","handleAceEditorRef","componentDidUpdate","aceEditorRef","editor","resize","clause","duplicateWith","expressionType","Sql","sqlExpression","ref","render","keywords","concat","map","option","column_name","name","value","score","meta","filter","Boolean","selectOptions","Object","values","label","children","className","ariaLabel","placeholder","css","marginTop","width","showGutter","translateToSql","editorProps","$blockScrolling","enableLiveAutocompletion","wrapEnabled","__reactstandin__regenerateByEval","key","code","eval","reactHotLoader","reactHotLoaderGlobal","default","undefined","register","leaveModule","module"],"sources":["/app/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSqlTabContent/index.jsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { Select } from 'src/components';\nimport { styled, t } from '@superset-ui/core';\nimport { SQLEditor } from 'src/components/AsyncAceEditor';\nimport sqlKeywords from 'src/SqlLab/utils/sqlKeywords';\n\nimport adhocMetricType from 'src/explore/components/controls/MetricControl/adhocMetricType';\nimport columnType from 'src/explore/components/controls/FilterControl/columnType';\nimport AdhocFilter from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport { Clauses, ExpressionTypes } from '../types';\n\nconst propTypes = {\n  adhocFilter: PropTypes.instanceOf(AdhocFilter).isRequired,\n  onChange: PropTypes.func.isRequired,\n  options: PropTypes.arrayOf(\n    PropTypes.oneOfType([\n      columnType,\n      PropTypes.shape({ saved_metric_name: PropTypes.string.isRequired }),\n      adhocMetricType,\n    ]),\n  ).isRequired,\n  height: PropTypes.number.isRequired,\n};\n\nconst StyledSelect = styled(Select)`\n  ${({ theme }) => `\n    width: ${theme.gridUnit * 30}px;\n    marginRight: ${theme.gridUnit}px;\n  `}\n`;\n\nexport default class AdhocFilterEditPopoverSqlTabContent extends Component {\n  constructor(props) {\n    super(props);\n    this.onSqlExpressionChange = this.onSqlExpressionChange.bind(this);\n    this.onSqlExpressionClauseChange =\n      this.onSqlExpressionClauseChange.bind(this);\n    this.handleAceEditorRef = this.handleAceEditorRef.bind(this);\n  }\n\n  componentDidUpdate() {\n    if (this.aceEditorRef) {\n      this.aceEditorRef.editor.resize();\n    }\n  }\n\n  onSqlExpressionClauseChange(clause) {\n    this.props.onChange(\n      this.props.adhocFilter.duplicateWith({\n        clause,\n        expressionType: ExpressionTypes.Sql,\n      }),\n    );\n  }\n\n  onSqlExpressionChange(sqlExpression) {\n    this.props.onChange(\n      this.props.adhocFilter.duplicateWith({\n        sqlExpression,\n        expressionType: ExpressionTypes.Sql,\n      }),\n    );\n  }\n\n  handleAceEditorRef(ref) {\n    if (ref) {\n      this.aceEditorRef = ref;\n    }\n  }\n\n  render() {\n    const { adhocFilter, height, options } = this.props;\n\n    const keywords = sqlKeywords.concat(\n      options\n        .map(option => {\n          if (option.column_name) {\n            return {\n              name: option.column_name,\n              value: option.column_name,\n              score: 50,\n              meta: 'option',\n            };\n          }\n          return null;\n        })\n        .filter(Boolean),\n    );\n    const selectOptions = Object.values(Clauses).map(clause => ({\n      label: clause,\n      value: clause,\n    }));\n\n    return (\n      <span>\n        <div className=\"filter-edit-clause-section\">\n          <div>\n            <StyledSelect\n              options={selectOptions}\n              ariaLabel={t('Select column')}\n              placeholder={t('choose WHERE or HAVING...')}\n              value={adhocFilter.clause}\n              onChange={this.onSqlExpressionClauseChange}\n            />\n          </div>\n          <span className=\"filter-edit-clause-info\">\n            <strong>WHERE</strong> {t('Filters by columns')}\n            <br />\n            <strong>HAVING</strong> {t('Filters by metrics')}\n          </span>\n        </div>\n        <div css={theme => ({ marginTop: theme.gridUnit * 4 })}>\n          <SQLEditor\n            ref={this.handleAceEditorRef}\n            keywords={keywords}\n            height={`${height - 130}px`}\n            onChange={this.onSqlExpressionChange}\n            width=\"100%\"\n            showGutter={false}\n            value={adhocFilter.sqlExpression || adhocFilter.translateToSql()}\n            editorProps={{ $blockScrolling: true }}\n            enableLiveAutocompletion\n            className=\"filter-sql-editor\"\n            wrapEnabled\n          />\n        </div>\n      </span>\n    );\n  }\n}\nAdhocFilterEditPopoverSqlTabContent.propTypes = propTypes;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}