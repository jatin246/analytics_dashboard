{"ast":null,"code":"import _uniq from \"lodash/uniq\";import _isEqual from \"lodash/isEqual\";import _debounce from \"lodash/debounce\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { forwardRef, useEffect, useMemo, useState, useCallback } from 'react';\nimport { ensureIsArray, formatNumber, NumberFormats, t, usePrevious } from '@superset-ui/core';\nimport AntdSelect from 'antd/lib/select';\n\nimport { FAST_DEBOUNCE } from 'src/constants';\nimport { getValue, hasOption, isLabeledValue, renderSelectOptions, sortSelectedFirstHelper, sortComparatorWithSearchHelper, handleFilterOptionHelper, dropDownRenderHelper, getSuffixIcon, SELECT_ALL_VALUE, selectAllOption, mapValues, mapOptions, hasCustomLabels, getOption, isObject, isEqual as utilsIsEqual } from './utils';\nimport { StyledCheckOutlined, StyledContainer, StyledHeader, StyledSelect, StyledStopOutlined } from './styles';\nimport { EMPTY_OPTIONS, MAX_TAG_COUNT, TOKEN_SEPARATORS, DEFAULT_SORT_COMPARATOR } from './constants';\nimport { customTagRender } from './CustomTag';\n/**\n * This component is a customized version of the Antdesign 4.X Select component\n * https://ant.design/components/select/.\n * This Select component provides an API that is tested against all the different use cases of Superset.\n * It limits and overrides the existing Antdesign API in order to keep their usage to the minimum\n * and to enforce simplification and standardization.\n * It is divided into two macro categories, Static and Async.\n * The Static type accepts a static array of options.\n * The Async type accepts a promise that will return the options.\n * Each of the categories come with different abilities. For a comprehensive guide please refer to\n * the storybook in src/components/Select/Select.stories.tsx.\n */import { jsx as _jsx, jsxs as _jsxs } from \"@emotion/react/jsx-runtime\";\nconst Select = /*#__PURE__*/forwardRef(__signature__(({ allowClear, allowNewOptions = false, allowSelectAll = true, ariaLabel, autoClearSearchValue = false, filterOption = true, header = null, headerPosition = 'top', helperText, invertSelection = false, labelInValue = false, loading, mode = 'single', name, notFoundContent, onBlur, onChange, onClear, onDropdownVisibleChange, onDeselect, onSearch, onSelect, optionFilterProps = ['label', 'value'], options, placeholder = t('Select ...'), showSearch = true, sortComparator = DEFAULT_SORT_COMPARATOR, tokenSeparators = TOKEN_SEPARATORS, value, getPopupContainer, oneLine, maxTagCount: propsMaxTagCount, ...props }, ref) => {\n  const isSingleMode = mode === 'single';\n  const shouldShowSearch = allowNewOptions ? true : showSearch;\n  const [selectValue, setSelectValue] = useState(value);\n  const [inputValue, setInputValue] = useState('');\n  const [isLoading, setIsLoading] = useState(loading);\n  const [isDropdownVisible, setIsDropdownVisible] = useState(false);\n  const [maxTagCount, setMaxTagCount] = useState(propsMaxTagCount != null ? propsMaxTagCount : MAX_TAG_COUNT);\n  const [onChangeCount, setOnChangeCount] = useState(0);\n  const previousChangeCount = usePrevious(onChangeCount, 0);\n  const fireOnChange = useCallback(() => setOnChangeCount(onChangeCount + 1), [onChangeCount]);\n  useEffect(() => {\n    if (oneLine) {\n      setMaxTagCount(isDropdownVisible ? 0 : 1);\n    }\n  }, [isDropdownVisible, oneLine]);\n  const mappedMode = isSingleMode ? undefined : 'multiple';\n  const { Option } = AntdSelect;\n  const sortSelectedFirst = useCallback((a, b) => sortSelectedFirstHelper(a, b, selectValue), [selectValue]);\n  const sortComparatorWithSearch = useCallback((a, b) => sortComparatorWithSearchHelper(a, b, inputValue, sortSelectedFirst, sortComparator), [inputValue, sortComparator, sortSelectedFirst]);\n  const initialOptions = useMemo(() => Array.isArray(options) ? options.slice() : EMPTY_OPTIONS, [options]);\n  const initialOptionsSorted = useMemo(() => initialOptions.slice().sort(sortSelectedFirst), [initialOptions, sortSelectedFirst]);\n  const [selectOptions, setSelectOptions] = useState(initialOptionsSorted);\n  // add selected values to options list if they are not in it\n  const fullSelectOptions = useMemo(() => {\n    // check to see if selectOptions are grouped\n    let groupedOptions;\n    if (selectOptions.some((opt) => opt.options)) {\n      groupedOptions = selectOptions.reduce((acc, group) => [...acc, ...group.options], []);\n    }\n    const missingValues = ensureIsArray(selectValue).\n    filter((opt) => !hasOption(getValue(opt), groupedOptions || selectOptions)).\n    map((opt) => isLabeledValue(opt) ? opt : { value: opt, label: String(opt) });\n    const result = missingValues.length > 0 ?\n    missingValues.concat(selectOptions) :\n    selectOptions;\n    return result.filter((opt) => opt.value !== SELECT_ALL_VALUE);\n  }, [selectOptions, selectValue]);\n  const enabledOptions = useMemo(() => fullSelectOptions.filter((option) => !option.disabled), [fullSelectOptions]);\n  const selectAllEligible = useMemo(() => fullSelectOptions.filter((option) => hasOption(option.value, selectValue) || !option.disabled), [fullSelectOptions, selectValue]);\n  const selectAllEnabled = useMemo(() => !isSingleMode &&\n  allowSelectAll &&\n  selectOptions.length > 0 &&\n  enabledOptions.length > 1 &&\n  !inputValue, [\n  isSingleMode,\n  allowSelectAll,\n  selectOptions.length,\n  enabledOptions.length,\n  inputValue]\n  );\n  const selectAllMode = useMemo(() => ensureIsArray(selectValue).length === selectAllEligible.length + 1, [selectValue, selectAllEligible]);\n  const handleOnSelect = (selectedItem, option) => {\n    if (isSingleMode) {\n      // on select is fired in single value mode if the same value is selected\n      const valueChanged = !utilsIsEqual(selectedItem, selectValue, 'value');\n      setSelectValue(selectedItem);\n      if (valueChanged) {\n        fireOnChange();\n      }\n    } else\n    {\n      setSelectValue((previousState) => {\n        const array = ensureIsArray(previousState);\n        const value = getValue(selectedItem);\n        // Tokenized values can contain duplicated values\n        if (value === getValue(SELECT_ALL_VALUE)) {\n          if (isLabeledValue(selectedItem)) {\n            return [\n            ...selectAllEligible,\n            selectAllOption];\n\n          }\n          return [\n          SELECT_ALL_VALUE,\n          ...selectAllEligible.map((opt) => opt.value)];\n\n        }\n        if (!hasOption(value, array)) {\n          const result = [...array, selectedItem];\n          if (result.length === selectAllEligible.length &&\n          selectAllEnabled) {\n            return isLabeledValue(selectedItem) ?\n            [...result, selectAllOption] :\n            [...result, SELECT_ALL_VALUE];\n          }\n          return result;\n        }\n        return previousState;\n      });\n      fireOnChange();\n    }\n    onSelect == null ? void 0 : onSelect(selectedItem, option);\n  };\n  const clear = () => {\n    if (isSingleMode) {\n      setSelectValue(undefined);\n    } else\n    {\n      setSelectValue(fullSelectOptions.\n      filter((option) => option.disabled && hasOption(option.value, selectValue)).\n      map((option) => labelInValue ?\n      { label: option.label, value: option.value } :\n      option.value));\n    }\n    fireOnChange();\n  };\n  const handleOnDeselect = (value, option) => {\n    if (Array.isArray(selectValue)) {\n      if (getValue(value) === getValue(SELECT_ALL_VALUE)) {\n        clear();\n      } else\n      {\n        let array = selectValue;\n        array = array.filter((element) => getValue(element) !== getValue(value));\n        // if this was not a new item, deselect select all option\n        if (selectAllMode && !option.isNewOption) {\n          array = array.filter((element) => getValue(element) !== SELECT_ALL_VALUE);\n        }\n        setSelectValue(array);\n        // removes new option\n        if (option.isNewOption) {\n          setSelectOptions(fullSelectOptions.filter((option) => getValue(option.value) !== getValue(value)));\n        }\n      }\n    }\n    fireOnChange();\n    onDeselect == null ? void 0 : onDeselect(value, option);\n  };\n  const handleOnSearch = _debounce((search) => {\n    const searchValue = search.trim();\n    if (allowNewOptions) {\n      const newOption = searchValue &&\n      !hasOption(searchValue, fullSelectOptions, true) && {\n        label: searchValue,\n        value: searchValue,\n        isNewOption: true\n      };\n      const cleanSelectOptions = ensureIsArray(fullSelectOptions).filter((opt) => !opt.isNewOption || hasOption(opt.value, selectValue));\n      const newOptions = newOption ?\n      [newOption, ...cleanSelectOptions] :\n      cleanSelectOptions;\n      setSelectOptions(newOptions);\n    }\n    setInputValue(searchValue);\n    onSearch == null ? void 0 : onSearch(searchValue);\n  }, FAST_DEBOUNCE);\n  useEffect(() => () => handleOnSearch.cancel(), [handleOnSearch]);\n  const handleFilterOption = (search, option) => handleFilterOptionHelper(search, option, optionFilterProps, filterOption);\n  const handleOnDropdownVisibleChange = (isDropdownVisible) => {\n    setIsDropdownVisible(isDropdownVisible);\n    // if no search input value, force sort options because it won't be sorted by\n    // `filterSort`.\n    if (isDropdownVisible && !inputValue && selectOptions.length > 1) {\n      if (!_isEqual(initialOptionsSorted, selectOptions)) {\n        setSelectOptions(initialOptionsSorted);\n      }\n    }\n    if (onDropdownVisibleChange) {\n      onDropdownVisibleChange(isDropdownVisible);\n    }\n  };\n  const dropdownRender = (originNode) => dropDownRenderHelper(originNode, isDropdownVisible, isLoading, fullSelectOptions.length, helperText);\n  const handleClear = () => {\n    clear();\n    if (onClear) {\n      onClear();\n    }\n  };\n  useEffect(() => {\n    // when `options` list is updated from component prop, reset states\n    setSelectOptions(initialOptions);\n  }, [initialOptions]);\n  useEffect(() => {\n    if (loading !== undefined && loading !== isLoading) {\n      setIsLoading(loading);\n    }\n  }, [isLoading, loading]);\n  useEffect(() => {\n    setSelectValue(value);\n  }, [value]);\n  useEffect(() => {\n    // if all values are selected, add select all to value\n    if (selectAllEnabled &&\n    ensureIsArray(value).length === selectAllEligible.length) {\n      setSelectValue(labelInValue ?\n      [...ensureIsArray(value), selectAllOption] :\n      [...ensureIsArray(value), SELECT_ALL_VALUE]);\n    }\n  }, [labelInValue, selectAllEligible.length, selectAllEnabled, value]);\n  useEffect(() => {\n    const checkSelectAll = ensureIsArray(selectValue).some((v) => getValue(v) === SELECT_ALL_VALUE);\n    if (checkSelectAll && !selectAllMode) {\n      const optionsToSelect = selectAllEligible.map((option) => labelInValue ? option : option.value);\n      optionsToSelect.push(labelInValue ? selectAllOption : SELECT_ALL_VALUE);\n      setSelectValue(optionsToSelect);\n      fireOnChange();\n    }\n  }, [\n  selectValue,\n  selectAllMode,\n  labelInValue,\n  selectAllEligible,\n  fireOnChange]\n  );\n  const selectAllLabel = useMemo(() => () =>\n  // TODO: localize\n  `${SELECT_ALL_VALUE} (${formatNumber(NumberFormats.INTEGER, selectAllEligible.length)})`, [selectAllEligible]);\n  const handleOnBlur = (event) => {\n    setInputValue('');\n    onBlur == null ? void 0 : onBlur(event);\n  };\n  const handleOnChange = useCallback((values, options) => {\n    // intercept onChange call to handle the select all case\n    // if the \"select all\" option is selected, we want to send all options to the onChange,\n    // otherwise we want to remove\n    let newValues = values;\n    let newOptions = options;\n    if (!isSingleMode) {\n      if (ensureIsArray(newValues).some((val) => getValue(val) === SELECT_ALL_VALUE)) {\n        // send all options to onchange if all are not currently there\n        if (!selectAllMode) {\n          newValues = mapValues(selectAllEligible, labelInValue);\n          newOptions = mapOptions(selectAllEligible);\n        } else\n        {\n          newValues = ensureIsArray(values).filter((val) => getValue(val) !== SELECT_ALL_VALUE);\n        }\n      } else\n      if (ensureIsArray(values).length === selectAllEligible.length &&\n      selectAllMode) {\n        const array = selectAllEligible.filter((option) => hasOption(option.value, selectValue) && option.disabled);\n        newValues = mapValues(array, labelInValue);\n        newOptions = mapOptions(array);\n      }\n    }\n    onChange == null ? void 0 : onChange(newValues, newOptions);\n  }, [\n  isSingleMode,\n  labelInValue,\n  onChange,\n  selectAllEligible,\n  selectAllMode,\n  selectValue]\n  );\n  useEffect(() => {\n    if (onChangeCount !== previousChangeCount) {\n      const array = ensureIsArray(selectValue);\n      const set = new Set(array.map(getValue));\n      const options = mapOptions(fullSelectOptions.filter((opt) => set.has(opt.value)));\n      if (isSingleMode) {\n        handleOnChange(selectValue, selectValue ? options[0] : undefined);\n      } else\n      {\n        handleOnChange(array, options);\n      }\n    }\n  }, [\n  fullSelectOptions,\n  handleOnChange,\n  isSingleMode,\n  onChange,\n  onChangeCount,\n  previousChangeCount,\n  selectValue]\n  );\n  const shouldRenderChildrenOptions = useMemo(() => selectAllEnabled || hasCustomLabels(options), [selectAllEnabled, options]);\n  const omittedCount = useMemo(() => {\n    const num_selected = ensureIsArray(selectValue).length;\n    const num_shown = maxTagCount;\n    return num_selected - num_shown - (selectAllMode ? 1 : 0);\n  }, [maxTagCount, selectAllMode, selectValue]);\n  const customMaxTagPlaceholder = () => `+ ${omittedCount > 0 ? omittedCount : 1} ...`;\n  // We can't remove the + tag so when Select All\n  // is the only item omitted, we subtract one from maxTagCount\n  let actualMaxTagCount = maxTagCount;\n  if (actualMaxTagCount !== 'responsive' &&\n  omittedCount === 0 &&\n  selectAllMode) {\n    actualMaxTagCount -= 1;\n  }\n  const getPastedTextValue = useCallback((text) => {\n    const option = getOption(text, fullSelectOptions, true);\n    if (!option && !allowNewOptions) {\n      return undefined;\n    }\n    if (labelInValue) {\n      const value = {\n        label: text,\n        value: text\n      };\n      if (option) {\n        value.label = isObject(option) ? option.label : option;\n        value.value = isObject(option) ? option.value : option;\n      }\n      return value;\n    }\n    return option ? isObject(option) ? option.value : option : text;\n  }, [allowNewOptions, fullSelectOptions, labelInValue]);\n  const onPaste = (e) => {\n    const pastedText = e.clipboardData.getData('text');\n    if (isSingleMode) {\n      const value = getPastedTextValue(pastedText);\n      if (value) {\n        setSelectValue(value);\n      }\n    } else\n    {\n      const token = tokenSeparators.find((token) => pastedText.includes(token));\n      const array = token ? _uniq(pastedText.split(token)) : [pastedText];\n      const values = array.\n      map((item) => getPastedTextValue(item)).\n      filter((item) => item !== undefined);\n      if (labelInValue) {\n        setSelectValue((previous) => [\n        ...(previous || []),\n        ...values]\n        );\n      } else\n      {\n        setSelectValue((previous) => [\n        ...(previous || []),\n        ...values]\n        );\n      }\n    }\n    fireOnChange();\n  };\n  return _jsxs(StyledContainer, { headerPosition: headerPosition, children: [\n    header && _jsx(StyledHeader, { headerPosition: headerPosition, children: header }),\n    _jsxs(StyledSelect, { allowClear: !isLoading && allowClear, \"aria-label\": ariaLabel || name, autoClearSearchValue: autoClearSearchValue, dropdownRender: dropdownRender, filterOption: handleFilterOption, filterSort: sortComparatorWithSearch, getPopupContainer: getPopupContainer || ((triggerNode) => triggerNode.parentNode), headerPosition: headerPosition, labelInValue: labelInValue, maxTagCount: actualMaxTagCount, maxTagPlaceholder: customMaxTagPlaceholder, mode: mappedMode, notFoundContent: isLoading ? t('Loading...') : notFoundContent, onBlur: handleOnBlur, onDeselect: handleOnDeselect, onDropdownVisibleChange: handleOnDropdownVisibleChange\n      // @ts-ignore\n      , onPaste: onPaste, onPopupScroll: undefined, onSearch: shouldShowSearch ? handleOnSearch : undefined, onSelect: handleOnSelect, onClear: handleClear, placeholder: placeholder, showSearch: shouldShowSearch, showArrow: true, tokenSeparators: tokenSeparators, value: selectValue, suffixIcon: getSuffixIcon(isLoading, shouldShowSearch, isDropdownVisible), menuItemSelectedIcon: invertSelection ? _jsx(StyledStopOutlined, { iconSize: \"m\", \"aria-label\": \"stop\" }) : _jsx(StyledCheckOutlined, { iconSize: \"m\", \"aria-label\": \"check\" }), options: shouldRenderChildrenOptions ? undefined : fullSelectOptions, oneLine: oneLine, tagRender: customTagRender, ...props, ref: ref, children: [\n      selectAllEnabled && _jsx(Option, { id: \"select-all\", className: \"select-all\", value: SELECT_ALL_VALUE, children:\n        selectAllLabel() }, SELECT_ALL_VALUE\n      ),\n      shouldRenderChildrenOptions &&\n      renderSelectOptions(fullSelectOptions)] }\n    )] }\n  );\n}, \"useState{[selectValue, setSelectValue](value)}\\nuseState{[inputValue, setInputValue]('')}\\nuseState{[isLoading, setIsLoading](loading)}\\nuseState{[isDropdownVisible, setIsDropdownVisible](false)}\\nuseState{[maxTagCount, setMaxTagCount](propsMaxTagCount ?? MAX_TAG_COUNT)}\\nuseState{[onChangeCount, setOnChangeCount](0)}\\nusePrevious{previousChangeCount}\\nuseCallback{fireOnChange}\\nuseEffect{}\\nuseCallback{sortSelectedFirst}\\nuseCallback{sortComparatorWithSearch}\\nuseMemo{initialOptions}\\nuseMemo{initialOptionsSorted}\\nuseState{[selectOptions, setSelectOptions](initialOptionsSorted)}\\nuseMemo{fullSelectOptions}\\nuseMemo{enabledOptions}\\nuseMemo{selectAllEligible}\\nuseMemo{selectAllEnabled}\\nuseMemo{selectAllMode}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseMemo{selectAllLabel}\\nuseCallback{handleOnChange}\\nuseEffect{}\\nuseMemo{shouldRenderChildrenOptions}\\nuseMemo{omittedCount}\\nuseCallback{getPastedTextValue}\", () => [usePrevious]));const _default =\nSelect;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(Select, \"Select\", \"/app/superset-frontend/src/components/Select/Select.tsx\");reactHotLoader.register(_default, \"default\", \"/app/superset-frontend/src/components/Select/Select.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["forwardRef","useEffect","useMemo","useState","useCallback","ensureIsArray","formatNumber","NumberFormats","t","usePrevious","AntdSelect","FAST_DEBOUNCE","getValue","hasOption","isLabeledValue","renderSelectOptions","sortSelectedFirstHelper","sortComparatorWithSearchHelper","handleFilterOptionHelper","dropDownRenderHelper","getSuffixIcon","SELECT_ALL_VALUE","selectAllOption","mapValues","mapOptions","hasCustomLabels","getOption","isObject","isEqual","utilsIsEqual","StyledCheckOutlined","StyledContainer","StyledHeader","StyledSelect","StyledStopOutlined","EMPTY_OPTIONS","MAX_TAG_COUNT","TOKEN_SEPARATORS","DEFAULT_SORT_COMPARATOR","customTagRender","jsx","_jsx","jsxs","_jsxs","Select","__signature__","allowClear","allowNewOptions","allowSelectAll","ariaLabel","autoClearSearchValue","filterOption","header","headerPosition","helperText","invertSelection","labelInValue","loading","mode","name","notFoundContent","onBlur","onChange","onClear","onDropdownVisibleChange","onDeselect","onSearch","onSelect","optionFilterProps","options","placeholder","showSearch","sortComparator","tokenSeparators","value","getPopupContainer","oneLine","maxTagCount","propsMaxTagCount","props","ref","isSingleMode","shouldShowSearch","selectValue","setSelectValue","inputValue","setInputValue","isLoading","setIsLoading","isDropdownVisible","setIsDropdownVisible","setMaxTagCount","onChangeCount","setOnChangeCount","previousChangeCount","fireOnChange","mappedMode","undefined","Option","sortSelectedFirst","a","b","sortComparatorWithSearch","initialOptions","Array","isArray","slice","initialOptionsSorted","sort","selectOptions","setSelectOptions","fullSelectOptions","groupedOptions","some","opt","reduce","acc","group","missingValues","filter","map","label","String","result","length","concat","enabledOptions","option","disabled","selectAllEligible","selectAllEnabled","selectAllMode","handleOnSelect","selectedItem","valueChanged","previousState","array","clear","handleOnDeselect","element","isNewOption","handleOnSearch","_debounce","search","searchValue","trim","newOption","cleanSelectOptions","newOptions","cancel","handleFilterOption","handleOnDropdownVisibleChange","_isEqual","dropdownRender","originNode","handleClear","checkSelectAll","v","optionsToSelect","push","selectAllLabel","INTEGER","handleOnBlur","event","handleOnChange","values","newValues","val","set","Set","has","shouldRenderChildrenOptions","omittedCount","num_selected","num_shown","customMaxTagPlaceholder","actualMaxTagCount","getPastedTextValue","text","onPaste","e","pastedText","clipboardData","getData","token","find","includes","_uniq","split","item","previous","children","filterSort","triggerNode","parentNode","maxTagPlaceholder","onPopupScroll","showArrow","suffixIcon","menuItemSelectedIcon","iconSize","tagRender","id","className","_default","reactHotLoader","reactHotLoaderGlobal","default","register","leaveModule","module"],"sources":["/app/superset-frontend/src/components/Select/Select.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  forwardRef,\n  FocusEvent,\n  ReactElement,\n  RefObject,\n  useEffect,\n  useMemo,\n  useState,\n  useCallback,\n  ClipboardEvent,\n} from 'react';\n\nimport {\n  ensureIsArray,\n  formatNumber,\n  NumberFormats,\n  t,\n  usePrevious,\n} from '@superset-ui/core';\nimport AntdSelect, { LabeledValue as AntdLabeledValue } from 'antd/lib/select';\nimport { debounce, isEqual, uniq } from 'lodash';\nimport { FAST_DEBOUNCE } from 'src/constants';\nimport {\n  getValue,\n  hasOption,\n  isLabeledValue,\n  renderSelectOptions,\n  sortSelectedFirstHelper,\n  sortComparatorWithSearchHelper,\n  handleFilterOptionHelper,\n  dropDownRenderHelper,\n  getSuffixIcon,\n  SELECT_ALL_VALUE,\n  selectAllOption,\n  mapValues,\n  mapOptions,\n  hasCustomLabels,\n  getOption,\n  isObject,\n  isEqual as utilsIsEqual,\n} from './utils';\nimport { RawValue, SelectOptionsType, SelectProps } from './types';\nimport {\n  StyledCheckOutlined,\n  StyledContainer,\n  StyledHeader,\n  StyledSelect,\n  StyledStopOutlined,\n} from './styles';\nimport {\n  EMPTY_OPTIONS,\n  MAX_TAG_COUNT,\n  TOKEN_SEPARATORS,\n  DEFAULT_SORT_COMPARATOR,\n} from './constants';\nimport { customTagRender } from './CustomTag';\n\n/**\n * This component is a customized version of the Antdesign 4.X Select component\n * https://ant.design/components/select/.\n * This Select component provides an API that is tested against all the different use cases of Superset.\n * It limits and overrides the existing Antdesign API in order to keep their usage to the minimum\n * and to enforce simplification and standardization.\n * It is divided into two macro categories, Static and Async.\n * The Static type accepts a static array of options.\n * The Async type accepts a promise that will return the options.\n * Each of the categories come with different abilities. For a comprehensive guide please refer to\n * the storybook in src/components/Select/Select.stories.tsx.\n */\nconst Select = forwardRef(\n  (\n    {\n      allowClear,\n      allowNewOptions = false,\n      allowSelectAll = true,\n      ariaLabel,\n      autoClearSearchValue = false,\n      filterOption = true,\n      header = null,\n      headerPosition = 'top',\n      helperText,\n      invertSelection = false,\n      labelInValue = false,\n      loading,\n      mode = 'single',\n      name,\n      notFoundContent,\n      onBlur,\n      onChange,\n      onClear,\n      onDropdownVisibleChange,\n      onDeselect,\n      onSearch,\n      onSelect,\n      optionFilterProps = ['label', 'value'],\n      options,\n      placeholder = t('Select ...'),\n      showSearch = true,\n      sortComparator = DEFAULT_SORT_COMPARATOR,\n      tokenSeparators = TOKEN_SEPARATORS,\n      value,\n      getPopupContainer,\n      oneLine,\n      maxTagCount: propsMaxTagCount,\n      ...props\n    }: SelectProps,\n    ref: RefObject<HTMLInputElement>,\n  ) => {\n    const isSingleMode = mode === 'single';\n    const shouldShowSearch = allowNewOptions ? true : showSearch;\n    const [selectValue, setSelectValue] = useState(value);\n    const [inputValue, setInputValue] = useState('');\n    const [isLoading, setIsLoading] = useState(loading);\n    const [isDropdownVisible, setIsDropdownVisible] = useState(false);\n    const [maxTagCount, setMaxTagCount] = useState(\n      propsMaxTagCount ?? MAX_TAG_COUNT,\n    );\n    const [onChangeCount, setOnChangeCount] = useState(0);\n    const previousChangeCount = usePrevious(onChangeCount, 0);\n\n    const fireOnChange = useCallback(\n      () => setOnChangeCount(onChangeCount + 1),\n      [onChangeCount],\n    );\n\n    useEffect(() => {\n      if (oneLine) {\n        setMaxTagCount(isDropdownVisible ? 0 : 1);\n      }\n    }, [isDropdownVisible, oneLine]);\n\n    const mappedMode = isSingleMode ? undefined : 'multiple';\n\n    const { Option } = AntdSelect;\n\n    const sortSelectedFirst = useCallback(\n      (a: AntdLabeledValue, b: AntdLabeledValue) =>\n        sortSelectedFirstHelper(a, b, selectValue),\n      [selectValue],\n    );\n    const sortComparatorWithSearch = useCallback(\n      (a: AntdLabeledValue, b: AntdLabeledValue) =>\n        sortComparatorWithSearchHelper(\n          a,\n          b,\n          inputValue,\n          sortSelectedFirst,\n          sortComparator,\n        ),\n      [inputValue, sortComparator, sortSelectedFirst],\n    );\n\n    const initialOptions = useMemo(\n      () => (Array.isArray(options) ? options.slice() : EMPTY_OPTIONS),\n      [options],\n    );\n    const initialOptionsSorted = useMemo(\n      () => initialOptions.slice().sort(sortSelectedFirst),\n      [initialOptions, sortSelectedFirst],\n    );\n\n    const [selectOptions, setSelectOptions] =\n      useState<SelectOptionsType>(initialOptionsSorted);\n\n    // add selected values to options list if they are not in it\n    const fullSelectOptions = useMemo(() => {\n      // check to see if selectOptions are grouped\n      let groupedOptions: SelectOptionsType;\n      if (selectOptions.some(opt => opt.options)) {\n        groupedOptions = selectOptions.reduce(\n          (acc, group) => [...acc, ...group.options],\n          [] as SelectOptionsType,\n        );\n      }\n      const missingValues: SelectOptionsType = ensureIsArray(selectValue)\n        .filter(\n          opt => !hasOption(getValue(opt), groupedOptions || selectOptions),\n        )\n        .map(opt =>\n          isLabeledValue(opt) ? opt : { value: opt, label: String(opt) },\n        );\n      const result =\n        missingValues.length > 0\n          ? missingValues.concat(selectOptions)\n          : selectOptions;\n      return result.filter(opt => opt.value !== SELECT_ALL_VALUE);\n    }, [selectOptions, selectValue]);\n\n    const enabledOptions = useMemo(\n      () => fullSelectOptions.filter(option => !option.disabled),\n      [fullSelectOptions],\n    );\n\n    const selectAllEligible = useMemo(\n      () =>\n        fullSelectOptions.filter(\n          option => hasOption(option.value, selectValue) || !option.disabled,\n        ),\n      [fullSelectOptions, selectValue],\n    );\n\n    const selectAllEnabled = useMemo(\n      () =>\n        !isSingleMode &&\n        allowSelectAll &&\n        selectOptions.length > 0 &&\n        enabledOptions.length > 1 &&\n        !inputValue,\n      [\n        isSingleMode,\n        allowSelectAll,\n        selectOptions.length,\n        enabledOptions.length,\n        inputValue,\n      ],\n    );\n\n    const selectAllMode = useMemo(\n      () => ensureIsArray(selectValue).length === selectAllEligible.length + 1,\n      [selectValue, selectAllEligible],\n    );\n\n    const handleOnSelect: SelectProps['onSelect'] = (selectedItem, option) => {\n      if (isSingleMode) {\n        // on select is fired in single value mode if the same value is selected\n        const valueChanged = !utilsIsEqual(\n          selectedItem,\n          selectValue as RawValue | AntdLabeledValue,\n          'value',\n        );\n        setSelectValue(selectedItem);\n        if (valueChanged) {\n          fireOnChange();\n        }\n      } else {\n        setSelectValue(previousState => {\n          const array = ensureIsArray(previousState);\n          const value = getValue(selectedItem);\n          // Tokenized values can contain duplicated values\n          if (value === getValue(SELECT_ALL_VALUE)) {\n            if (isLabeledValue(selectedItem)) {\n              return [\n                ...selectAllEligible,\n                selectAllOption,\n              ] as AntdLabeledValue[];\n            }\n            return [\n              SELECT_ALL_VALUE,\n              ...selectAllEligible.map(opt => opt.value),\n            ] as AntdLabeledValue[];\n          }\n          if (!hasOption(value, array)) {\n            const result = [...array, selectedItem];\n            if (\n              result.length === selectAllEligible.length &&\n              selectAllEnabled\n            ) {\n              return isLabeledValue(selectedItem)\n                ? ([...result, selectAllOption] as AntdLabeledValue[])\n                : ([...result, SELECT_ALL_VALUE] as (string | number)[]);\n            }\n            return result as AntdLabeledValue[];\n          }\n          return previousState;\n        });\n        fireOnChange();\n      }\n      onSelect?.(selectedItem, option);\n    };\n\n    const clear = () => {\n      if (isSingleMode) {\n        setSelectValue(undefined);\n      } else {\n        setSelectValue(\n          fullSelectOptions\n            .filter(\n              option => option.disabled && hasOption(option.value, selectValue),\n            )\n            .map(option =>\n              labelInValue\n                ? { label: option.label, value: option.value }\n                : option.value,\n            ),\n        );\n      }\n      fireOnChange();\n    };\n\n    const handleOnDeselect: SelectProps['onDeselect'] = (value, option) => {\n      if (Array.isArray(selectValue)) {\n        if (getValue(value) === getValue(SELECT_ALL_VALUE)) {\n          clear();\n        } else {\n          let array = selectValue as AntdLabeledValue[];\n          array = array.filter(\n            element => getValue(element) !== getValue(value),\n          );\n          // if this was not a new item, deselect select all option\n          if (selectAllMode && !option.isNewOption) {\n            array = array.filter(\n              element => getValue(element) !== SELECT_ALL_VALUE,\n            );\n          }\n          setSelectValue(array);\n\n          // removes new option\n          if (option.isNewOption) {\n            setSelectOptions(\n              fullSelectOptions.filter(\n                option => getValue(option.value) !== getValue(value),\n              ),\n            );\n          }\n        }\n      }\n      fireOnChange();\n      onDeselect?.(value, option);\n    };\n\n    const handleOnSearch = debounce((search: string) => {\n      const searchValue = search.trim();\n      if (allowNewOptions) {\n        const newOption = searchValue &&\n          !hasOption(searchValue, fullSelectOptions, true) && {\n            label: searchValue,\n            value: searchValue,\n            isNewOption: true,\n          };\n        const cleanSelectOptions = ensureIsArray(fullSelectOptions).filter(\n          opt => !opt.isNewOption || hasOption(opt.value, selectValue),\n        );\n        const newOptions = newOption\n          ? [newOption, ...cleanSelectOptions]\n          : cleanSelectOptions;\n        setSelectOptions(newOptions);\n      }\n      setInputValue(searchValue);\n      onSearch?.(searchValue);\n    }, FAST_DEBOUNCE);\n\n    useEffect(() => () => handleOnSearch.cancel(), [handleOnSearch]);\n\n    const handleFilterOption = (search: string, option: AntdLabeledValue) =>\n      handleFilterOptionHelper(search, option, optionFilterProps, filterOption);\n\n    const handleOnDropdownVisibleChange = (isDropdownVisible: boolean) => {\n      setIsDropdownVisible(isDropdownVisible);\n\n      // if no search input value, force sort options because it won't be sorted by\n      // `filterSort`.\n      if (isDropdownVisible && !inputValue && selectOptions.length > 1) {\n        if (!isEqual(initialOptionsSorted, selectOptions)) {\n          setSelectOptions(initialOptionsSorted);\n        }\n      }\n      if (onDropdownVisibleChange) {\n        onDropdownVisibleChange(isDropdownVisible);\n      }\n    };\n\n    const dropdownRender = (\n      originNode: ReactElement & { ref?: RefObject<HTMLElement> },\n    ) =>\n      dropDownRenderHelper(\n        originNode,\n        isDropdownVisible,\n        isLoading,\n        fullSelectOptions.length,\n        helperText,\n      );\n\n    const handleClear = () => {\n      clear();\n      if (onClear) {\n        onClear();\n      }\n    };\n\n    useEffect(() => {\n      // when `options` list is updated from component prop, reset states\n      setSelectOptions(initialOptions);\n    }, [initialOptions]);\n\n    useEffect(() => {\n      if (loading !== undefined && loading !== isLoading) {\n        setIsLoading(loading);\n      }\n    }, [isLoading, loading]);\n\n    useEffect(() => {\n      setSelectValue(value);\n    }, [value]);\n\n    useEffect(() => {\n      // if all values are selected, add select all to value\n      if (\n        selectAllEnabled &&\n        ensureIsArray(value).length === selectAllEligible.length\n      ) {\n        setSelectValue(\n          labelInValue\n            ? ([...ensureIsArray(value), selectAllOption] as AntdLabeledValue[])\n            : ([...ensureIsArray(value), SELECT_ALL_VALUE] as RawValue[]),\n        );\n      }\n    }, [labelInValue, selectAllEligible.length, selectAllEnabled, value]);\n\n    useEffect(() => {\n      const checkSelectAll = ensureIsArray(selectValue).some(\n        v => getValue(v) === SELECT_ALL_VALUE,\n      );\n      if (checkSelectAll && !selectAllMode) {\n        const optionsToSelect = selectAllEligible.map(option =>\n          labelInValue ? option : option.value,\n        );\n        optionsToSelect.push(labelInValue ? selectAllOption : SELECT_ALL_VALUE);\n        setSelectValue(optionsToSelect);\n        fireOnChange();\n      }\n    }, [\n      selectValue,\n      selectAllMode,\n      labelInValue,\n      selectAllEligible,\n      fireOnChange,\n    ]);\n\n    const selectAllLabel = useMemo(\n      () => () =>\n        // TODO: localize\n        `${SELECT_ALL_VALUE} (${formatNumber(\n          NumberFormats.INTEGER,\n          selectAllEligible.length,\n        )})`,\n      [selectAllEligible],\n    );\n\n    const handleOnBlur = (event: FocusEvent<HTMLElement>) => {\n      setInputValue('');\n      onBlur?.(event);\n    };\n\n    const handleOnChange = useCallback(\n      (values: any, options: any) => {\n        // intercept onChange call to handle the select all case\n        // if the \"select all\" option is selected, we want to send all options to the onChange,\n        // otherwise we want to remove\n        let newValues = values;\n        let newOptions = options;\n        if (!isSingleMode) {\n          if (\n            ensureIsArray(newValues).some(\n              val => getValue(val) === SELECT_ALL_VALUE,\n            )\n          ) {\n            // send all options to onchange if all are not currently there\n            if (!selectAllMode) {\n              newValues = mapValues(selectAllEligible, labelInValue);\n              newOptions = mapOptions(selectAllEligible);\n            } else {\n              newValues = ensureIsArray(values).filter(\n                (val: any) => getValue(val) !== SELECT_ALL_VALUE,\n              );\n            }\n          } else if (\n            ensureIsArray(values).length === selectAllEligible.length &&\n            selectAllMode\n          ) {\n            const array = selectAllEligible.filter(\n              option => hasOption(option.value, selectValue) && option.disabled,\n            );\n            newValues = mapValues(array, labelInValue);\n            newOptions = mapOptions(array);\n          }\n        }\n        onChange?.(newValues, newOptions);\n      },\n      [\n        isSingleMode,\n        labelInValue,\n        onChange,\n        selectAllEligible,\n        selectAllMode,\n        selectValue,\n      ],\n    );\n\n    useEffect(() => {\n      if (onChangeCount !== previousChangeCount) {\n        const array = ensureIsArray(selectValue);\n        const set = new Set(array.map(getValue));\n        const options = mapOptions(\n          fullSelectOptions.filter(opt => set.has(opt.value)),\n        );\n        if (isSingleMode) {\n          handleOnChange(selectValue, selectValue ? options[0] : undefined);\n        } else {\n          handleOnChange(array, options);\n        }\n      }\n    }, [\n      fullSelectOptions,\n      handleOnChange,\n      isSingleMode,\n      onChange,\n      onChangeCount,\n      previousChangeCount,\n      selectValue,\n    ]);\n\n    const shouldRenderChildrenOptions = useMemo(\n      () => selectAllEnabled || hasCustomLabels(options),\n      [selectAllEnabled, options],\n    );\n\n    const omittedCount = useMemo(() => {\n      const num_selected = ensureIsArray(selectValue).length;\n      const num_shown = maxTagCount as number;\n      return num_selected - num_shown - (selectAllMode ? 1 : 0);\n    }, [maxTagCount, selectAllMode, selectValue]);\n\n    const customMaxTagPlaceholder = () =>\n      `+ ${omittedCount > 0 ? omittedCount : 1} ...`;\n\n    // We can't remove the + tag so when Select All\n    // is the only item omitted, we subtract one from maxTagCount\n    let actualMaxTagCount = maxTagCount;\n    if (\n      actualMaxTagCount !== 'responsive' &&\n      omittedCount === 0 &&\n      selectAllMode\n    ) {\n      actualMaxTagCount -= 1;\n    }\n\n    const getPastedTextValue = useCallback(\n      (text: string) => {\n        const option = getOption(text, fullSelectOptions, true);\n        if (!option && !allowNewOptions) {\n          return undefined;\n        }\n        if (labelInValue) {\n          const value: AntdLabeledValue = {\n            label: text,\n            value: text,\n          };\n          if (option) {\n            value.label = isObject(option) ? option.label : option;\n            value.value = isObject(option) ? option.value! : option;\n          }\n          return value;\n        }\n        return option ? (isObject(option) ? option.value! : option) : text;\n      },\n      [allowNewOptions, fullSelectOptions, labelInValue],\n    );\n\n    const onPaste = (e: ClipboardEvent<HTMLInputElement>) => {\n      const pastedText = e.clipboardData.getData('text');\n      if (isSingleMode) {\n        const value = getPastedTextValue(pastedText);\n        if (value) {\n          setSelectValue(value);\n        }\n      } else {\n        const token = tokenSeparators.find(token => pastedText.includes(token));\n        const array = token ? uniq(pastedText.split(token)) : [pastedText];\n        const values = array\n          .map(item => getPastedTextValue(item))\n          .filter(item => item !== undefined);\n        if (labelInValue) {\n          setSelectValue(previous => [\n            ...((previous || []) as AntdLabeledValue[]),\n            ...(values as AntdLabeledValue[]),\n          ]);\n        } else {\n          setSelectValue(previous => [\n            ...((previous || []) as string[]),\n            ...(values as string[]),\n          ]);\n        }\n      }\n      fireOnChange();\n    };\n\n    return (\n      <StyledContainer headerPosition={headerPosition}>\n        {header && (\n          <StyledHeader headerPosition={headerPosition}>{header}</StyledHeader>\n        )}\n        <StyledSelect\n          allowClear={!isLoading && allowClear}\n          aria-label={ariaLabel || name}\n          autoClearSearchValue={autoClearSearchValue}\n          dropdownRender={dropdownRender}\n          filterOption={handleFilterOption}\n          filterSort={sortComparatorWithSearch}\n          getPopupContainer={\n            getPopupContainer || (triggerNode => triggerNode.parentNode)\n          }\n          headerPosition={headerPosition}\n          labelInValue={labelInValue}\n          maxTagCount={actualMaxTagCount}\n          maxTagPlaceholder={customMaxTagPlaceholder}\n          mode={mappedMode}\n          notFoundContent={isLoading ? t('Loading...') : notFoundContent}\n          onBlur={handleOnBlur}\n          onDeselect={handleOnDeselect}\n          onDropdownVisibleChange={handleOnDropdownVisibleChange}\n          // @ts-ignore\n          onPaste={onPaste}\n          onPopupScroll={undefined}\n          onSearch={shouldShowSearch ? handleOnSearch : undefined}\n          onSelect={handleOnSelect}\n          onClear={handleClear}\n          placeholder={placeholder}\n          showSearch={shouldShowSearch}\n          showArrow\n          tokenSeparators={tokenSeparators}\n          value={selectValue}\n          suffixIcon={getSuffixIcon(\n            isLoading,\n            shouldShowSearch,\n            isDropdownVisible,\n          )}\n          menuItemSelectedIcon={\n            invertSelection ? (\n              <StyledStopOutlined iconSize=\"m\" aria-label=\"stop\" />\n            ) : (\n              <StyledCheckOutlined iconSize=\"m\" aria-label=\"check\" />\n            )\n          }\n          options={shouldRenderChildrenOptions ? undefined : fullSelectOptions}\n          oneLine={oneLine}\n          tagRender={customTagRender}\n          {...props}\n          ref={ref}\n        >\n          {selectAllEnabled && (\n            <Option\n              id=\"select-all\"\n              className=\"select-all\"\n              key={SELECT_ALL_VALUE}\n              value={SELECT_ALL_VALUE}\n            >\n              {selectAllLabel()}\n            </Option>\n          )}\n          {shouldRenderChildrenOptions &&\n            renderSelectOptions(fullSelectOptions)}\n        </StyledSelect>\n      </StyledContainer>\n    );\n  },\n);\n\nexport default Select;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}