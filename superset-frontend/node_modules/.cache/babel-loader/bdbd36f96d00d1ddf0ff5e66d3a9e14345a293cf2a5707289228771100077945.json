{"ast":null,"code":"import { css as _css } from \"@emotion/react\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { forwardRef, useCallback, useImperativeHandle, useState } from 'react';\nimport ReactDOM from 'react-dom';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { Behavior, ensureIsArray, FeatureFlag, getChartMetadataRegistry, isFeatureEnabled, t, useTheme } from '@superset-ui/core';\nimport { findPermission } from 'src/utils/findPermission';\nimport { Menu } from 'src/components/Menu';\nimport { AntdDropdown as Dropdown } from 'src/components/index';\nimport { updateDataMask } from 'src/dataMask/actions';\nimport { DrillDetailMenuItems } from '../DrillDetail';\nimport { getMenuAdjustedY } from '../utils';\nimport { MenuItemTooltip } from '../DisabledMenuItemTooltip';\nimport { DrillByMenuItems } from '../DrillBy/DrillByMenuItems';import { jsx as _jsx, Fragment as _Fragment, jsxs as _jsxs } from \"@emotion/react/jsx-runtime\";\nexport var ContextMenuItem;\n(function (ContextMenuItem) {\n  ContextMenuItem[ContextMenuItem[\"CrossFilter\"] = 0] = \"CrossFilter\";\n  ContextMenuItem[ContextMenuItem[\"DrillToDetail\"] = 1] = \"DrillToDetail\";\n  ContextMenuItem[ContextMenuItem[\"DrillBy\"] = 2] = \"DrillBy\";\n  ContextMenuItem[ContextMenuItem[\"All\"] = 3] = \"All\";\n})(ContextMenuItem || (ContextMenuItem = {}));\nconst ChartContextMenu = ({ id, formData, onSelection, onClose, displayedItems = ContextMenuItem.All, additionalConfig }, ref) => {var _getChartMetadataRegi, _getChartMetadataRegi2;\n  const theme = useTheme();\n  const dispatch = useDispatch();\n  const canExplore = useSelector((state) => {var _state$user;return findPermission('can_explore', 'Superset', (_state$user = state.user) == null ? void 0 : _state$user.roles);});\n  const canWriteExploreFormData = useSelector((state) => {var _state$user2;return findPermission('can_write', 'ExploreFormDataRestApi', (_state$user2 = state.user) == null ? void 0 : _state$user2.roles);});\n  const canDatasourceSamples = useSelector((state) => {var _state$user3;return findPermission('can_samples', 'Datasource', (_state$user3 = state.user) == null ? void 0 : _state$user3.roles);});\n  const canDownload = useSelector((state) => {var _state$user4;return findPermission('can_csv', 'Superset', (_state$user4 = state.user) == null ? void 0 : _state$user4.roles);});\n  const canDrill = useSelector((state) => {var _state$user5;return findPermission('can_drill', 'Dashboard', (_state$user5 = state.user) == null ? void 0 : _state$user5.roles);});\n  const canDrillBy = (canExplore || canDrill) && canWriteExploreFormData;\n  const canDrillToDetail = (canExplore || canDrill) && canDatasourceSamples;\n  const crossFiltersEnabled = useSelector(({ dashboardInfo }) => dashboardInfo.crossFiltersEnabled);\n  const [openKeys, setOpenKeys] = useState([]);\n  const isDisplayed = (item) => displayedItems === ContextMenuItem.All ||\n  ensureIsArray(displayedItems).includes(item);\n  const [{ filters, clientX, clientY }, setState] = useState({ clientX: 0, clientY: 0 });\n  const [drillModalIsOpen, setDrillModalIsOpen] = useState(false);\n  const menuItems = [];\n  const showDrillToDetail = isFeatureEnabled(FeatureFlag.DrillToDetail) &&\n  canDrillToDetail &&\n  isDisplayed(ContextMenuItem.DrillToDetail);\n  const showDrillBy = isFeatureEnabled(FeatureFlag.DrillBy) &&\n  canDrillBy &&\n  isDisplayed(ContextMenuItem.DrillBy);\n  const showCrossFilters = isFeatureEnabled(FeatureFlag.DashboardCrossFilters) &&\n  isDisplayed(ContextMenuItem.CrossFilter);\n  const isCrossFilteringSupportedByChart = (_getChartMetadataRegi = getChartMetadataRegistry().\n  get(formData.viz_type)) == null ? void 0 : (_getChartMetadataRegi2 = _getChartMetadataRegi.\n  behaviors) == null ? void 0 : _getChartMetadataRegi2.includes(Behavior.InteractiveChart);\n  let itemsCount = 0;\n  if (showCrossFilters) {\n    itemsCount += 1;\n  }\n  if (showDrillToDetail) {\n    itemsCount += 2; // Drill to detail always has 2 top-level menu items\n  }\n  if (showDrillBy) {\n    itemsCount += 1;\n  }\n  if (itemsCount === 0) {\n    itemsCount = 1; // \"No actions\" appears if no actions in menu\n  }\n  if (showCrossFilters) {var _filters$crossFilter;\n    const isCrossFilterDisabled = !isCrossFilteringSupportedByChart ||\n    !crossFiltersEnabled ||\n    !(filters != null && filters.crossFilter);\n    let crossFilteringTooltipTitle = null;\n    if (!isCrossFilterDisabled) {\n      crossFilteringTooltipTitle = _jsxs(_Fragment, { children: [\n        _jsx(\"div\", { children:\n          t('Cross-filter will be applied to all of the charts that use this dataset.') }\n        ),\n        _jsx(\"div\", { children:\n          t('You can also just click on the chart to apply cross-filter.') }\n        )] }\n      );\n    } else\n    if (!crossFiltersEnabled) {\n      crossFilteringTooltipTitle = _jsx(_Fragment, { children:\n        _jsx(\"div\", { children: t('Cross-filtering is not enabled for this dashboard.') }) }\n      );\n    } else\n    if (!isCrossFilteringSupportedByChart) {\n      crossFilteringTooltipTitle = _jsx(_Fragment, { children:\n        _jsx(\"div\", { children:\n          t('This visualization type does not support cross-filtering.') }\n        ) }\n      );\n    } else\n    if (!(filters != null && filters.crossFilter)) {\n      crossFilteringTooltipTitle = _jsx(_Fragment, { children:\n        _jsx(\"div\", { children: t(`You can't apply cross-filter on this data point.`) }) }\n      );\n    }\n    menuItems.push(_jsxs(_Fragment, { children: [\n      _jsx(Menu.Item, { disabled: isCrossFilterDisabled, onClick: () => {\n          if (filters != null && filters.crossFilter) {\n            dispatch(updateDataMask(id, filters.crossFilter.dataMask));\n          }\n        }, children:\n        filters != null && (_filters$crossFilter = filters.crossFilter) != null && _filters$crossFilter.isCurrentValueSelected ? t('Remove cross-filter') : _jsxs(\"div\", { children: [\n          t('Add cross-filter'),\n          _jsx(MenuItemTooltip, { title: crossFilteringTooltipTitle, color: !isCrossFilterDisabled ?\n            theme.colors.grayscale.base :\n            undefined })] }\n        ) }, \"cross-filtering-menu-item\"\n      ),\n      itemsCount > 1 && _jsx(Menu.Divider, {})] }\n    ));\n  }\n  if (showDrillToDetail) {\n    menuItems.push(_jsx(DrillDetailMenuItems, { chartId: id, formData: formData, filters: filters == null ? void 0 : filters.drillToDetail, isContextMenu: true, contextMenuY: clientY, onSelection: onSelection, submenuIndex: showCrossFilters ? 2 : 1, showModal: drillModalIsOpen, setShowModal: setDrillModalIsOpen, ...((additionalConfig == null ? void 0 : additionalConfig.drillToDetail) || {}) }));\n  }\n  if (showDrillBy) {\n    let submenuIndex = 0;\n    if (showCrossFilters) {\n      submenuIndex += 1;\n    }\n    if (showDrillToDetail) {\n      submenuIndex += 2;\n    }\n    menuItems.push(_jsx(DrillByMenuItems, { drillByConfig: filters == null ? void 0 : filters.drillBy, onSelection: onSelection, formData: formData, contextMenuY: clientY, submenuIndex: submenuIndex, canDownload: canDownload, open: openKeys.includes('drill-by-submenu'), ...((additionalConfig == null ? void 0 : additionalConfig.drillBy) || {}) }, \"drill-by-submenu\"));\n  }\n  const open = useCallback((clientX, clientY, filters) => {var _document$getElementB;\n    const adjustedY = getMenuAdjustedY(clientY, itemsCount);\n    setState({\n      clientX,\n      clientY: adjustedY,\n      filters\n    });\n    // Since Ant Design's Dropdown does not offer an imperative API\n    // and we can't attach event triggers to charts SVG elements, we\n    // use a hidden span that gets clicked on when receiving click events\n    // from the charts.\n    (_document$getElementB = document.getElementById(`hidden-span-${id}`)) == null ? void 0 : _document$getElementB.click();\n  }, [id, itemsCount]);\n  useImperativeHandle(ref, () => ({\n    open\n  }), [open]);\n  return /*#__PURE__*/ReactDOM.createPortal(_jsx(Dropdown, { overlay: _jsx(Menu, { className: \"chart-context-menu\", \"data-test\": \"chart-context-menu\", onOpenChange: (openKeys) => {\n        setOpenKeys(openKeys);\n      }, children:\n      menuItems.length ? menuItems : _jsx(Menu.Item, { disabled: true, children: \"No actions\" }) }\n    ), trigger: ['click'], onVisibleChange: (value) => !value && onClose(), children:\n    _jsx(\"span\", { id: `hidden-span-${id}`, css: /*#__PURE__*/_css({\n        visibility: 'hidden',\n        position: 'fixed',\n        top: clientY,\n        left: clientX,\n        width: 1,\n        height: 1\n      }, process.env.NODE_ENV === \"production\" ? \"\" : \";label:ChartContextMenu;\", process.env.NODE_ENV === \"production\" ? \"\" : \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9hcHAvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL2NvbXBvbmVudHMvQ2hhcnQvQ2hhcnRDb250ZXh0TWVudS9DaGFydENvbnRleHRNZW51LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFnS3FDIiwiZmlsZSI6Ii9hcHAvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL2NvbXBvbmVudHMvQ2hhcnQvQ2hhcnRDb250ZXh0TWVudS9DaGFydENvbnRleHRNZW51LnRzeCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4gKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuICogXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuICogXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuICogdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmltcG9ydCB7IGZvcndhcmRSZWYsIHVzZUNhbGxiYWNrLCB1c2VJbXBlcmF0aXZlSGFuZGxlLCB1c2VTdGF0ZSwgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUmVhY3RET00gZnJvbSAncmVhY3QtZG9tJztcbmltcG9ydCB7IHVzZURpc3BhdGNoLCB1c2VTZWxlY3RvciB9IGZyb20gJ3JlYWN0LXJlZHV4JztcbmltcG9ydCB7IEJlaGF2aW9yLCBlbnN1cmVJc0FycmF5LCBGZWF0dXJlRmxhZywgZ2V0Q2hhcnRNZXRhZGF0YVJlZ2lzdHJ5LCBpc0ZlYXR1cmVFbmFibGVkLCB0LCB1c2VUaGVtZSwgfSBmcm9tICdAc3VwZXJzZXQtdWkvY29yZSc7XG5pbXBvcnQgeyBmaW5kUGVybWlzc2lvbiB9IGZyb20gJ3NyYy91dGlscy9maW5kUGVybWlzc2lvbic7XG5pbXBvcnQgeyBNZW51IH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvTWVudSc7XG5pbXBvcnQgeyBBbnRkRHJvcGRvd24gYXMgRHJvcGRvd24gfSBmcm9tICdzcmMvY29tcG9uZW50cy9pbmRleCc7XG5pbXBvcnQgeyB1cGRhdGVEYXRhTWFzayB9IGZyb20gJ3NyYy9kYXRhTWFzay9hY3Rpb25zJztcbmltcG9ydCB7IERyaWxsRGV0YWlsTWVudUl0ZW1zIH0gZnJvbSAnLi4vRHJpbGxEZXRhaWwnO1xuaW1wb3J0IHsgZ2V0TWVudUFkanVzdGVkWSB9IGZyb20gJy4uL3V0aWxzJztcbmltcG9ydCB7IE1lbnVJdGVtVG9vbHRpcCB9IGZyb20gJy4uL0Rpc2FibGVkTWVudUl0ZW1Ub29sdGlwJztcbmltcG9ydCB7IERyaWxsQnlNZW51SXRlbXMgfSBmcm9tICcuLi9EcmlsbEJ5L0RyaWxsQnlNZW51SXRlbXMnO1xuZXhwb3J0IHZhciBDb250ZXh0TWVudUl0ZW07XG4oZnVuY3Rpb24gKENvbnRleHRNZW51SXRlbSkge1xuICAgIENvbnRleHRNZW51SXRlbVtDb250ZXh0TWVudUl0ZW1bXCJDcm9zc0ZpbHRlclwiXSA9IDBdID0gXCJDcm9zc0ZpbHRlclwiO1xuICAgIENvbnRleHRNZW51SXRlbVtDb250ZXh0TWVudUl0ZW1bXCJEcmlsbFRvRGV0YWlsXCJdID0gMV0gPSBcIkRyaWxsVG9EZXRhaWxcIjtcbiAgICBDb250ZXh0TWVudUl0ZW1bQ29udGV4dE1lbnVJdGVtW1wiRHJpbGxCeVwiXSA9IDJdID0gXCJEcmlsbEJ5XCI7XG4gICAgQ29udGV4dE1lbnVJdGVtW0NvbnRleHRNZW51SXRlbVtcIkFsbFwiXSA9IDNdID0gXCJBbGxcIjtcbn0pKENvbnRleHRNZW51SXRlbSB8fCAoQ29udGV4dE1lbnVJdGVtID0ge30pKTtcbmNvbnN0IENoYXJ0Q29udGV4dE1lbnUgPSAoeyBpZCwgZm9ybURhdGEsIG9uU2VsZWN0aW9uLCBvbkNsb3NlLCBkaXNwbGF5ZWRJdGVtcyA9IENvbnRleHRNZW51SXRlbS5BbGwsIGFkZGl0aW9uYWxDb25maWcsIH0sIHJlZikgPT4ge1xuICAgIGNvbnN0IHRoZW1lID0gdXNlVGhlbWUoKTtcbiAgICBjb25zdCBkaXNwYXRjaCA9IHVzZURpc3BhdGNoKCk7XG4gICAgY29uc3QgY2FuRXhwbG9yZSA9IHVzZVNlbGVjdG9yKChzdGF0ZSkgPT4gZmluZFBlcm1pc3Npb24oJ2Nhbl9leHBsb3JlJywgJ1N1cGVyc2V0Jywgc3RhdGUudXNlcj8ucm9sZXMpKTtcbiAgICBjb25zdCBjYW5Xcml0ZUV4cGxvcmVGb3JtRGF0YSA9IHVzZVNlbGVjdG9yKChzdGF0ZSkgPT4gZmluZFBlcm1pc3Npb24oJ2Nhbl93cml0ZScsICdFeHBsb3JlRm9ybURhdGFSZXN0QXBpJywgc3RhdGUudXNlcj8ucm9sZXMpKTtcbiAgICBjb25zdCBjYW5EYXRhc291cmNlU2FtcGxlcyA9IHVzZVNlbGVjdG9yKChzdGF0ZSkgPT4gZmluZFBlcm1pc3Npb24oJ2Nhbl9zYW1wbGVzJywgJ0RhdGFzb3VyY2UnLCBzdGF0ZS51c2VyPy5yb2xlcykpO1xuICAgIGNvbnN0IGNhbkRvd25sb2FkID0gdXNlU2VsZWN0b3IoKHN0YXRlKSA9PiBmaW5kUGVybWlzc2lvbignY2FuX2NzdicsICdTdXBlcnNldCcsIHN0YXRlLnVzZXI/LnJvbGVzKSk7XG4gICAgY29uc3QgY2FuRHJpbGwgPSB1c2VTZWxlY3Rvcigoc3RhdGUpID0+IGZpbmRQZXJtaXNzaW9uKCdjYW5fZHJpbGwnLCAnRGFzaGJvYXJkJywgc3RhdGUudXNlcj8ucm9sZXMpKTtcbiAgICBjb25zdCBjYW5EcmlsbEJ5ID0gKGNhbkV4cGxvcmUgfHwgY2FuRHJpbGwpICYmIGNhbldyaXRlRXhwbG9yZUZvcm1EYXRhO1xuICAgIGNvbnN0IGNhbkRyaWxsVG9EZXRhaWwgPSAoY2FuRXhwbG9yZSB8fCBjYW5EcmlsbCkgJiYgY2FuRGF0YXNvdXJjZVNhbXBsZXM7XG4gICAgY29uc3QgY3Jvc3NGaWx0ZXJzRW5hYmxlZCA9IHVzZVNlbGVjdG9yKCh7IGRhc2hib2FyZEluZm8gfSkgPT4gZGFzaGJvYXJkSW5mby5jcm9zc0ZpbHRlcnNFbmFibGVkKTtcbiAgICBjb25zdCBbb3BlbktleXMsIHNldE9wZW5LZXlzXSA9IHVzZVN0YXRlKFtdKTtcbiAgICBjb25zdCBpc0Rpc3BsYXllZCA9IChpdGVtKSA9PiBkaXNwbGF5ZWRJdGVtcyA9PT0gQ29udGV4dE1lbnVJdGVtLkFsbCB8fFxuICAgICAgICBlbnN1cmVJc0FycmF5KGRpc3BsYXllZEl0ZW1zKS5pbmNsdWRlcyhpdGVtKTtcbiAgICBjb25zdCBbeyBmaWx0ZXJzLCBjbGllbnRYLCBjbGllbnRZIH0sIHNldFN0YXRlXSA9IHVzZVN0YXRlKHsgY2xpZW50WDogMCwgY2xpZW50WTogMCB9KTtcbiAgICBjb25zdCBbZHJpbGxNb2RhbElzT3Blbiwgc2V0RHJpbGxNb2RhbElzT3Blbl0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gICAgY29uc3QgbWVudUl0ZW1zID0gW107XG4gICAgY29uc3Qgc2hvd0RyaWxsVG9EZXRhaWwgPSBpc0ZlYXR1cmVFbmFibGVkKEZlYXR1cmVGbGFnLkRyaWxsVG9EZXRhaWwpICYmXG4gICAgICAgIGNhbkRyaWxsVG9EZXRhaWwgJiZcbiAgICAgICAgaXNEaXNwbGF5ZWQoQ29udGV4dE1lbnVJdGVtLkRyaWxsVG9EZXRhaWwpO1xuICAgIGNvbnN0IHNob3dEcmlsbEJ5ID0gaXNGZWF0dXJlRW5hYmxlZChGZWF0dXJlRmxhZy5EcmlsbEJ5KSAmJlxuICAgICAgICBjYW5EcmlsbEJ5ICYmXG4gICAgICAgIGlzRGlzcGxheWVkKENvbnRleHRNZW51SXRlbS5EcmlsbEJ5KTtcbiAgICBjb25zdCBzaG93Q3Jvc3NGaWx0ZXJzID0gaXNGZWF0dXJlRW5hYmxlZChGZWF0dXJlRmxhZy5EYXNoYm9hcmRDcm9zc0ZpbHRlcnMpICYmXG4gICAgICAgIGlzRGlzcGxheWVkKENvbnRleHRNZW51SXRlbS5Dcm9zc0ZpbHRlcik7XG4gICAgY29uc3QgaXNDcm9zc0ZpbHRlcmluZ1N1cHBvcnRlZEJ5Q2hhcnQgPSBnZXRDaGFydE1ldGFkYXRhUmVnaXN0cnkoKVxuICAgICAgICAuZ2V0KGZvcm1EYXRhLnZpel90eXBlKVxuICAgICAgICA/LmJlaGF2aW9ycz8uaW5jbHVkZXMoQmVoYXZpb3IuSW50ZXJhY3RpdmVDaGFydCk7XG4gICAgbGV0IGl0ZW1zQ291bnQgPSAwO1xuICAgIGlmIChzaG93Q3Jvc3NGaWx0ZXJzKSB7XG4gICAgICAgIGl0ZW1zQ291bnQgKz0gMTtcbiAgICB9XG4gICAgaWYgKHNob3dEcmlsbFRvRGV0YWlsKSB7XG4gICAgICAgIGl0ZW1zQ291bnQgKz0gMjsgLy8gRHJpbGwgdG8gZGV0YWlsIGFsd2F5cyBoYXMgMiB0b3AtbGV2ZWwgbWVudSBpdGVtc1xuICAgIH1cbiAgICBpZiAoc2hvd0RyaWxsQnkpIHtcbiAgICAgICAgaXRlbXNDb3VudCArPSAxO1xuICAgIH1cbiAgICBpZiAoaXRlbXNDb3VudCA9PT0gMCkge1xuICAgICAgICBpdGVtc0NvdW50ID0gMTsgLy8gXCJObyBhY3Rpb25zXCIgYXBwZWFycyBpZiBubyBhY3Rpb25zIGluIG1lbnVcbiAgICB9XG4gICAgaWYgKHNob3dDcm9zc0ZpbHRlcnMpIHtcbiAgICAgICAgY29uc3QgaXNDcm9zc0ZpbHRlckRpc2FibGVkID0gIWlzQ3Jvc3NGaWx0ZXJpbmdTdXBwb3J0ZWRCeUNoYXJ0IHx8XG4gICAgICAgICAgICAhY3Jvc3NGaWx0ZXJzRW5hYmxlZCB8fFxuICAgICAgICAgICAgIWZpbHRlcnM/LmNyb3NzRmlsdGVyO1xuICAgICAgICBsZXQgY3Jvc3NGaWx0ZXJpbmdUb29sdGlwVGl0bGUgPSBudWxsO1xuICAgICAgICBpZiAoIWlzQ3Jvc3NGaWx0ZXJEaXNhYmxlZCkge1xuICAgICAgICAgICAgY3Jvc3NGaWx0ZXJpbmdUb29sdGlwVGl0bGUgPSAoPD5cbiAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAge3QoJ0Nyb3NzLWZpbHRlciB3aWxsIGJlIGFwcGxpZWQgdG8gYWxsIG9mIHRoZSBjaGFydHMgdGhhdCB1c2UgdGhpcyBkYXRhc2V0LicpfVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICB7dCgnWW91IGNhbiBhbHNvIGp1c3QgY2xpY2sgb24gdGhlIGNoYXJ0IHRvIGFwcGx5IGNyb3NzLWZpbHRlci4nKX1cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC8+KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICghY3Jvc3NGaWx0ZXJzRW5hYmxlZCkge1xuICAgICAgICAgICAgY3Jvc3NGaWx0ZXJpbmdUb29sdGlwVGl0bGUgPSAoPD5cbiAgICAgICAgICA8ZGl2Pnt0KCdDcm9zcy1maWx0ZXJpbmcgaXMgbm90IGVuYWJsZWQgZm9yIHRoaXMgZGFzaGJvYXJkLicpfTwvZGl2PlxuICAgICAgICA8Lz4pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCFpc0Nyb3NzRmlsdGVyaW5nU3VwcG9ydGVkQnlDaGFydCkge1xuICAgICAgICAgICAgY3Jvc3NGaWx0ZXJpbmdUb29sdGlwVGl0bGUgPSAoPD5cbiAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAge3QoJ1RoaXMgdmlzdWFsaXphdGlvbiB0eXBlIGRvZXMgbm90IHN1cHBvcnQgY3Jvc3MtZmlsdGVyaW5nLicpfVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8Lz4pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCFmaWx0ZXJzPy5jcm9zc0ZpbHRlcikge1xuICAgICAgICAgICAgY3Jvc3NGaWx0ZXJpbmdUb29sdGlwVGl0bGUgPSAoPD5cbiAgICAgICAgICA8ZGl2Pnt0KGBZb3UgY2FuJ3QgYXBwbHkgY3Jvc3MtZmlsdGVyIG9uIHRoaXMgZGF0YSBwb2ludC5gKX08L2Rpdj5cbiAgICAgICAgPC8+KTtcbiAgICAgICAgfVxuICAgICAgICBtZW51SXRlbXMucHVzaCg8PlxuICAgICAgICA8TWVudS5JdGVtIGtleT1cImNyb3NzLWZpbHRlcmluZy1tZW51LWl0ZW1cIiBkaXNhYmxlZD17aXNDcm9zc0ZpbHRlckRpc2FibGVkfSBvbkNsaWNrPXsoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGZpbHRlcnM/LmNyb3NzRmlsdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoKHVwZGF0ZURhdGFNYXNrKGlkLCBmaWx0ZXJzLmNyb3NzRmlsdGVyLmRhdGFNYXNrKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfX0+XG4gICAgICAgICAge2ZpbHRlcnM/LmNyb3NzRmlsdGVyPy5pc0N1cnJlbnRWYWx1ZVNlbGVjdGVkID8gKHQoJ1JlbW92ZSBjcm9zcy1maWx0ZXInKSkgOiAoPGRpdj5cbiAgICAgICAgICAgICAge3QoJ0FkZCBjcm9zcy1maWx0ZXInKX1cbiAgICAgICAgICAgICAgPE1lbnVJdGVtVG9vbHRpcCB0aXRsZT17Y3Jvc3NGaWx0ZXJpbmdUb29sdGlwVGl0bGV9IGNvbG9yPXshaXNDcm9zc0ZpbHRlckRpc2FibGVkXG4gICAgICAgICAgICAgICAgICAgID8gdGhlbWUuY29sb3JzLmdyYXlzY2FsZS5iYXNlXG4gICAgICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkfS8+XG4gICAgICAgICAgICA8L2Rpdj4pfVxuICAgICAgICA8L01lbnUuSXRlbT5cbiAgICAgICAge2l0ZW1zQ291bnQgPiAxICYmIDxNZW51LkRpdmlkZXIgLz59XG4gICAgICA8Lz4pO1xuICAgIH1cbiAgICBpZiAoc2hvd0RyaWxsVG9EZXRhaWwpIHtcbiAgICAgICAgbWVudUl0ZW1zLnB1c2goPERyaWxsRGV0YWlsTWVudUl0ZW1zIGNoYXJ0SWQ9e2lkfSBmb3JtRGF0YT17Zm9ybURhdGF9IGZpbHRlcnM9e2ZpbHRlcnM/LmRyaWxsVG9EZXRhaWx9IGlzQ29udGV4dE1lbnUgY29udGV4dE1lbnVZPXtjbGllbnRZfSBvblNlbGVjdGlvbj17b25TZWxlY3Rpb259IHN1Ym1lbnVJbmRleD17c2hvd0Nyb3NzRmlsdGVycyA/IDIgOiAxfSBzaG93TW9kYWw9e2RyaWxsTW9kYWxJc09wZW59IHNldFNob3dNb2RhbD17c2V0RHJpbGxNb2RhbElzT3Blbn0gey4uLihhZGRpdGlvbmFsQ29uZmlnPy5kcmlsbFRvRGV0YWlsIHx8IHt9KX0vPik7XG4gICAgfVxuICAgIGlmIChzaG93RHJpbGxCeSkge1xuICAgICAgICBsZXQgc3VibWVudUluZGV4ID0gMDtcbiAgICAgICAgaWYgKHNob3dDcm9zc0ZpbHRlcnMpIHtcbiAgICAgICAgICAgIHN1Ym1lbnVJbmRleCArPSAxO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzaG93RHJpbGxUb0RldGFpbCkge1xuICAgICAgICAgICAgc3VibWVudUluZGV4ICs9IDI7XG4gICAgICAgIH1cbiAgICAgICAgbWVudUl0ZW1zLnB1c2goPERyaWxsQnlNZW51SXRlbXMgZHJpbGxCeUNvbmZpZz17ZmlsdGVycz8uZHJpbGxCeX0gb25TZWxlY3Rpb249e29uU2VsZWN0aW9ufSBmb3JtRGF0YT17Zm9ybURhdGF9IGNvbnRleHRNZW51WT17Y2xpZW50WX0gc3VibWVudUluZGV4PXtzdWJtZW51SW5kZXh9IGNhbkRvd25sb2FkPXtjYW5Eb3dubG9hZH0gb3Blbj17b3BlbktleXMuaW5jbHVkZXMoJ2RyaWxsLWJ5LXN1Ym1lbnUnKX0ga2V5PVwiZHJpbGwtYnktc3VibWVudVwiIHsuLi4oYWRkaXRpb25hbENvbmZpZz8uZHJpbGxCeSB8fCB7fSl9Lz4pO1xuICAgIH1cbiAgICBjb25zdCBvcGVuID0gdXNlQ2FsbGJhY2soKGNsaWVudFgsIGNsaWVudFksIGZpbHRlcnMpID0+IHtcbiAgICAgICAgY29uc3QgYWRqdXN0ZWRZID0gZ2V0TWVudUFkanVzdGVkWShjbGllbnRZLCBpdGVtc0NvdW50KTtcbiAgICAgICAgc2V0U3RhdGUoe1xuICAgICAgICAgICAgY2xpZW50WCxcbiAgICAgICAgICAgIGNsaWVudFk6IGFkanVzdGVkWSxcbiAgICAgICAgICAgIGZpbHRlcnMsXG4gICAgICAgIH0pO1xuICAgICAgICAvLyBTaW5jZSBBbnQgRGVzaWduJ3MgRHJvcGRvd24gZG9lcyBub3Qgb2ZmZXIgYW4gaW1wZXJhdGl2ZSBBUElcbiAgICAgICAgLy8gYW5kIHdlIGNhbid0IGF0dGFjaCBldmVudCB0cmlnZ2VycyB0byBjaGFydHMgU1ZHIGVsZW1lbnRzLCB3ZVxuICAgICAgICAvLyB1c2UgYSBoaWRkZW4gc3BhbiB0aGF0IGdldHMgY2xpY2tlZCBvbiB3aGVuIHJlY2VpdmluZyBjbGljayBldmVudHNcbiAgICAgICAgLy8gZnJvbSB0aGUgY2hhcnRzLlxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgaGlkZGVuLXNwYW4tJHtpZH1gKT8uY2xpY2soKTtcbiAgICB9LCBbaWQsIGl0ZW1zQ291bnRdKTtcbiAgICB1c2VJbXBlcmF0aXZlSGFuZGxlKHJlZiwgKCkgPT4gKHtcbiAgICAgICAgb3BlbixcbiAgICB9KSwgW29wZW5dKTtcbiAgICByZXR1cm4gUmVhY3RET00uY3JlYXRlUG9ydGFsKDxEcm9wZG93biBvdmVybGF5PXs8TWVudSBjbGFzc05hbWU9XCJjaGFydC1jb250ZXh0LW1lbnVcIiBkYXRhLXRlc3Q9XCJjaGFydC1jb250ZXh0LW1lbnVcIiBvbk9wZW5DaGFuZ2U9e29wZW5LZXlzID0+IHtcbiAgICAgICAgICAgICAgICBzZXRPcGVuS2V5cyhvcGVuS2V5cyk7XG4gICAgICAgICAgICB9fT5cbiAgICAgICAgICB7bWVudUl0ZW1zLmxlbmd0aCA/IChtZW51SXRlbXMpIDogKDxNZW51Lkl0ZW0gZGlzYWJsZWQ+Tm8gYWN0aW9uczwvTWVudS5JdGVtPil9XG4gICAgICAgIDwvTWVudT59IHRyaWdnZXI9e1snY2xpY2snXX0gb25WaXNpYmxlQ2hhbmdlPXt2YWx1ZSA9PiAhdmFsdWUgJiYgb25DbG9zZSgpfT5cbiAgICAgIDxzcGFuIGlkPXtgaGlkZGVuLXNwYW4tJHtpZH1gfSBjc3M9e3tcbiAgICAgICAgICAgIHZpc2liaWxpdHk6ICdoaWRkZW4nLFxuICAgICAgICAgICAgcG9zaXRpb246ICdmaXhlZCcsXG4gICAgICAgICAgICB0b3A6IGNsaWVudFksXG4gICAgICAgICAgICBsZWZ0OiBjbGllbnRYLFxuICAgICAgICAgICAgd2lkdGg6IDEsXG4gICAgICAgICAgICBoZWlnaHQ6IDEsXG4gICAgICAgIH19Lz5cbiAgICA8L0Ryb3Bkb3duPiwgZG9jdW1lbnQuYm9keSk7XG59O1xuZXhwb3J0IGRlZmF1bHQgZm9yd2FyZFJlZihDaGFydENvbnRleHRNZW51KTtcbiJdfQ== */\") }) }\n  ), document.body);\n};__signature__(ChartContextMenu, \"useTheme{theme}\\nuseDispatch{dispatch}\\nuseSelector{canExplore}\\nuseSelector{canWriteExploreFormData}\\nuseSelector{canDatasourceSamples}\\nuseSelector{canDownload}\\nuseSelector{canDrill}\\nuseSelector{crossFiltersEnabled}\\nuseState{[openKeys, setOpenKeys]([])}\\nuseState{[{ filters, clientX, clientY }, setState]({ clientX: 0, clientY: 0 })}\\nuseState{[drillModalIsOpen, setDrillModalIsOpen](false)}\\nuseCallback{open}\\nuseImperativeHandle{}\", () => [useTheme, useDispatch, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useImperativeHandle]);const _default = /*#__PURE__*/\nforwardRef(ChartContextMenu);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(ContextMenuItem, \"ContextMenuItem\", \"/app/superset-frontend/src/components/Chart/ChartContextMenu/ChartContextMenu.tsx\");reactHotLoader.register(ChartContextMenu, \"ChartContextMenu\", \"/app/superset-frontend/src/components/Chart/ChartContextMenu/ChartContextMenu.tsx\");reactHotLoader.register(_default, \"default\", \"/app/superset-frontend/src/components/Chart/ChartContextMenu/ChartContextMenu.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["forwardRef","useCallback","useImperativeHandle","useState","ReactDOM","useDispatch","useSelector","Behavior","ensureIsArray","FeatureFlag","getChartMetadataRegistry","isFeatureEnabled","t","useTheme","findPermission","Menu","AntdDropdown","Dropdown","updateDataMask","DrillDetailMenuItems","getMenuAdjustedY","MenuItemTooltip","DrillByMenuItems","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","ContextMenuItem","ChartContextMenu","id","formData","onSelection","onClose","displayedItems","All","additionalConfig","ref","_getChartMetadataRegi","_getChartMetadataRegi2","theme","dispatch","canExplore","state","_state$user","user","roles","canWriteExploreFormData","_state$user2","canDatasourceSamples","_state$user3","canDownload","_state$user4","canDrill","_state$user5","canDrillBy","canDrillToDetail","crossFiltersEnabled","dashboardInfo","openKeys","setOpenKeys","isDisplayed","item","includes","filters","clientX","clientY","setState","drillModalIsOpen","setDrillModalIsOpen","menuItems","showDrillToDetail","DrillToDetail","showDrillBy","DrillBy","showCrossFilters","DashboardCrossFilters","CrossFilter","isCrossFilteringSupportedByChart","get","viz_type","behaviors","InteractiveChart","itemsCount","_filters$crossFilter","isCrossFilterDisabled","crossFilter","crossFilteringTooltipTitle","children","push","Item","disabled","onClick","dataMask","isCurrentValueSelected","title","color","colors","grayscale","base","undefined","Divider","chartId","drillToDetail","isContextMenu","contextMenuY","submenuIndex","showModal","setShowModal","drillByConfig","drillBy","open","_document$getElementB","adjustedY","document","getElementById","click","createPortal","overlay","className","onOpenChange","length","trigger","onVisibleChange","value","css","_css","visibility","position","top","left","width","height","process","env","NODE_ENV","body","__signature__","_default","reactHotLoader","reactHotLoaderGlobal","default","register","leaveModule","module"],"sources":["/app/superset-frontend/src/components/Chart/ChartContextMenu/ChartContextMenu.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  forwardRef,\n  Key,\n  ReactNode,\n  RefObject,\n  useCallback,\n  useImperativeHandle,\n  useState,\n} from 'react';\nimport ReactDOM from 'react-dom';\nimport { useDispatch, useSelector } from 'react-redux';\nimport {\n  Behavior,\n  ContextMenuFilters,\n  ensureIsArray,\n  FeatureFlag,\n  getChartMetadataRegistry,\n  isFeatureEnabled,\n  QueryFormData,\n  t,\n  useTheme,\n} from '@superset-ui/core';\nimport { RootState } from 'src/dashboard/types';\nimport { findPermission } from 'src/utils/findPermission';\nimport { Menu } from 'src/components/Menu';\nimport { AntdDropdown as Dropdown } from 'src/components/index';\nimport { updateDataMask } from 'src/dataMask/actions';\nimport { DrillDetailMenuItems } from '../DrillDetail';\nimport { getMenuAdjustedY } from '../utils';\nimport { MenuItemTooltip } from '../DisabledMenuItemTooltip';\nimport { DrillByMenuItems } from '../DrillBy/DrillByMenuItems';\n\nexport enum ContextMenuItem {\n  CrossFilter,\n  DrillToDetail,\n  DrillBy,\n  All,\n}\nexport interface ChartContextMenuProps {\n  id: number;\n  formData: QueryFormData;\n  onSelection: () => void;\n  onClose: () => void;\n  additionalConfig?: {\n    crossFilter?: Record<string, any>;\n    drillToDetail?: Record<string, any>;\n    drillBy?: Record<string, any>;\n  };\n  displayedItems?: ContextMenuItem[] | ContextMenuItem;\n}\n\nexport interface ChartContextMenuRef {\n  open: (\n    clientX: number,\n    clientY: number,\n    filters?: ContextMenuFilters,\n  ) => void;\n}\n\nconst ChartContextMenu = (\n  {\n    id,\n    formData,\n    onSelection,\n    onClose,\n    displayedItems = ContextMenuItem.All,\n    additionalConfig,\n  }: ChartContextMenuProps,\n  ref: RefObject<ChartContextMenuRef>,\n) => {\n  const theme = useTheme();\n  const dispatch = useDispatch();\n  const canExplore = useSelector((state: RootState) =>\n    findPermission('can_explore', 'Superset', state.user?.roles),\n  );\n  const canWriteExploreFormData = useSelector((state: RootState) =>\n    findPermission('can_write', 'ExploreFormDataRestApi', state.user?.roles),\n  );\n  const canDatasourceSamples = useSelector((state: RootState) =>\n    findPermission('can_samples', 'Datasource', state.user?.roles),\n  );\n  const canDownload = useSelector((state: RootState) =>\n    findPermission('can_csv', 'Superset', state.user?.roles),\n  );\n  const canDrill = useSelector((state: RootState) =>\n    findPermission('can_drill', 'Dashboard', state.user?.roles),\n  );\n  const canDrillBy = (canExplore || canDrill) && canWriteExploreFormData;\n  const canDrillToDetail = (canExplore || canDrill) && canDatasourceSamples;\n  const crossFiltersEnabled = useSelector<RootState, boolean>(\n    ({ dashboardInfo }) => dashboardInfo.crossFiltersEnabled,\n  );\n  const [openKeys, setOpenKeys] = useState<Key[]>([]);\n\n  const isDisplayed = (item: ContextMenuItem) =>\n    displayedItems === ContextMenuItem.All ||\n    ensureIsArray(displayedItems).includes(item);\n\n  const [{ filters, clientX, clientY }, setState] = useState<{\n    clientX: number;\n    clientY: number;\n    filters?: ContextMenuFilters;\n  }>({ clientX: 0, clientY: 0 });\n\n  const [drillModalIsOpen, setDrillModalIsOpen] = useState(false);\n\n  const menuItems = [];\n\n  const showDrillToDetail =\n    isFeatureEnabled(FeatureFlag.DrillToDetail) &&\n    canDrillToDetail &&\n    isDisplayed(ContextMenuItem.DrillToDetail);\n\n  const showDrillBy =\n    isFeatureEnabled(FeatureFlag.DrillBy) &&\n    canDrillBy &&\n    isDisplayed(ContextMenuItem.DrillBy);\n\n  const showCrossFilters =\n    isFeatureEnabled(FeatureFlag.DashboardCrossFilters) &&\n    isDisplayed(ContextMenuItem.CrossFilter);\n\n  const isCrossFilteringSupportedByChart = getChartMetadataRegistry()\n    .get(formData.viz_type)\n    ?.behaviors?.includes(Behavior.InteractiveChart);\n\n  let itemsCount = 0;\n  if (showCrossFilters) {\n    itemsCount += 1;\n  }\n  if (showDrillToDetail) {\n    itemsCount += 2; // Drill to detail always has 2 top-level menu items\n  }\n  if (showDrillBy) {\n    itemsCount += 1;\n  }\n  if (itemsCount === 0) {\n    itemsCount = 1; // \"No actions\" appears if no actions in menu\n  }\n\n  if (showCrossFilters) {\n    const isCrossFilterDisabled =\n      !isCrossFilteringSupportedByChart ||\n      !crossFiltersEnabled ||\n      !filters?.crossFilter;\n\n    let crossFilteringTooltipTitle: ReactNode = null;\n    if (!isCrossFilterDisabled) {\n      crossFilteringTooltipTitle = (\n        <>\n          <div>\n            {t(\n              'Cross-filter will be applied to all of the charts that use this dataset.',\n            )}\n          </div>\n          <div>\n            {t('You can also just click on the chart to apply cross-filter.')}\n          </div>\n        </>\n      );\n    } else if (!crossFiltersEnabled) {\n      crossFilteringTooltipTitle = (\n        <>\n          <div>{t('Cross-filtering is not enabled for this dashboard.')}</div>\n        </>\n      );\n    } else if (!isCrossFilteringSupportedByChart) {\n      crossFilteringTooltipTitle = (\n        <>\n          <div>\n            {t('This visualization type does not support cross-filtering.')}\n          </div>\n        </>\n      );\n    } else if (!filters?.crossFilter) {\n      crossFilteringTooltipTitle = (\n        <>\n          <div>{t(`You can't apply cross-filter on this data point.`)}</div>\n        </>\n      );\n    }\n    menuItems.push(\n      <>\n        <Menu.Item\n          key=\"cross-filtering-menu-item\"\n          disabled={isCrossFilterDisabled}\n          onClick={() => {\n            if (filters?.crossFilter) {\n              dispatch(updateDataMask(id, filters.crossFilter.dataMask));\n            }\n          }}\n        >\n          {filters?.crossFilter?.isCurrentValueSelected ? (\n            t('Remove cross-filter')\n          ) : (\n            <div>\n              {t('Add cross-filter')}\n              <MenuItemTooltip\n                title={crossFilteringTooltipTitle}\n                color={\n                  !isCrossFilterDisabled\n                    ? theme.colors.grayscale.base\n                    : undefined\n                }\n              />\n            </div>\n          )}\n        </Menu.Item>\n        {itemsCount > 1 && <Menu.Divider />}\n      </>,\n    );\n  }\n  if (showDrillToDetail) {\n    menuItems.push(\n      <DrillDetailMenuItems\n        chartId={id}\n        formData={formData}\n        filters={filters?.drillToDetail}\n        isContextMenu\n        contextMenuY={clientY}\n        onSelection={onSelection}\n        submenuIndex={showCrossFilters ? 2 : 1}\n        showModal={drillModalIsOpen}\n        setShowModal={setDrillModalIsOpen}\n        {...(additionalConfig?.drillToDetail || {})}\n      />,\n    );\n  }\n  if (showDrillBy) {\n    let submenuIndex = 0;\n    if (showCrossFilters) {\n      submenuIndex += 1;\n    }\n    if (showDrillToDetail) {\n      submenuIndex += 2;\n    }\n    menuItems.push(\n      <DrillByMenuItems\n        drillByConfig={filters?.drillBy}\n        onSelection={onSelection}\n        formData={formData}\n        contextMenuY={clientY}\n        submenuIndex={submenuIndex}\n        canDownload={canDownload}\n        open={openKeys.includes('drill-by-submenu')}\n        key=\"drill-by-submenu\"\n        {...(additionalConfig?.drillBy || {})}\n      />,\n    );\n  }\n\n  const open = useCallback(\n    (clientX: number, clientY: number, filters?: ContextMenuFilters) => {\n      const adjustedY = getMenuAdjustedY(clientY, itemsCount);\n      setState({\n        clientX,\n        clientY: adjustedY,\n        filters,\n      });\n\n      // Since Ant Design's Dropdown does not offer an imperative API\n      // and we can't attach event triggers to charts SVG elements, we\n      // use a hidden span that gets clicked on when receiving click events\n      // from the charts.\n      document.getElementById(`hidden-span-${id}`)?.click();\n    },\n    [id, itemsCount],\n  );\n\n  useImperativeHandle(\n    ref,\n    () => ({\n      open,\n    }),\n    [open],\n  );\n\n  return ReactDOM.createPortal(\n    <Dropdown\n      overlay={\n        <Menu\n          className=\"chart-context-menu\"\n          data-test=\"chart-context-menu\"\n          onOpenChange={openKeys => {\n            setOpenKeys(openKeys);\n          }}\n        >\n          {menuItems.length ? (\n            menuItems\n          ) : (\n            <Menu.Item disabled>No actions</Menu.Item>\n          )}\n        </Menu>\n      }\n      trigger={['click']}\n      onVisibleChange={value => !value && onClose()}\n    >\n      <span\n        id={`hidden-span-${id}`}\n        css={{\n          visibility: 'hidden',\n          position: 'fixed',\n          top: clientY,\n          left: clientX,\n          width: 1,\n          height: 1,\n        }}\n      />\n    </Dropdown>,\n    document.body,\n  );\n};\n\nexport default forwardRef(ChartContextMenu);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}