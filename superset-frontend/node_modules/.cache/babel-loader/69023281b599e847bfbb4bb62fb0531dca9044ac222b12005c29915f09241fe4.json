{"ast":null,"code":"import _isNumber from \"lodash/isNumber\";import _isEmpty from \"lodash/isEmpty\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();function _EMOTION_STRINGIFIED_CSS_ERROR__() {return \"You have tried to stringify object returned from `css` function. It isn't supposed to be used directly (e.g. as value of the `className` prop), but rather handed to emotion so it can handle it (e.g. as value of `css` prop).\";}var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useCallback, useLayoutEffect, useMemo, useState } from 'react';\nimport { extent as d3Extent, max as d3Max } from 'd3-array';\nimport { FaSort } from '@react-icons/all-files/fa/FaSort';\nimport { FaSortDown as FaSortDesc } from '@react-icons/all-files/fa/FaSortDown';\nimport { FaSortUp as FaSortAsc } from '@react-icons/all-files/fa/FaSortUp';\nimport cx from 'classnames';\nimport { DTTM_ALIAS, ensureIsArray, GenericDataType, getSelectedText, getTimeFormatterForGranularity, styled, css, t, tn, useTheme } from '@superset-ui/core';\nimport { Dropdown, Menu, Tooltip } from '@superset-ui/chart-controls';\nimport { CheckOutlined, InfoCircleOutlined, DownOutlined, MinusCircleOutlined, PlusCircleOutlined, TableOutlined } from '@ant-design/icons';\n\nimport { ColorSchemeEnum } from './types';\nimport DataTable from './DataTable';\nimport Styles from './Styles';\nimport { formatColumnValue } from './utils/formatValue';\nimport { PAGE_SIZE_OPTIONS } from './consts';\nimport { updateExternalFormData } from './DataTable/utils/externalAPIs';\nimport getScrollBarSize from './DataTable/utils/getScrollBarSize';import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"@emotion/react/jsx-runtime\";\nconst ACTION_KEYS = {\n  enter: 'Enter',\n  spacebar: 'Spacebar',\n  space: ' '\n};\n/**\n * Return sortType based on data type\n */\nfunction getSortTypeByDataType(dataType) {\n  if (dataType === GenericDataType.Temporal) {\n    return 'datetime';\n  }\n  if (dataType === GenericDataType.String) {\n    return 'alphanumeric';\n  }\n  return 'basic';\n}\n/**\n * Cell background width calculation for horizontal bar chart\n */\nfunction cellWidth({ value, valueRange, alignPositiveNegative }) {\n  const [minValue, maxValue] = valueRange;\n  if (alignPositiveNegative) {\n    const perc = Math.abs(Math.round(value / maxValue * 100));\n    return perc;\n  }\n  const posExtent = Math.abs(Math.max(maxValue, 0));\n  const negExtent = Math.abs(Math.min(minValue, 0));\n  const tot = posExtent + negExtent;\n  const perc2 = Math.round(Math.abs(value) / tot * 100);\n  return perc2;\n}\n/**\n * Cell left margin (offset) calculation for horizontal bar chart elements\n * when alignPositiveNegative is not set\n */\nfunction cellOffset({ value, valueRange, alignPositiveNegative }) {\n  if (alignPositiveNegative) {\n    return 0;\n  }\n  const [minValue, maxValue] = valueRange;\n  const posExtent = Math.abs(Math.max(maxValue, 0));\n  const negExtent = Math.abs(Math.min(minValue, 0));\n  const tot = posExtent + negExtent;\n  return Math.round(Math.min(negExtent + value, negExtent) / tot * 100);\n}\n/**\n * Cell background color calculation for horizontal bar chart\n */\nfunction cellBackground({ value, colorPositiveNegative = false }) {\n  const r = colorPositiveNegative && value < 0 ? 150 : 0;\n  return `rgba(${r},0,0,0.2)`;\n}\nfunction SortIcon({ column }) {\n  const { isSorted, isSortedDesc } = column;\n  let sortIcon = _jsx(FaSort, {});\n  if (isSorted) {\n    sortIcon = isSortedDesc ? _jsx(FaSortDesc, {}) : _jsx(FaSortAsc, {});\n  }\n  return sortIcon;\n}\nfunction SearchInput({ count, value, onChange }) {\n  return _jsxs(\"span\", { className: \"dt-global-filter\", children: [\n    t('Search'), ' ',\n    _jsx(\"input\", { \"aria-label\": t('Search %s records', count), className: \"form-control input-sm\", placeholder: tn('search.num_records', count), value: value, onChange: onChange })] }\n  );\n}\nfunction SelectPageSize({ options, current, onChange }) {\n  return _jsxs(\"span\", { className: \"dt-select-page-size form-inline\", children: [\n    t('page_size.show'), ' ',\n    _jsx(\"select\", { className: \"form-control input-sm\", value: current, onBlur: () => {}, onChange: (e) => {\n        onChange(Number(e.target.value));\n      }, children:\n      options.map((option) => {\n        const [size, text] = Array.isArray(option) ?\n        option :\n        [option, option];\n        const sizeLabel = size === 0 ? t('all') : size;\n        return _jsx(\"option\", { \"aria-label\": t('Show %s entries', sizeLabel), value: size, children:\n          text }, size\n        );\n      }) }\n    ), ' ',\n    t('page_size.entries')] }\n  );\n}\nconst getNoResultsMessage = (filter) => filter ? t('No matching records found') : t('No records found');var _ref = process.env.NODE_ENV === \"production\" ? { name: \"tvoj80\", styles: \"display:inline-flex;align-items:flex-end\" } : { name: \"1f5n49p-Header\", styles: \"display:inline-flex;align-items:flex-end;label:Header;\", map: \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9hcHAvc3VwZXJzZXQtZnJvbnRlbmQvcGx1Z2lucy9wbHVnaW4tY2hhcnQtdGFibGUvc3JjL1RhYmxlQ2hhcnQudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQXFtQjJDIiwiZmlsZSI6Ii9hcHAvc3VwZXJzZXQtZnJvbnRlbmQvcGx1Z2lucy9wbHVnaW4tY2hhcnQtdGFibGUvc3JjL1RhYmxlQ2hhcnQudHN4Iiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4gKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbiAqIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4gKiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4gKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4gKiBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4gKiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4gKiBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4gKiB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuaW1wb3J0IHsgdXNlQ2FsbGJhY2ssIHVzZUxheW91dEVmZmVjdCwgdXNlTWVtbywgdXNlU3RhdGUsIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgZXh0ZW50IGFzIGQzRXh0ZW50LCBtYXggYXMgZDNNYXggfSBmcm9tICdkMy1hcnJheSc7XG5pbXBvcnQgeyBGYVNvcnQgfSBmcm9tICdAcmVhY3QtaWNvbnMvYWxsLWZpbGVzL2ZhL0ZhU29ydCc7XG5pbXBvcnQgeyBGYVNvcnREb3duIGFzIEZhU29ydERlc2MgfSBmcm9tICdAcmVhY3QtaWNvbnMvYWxsLWZpbGVzL2ZhL0ZhU29ydERvd24nO1xuaW1wb3J0IHsgRmFTb3J0VXAgYXMgRmFTb3J0QXNjIH0gZnJvbSAnQHJlYWN0LWljb25zL2FsbC1maWxlcy9mYS9GYVNvcnRVcCc7XG5pbXBvcnQgY3ggZnJvbSAnY2xhc3NuYW1lcyc7XG5pbXBvcnQgeyBEVFRNX0FMSUFTLCBlbnN1cmVJc0FycmF5LCBHZW5lcmljRGF0YVR5cGUsIGdldFNlbGVjdGVkVGV4dCwgZ2V0VGltZUZvcm1hdHRlckZvckdyYW51bGFyaXR5LCBzdHlsZWQsIGNzcywgdCwgdG4sIHVzZVRoZW1lLCB9IGZyb20gJ0BzdXBlcnNldC11aS9jb3JlJztcbmltcG9ydCB7IERyb3Bkb3duLCBNZW51LCBUb29sdGlwIH0gZnJvbSAnQHN1cGVyc2V0LXVpL2NoYXJ0LWNvbnRyb2xzJztcbmltcG9ydCB7IENoZWNrT3V0bGluZWQsIEluZm9DaXJjbGVPdXRsaW5lZCwgRG93bk91dGxpbmVkLCBNaW51c0NpcmNsZU91dGxpbmVkLCBQbHVzQ2lyY2xlT3V0bGluZWQsIFRhYmxlT3V0bGluZWQsIH0gZnJvbSAnQGFudC1kZXNpZ24vaWNvbnMnO1xuaW1wb3J0IHsgaXNFbXB0eSwgaXNOdW1iZXIgfSBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgQ29sb3JTY2hlbWVFbnVtLCB9IGZyb20gJy4vdHlwZXMnO1xuaW1wb3J0IERhdGFUYWJsZSBmcm9tICcuL0RhdGFUYWJsZSc7XG5pbXBvcnQgU3R5bGVzIGZyb20gJy4vU3R5bGVzJztcbmltcG9ydCB7IGZvcm1hdENvbHVtblZhbHVlIH0gZnJvbSAnLi91dGlscy9mb3JtYXRWYWx1ZSc7XG5pbXBvcnQgeyBQQUdFX1NJWkVfT1BUSU9OUyB9IGZyb20gJy4vY29uc3RzJztcbmltcG9ydCB7IHVwZGF0ZUV4dGVybmFsRm9ybURhdGEgfSBmcm9tICcuL0RhdGFUYWJsZS91dGlscy9leHRlcm5hbEFQSXMnO1xuaW1wb3J0IGdldFNjcm9sbEJhclNpemUgZnJvbSAnLi9EYXRhVGFibGUvdXRpbHMvZ2V0U2Nyb2xsQmFyU2l6ZSc7XG5jb25zdCBBQ1RJT05fS0VZUyA9IHtcbiAgICBlbnRlcjogJ0VudGVyJyxcbiAgICBzcGFjZWJhcjogJ1NwYWNlYmFyJyxcbiAgICBzcGFjZTogJyAnLFxufTtcbi8qKlxuICogUmV0dXJuIHNvcnRUeXBlIGJhc2VkIG9uIGRhdGEgdHlwZVxuICovXG5mdW5jdGlvbiBnZXRTb3J0VHlwZUJ5RGF0YVR5cGUoZGF0YVR5cGUpIHtcbiAgICBpZiAoZGF0YVR5cGUgPT09IEdlbmVyaWNEYXRhVHlwZS5UZW1wb3JhbCkge1xuICAgICAgICByZXR1cm4gJ2RhdGV0aW1lJztcbiAgICB9XG4gICAgaWYgKGRhdGFUeXBlID09PSBHZW5lcmljRGF0YVR5cGUuU3RyaW5nKSB7XG4gICAgICAgIHJldHVybiAnYWxwaGFudW1lcmljJztcbiAgICB9XG4gICAgcmV0dXJuICdiYXNpYyc7XG59XG4vKipcbiAqIENlbGwgYmFja2dyb3VuZCB3aWR0aCBjYWxjdWxhdGlvbiBmb3IgaG9yaXpvbnRhbCBiYXIgY2hhcnRcbiAqL1xuZnVuY3Rpb24gY2VsbFdpZHRoKHsgdmFsdWUsIHZhbHVlUmFuZ2UsIGFsaWduUG9zaXRpdmVOZWdhdGl2ZSwgfSkge1xuICAgIGNvbnN0IFttaW5WYWx1ZSwgbWF4VmFsdWVdID0gdmFsdWVSYW5nZTtcbiAgICBpZiAoYWxpZ25Qb3NpdGl2ZU5lZ2F0aXZlKSB7XG4gICAgICAgIGNvbnN0IHBlcmMgPSBNYXRoLmFicyhNYXRoLnJvdW5kKCh2YWx1ZSAvIG1heFZhbHVlKSAqIDEwMCkpO1xuICAgICAgICByZXR1cm4gcGVyYztcbiAgICB9XG4gICAgY29uc3QgcG9zRXh0ZW50ID0gTWF0aC5hYnMoTWF0aC5tYXgobWF4VmFsdWUsIDApKTtcbiAgICBjb25zdCBuZWdFeHRlbnQgPSBNYXRoLmFicyhNYXRoLm1pbihtaW5WYWx1ZSwgMCkpO1xuICAgIGNvbnN0IHRvdCA9IHBvc0V4dGVudCArIG5lZ0V4dGVudDtcbiAgICBjb25zdCBwZXJjMiA9IE1hdGgucm91bmQoKE1hdGguYWJzKHZhbHVlKSAvIHRvdCkgKiAxMDApO1xuICAgIHJldHVybiBwZXJjMjtcbn1cbi8qKlxuICogQ2VsbCBsZWZ0IG1hcmdpbiAob2Zmc2V0KSBjYWxjdWxhdGlvbiBmb3IgaG9yaXpvbnRhbCBiYXIgY2hhcnQgZWxlbWVudHNcbiAqIHdoZW4gYWxpZ25Qb3NpdGl2ZU5lZ2F0aXZlIGlzIG5vdCBzZXRcbiAqL1xuZnVuY3Rpb24gY2VsbE9mZnNldCh7IHZhbHVlLCB2YWx1ZVJhbmdlLCBhbGlnblBvc2l0aXZlTmVnYXRpdmUsIH0pIHtcbiAgICBpZiAoYWxpZ25Qb3NpdGl2ZU5lZ2F0aXZlKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICBjb25zdCBbbWluVmFsdWUsIG1heFZhbHVlXSA9IHZhbHVlUmFuZ2U7XG4gICAgY29uc3QgcG9zRXh0ZW50ID0gTWF0aC5hYnMoTWF0aC5tYXgobWF4VmFsdWUsIDApKTtcbiAgICBjb25zdCBuZWdFeHRlbnQgPSBNYXRoLmFicyhNYXRoLm1pbihtaW5WYWx1ZSwgMCkpO1xuICAgIGNvbnN0IHRvdCA9IHBvc0V4dGVudCArIG5lZ0V4dGVudDtcbiAgICByZXR1cm4gTWF0aC5yb3VuZCgoTWF0aC5taW4obmVnRXh0ZW50ICsgdmFsdWUsIG5lZ0V4dGVudCkgLyB0b3QpICogMTAwKTtcbn1cbi8qKlxuICogQ2VsbCBiYWNrZ3JvdW5kIGNvbG9yIGNhbGN1bGF0aW9uIGZvciBob3Jpem9udGFsIGJhciBjaGFydFxuICovXG5mdW5jdGlvbiBjZWxsQmFja2dyb3VuZCh7IHZhbHVlLCBjb2xvclBvc2l0aXZlTmVnYXRpdmUgPSBmYWxzZSwgfSkge1xuICAgIGNvbnN0IHIgPSBjb2xvclBvc2l0aXZlTmVnYXRpdmUgJiYgdmFsdWUgPCAwID8gMTUwIDogMDtcbiAgICByZXR1cm4gYHJnYmEoJHtyfSwwLDAsMC4yKWA7XG59XG5mdW5jdGlvbiBTb3J0SWNvbih7IGNvbHVtbiB9KSB7XG4gICAgY29uc3QgeyBpc1NvcnRlZCwgaXNTb3J0ZWREZXNjIH0gPSBjb2x1bW47XG4gICAgbGV0IHNvcnRJY29uID0gPEZhU29ydCAvPjtcbiAgICBpZiAoaXNTb3J0ZWQpIHtcbiAgICAgICAgc29ydEljb24gPSBpc1NvcnRlZERlc2MgPyA8RmFTb3J0RGVzYyAvPiA6IDxGYVNvcnRBc2MgLz47XG4gICAgfVxuICAgIHJldHVybiBzb3J0SWNvbjtcbn1cbmZ1bmN0aW9uIFNlYXJjaElucHV0KHsgY291bnQsIHZhbHVlLCBvbkNoYW5nZSB9KSB7XG4gICAgcmV0dXJuICg8c3BhbiBjbGFzc05hbWU9XCJkdC1nbG9iYWwtZmlsdGVyXCI+XG4gICAgICB7dCgnU2VhcmNoJyl9eycgJ31cbiAgICAgIDxpbnB1dCBhcmlhLWxhYmVsPXt0KCdTZWFyY2ggJXMgcmVjb3JkcycsIGNvdW50KX0gY2xhc3NOYW1lPVwiZm9ybS1jb250cm9sIGlucHV0LXNtXCIgcGxhY2Vob2xkZXI9e3RuKCdzZWFyY2gubnVtX3JlY29yZHMnLCBjb3VudCl9IHZhbHVlPXt2YWx1ZX0gb25DaGFuZ2U9e29uQ2hhbmdlfS8+XG4gICAgPC9zcGFuPik7XG59XG5mdW5jdGlvbiBTZWxlY3RQYWdlU2l6ZSh7IG9wdGlvbnMsIGN1cnJlbnQsIG9uQ2hhbmdlLCB9KSB7XG4gICAgcmV0dXJuICg8c3BhbiBjbGFzc05hbWU9XCJkdC1zZWxlY3QtcGFnZS1zaXplIGZvcm0taW5saW5lXCI+XG4gICAgICB7dCgncGFnZV9zaXplLnNob3cnKX17JyAnfVxuICAgICAgPHNlbGVjdCBjbGFzc05hbWU9XCJmb3JtLWNvbnRyb2wgaW5wdXQtc21cIiB2YWx1ZT17Y3VycmVudH0gb25CbHVyPXsoKSA9PiB7IH19IG9uQ2hhbmdlPXtlID0+IHtcbiAgICAgICAgICAgIG9uQ2hhbmdlKE51bWJlcihlLnRhcmdldC52YWx1ZSkpO1xuICAgICAgICB9fT5cbiAgICAgICAge29wdGlvbnMubWFwKG9wdGlvbiA9PiB7XG4gICAgICAgICAgICBjb25zdCBbc2l6ZSwgdGV4dF0gPSBBcnJheS5pc0FycmF5KG9wdGlvbilcbiAgICAgICAgICAgICAgICA/IG9wdGlvblxuICAgICAgICAgICAgICAgIDogW29wdGlvbiwgb3B0aW9uXTtcbiAgICAgICAgICAgIGNvbnN0IHNpemVMYWJlbCA9IHNpemUgPT09IDAgPyB0KCdhbGwnKSA6IHNpemU7XG4gICAgICAgICAgICByZXR1cm4gKDxvcHRpb24gYXJpYS1sYWJlbD17dCgnU2hvdyAlcyBlbnRyaWVzJywgc2l6ZUxhYmVsKX0ga2V5PXtzaXplfSB2YWx1ZT17c2l6ZX0+XG4gICAgICAgICAgICAgIHt0ZXh0fVxuICAgICAgICAgICAgPC9vcHRpb24+KTtcbiAgICAgICAgfSl9XG4gICAgICA8L3NlbGVjdD57JyAnfVxuICAgICAge3QoJ3BhZ2Vfc2l6ZS5lbnRyaWVzJyl9XG4gICAgPC9zcGFuPik7XG59XG5jb25zdCBnZXROb1Jlc3VsdHNNZXNzYWdlID0gKGZpbHRlcikgPT4gZmlsdGVyID8gdCgnTm8gbWF0Y2hpbmcgcmVjb3JkcyBmb3VuZCcpIDogdCgnTm8gcmVjb3JkcyBmb3VuZCcpO1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gVGFibGVDaGFydChwcm9wcykge1xuICAgIGNvbnN0IHsgdGltZUdyYWluLCBoZWlnaHQsIHdpZHRoLCBkYXRhLCB0b3RhbHMsIGlzUmF3UmVjb3Jkcywgcm93Q291bnQgPSAwLCBjb2x1bW5zOiBjb2x1bW5zTWV0YSwgYWxpZ25Qb3NpdGl2ZU5lZ2F0aXZlOiBkZWZhdWx0QWxpZ25QTiA9IGZhbHNlLCBjb2xvclBvc2l0aXZlTmVnYXRpdmU6IGRlZmF1bHRDb2xvclBOID0gZmFsc2UsIGluY2x1ZGVTZWFyY2ggPSBmYWxzZSwgcGFnZVNpemUgPSAwLCBzZXJ2ZXJQYWdpbmF0aW9uID0gZmFsc2UsIHNlcnZlclBhZ2luYXRpb25EYXRhLCBzZXREYXRhTWFzaywgc2hvd0NlbGxCYXJzID0gdHJ1ZSwgc29ydERlc2MgPSBmYWxzZSwgZmlsdGVycywgc3RpY2t5ID0gdHJ1ZSwgLy8gd2hldGhlciB0byB1c2Ugc3RpY2t5IGhlYWRlclxuICAgIGNvbHVtbkNvbG9yRm9ybWF0dGVycywgYWxsb3dSZWFycmFuZ2VDb2x1bW5zID0gZmFsc2UsIGFsbG93UmVuZGVySHRtbCA9IHRydWUsIG9uQ29udGV4dE1lbnUsIGVtaXRDcm9zc0ZpbHRlcnMsIGlzVXNpbmdUaW1lQ29tcGFyaXNvbiwgYmFzaWNDb2xvckZvcm1hdHRlcnMsIGJhc2ljQ29sb3JDb2x1bW5Gb3JtYXR0ZXJzLCB9ID0gcHJvcHM7XG4gICAgY29uc3QgY29tcGFyaXNvbkNvbHVtbnMgPSBbXG4gICAgICAgIHsga2V5OiAnYWxsJywgbGFiZWw6IHQoJ0Rpc3BsYXkgYWxsJykgfSxcbiAgICAgICAgeyBrZXk6ICcjJywgbGFiZWw6ICcjJyB9LFxuICAgICAgICB7IGtleTogJ+KWsycsIGxhYmVsOiAn4pazJyB9LFxuICAgICAgICB7IGtleTogJyUnLCBsYWJlbDogJyUnIH0sXG4gICAgXTtcbiAgICBjb25zdCB0aW1lc3RhbXBGb3JtYXR0ZXIgPSB1c2VDYWxsYmFjayh2YWx1ZSA9PiBnZXRUaW1lRm9ybWF0dGVyRm9yR3JhbnVsYXJpdHkodGltZUdyYWluKSh2YWx1ZSksIFt0aW1lR3JhaW5dKTtcbiAgICBjb25zdCBbdGFibGVTaXplLCBzZXRUYWJsZVNpemVdID0gdXNlU3RhdGUoe1xuICAgICAgICB3aWR0aDogMCxcbiAgICAgICAgaGVpZ2h0OiAwLFxuICAgIH0pO1xuICAgIC8vIGtlZXAgdHJhY2sgb2Ygd2hldGhlciBjb2x1bW4gb3JkZXIgY2hhbmdlZCwgc28gdGhhdCBjb2x1bW4gd2lkdGhzIGNhbiB0b29cbiAgICBjb25zdCBbY29sdW1uT3JkZXJUb2dnbGUsIHNldENvbHVtbk9yZGVyVG9nZ2xlXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgICBjb25zdCBbc2hvd0NvbXBhcmlzb25Ecm9wZG93biwgc2V0U2hvd0NvbXBhcmlzb25Ecm9wZG93bl0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gICAgY29uc3QgW3NlbGVjdGVkQ29tcGFyaXNvbkNvbHVtbnMsIHNldFNlbGVjdGVkQ29tcGFyaXNvbkNvbHVtbnNdID0gdXNlU3RhdGUoW1xuICAgICAgICBjb21wYXJpc29uQ29sdW1uc1swXS5rZXksXG4gICAgXSk7XG4gICAgY29uc3QgW2hpZGVDb21wYXJpc29uS2V5cywgc2V0SGlkZUNvbXBhcmlzb25LZXlzXSA9IHVzZVN0YXRlKFtdKTtcbiAgICBjb25zdCB0aGVtZSA9IHVzZVRoZW1lKCk7XG4gICAgLy8gb25seSB0YWtlIHJlbGV2YW50IHBhZ2Ugc2l6ZSBvcHRpb25zXG4gICAgY29uc3QgcGFnZVNpemVPcHRpb25zID0gdXNlTWVtbygoKSA9PiB7XG4gICAgICAgIGNvbnN0IGdldFNlcnZlclBhZ2luYXRpb24gPSAobikgPT4gbiA8PSByb3dDb3VudDtcbiAgICAgICAgcmV0dXJuIFBBR0VfU0laRV9PUFRJT05TLmZpbHRlcigoW25dKSA9PiBzZXJ2ZXJQYWdpbmF0aW9uID8gZ2V0U2VydmVyUGFnaW5hdGlvbihuKSA6IG4gPD0gMiAqIGRhdGEubGVuZ3RoKTtcbiAgICB9LCBbZGF0YS5sZW5ndGgsIHJvd0NvdW50LCBzZXJ2ZXJQYWdpbmF0aW9uXSk7XG4gICAgY29uc3QgZ2V0VmFsdWVSYW5nZSA9IHVzZUNhbGxiYWNrKGZ1bmN0aW9uIGdldFZhbHVlUmFuZ2Uoa2V5LCBhbGlnblBvc2l0aXZlTmVnYXRpdmUpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBkYXRhPy5bMF0/LltrZXldID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgY29uc3QgbnVtcyA9IGRhdGEubWFwKHJvdyA9PiByb3dba2V5XSk7XG4gICAgICAgICAgICByZXR1cm4gKGFsaWduUG9zaXRpdmVOZWdhdGl2ZVxuICAgICAgICAgICAgICAgID8gWzAsIGQzTWF4KG51bXMubWFwKE1hdGguYWJzKSldXG4gICAgICAgICAgICAgICAgOiBkM0V4dGVudChudW1zKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSwgW2RhdGFdKTtcbiAgICBjb25zdCBpc0FjdGl2ZUZpbHRlclZhbHVlID0gdXNlQ2FsbGJhY2soZnVuY3Rpb24gaXNBY3RpdmVGaWx0ZXJWYWx1ZShrZXksIHZhbCkge1xuICAgICAgICByZXR1cm4gISFmaWx0ZXJzICYmIGZpbHRlcnNba2V5XT8uaW5jbHVkZXModmFsKTtcbiAgICB9LCBbZmlsdGVyc10pO1xuICAgIGNvbnN0IGdldENyb3NzRmlsdGVyRGF0YU1hc2sgPSAoa2V5LCB2YWx1ZSkgPT4ge1xuICAgICAgICBsZXQgdXBkYXRlZEZpbHRlcnMgPSB7IC4uLihmaWx0ZXJzIHx8IHt9KSB9O1xuICAgICAgICBpZiAoZmlsdGVycyAmJiBpc0FjdGl2ZUZpbHRlclZhbHVlKGtleSwgdmFsdWUpKSB7XG4gICAgICAgICAgICB1cGRhdGVkRmlsdGVycyA9IHt9O1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdXBkYXRlZEZpbHRlcnMgPSB7XG4gICAgICAgICAgICAgICAgW2tleV06IFt2YWx1ZV0sXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHVwZGF0ZWRGaWx0ZXJzW2tleV0pICYmXG4gICAgICAgICAgICB1cGRhdGVkRmlsdGVyc1trZXldLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgZGVsZXRlIHVwZGF0ZWRGaWx0ZXJzW2tleV07XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZ3JvdXBCeSA9IE9iamVjdC5rZXlzKHVwZGF0ZWRGaWx0ZXJzKTtcbiAgICAgICAgY29uc3QgZ3JvdXBCeVZhbHVlcyA9IE9iamVjdC52YWx1ZXModXBkYXRlZEZpbHRlcnMpO1xuICAgICAgICBjb25zdCBsYWJlbEVsZW1lbnRzID0gW107XG4gICAgICAgIGdyb3VwQnkuZm9yRWFjaChjb2wgPT4ge1xuICAgICAgICAgICAgY29uc3QgaXNUaW1lc3RhbXAgPSBjb2wgPT09IERUVE1fQUxJQVM7XG4gICAgICAgICAgICBjb25zdCBmaWx0ZXJWYWx1ZXMgPSBlbnN1cmVJc0FycmF5KHVwZGF0ZWRGaWx0ZXJzPy5bY29sXSk7XG4gICAgICAgICAgICBpZiAoZmlsdGVyVmFsdWVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlTGFiZWxzID0gZmlsdGVyVmFsdWVzLm1hcCh2YWx1ZSA9PiBpc1RpbWVzdGFtcCA/IHRpbWVzdGFtcEZvcm1hdHRlcih2YWx1ZSkgOiB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgbGFiZWxFbGVtZW50cy5wdXNoKGAke3ZhbHVlTGFiZWxzLmpvaW4oJywgJyl9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZGF0YU1hc2s6IHtcbiAgICAgICAgICAgICAgICBleHRyYUZvcm1EYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlcnM6IGdyb3VwQnkubGVuZ3RoID09PSAwXG4gICAgICAgICAgICAgICAgICAgICAgICA/IFtdXG4gICAgICAgICAgICAgICAgICAgICAgICA6IGdyb3VwQnkubWFwKGNvbCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsID0gZW5zdXJlSXNBcnJheSh1cGRhdGVkRmlsdGVycz8uW2NvbF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdmFsLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wOiAnSVMgTlVMTCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcDogJ0lOJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsOiB2YWwubWFwKGVsID0+IGVsIGluc3RhbmNlb2YgRGF0ZSA/IGVsLmdldFRpbWUoKSA6IGVsKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JhaW46IGNvbCA9PT0gRFRUTV9BTElBUyA/IHRpbWVHcmFpbiA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBmaWx0ZXJTdGF0ZToge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogbGFiZWxFbGVtZW50cy5qb2luKCcsICcpLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogZ3JvdXBCeVZhbHVlcy5sZW5ndGggPyBncm91cEJ5VmFsdWVzIDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyczogdXBkYXRlZEZpbHRlcnMgJiYgT2JqZWN0LmtleXModXBkYXRlZEZpbHRlcnMpLmxlbmd0aFxuICAgICAgICAgICAgICAgICAgICAgICAgPyB1cGRhdGVkRmlsdGVyc1xuICAgICAgICAgICAgICAgICAgICAgICAgOiBudWxsLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXNDdXJyZW50VmFsdWVTZWxlY3RlZDogaXNBY3RpdmVGaWx0ZXJWYWx1ZShrZXksIHZhbHVlKSxcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIGNvbnN0IHRvZ2dsZUZpbHRlciA9IHVzZUNhbGxiYWNrKGZ1bmN0aW9uIHRvZ2dsZUZpbHRlcihrZXksIHZhbCkge1xuICAgICAgICBpZiAoIWVtaXRDcm9zc0ZpbHRlcnMpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBzZXREYXRhTWFzayhnZXRDcm9zc0ZpbHRlckRhdGFNYXNrKGtleSwgdmFsKS5kYXRhTWFzayk7XG4gICAgfSwgW2VtaXRDcm9zc0ZpbHRlcnMsIGdldENyb3NzRmlsdGVyRGF0YU1hc2ssIHNldERhdGFNYXNrXSk7XG4gICAgY29uc3QgZ2V0U2hhcmVkU3R5bGUgPSAoY29sdW1uKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgaXNOdW1lcmljLCBjb25maWcgPSB7fSB9ID0gY29sdW1uO1xuICAgICAgICBjb25zdCB0ZXh0QWxpZ24gPSBjb25maWcuaG9yaXpvbnRhbEFsaWduIHx8XG4gICAgICAgICAgICAoaXNOdW1lcmljICYmICFpc1VzaW5nVGltZUNvbXBhcmlzb24gPyAncmlnaHQnIDogJ2xlZnQnKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRleHRBbGlnbixcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIGNvbnN0IGNvbXBhcmlzb25MYWJlbHMgPSBbdCgnTWFpbicpLCAnIycsICfilrMnLCAnJSddO1xuICAgIGNvbnN0IGZpbHRlcmVkQ29sdW1uc01ldGEgPSB1c2VNZW1vKCgpID0+IHtcbiAgICAgICAgaWYgKCFpc1VzaW5nVGltZUNvbXBhcmlzb24pIHtcbiAgICAgICAgICAgIHJldHVybiBjb2x1bW5zTWV0YTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhbGxDb2x1bW5zID0gY29tcGFyaXNvbkNvbHVtbnNbMF0ua2V5O1xuICAgICAgICBjb25zdCBtYWluID0gY29tcGFyaXNvbkxhYmVsc1swXTtcbiAgICAgICAgY29uc3Qgc2hvd0FsbENvbHVtbnMgPSBzZWxlY3RlZENvbXBhcmlzb25Db2x1bW5zLmluY2x1ZGVzKGFsbENvbHVtbnMpO1xuICAgICAgICByZXR1cm4gY29sdW1uc01ldGEuZmlsdGVyKCh7IGxhYmVsLCBrZXkgfSkgPT4ge1xuICAgICAgICAgICAgLy8gRXh0cmFjdCB0aGUga2V5IHBvcnRpb24gYWZ0ZXIgdGhlIHNwYWNlLCBhc3N1bWluZyB0aGUgZm9ybWF0IGlzIGFsd2F5cyBcImxhYmVsIGtleVwiXG4gICAgICAgICAgICBjb25zdCBrZXlQb3J0aW9uID0ga2V5LnN1YnN0cmluZyhsYWJlbC5sZW5ndGgpO1xuICAgICAgICAgICAgY29uc3QgaXNLZXlIaWRkZWQgPSBoaWRlQ29tcGFyaXNvbktleXMuaW5jbHVkZXMoa2V5UG9ydGlvbik7XG4gICAgICAgICAgICBjb25zdCBpc0xhYmxlTWFpbiA9IGxhYmVsID09PSBtYWluO1xuICAgICAgICAgICAgcmV0dXJuIChpc0xhYmxlTWFpbiB8fFxuICAgICAgICAgICAgICAgICghaXNLZXlIaWRkZWQgJiZcbiAgICAgICAgICAgICAgICAgICAgKCFjb21wYXJpc29uTGFiZWxzLmluY2x1ZGVzKGxhYmVsKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0FsbENvbHVtbnMgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkQ29tcGFyaXNvbkNvbHVtbnMuaW5jbHVkZXMobGFiZWwpKSkpO1xuICAgICAgICB9KTtcbiAgICB9LCBbXG4gICAgICAgIGNvbHVtbnNNZXRhLFxuICAgICAgICBjb21wYXJpc29uQ29sdW1ucyxcbiAgICAgICAgY29tcGFyaXNvbkxhYmVscyxcbiAgICAgICAgaXNVc2luZ1RpbWVDb21wYXJpc29uLFxuICAgICAgICBoaWRlQ29tcGFyaXNvbktleXMsXG4gICAgICAgIHNlbGVjdGVkQ29tcGFyaXNvbkNvbHVtbnMsXG4gICAgXSk7XG4gICAgY29uc3QgaGFuZGxlQ29udGV4dE1lbnUgPSBvbkNvbnRleHRNZW51ICYmICFpc1Jhd1JlY29yZHNcbiAgICAgICAgPyAodmFsdWUsIGNlbGxQb2ludCwgY2xpZW50WCwgY2xpZW50WSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZHJpbGxUb0RldGFpbEZpbHRlcnMgPSBbXTtcbiAgICAgICAgICAgIGZpbHRlcmVkQ29sdW1uc01ldGEuZm9yRWFjaChjb2wgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghY29sLmlzTWV0cmljKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGFSZWNvcmRWYWx1ZSA9IHZhbHVlW2NvbC5rZXldO1xuICAgICAgICAgICAgICAgICAgICBkcmlsbFRvRGV0YWlsRmlsdGVycy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbDogY29sLmtleSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wOiAnPT0nLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsOiBkYXRhUmVjb3JkVmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXR0ZWRWYWw6IGZvcm1hdENvbHVtblZhbHVlKGNvbCwgZGF0YVJlY29yZFZhbHVlKVsxXSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBvbkNvbnRleHRNZW51KGNsaWVudFgsIGNsaWVudFksIHtcbiAgICAgICAgICAgICAgICBkcmlsbFRvRGV0YWlsOiBkcmlsbFRvRGV0YWlsRmlsdGVycyxcbiAgICAgICAgICAgICAgICBjcm9zc0ZpbHRlcjogY2VsbFBvaW50LmlzTWV0cmljXG4gICAgICAgICAgICAgICAgICAgID8gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgICAgIDogZ2V0Q3Jvc3NGaWx0ZXJEYXRhTWFzayhjZWxsUG9pbnQua2V5LCBjZWxsUG9pbnQudmFsdWUpLFxuICAgICAgICAgICAgICAgIGRyaWxsQnk6IGNlbGxQb2ludC5pc01ldHJpY1xuICAgICAgICAgICAgICAgICAgICA/IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgICAgICA6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcnM6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbDogY2VsbFBvaW50LmtleSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3A6ICc9PScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbDogY2VsbFBvaW50LnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBieUZpZWxkTmFtZTogJ2dyb3VwYnknLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgOiB1bmRlZmluZWQ7XG4gICAgY29uc3QgZ2V0SGVhZGVyQ29sdW1ucyA9IChjb2x1bW5zTWV0YSwgZW5hYmxlVGltZUNvbXBhcmlzb24pID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0TWFwID0ge307XG4gICAgICAgIGlmICghZW5hYmxlVGltZUNvbXBhcmlzb24pIHtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHRNYXA7XG4gICAgICAgIH1cbiAgICAgICAgY29sdW1uc01ldGEuZm9yRWFjaCgoZWxlbWVudCwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIGVsZW1lbnQncyBsYWJlbCBpcyBvbmUgb2YgdGhlIGNvbXBhcmlzb24gbGFiZWxzXG4gICAgICAgICAgICBpZiAoY29tcGFyaXNvbkxhYmVscy5pbmNsdWRlcyhlbGVtZW50LmxhYmVsKSkge1xuICAgICAgICAgICAgICAgIC8vIEV4dHJhY3QgdGhlIGtleSBwb3J0aW9uIGFmdGVyIHRoZSBzcGFjZSwgYXNzdW1pbmcgdGhlIGZvcm1hdCBpcyBhbHdheXMgXCJsYWJlbCBrZXlcIlxuICAgICAgICAgICAgICAgIGNvbnN0IGtleVBvcnRpb24gPSBlbGVtZW50LmtleS5zdWJzdHJpbmcoZWxlbWVudC5sYWJlbC5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIC8vIElmIHRoZSBrZXkgcG9ydGlvbiBpcyBub3QgaW4gdGhlIG1hcCwgaW5pdGlhbGl6ZSBpdCB3aXRoIHRoZSBjdXJyZW50IGluZGV4XG4gICAgICAgICAgICAgICAgaWYgKCFyZXN1bHRNYXBba2V5UG9ydGlvbl0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0TWFwW2tleVBvcnRpb25dID0gW2luZGV4XTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEFkZCB0aGUgaW5kZXggdG8gdGhlIGV4aXN0aW5nIGFycmF5XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdE1hcFtrZXlQb3J0aW9uXS5wdXNoKGluZGV4KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcmVzdWx0TWFwO1xuICAgIH07XG4gICAgY29uc3QgcmVuZGVyVGltZUNvbXBhcmlzb25Ecm9wZG93biA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgYWxsS2V5ID0gY29tcGFyaXNvbkNvbHVtbnNbMF0ua2V5O1xuICAgICAgICBjb25zdCBoYW5kbGVPbkNsaWNrID0gKGRhdGEpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsga2V5IH0gPSBkYXRhO1xuICAgICAgICAgICAgLy8gVG9nZ2xlICdBbGwnIGtleSBzZWxlY3Rpb25cbiAgICAgICAgICAgIGlmIChrZXkgPT09IGFsbEtleSkge1xuICAgICAgICAgICAgICAgIHNldFNlbGVjdGVkQ29tcGFyaXNvbkNvbHVtbnMoW2FsbEtleV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoc2VsZWN0ZWRDb21wYXJpc29uQ29sdW1ucy5pbmNsdWRlcyhhbGxLZXkpKSB7XG4gICAgICAgICAgICAgICAgc2V0U2VsZWN0ZWRDb21wYXJpc29uQ29sdW1ucyhba2V5XSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBUb2dnbGUgc2VsZWN0aW9uIGZvciBvdGhlciBrZXlzXG4gICAgICAgICAgICAgICAgc2V0U2VsZWN0ZWRDb21wYXJpc29uQ29sdW1ucyhzZWxlY3RlZENvbXBhcmlzb25Db2x1bW5zLmluY2x1ZGVzKGtleSlcbiAgICAgICAgICAgICAgICAgICAgPyBzZWxlY3RlZENvbXBhcmlzb25Db2x1bW5zLmZpbHRlcihrID0+IGsgIT09IGtleSkgLy8gRGVzZWxlY3QgaWYgYWxyZWFkeSBzZWxlY3RlZFxuICAgICAgICAgICAgICAgICAgICA6IFsuLi5zZWxlY3RlZENvbXBhcmlzb25Db2x1bW5zLCBrZXldKTsgLy8gU2VsZWN0IGlmIG5vdCBhbHJlYWR5IHNlbGVjdGVkXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGhhbmRsZU9uQmx1ciA9ICgpID0+IHtcbiAgICAgICAgICAgIGlmIChzZWxlY3RlZENvbXBhcmlzb25Db2x1bW5zLmxlbmd0aCA9PT0gMykge1xuICAgICAgICAgICAgICAgIHNldFNlbGVjdGVkQ29tcGFyaXNvbkNvbHVtbnMoW2NvbXBhcmlzb25Db2x1bW5zWzBdLmtleV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gKDxEcm9wZG93biBwbGFjZW1lbnQ9XCJib3R0b21SaWdodFwiIHZpc2libGU9e3Nob3dDb21wYXJpc29uRHJvcGRvd259IG9uVmlzaWJsZUNoYW5nZT17KGZsYWcpID0+IHtcbiAgICAgICAgICAgICAgICBzZXRTaG93Q29tcGFyaXNvbkRyb3Bkb3duKGZsYWcpO1xuICAgICAgICAgICAgfX0gb3ZlcmxheT17PE1lbnUgbXVsdGlwbGUgb25DbGljaz17aGFuZGxlT25DbGlja30gb25CbHVyPXtoYW5kbGVPbkJsdXJ9IHNlbGVjdGVkS2V5cz17c2VsZWN0ZWRDb21wYXJpc29uQ29sdW1uc30+XG4gICAgICAgICAgICA8ZGl2IGNzcz17Y3NzIGBcbiAgICAgICAgICAgICAgICBtYXgtd2lkdGg6IDI0MnB4O1xuICAgICAgICAgICAgICAgIHBhZGRpbmc6IDAgJHt0aGVtZS5ncmlkVW5pdCAqIDJ9cHg7XG4gICAgICAgICAgICAgICAgY29sb3I6ICR7dGhlbWUuY29sb3JzLmdyYXlzY2FsZS5iYXNlfTtcbiAgICAgICAgICAgICAgICBmb250LXNpemU6ICR7dGhlbWUudHlwb2dyYXBoeS5zaXplcy5zfXB4O1xuICAgICAgICAgICAgICBgfT5cbiAgICAgICAgICAgICAge3QoJ1NlbGVjdCBjb2x1bW5zIHRoYXQgd2lsbCBiZSBkaXNwbGF5ZWQgaW4gdGhlIHRhYmxlLiBZb3UgY2FuIG11bHRpc2VsZWN0IGNvbHVtbnMuJyl9XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIHtjb21wYXJpc29uQ29sdW1ucy5tYXAoY29sdW1uID0+ICg8TWVudS5JdGVtIGtleT17Y29sdW1uLmtleX0+XG4gICAgICAgICAgICAgICAgPHNwYW4gY3NzPXtjc3MgYFxuICAgICAgICAgICAgICAgICAgICBjb2xvcjogJHt0aGVtZS5jb2xvcnMuZ3JheXNjYWxlLmRhcmsyfTtcbiAgICAgICAgICAgICAgICAgIGB9PlxuICAgICAgICAgICAgICAgICAge2NvbHVtbi5sYWJlbH1cbiAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgICAgPHNwYW4gY3NzPXtjc3MgYFxuICAgICAgICAgICAgICAgICAgICBmbG9hdDogcmlnaHQ7XG4gICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogJHt0aGVtZS50eXBvZ3JhcGh5LnNpemVzLnN9cHg7XG4gICAgICAgICAgICAgICAgICBgfT5cbiAgICAgICAgICAgICAgICAgIHtzZWxlY3RlZENvbXBhcmlzb25Db2x1bW5zLmluY2x1ZGVzKGNvbHVtbi5rZXkpICYmICg8Q2hlY2tPdXRsaW5lZCAvPil9XG4gICAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgICA8L01lbnUuSXRlbT4pKX1cbiAgICAgICAgICA8L01lbnU+fSB0cmlnZ2VyPXtbJ2NsaWNrJ119PlxuICAgICAgICA8c3Bhbj5cbiAgICAgICAgICA8VGFibGVPdXRsaW5lZCAvPiA8RG93bk91dGxpbmVkIC8+XG4gICAgICAgIDwvc3Bhbj5cbiAgICAgIDwvRHJvcGRvd24+KTtcbiAgICB9O1xuICAgIGNvbnN0IHJlbmRlckdyb3VwaW5nSGVhZGVycyA9ICgpID0+IHtcbiAgICAgICAgLy8gVE9ETzogTWFrZSB1c2Ugb2YgQ29sdW1uR3JvdXAgdG8gcmVuZGVyIHRoZSBhZGl0aW9uYWwgaGVhZGVyc1xuICAgICAgICBjb25zdCBoZWFkZXJzID0gW107XG4gICAgICAgIGxldCBjdXJyZW50Q29sdW1uSW5kZXggPSAwO1xuICAgICAgICBPYmplY3QuZW50cmllcyhncm91cEhlYWRlckNvbHVtbnMgfHwge30pLmZvckVhY2goKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBudW1iZXIgb2YgcGxhY2Vob2xkZXIgY29sdW1ucyBuZWVkZWQgYmVmb3JlIHRoZSBjdXJyZW50IGhlYWRlclxuICAgICAgICAgICAgY29uc3Qgc3RhcnRQb3NpdGlvbiA9IHZhbHVlWzBdO1xuICAgICAgICAgICAgY29uc3QgY29sU3BhbiA9IHZhbHVlLmxlbmd0aDtcbiAgICAgICAgICAgIC8vIEFkZCBwbGFjZWhvbGRlciA8dGg+IGZvciBjb2x1bW5zIGJlZm9yZSB0aGlzIGhlYWRlclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IGN1cnJlbnRDb2x1bW5JbmRleDsgaSA8IHN0YXJ0UG9zaXRpb247IGkgKz0gMSkge1xuICAgICAgICAgICAgICAgIGhlYWRlcnMucHVzaCg8dGgga2V5PXtgcGxhY2Vob2xkZXItJHtpfWB9IHN0eWxlPXt7IGJvcmRlckJvdHRvbTogMCB9fSBhcmlhLWxhYmVsPXtgSGVhZGVyLSR7aX1gfS8+KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEFkZCB0aGUgY3VycmVudCBoZWFkZXIgPHRoPlxuICAgICAgICAgICAgaGVhZGVycy5wdXNoKDx0aCBrZXk9e2BoZWFkZXItJHtrZXl9YH0gY29sU3Bhbj17Y29sU3Bhbn0gc3R5bGU9e3sgYm9yZGVyQm90dG9tOiAwIH19PlxuICAgICAgICAgIHtrZXl9XG4gICAgICAgICAgPHNwYW4gY3NzPXtjc3MgYFxuICAgICAgICAgICAgICBmbG9hdDogcmlnaHQ7XG4gICAgICAgICAgICAgICYgc3ZnIHtcbiAgICAgICAgICAgICAgICBjb2xvcjogJHt0aGVtZS5jb2xvcnMuZ3JheXNjYWxlLmJhc2V9ICFpbXBvcnRhbnQ7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGB9PlxuICAgICAgICAgICAge2hpZGVDb21wYXJpc29uS2V5cy5pbmNsdWRlcyhrZXkpID8gKDxQbHVzQ2lyY2xlT3V0bGluZWQgb25DbGljaz17KCkgPT4gc2V0SGlkZUNvbXBhcmlzb25LZXlzKGhpZGVDb21wYXJpc29uS2V5cy5maWx0ZXIoayA9PiBrICE9PSBrZXkpKX0vPikgOiAoPE1pbnVzQ2lyY2xlT3V0bGluZWQgb25DbGljaz17KCkgPT4gc2V0SGlkZUNvbXBhcmlzb25LZXlzKFsuLi5oaWRlQ29tcGFyaXNvbktleXMsIGtleV0pfS8+KX1cbiAgICAgICAgICA8L3NwYW4+XG4gICAgICAgIDwvdGg+KTtcbiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgY3VycmVudCBjb2x1bW4gaW5kZXhcbiAgICAgICAgICAgIGN1cnJlbnRDb2x1bW5JbmRleCA9IHN0YXJ0UG9zaXRpb24gKyBjb2xTcGFuO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuICg8dHIgY3NzPXtjc3MgYFxuICAgICAgICAgIHRoIHtcbiAgICAgICAgICAgIGJvcmRlci1yaWdodDogMnB4IHNvbGlkICR7dGhlbWUuY29sb3JzLmdyYXlzY2FsZS5saWdodDJ9O1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aDpmaXJzdC1jaGlsZCB7XG4gICAgICAgICAgICBib3JkZXItbGVmdDogbm9uZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGg6bGFzdC1jaGlsZCB7XG4gICAgICAgICAgICBib3JkZXItcmlnaHQ6IG5vbmU7XG4gICAgICAgICAgfVxuICAgICAgICBgfT5cbiAgICAgICAge2hlYWRlcnN9XG4gICAgICA8L3RyPik7XG4gICAgfTtcbiAgICBjb25zdCBncm91cEhlYWRlckNvbHVtbnMgPSB1c2VNZW1vKCgpID0+IGdldEhlYWRlckNvbHVtbnMoZmlsdGVyZWRDb2x1bW5zTWV0YSwgaXNVc2luZ1RpbWVDb21wYXJpc29uKSwgW2ZpbHRlcmVkQ29sdW1uc01ldGEsIGlzVXNpbmdUaW1lQ29tcGFyaXNvbl0pO1xuICAgIGNvbnN0IGdldENvbHVtbkNvbmZpZ3MgPSB1c2VDYWxsYmFjaygoY29sdW1uLCBpKSA9PiB7XG4gICAgICAgIGNvbnN0IHsga2V5LCBsYWJlbCwgaXNOdW1lcmljLCBkYXRhVHlwZSwgaXNNZXRyaWMsIGlzUGVyY2VudE1ldHJpYywgY29uZmlnID0ge30sIH0gPSBjb2x1bW47XG4gICAgICAgIGNvbnN0IGNvbHVtbldpZHRoID0gTnVtYmVyLmlzTmFOKE51bWJlcihjb25maWcuY29sdW1uV2lkdGgpKVxuICAgICAgICAgICAgPyBjb25maWcuY29sdW1uV2lkdGhcbiAgICAgICAgICAgIDogTnVtYmVyKGNvbmZpZy5jb2x1bW5XaWR0aCk7XG4gICAgICAgIC8vIGlubGluZSBzdHlsZSBmb3IgYm90aCB0aCBhbmQgdGQgY2VsbFxuICAgICAgICBjb25zdCBzaGFyZWRTdHlsZSA9IGdldFNoYXJlZFN0eWxlKGNvbHVtbik7XG4gICAgICAgIGNvbnN0IGFsaWduUG9zaXRpdmVOZWdhdGl2ZSA9IGNvbmZpZy5hbGlnblBvc2l0aXZlTmVnYXRpdmUgPT09IHVuZGVmaW5lZFxuICAgICAgICAgICAgPyBkZWZhdWx0QWxpZ25QTlxuICAgICAgICAgICAgOiBjb25maWcuYWxpZ25Qb3NpdGl2ZU5lZ2F0aXZlO1xuICAgICAgICBjb25zdCBjb2xvclBvc2l0aXZlTmVnYXRpdmUgPSBjb25maWcuY29sb3JQb3NpdGl2ZU5lZ2F0aXZlID09PSB1bmRlZmluZWRcbiAgICAgICAgICAgID8gZGVmYXVsdENvbG9yUE5cbiAgICAgICAgICAgIDogY29uZmlnLmNvbG9yUG9zaXRpdmVOZWdhdGl2ZTtcbiAgICAgICAgY29uc3QgeyB0cnVuY2F0ZUxvbmdDZWxscyB9ID0gY29uZmlnO1xuICAgICAgICBjb25zdCBoYXNDb2x1bW5Db2xvckZvcm1hdHRlcnMgPSBpc051bWVyaWMgJiZcbiAgICAgICAgICAgIEFycmF5LmlzQXJyYXkoY29sdW1uQ29sb3JGb3JtYXR0ZXJzKSAmJlxuICAgICAgICAgICAgY29sdW1uQ29sb3JGb3JtYXR0ZXJzLmxlbmd0aCA+IDA7XG4gICAgICAgIGNvbnN0IGhhc0Jhc2ljQ29sb3JGb3JtYXR0ZXJzID0gaXNVc2luZ1RpbWVDb21wYXJpc29uICYmXG4gICAgICAgICAgICBBcnJheS5pc0FycmF5KGJhc2ljQ29sb3JGb3JtYXR0ZXJzKSAmJlxuICAgICAgICAgICAgYmFzaWNDb2xvckZvcm1hdHRlcnMubGVuZ3RoID4gMDtcbiAgICAgICAgY29uc3QgdmFsdWVSYW5nZSA9ICFoYXNCYXNpY0NvbG9yRm9ybWF0dGVycyAmJlxuICAgICAgICAgICAgIWhhc0NvbHVtbkNvbG9yRm9ybWF0dGVycyAmJlxuICAgICAgICAgICAgKGNvbmZpZy5zaG93Q2VsbEJhcnMgPT09IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgID8gc2hvd0NlbGxCYXJzXG4gICAgICAgICAgICAgICAgOiBjb25maWcuc2hvd0NlbGxCYXJzKSAmJlxuICAgICAgICAgICAgKGlzTWV0cmljIHx8IGlzUmF3UmVjb3JkcyB8fCBpc1BlcmNlbnRNZXRyaWMpICYmXG4gICAgICAgICAgICBnZXRWYWx1ZVJhbmdlKGtleSwgYWxpZ25Qb3NpdGl2ZU5lZ2F0aXZlKTtcbiAgICAgICAgbGV0IGNsYXNzTmFtZSA9ICcnO1xuICAgICAgICBpZiAoZW1pdENyb3NzRmlsdGVycyAmJiAhaXNNZXRyaWMpIHtcbiAgICAgICAgICAgIGNsYXNzTmFtZSArPSAnIGR0LWlzLWZpbHRlcic7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFpc01ldHJpYyAmJiAhaXNQZXJjZW50TWV0cmljKSB7XG4gICAgICAgICAgICBjbGFzc05hbWUgKz0gJyByaWdodC1ib3JkZXItb25seSc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29tcGFyaXNvbkxhYmVscy5pbmNsdWRlcyhsYWJlbCkpIHtcbiAgICAgICAgICAgIGNvbnN0IGdyb3VwaW5IZWFkZXIgPSBrZXkuc3Vic3RyaW5nKGxhYmVsLmxlbmd0aCk7XG4gICAgICAgICAgICBjb25zdCBjb2x1bW5zVW5kZXJIZWFkZXIgPSBncm91cEhlYWRlckNvbHVtbnNbZ3JvdXBpbkhlYWRlcl0gfHwgW107XG4gICAgICAgICAgICBpZiAoaSA9PT0gY29sdW1uc1VuZGVySGVhZGVyW2NvbHVtbnNVbmRlckhlYWRlci5sZW5ndGggLSAxXSkge1xuICAgICAgICAgICAgICAgIGNsYXNzTmFtZSArPSAnIHJpZ2h0LWJvcmRlci1vbmx5JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaWQ6IFN0cmluZyhpKSxcbiAgICAgICAgICAgIC8vIG11c3QgdXNlIGN1c3RvbSBhY2Nlc3NvciB0byBhbGxvdyBgLmAgaW4gY29sdW1uIG5hbWVzXG4gICAgICAgICAgICAvLyB0eXBpbmcgaXMgaW5jb3JyZWN0IGluIGN1cnJlbnQgdmVyc2lvbiBvZiBgQHR5cGVzL3JlYWN0LXRhYmxlYFxuICAgICAgICAgICAgLy8gc28gd2UgYXNrIFRTIG5vdCB0byBjaGVjay5cbiAgICAgICAgICAgIGFjY2Vzc29yOiAoKGRhdHVtKSA9PiBkYXR1bVtrZXldKSxcbiAgICAgICAgICAgIENlbGw6ICh7IHZhbHVlLCByb3cgfSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IFtpc0h0bWwsIHRleHRdID0gZm9ybWF0Q29sdW1uVmFsdWUoY29sdW1uLCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgY29uc3QgaHRtbCA9IGlzSHRtbCAmJiBhbGxvd1JlbmRlckh0bWwgPyB7IF9faHRtbDogdGV4dCB9IDogdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIGxldCBiYWNrZ3JvdW5kQ29sb3I7XG4gICAgICAgICAgICAgICAgbGV0IGFycm93ID0gJyc7XG4gICAgICAgICAgICAgICAgY29uc3Qgb3JpZ2luS2V5ID0gY29sdW1uLmtleS5zdWJzdHJpbmcoY29sdW1uLmxhYmVsLmxlbmd0aCkudHJpbSgpO1xuICAgICAgICAgICAgICAgIGlmICghaGFzQ29sdW1uQ29sb3JGb3JtYXR0ZXJzICYmIGhhc0Jhc2ljQ29sb3JGb3JtYXR0ZXJzKSB7XG4gICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvciA9XG4gICAgICAgICAgICAgICAgICAgICAgICBiYXNpY0NvbG9yRm9ybWF0dGVyc1tyb3cuaW5kZXhdW29yaWdpbktleV0/LmJhY2tncm91bmRDb2xvcjtcbiAgICAgICAgICAgICAgICAgICAgYXJyb3cgPVxuICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uLmxhYmVsID09PSBjb21wYXJpc29uTGFiZWxzWzBdXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBiYXNpY0NvbG9yRm9ybWF0dGVyc1tyb3cuaW5kZXhdW29yaWdpbktleV0/Lm1haW5BcnJvd1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogJyc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChoYXNDb2x1bW5Db2xvckZvcm1hdHRlcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uQ29sb3JGb3JtYXR0ZXJzXG4gICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKGZvcm1hdHRlciA9PiBmb3JtYXR0ZXIuY29sdW1uID09PSBjb2x1bW4ua2V5KVxuICAgICAgICAgICAgICAgICAgICAgICAgLmZvckVhY2goZm9ybWF0dGVyID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZvcm1hdHRlclJlc3VsdCA9IHZhbHVlIHx8IHZhbHVlID09PSAwXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBmb3JtYXR0ZXIuZ2V0Q29sb3JGcm9tVmFsdWUodmFsdWUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmb3JtYXR0ZXJSZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3IgPSBmb3JtYXR0ZXJSZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoYmFzaWNDb2xvckNvbHVtbkZvcm1hdHRlcnMgJiZcbiAgICAgICAgICAgICAgICAgICAgYmFzaWNDb2xvckNvbHVtbkZvcm1hdHRlcnM/Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yID1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJhc2ljQ29sb3JDb2x1bW5Gb3JtYXR0ZXJzW3Jvdy5pbmRleF1bY29sdW1uLmtleV1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/LmJhY2tncm91bmRDb2xvciB8fCBiYWNrZ3JvdW5kQ29sb3I7XG4gICAgICAgICAgICAgICAgICAgIGFycm93ID1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbi5sYWJlbCA9PT0gY29tcGFyaXNvbkxhYmVsc1swXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gYmFzaWNDb2xvckNvbHVtbkZvcm1hdHRlcnNbcm93LmluZGV4XVtjb2x1bW4ua2V5XT8ubWFpbkFycm93XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAnJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgU3R5bGVkQ2VsbCA9IHN0eWxlZC50ZCBgXG4gICAgICAgICAgICB0ZXh0LWFsaWduOiAke3NoYXJlZFN0eWxlLnRleHRBbGlnbn07XG4gICAgICAgICAgICB3aGl0ZS1zcGFjZTogJHt2YWx1ZSBpbnN0YW5jZW9mIERhdGUgPyAnbm93cmFwJyA6IHVuZGVmaW5lZH07XG4gICAgICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gICAgICAgICAgICBiYWNrZ3JvdW5kOiAke2JhY2tncm91bmRDb2xvciB8fCB1bmRlZmluZWR9O1xuICAgICAgICAgIGA7XG4gICAgICAgICAgICAgICAgY29uc3QgY2VsbEJhclN0eWxlcyA9IGNzcyBgXG4gICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICAgICAgICBoZWlnaHQ6IDEwMCU7XG4gICAgICAgICAgICBkaXNwbGF5OiBibG9jaztcbiAgICAgICAgICAgIHRvcDogMDtcbiAgICAgICAgICAgICR7dmFsdWVSYW5nZSAmJlxuICAgICAgICAgICAgICAgICAgICBgXG4gICAgICAgICAgICAgICAgd2lkdGg6ICR7YCR7Y2VsbFdpZHRoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlUmFuZ2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGlnblBvc2l0aXZlTmVnYXRpdmUsXG4gICAgICAgICAgICAgICAgICAgIH0pfSVgfTtcbiAgICAgICAgICAgICAgICBsZWZ0OiAke2Ake2NlbGxPZmZzZXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVSYW5nZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsaWduUG9zaXRpdmVOZWdhdGl2ZSxcbiAgICAgICAgICAgICAgICAgICAgfSl9JWB9O1xuICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICR7Y2VsbEJhY2tncm91bmQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3JQb3NpdGl2ZU5lZ2F0aXZlLFxuICAgICAgICAgICAgICAgICAgICB9KX07XG4gICAgICAgICAgICAgIGB9XG4gICAgICAgICAgYDtcbiAgICAgICAgICAgICAgICBsZXQgYXJyb3dTdHlsZXMgPSBjc3MgYFxuICAgICAgICAgICAgY29sb3I6ICR7YmFzaWNDb2xvckZvcm1hdHRlcnMgJiZcbiAgICAgICAgICAgICAgICAgICAgYmFzaWNDb2xvckZvcm1hdHRlcnNbcm93LmluZGV4XVtvcmlnaW5LZXldPy5hcnJvd0NvbG9yID09PVxuICAgICAgICAgICAgICAgICAgICAgICAgQ29sb3JTY2hlbWVFbnVtLkdyZWVuXG4gICAgICAgICAgICAgICAgICAgID8gdGhlbWUuY29sb3JzLnN1Y2Nlc3MuYmFzZVxuICAgICAgICAgICAgICAgICAgICA6IHRoZW1lLmNvbG9ycy5lcnJvci5iYXNlfTtcbiAgICAgICAgICAgIG1hcmdpbi1yaWdodDogJHt0aGVtZS5ncmlkVW5pdH1weDtcbiAgICAgICAgICBgO1xuICAgICAgICAgICAgICAgIGlmIChiYXNpY0NvbG9yQ29sdW1uRm9ybWF0dGVycyAmJlxuICAgICAgICAgICAgICAgICAgICBiYXNpY0NvbG9yQ29sdW1uRm9ybWF0dGVycz8ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBhcnJvd1N0eWxlcyA9IGNzcyBgXG4gICAgICAgICAgICAgIGNvbG9yOiAke2Jhc2ljQ29sb3JDb2x1bW5Gb3JtYXR0ZXJzW3Jvdy5pbmRleF1bY29sdW1uLmtleV1cbiAgICAgICAgICAgICAgICAgICAgICAgID8uYXJyb3dDb2xvciA9PT0gQ29sb3JTY2hlbWVFbnVtLkdyZWVuXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHRoZW1lLmNvbG9ycy5zdWNjZXNzLmJhc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIDogdGhlbWUuY29sb3JzLmVycm9yLmJhc2V9O1xuICAgICAgICAgICAgICBtYXJnaW4tcmlnaHQ6ICR7dGhlbWUuZ3JpZFVuaXR9cHg7XG4gICAgICAgICAgICBgO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCBjZWxsUHJvcHMgPSB7XG4gICAgICAgICAgICAgICAgICAgICdhcmlhLWxhYmVsbGVkYnknOiBgaGVhZGVyLSR7Y29sdW1uLmtleX1gLFxuICAgICAgICAgICAgICAgICAgICByb2xlOiAnY2VsbCcsXG4gICAgICAgICAgICAgICAgICAgIC8vIHNob3cgcmF3IG51bWJlciBpbiB0aXRsZSBpbiBjYXNlIG9mIG51bWVyaWMgdmFsdWVzXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInID8gU3RyaW5nKHZhbHVlKSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgb25DbGljazogZW1pdENyb3NzRmlsdGVycyAmJiAhdmFsdWVSYW5nZSAmJiAhaXNNZXRyaWNcbiAgICAgICAgICAgICAgICAgICAgICAgID8gKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFsbG93IHNlbGVjdGluZyB0ZXh0IGluIGEgY2VsbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZ2V0U2VsZWN0ZWRUZXh0KCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9nZ2xlRmlsdGVyKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICBvbkNvbnRleHRNZW51OiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhhbmRsZUNvbnRleHRNZW51KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlQ29udGV4dE1lbnUocm93Lm9yaWdpbmFsLCB7IGtleSwgdmFsdWUsIGlzTWV0cmljIH0sIGUubmF0aXZlRXZlbnQuY2xpZW50WCwgZS5uYXRpdmVFdmVudC5jbGllbnRZKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9PSBudWxsID8gJ2R0LWlzLW51bGwnIDogJycsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0FjdGl2ZUZpbHRlclZhbHVlKGtleSwgdmFsdWUpID8gJyBkdC1pcy1hY3RpdmUtZmlsdGVyJyA6ICcnLFxuICAgICAgICAgICAgICAgICAgICBdLmpvaW4oJyAnKSxcbiAgICAgICAgICAgICAgICAgICAgdGFiSW5kZXg6IDAsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBpZiAoaHRtbCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHJ1bmNhdGVMb25nQ2VsbHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC9uby1kYW5nZXJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoPFN0eWxlZENlbGwgey4uLmNlbGxQcm9wc30+XG4gICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImR0LXRydW5jYXRlLWNlbGxcIiBzdHlsZT17Y29sdW1uV2lkdGggPyB7IHdpZHRoOiBjb2x1bW5XaWR0aCB9IDogdW5kZWZpbmVkfSBkYW5nZXJvdXNseVNldElubmVySFRNTD17aHRtbH0vPlxuICAgICAgICAgICAgICAgIDwvU3R5bGVkQ2VsbD4pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC9uby1kYW5nZXJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDxTdHlsZWRDZWxsIHsuLi5jZWxsUHJvcHN9IGRhbmdlcm91c2x5U2V0SW5uZXJIVE1MPXtodG1sfS8+O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBJZiBjZWxsUHJvcHMgcmVuZGVycyB0ZXh0Q29udGVudCBhbHJlYWR5LCB0aGVuIHdlIGRvbid0IGhhdmUgdG9cbiAgICAgICAgICAgICAgICAvLyByZW5kZXIgYENlbGxgLiBUaGlzIHNhdmVzIHNvbWUgdGltZSBmb3IgbGFyZ2UgdGFibGVzLlxuICAgICAgICAgICAgICAgIHJldHVybiAoPFN0eWxlZENlbGwgey4uLmNlbGxQcm9wc30+XG4gICAgICAgICAgICAgIHt2YWx1ZVJhbmdlICYmICg8ZGl2IFxuICAgICAgICAgICAgICAgICAgICAvKiBUaGUgZm9sbG93aW5nIGNsYXNzZXMgYXJlIGFkZGVkIHRvIHN1cHBvcnQgY3VzdG9tIENTUyBzdHlsaW5nICovXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17Y3goJ2NlbGwtYmFyJywgaXNOdW1iZXIodmFsdWUpICYmIHZhbHVlIDwgMCA/ICduZWdhdGl2ZScgOiAncG9zaXRpdmUnKX0gY3NzPXtjZWxsQmFyU3R5bGVzfSByb2xlPVwicHJlc2VudGF0aW9uXCIvPil9XG4gICAgICAgICAgICAgIHt0cnVuY2F0ZUxvbmdDZWxscyA/ICg8ZGl2IGNsYXNzTmFtZT1cImR0LXRydW5jYXRlLWNlbGxcIiBzdHlsZT17Y29sdW1uV2lkdGggPyB7IHdpZHRoOiBjb2x1bW5XaWR0aCB9IDogdW5kZWZpbmVkfT5cbiAgICAgICAgICAgICAgICAgIHthcnJvdyAmJiA8c3BhbiBjc3M9e2Fycm93U3R5bGVzfT57YXJyb3d9PC9zcGFuPn1cbiAgICAgICAgICAgICAgICAgIHt0ZXh0fVxuICAgICAgICAgICAgICAgIDwvZGl2PikgOiAoPD5cbiAgICAgICAgICAgICAgICAgIHthcnJvdyAmJiA8c3BhbiBjc3M9e2Fycm93U3R5bGVzfT57YXJyb3d9PC9zcGFuPn1cbiAgICAgICAgICAgICAgICAgIHt0ZXh0fVxuICAgICAgICAgICAgICAgIDwvPil9XG4gICAgICAgICAgICA8L1N0eWxlZENlbGw+KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBIZWFkZXI6ICh7IGNvbHVtbjogY29sLCBvbkNsaWNrLCBzdHlsZSwgb25EcmFnU3RhcnQsIG9uRHJvcCB9KSA9PiAoPHRoIGlkPXtgaGVhZGVyLSR7Y29sdW1uLmtleX1gfSB0aXRsZT17dCgnU2hpZnQgKyBDbGljayB0byBzb3J0IGJ5IG11bHRpcGxlIGNvbHVtbnMnKX0gY2xhc3NOYW1lPXtbY2xhc3NOYW1lLCBjb2wuaXNTb3J0ZWQgPyAnaXMtc29ydGVkJyA6ICcnXS5qb2luKCcgJyl9IHN0eWxlPXt7XG4gICAgICAgICAgICAgICAgICAgIC4uLnNoYXJlZFN0eWxlLFxuICAgICAgICAgICAgICAgICAgICAuLi5zdHlsZSxcbiAgICAgICAgICAgICAgICB9fSBvbktleURvd249eyhlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHByb2dyYW1hdGljYWxseSBzb3J0IGNvbHVtbiBvbiBrZXlwcmVzc1xuICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LnZhbHVlcyhBQ1RJT05fS0VZUykuaW5jbHVkZXMoZS5rZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2wudG9nZ2xlU29ydEJ5KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9fSByb2xlPVwiY29sdW1uaGVhZGVyIGJ1dHRvblwiIG9uQ2xpY2s9e29uQ2xpY2t9IGRhdGEtY29sdW1uLW5hbWU9e2NvbC5pZH0gey4uLihhbGxvd1JlYXJyYW5nZUNvbHVtbnMgJiYge1xuICAgICAgICAgICAgICAgIGRyYWdnYWJsZTogJ3RydWUnLFxuICAgICAgICAgICAgICAgIG9uRHJhZ1N0YXJ0LFxuICAgICAgICAgICAgICAgIG9uRHJhZ092ZXI6IGUgPT4gZS5wcmV2ZW50RGVmYXVsdCgpLFxuICAgICAgICAgICAgICAgIG9uRHJhZ0VudGVyOiBlID0+IGUucHJldmVudERlZmF1bHQoKSxcbiAgICAgICAgICAgICAgICBvbkRyb3AsXG4gICAgICAgICAgICB9KX0gdGFiSW5kZXg9ezB9PlxuICAgICAgICAgICAgey8qIGNhbid0IHVzZSBgY29sdW1uV2lkdGggJiZgIGJlY2F1c2UgaXQgbWF5IGFsc28gYmUgemVybyAqL31cbiAgICAgICAgICAgIHtjb25maWcuY29sdW1uV2lkdGggPyAoXG4gICAgICAgICAgICAgICAgLy8gY29sdW1uIHdpZHRoIGhpbnRcbiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogY29sdW1uV2lkdGgsXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDAuMDEsXG4gICAgICAgICAgICAgICAgICAgIH19Lz4pIDogbnVsbH1cbiAgICAgICAgICAgIDxkaXYgZGF0YS1jb2x1bW4tbmFtZT17Y29sLmlkfSBjc3M9e3tcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogJ2lubGluZS1mbGV4JyxcbiAgICAgICAgICAgICAgICAgICAgYWxpZ25JdGVtczogJ2ZsZXgtZW5kJyxcbiAgICAgICAgICAgICAgICB9fT5cbiAgICAgICAgICAgICAgPHNwYW4gZGF0YS1jb2x1bW4tbmFtZT17Y29sLmlkfT57bGFiZWx9PC9zcGFuPlxuICAgICAgICAgICAgICA8U29ydEljb24gY29sdW1uPXtjb2x9Lz5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvdGg+KSxcbiAgICAgICAgICAgIEZvb3RlcjogdG90YWxzID8gKGkgPT09IDAgPyAoPHRoPlxuICAgICAgICAgICAgICA8ZGl2IGNzcz17Y3NzIGBcbiAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICAgICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyO1xuICAgICAgICAgICAgICAgICAgJiBzdmcge1xuICAgICAgICAgICAgICAgICAgICBtYXJnaW4tbGVmdDogJHt0aGVtZS5ncmlkVW5pdH1weDtcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6ICR7dGhlbWUuY29sb3JzLmdyYXlzY2FsZS5kYXJrMX0gIWltcG9ydGFudDtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBgfT5cbiAgICAgICAgICAgICAgICB7dCgnU3VtbWFyeScpfVxuICAgICAgICAgICAgICAgIDxUb29sdGlwIG92ZXJsYXk9e3QoJ1Nob3cgdG90YWwgYWdncmVnYXRpb25zIG9mIHNlbGVjdGVkIG1ldHJpY3MuIE5vdGUgdGhhdCByb3cgbGltaXQgZG9lcyBub3QgYXBwbHkgdG8gdGhlIHJlc3VsdC4nKX0+XG4gICAgICAgICAgICAgICAgICA8SW5mb0NpcmNsZU91dGxpbmVkIC8+XG4gICAgICAgICAgICAgICAgPC9Ub29sdGlwPlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvdGg+KSA6ICg8dGQgc3R5bGU9e3NoYXJlZFN0eWxlfT5cbiAgICAgICAgICAgICAgPHN0cm9uZz57Zm9ybWF0Q29sdW1uVmFsdWUoY29sdW1uLCB0b3RhbHNba2V5XSlbMV19PC9zdHJvbmc+XG4gICAgICAgICAgICA8L3RkPikpIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgc29ydERlc2NGaXJzdDogc29ydERlc2MsXG4gICAgICAgICAgICBzb3J0VHlwZTogZ2V0U29ydFR5cGVCeURhdGFUeXBlKGRhdGFUeXBlKSxcbiAgICAgICAgfTtcbiAgICB9LCBbXG4gICAgICAgIGRlZmF1bHRBbGlnblBOLFxuICAgICAgICBkZWZhdWx0Q29sb3JQTixcbiAgICAgICAgZW1pdENyb3NzRmlsdGVycyxcbiAgICAgICAgZ2V0VmFsdWVSYW5nZSxcbiAgICAgICAgaXNBY3RpdmVGaWx0ZXJWYWx1ZSxcbiAgICAgICAgaXNSYXdSZWNvcmRzLFxuICAgICAgICBzaG93Q2VsbEJhcnMsXG4gICAgICAgIHNvcnREZXNjLFxuICAgICAgICB0b2dnbGVGaWx0ZXIsXG4gICAgICAgIHRvdGFscyxcbiAgICAgICAgY29sdW1uQ29sb3JGb3JtYXR0ZXJzLFxuICAgICAgICBjb2x1bW5PcmRlclRvZ2dsZSxcbiAgICBdKTtcbiAgICBjb25zdCBjb2x1bW5zID0gdXNlTWVtbygoKSA9PiBmaWx0ZXJlZENvbHVtbnNNZXRhLm1hcChnZXRDb2x1bW5Db25maWdzKSwgW2ZpbHRlcmVkQ29sdW1uc01ldGEsIGdldENvbHVtbkNvbmZpZ3NdKTtcbiAgICBjb25zdCBoYW5kbGVTZXJ2ZXJQYWdpbmF0aW9uQ2hhbmdlID0gdXNlQ2FsbGJhY2soKHBhZ2VOdW1iZXIsIHBhZ2VTaXplKSA9PiB7XG4gICAgICAgIHVwZGF0ZUV4dGVybmFsRm9ybURhdGEoc2V0RGF0YU1hc2ssIHBhZ2VOdW1iZXIsIHBhZ2VTaXplKTtcbiAgICB9LCBbc2V0RGF0YU1hc2tdKTtcbiAgICBjb25zdCBoYW5kbGVTaXplQ2hhbmdlID0gdXNlQ2FsbGJhY2soKHsgd2lkdGgsIGhlaWdodCB9KSA9PiB7XG4gICAgICAgIHNldFRhYmxlU2l6ZSh7IHdpZHRoLCBoZWlnaHQgfSk7XG4gICAgfSwgW10pO1xuICAgIHVzZUxheW91dEVmZmVjdCgoKSA9PiB7XG4gICAgICAgIC8vIEFmdGVyIGluaXRpYWwgbG9hZCB0aGUgdGFibGUgc2hvdWxkIHJlc2l6ZSBvbmx5IHdoZW4gdGhlIG5ldyBzaXplc1xuICAgICAgICAvLyBBcmUgbm90IG9ubHkgc2Nyb2xsYmFyIHVwZGF0ZXMsIG90aGVyd2lzZSwgdGhlIHRhYmxlIHdvdWxkIHR3aWN0aFxuICAgICAgICBjb25zdCBzY3JvbGxCYXJTaXplID0gZ2V0U2Nyb2xsQmFyU2l6ZSgpO1xuICAgICAgICBjb25zdCB7IHdpZHRoOiB0YWJsZVdpZHRoLCBoZWlnaHQ6IHRhYmxlSGVpZ2h0IH0gPSB0YWJsZVNpemU7XG4gICAgICAgIC8vIFRhYmxlIGlzIGluY3JlYXNpbmcgaXRzIG9yaWdpbmFsIHNpemVcbiAgICAgICAgaWYgKHdpZHRoIC0gdGFibGVXaWR0aCA+IHNjcm9sbEJhclNpemUgfHxcbiAgICAgICAgICAgIGhlaWdodCAtIHRhYmxlSGVpZ2h0ID4gc2Nyb2xsQmFyU2l6ZSkge1xuICAgICAgICAgICAgaGFuZGxlU2l6ZUNoYW5nZSh7XG4gICAgICAgICAgICAgICAgd2lkdGg6IHdpZHRoIC0gc2Nyb2xsQmFyU2l6ZSxcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IGhlaWdodCAtIHNjcm9sbEJhclNpemUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0YWJsZVdpZHRoIC0gd2lkdGggPiBzY3JvbGxCYXJTaXplIHx8XG4gICAgICAgICAgICB0YWJsZUhlaWdodCAtIGhlaWdodCA+IHNjcm9sbEJhclNpemUpIHtcbiAgICAgICAgICAgIC8vIFRhYmxlIGlzIGRlY3JlYXNpbmcgaXRzIG9yaWdpbmFsIHNpemVcbiAgICAgICAgICAgIGhhbmRsZVNpemVDaGFuZ2Uoe1xuICAgICAgICAgICAgICAgIHdpZHRoLFxuICAgICAgICAgICAgICAgIGhlaWdodCxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSwgW3dpZHRoLCBoZWlnaHQsIGhhbmRsZVNpemVDaGFuZ2UsIHRhYmxlU2l6ZV0pO1xuICAgIGNvbnN0IHsgd2lkdGg6IHdpZHRoRnJvbVN0YXRlLCBoZWlnaHQ6IGhlaWdodEZyb21TdGF0ZSB9ID0gdGFibGVTaXplO1xuICAgIHJldHVybiAoPFN0eWxlcz5cbiAgICAgIDxEYXRhVGFibGUgY29sdW1ucz17Y29sdW1uc30gZGF0YT17ZGF0YX0gcm93Q291bnQ9e3Jvd0NvdW50fSB0YWJsZUNsYXNzTmFtZT1cInRhYmxlIHRhYmxlLXN0cmlwZWQgdGFibGUtY29uZGVuc2VkXCIgcGFnZVNpemU9e3BhZ2VTaXplfSBzZXJ2ZXJQYWdpbmF0aW9uRGF0YT17c2VydmVyUGFnaW5hdGlvbkRhdGF9IHBhZ2VTaXplT3B0aW9ucz17cGFnZVNpemVPcHRpb25zfSB3aWR0aD17d2lkdGhGcm9tU3RhdGV9IGhlaWdodD17aGVpZ2h0RnJvbVN0YXRlfSBzZXJ2ZXJQYWdpbmF0aW9uPXtzZXJ2ZXJQYWdpbmF0aW9ufSBvblNlcnZlclBhZ2luYXRpb25DaGFuZ2U9e2hhbmRsZVNlcnZlclBhZ2luYXRpb25DaGFuZ2V9IG9uQ29sdW1uT3JkZXJDaGFuZ2U9eygpID0+IHNldENvbHVtbk9yZGVyVG9nZ2xlKCFjb2x1bW5PcmRlclRvZ2dsZSl9IFxuICAgIC8vIDkgcGFnZSBpdGVtcyBpbiA+IDM0MHB4IHdvcmtzIHdlbGwgZXZlbiBmb3IgMTAwKyBwYWdlc1xuICAgIG1heFBhZ2VJdGVtQ291bnQ9e3dpZHRoID4gMzQwID8gOSA6IDd9IG5vUmVzdWx0cz17Z2V0Tm9SZXN1bHRzTWVzc2FnZX0gc2VhcmNoSW5wdXQ9e2luY2x1ZGVTZWFyY2ggJiYgU2VhcmNoSW5wdXR9IHNlbGVjdFBhZ2VTaXplPXtwYWdlU2l6ZSAhPT0gbnVsbCAmJiBTZWxlY3RQYWdlU2l6ZX0gXG4gICAgLy8gbm90IGluIHVzZSBpbiBTdXBlcnNldCwgYnV0IG5lZWRlZCBmb3IgdW5pdCB0ZXN0c1xuICAgIHN0aWNreT17c3RpY2t5fSByZW5kZXJHcm91cGluZ0hlYWRlcnM9eyFpc0VtcHR5KGdyb3VwSGVhZGVyQ29sdW1ucykgPyByZW5kZXJHcm91cGluZ0hlYWRlcnMgOiB1bmRlZmluZWR9IHJlbmRlclRpbWVDb21wYXJpc29uRHJvcGRvd249e2lzVXNpbmdUaW1lQ29tcGFyaXNvbiA/IHJlbmRlclRpbWVDb21wYXJpc29uRHJvcGRvd24gOiB1bmRlZmluZWR9Lz5cbiAgICA8L1N0eWxlcz4pO1xufVxuIl19 */\", toString: _EMOTION_STRINGIFIED_CSS_ERROR__ };\nexport default function TableChart(props) {\n  const { timeGrain, height, width, data, totals, isRawRecords, rowCount = 0, columns: columnsMeta, alignPositiveNegative: defaultAlignPN = false, colorPositiveNegative: defaultColorPN = false, includeSearch = false, pageSize = 0, serverPagination = false, serverPaginationData, setDataMask, showCellBars = true, sortDesc = false, filters, sticky = true, // whether to use sticky header\n    columnColorFormatters, allowRearrangeColumns = false, allowRenderHtml = true, onContextMenu, emitCrossFilters, isUsingTimeComparison, basicColorFormatters, basicColorColumnFormatters } = props;\n  const comparisonColumns = [\n  { key: 'all', label: t('Display all') },\n  { key: '#', label: '#' },\n  { key: '△', label: '△' },\n  { key: '%', label: '%' }];\n\n  const timestampFormatter = useCallback((value) => getTimeFormatterForGranularity(timeGrain)(value), [timeGrain]);\n  const [tableSize, setTableSize] = useState({\n    width: 0,\n    height: 0\n  });\n  // keep track of whether column order changed, so that column widths can too\n  const [columnOrderToggle, setColumnOrderToggle] = useState(false);\n  const [showComparisonDropdown, setShowComparisonDropdown] = useState(false);\n  const [selectedComparisonColumns, setSelectedComparisonColumns] = useState([\n  comparisonColumns[0].key]\n  );\n  const [hideComparisonKeys, setHideComparisonKeys] = useState([]);\n  const theme = useTheme();\n  // only take relevant page size options\n  const pageSizeOptions = useMemo(() => {\n    const getServerPagination = (n) => n <= rowCount;\n    return PAGE_SIZE_OPTIONS.filter(([n]) => serverPagination ? getServerPagination(n) : n <= 2 * data.length);\n  }, [data.length, rowCount, serverPagination]);\n  const getValueRange = useCallback(function getValueRange(key, alignPositiveNegative) {var _data$;\n    if (typeof (data == null ? void 0 : (_data$ = data[0]) == null ? void 0 : _data$[key]) === 'number') {\n      const nums = data.map((row) => row[key]);\n      return alignPositiveNegative ?\n      [0, d3Max(nums.map(Math.abs))] :\n      d3Extent(nums);\n    }\n    return null;\n  }, [data]);\n  const isActiveFilterValue = useCallback(function isActiveFilterValue(key, val) {var _filters$key;\n    return !!filters && ((_filters$key = filters[key]) == null ? void 0 : _filters$key.includes(val));\n  }, [filters]);\n  const getCrossFilterDataMask = (key, value) => {\n    let updatedFilters = { ...(filters || {}) };\n    if (filters && isActiveFilterValue(key, value)) {\n      updatedFilters = {};\n    } else\n    {\n      updatedFilters = {\n        [key]: [value]\n      };\n    }\n    if (Array.isArray(updatedFilters[key]) &&\n    updatedFilters[key].length === 0) {\n      delete updatedFilters[key];\n    }\n    const groupBy = Object.keys(updatedFilters);\n    const groupByValues = Object.values(updatedFilters);\n    const labelElements = [];\n    groupBy.forEach((col) => {var _updatedFilters;\n      const isTimestamp = col === DTTM_ALIAS;\n      const filterValues = ensureIsArray((_updatedFilters = updatedFilters) == null ? void 0 : _updatedFilters[col]);\n      if (filterValues.length) {\n        const valueLabels = filterValues.map((value) => isTimestamp ? timestampFormatter(value) : value);\n        labelElements.push(`${valueLabels.join(', ')}`);\n      }\n    });\n    return {\n      dataMask: {\n        extraFormData: {\n          filters: groupBy.length === 0 ?\n          [] :\n          groupBy.map((col) => {var _updatedFilters2;\n            const val = ensureIsArray((_updatedFilters2 = updatedFilters) == null ? void 0 : _updatedFilters2[col]);\n            if (!val.length)\n            return {\n              col,\n              op: 'IS NULL'\n            };\n            return {\n              col,\n              op: 'IN',\n              val: val.map((el) => el instanceof Date ? el.getTime() : el),\n              grain: col === DTTM_ALIAS ? timeGrain : undefined\n            };\n          })\n        },\n        filterState: {\n          label: labelElements.join(', '),\n          value: groupByValues.length ? groupByValues : null,\n          filters: updatedFilters && Object.keys(updatedFilters).length ?\n          updatedFilters :\n          null\n        }\n      },\n      isCurrentValueSelected: isActiveFilterValue(key, value)\n    };\n  };\n  const toggleFilter = useCallback(function toggleFilter(key, val) {\n    if (!emitCrossFilters) {\n      return;\n    }\n    setDataMask(getCrossFilterDataMask(key, val).dataMask);\n  }, [emitCrossFilters, getCrossFilterDataMask, setDataMask]);\n  const getSharedStyle = (column) => {\n    const { isNumeric, config = {} } = column;\n    const textAlign = config.horizontalAlign || (\n    isNumeric && !isUsingTimeComparison ? 'right' : 'left');\n    return {\n      textAlign\n    };\n  };\n  const comparisonLabels = [t('Main'), '#', '△', '%'];\n  const filteredColumnsMeta = useMemo(() => {\n    if (!isUsingTimeComparison) {\n      return columnsMeta;\n    }\n    const allColumns = comparisonColumns[0].key;\n    const main = comparisonLabels[0];\n    const showAllColumns = selectedComparisonColumns.includes(allColumns);\n    return columnsMeta.filter(({ label, key }) => {\n      // Extract the key portion after the space, assuming the format is always \"label key\"\n      const keyPortion = key.substring(label.length);\n      const isKeyHidded = hideComparisonKeys.includes(keyPortion);\n      const isLableMain = label === main;\n      return isLableMain ||\n      !isKeyHidded && (\n      !comparisonLabels.includes(label) ||\n      showAllColumns ||\n      selectedComparisonColumns.includes(label));\n    });\n  }, [\n  columnsMeta,\n  comparisonColumns,\n  comparisonLabels,\n  isUsingTimeComparison,\n  hideComparisonKeys,\n  selectedComparisonColumns]\n  );\n  const handleContextMenu = onContextMenu && !isRawRecords ?\n  (value, cellPoint, clientX, clientY) => {\n    const drillToDetailFilters = [];\n    filteredColumnsMeta.forEach((col) => {\n      if (!col.isMetric) {\n        const dataRecordValue = value[col.key];\n        drillToDetailFilters.push({\n          col: col.key,\n          op: '==',\n          val: dataRecordValue,\n          formattedVal: formatColumnValue(col, dataRecordValue)[1]\n        });\n      }\n    });\n    onContextMenu(clientX, clientY, {\n      drillToDetail: drillToDetailFilters,\n      crossFilter: cellPoint.isMetric ?\n      undefined :\n      getCrossFilterDataMask(cellPoint.key, cellPoint.value),\n      drillBy: cellPoint.isMetric ?\n      undefined :\n      {\n        filters: [\n        {\n          col: cellPoint.key,\n          op: '==',\n          val: cellPoint.value\n        }],\n\n        groupbyFieldName: 'groupby'\n      }\n    });\n  } :\n  undefined;\n  const getHeaderColumns = (columnsMeta, enableTimeComparison) => {\n    const resultMap = {};\n    if (!enableTimeComparison) {\n      return resultMap;\n    }\n    columnsMeta.forEach((element, index) => {\n      // Check if element's label is one of the comparison labels\n      if (comparisonLabels.includes(element.label)) {\n        // Extract the key portion after the space, assuming the format is always \"label key\"\n        const keyPortion = element.key.substring(element.label.length);\n        // If the key portion is not in the map, initialize it with the current index\n        if (!resultMap[keyPortion]) {\n          resultMap[keyPortion] = [index];\n        } else\n        {\n          // Add the index to the existing array\n          resultMap[keyPortion].push(index);\n        }\n      }\n    });\n    return resultMap;\n  };\n  const renderTimeComparisonDropdown = () => {\n    const allKey = comparisonColumns[0].key;\n    const handleOnClick = (data) => {\n      const { key } = data;\n      // Toggle 'All' key selection\n      if (key === allKey) {\n        setSelectedComparisonColumns([allKey]);\n      } else\n      if (selectedComparisonColumns.includes(allKey)) {\n        setSelectedComparisonColumns([key]);\n      } else\n      {\n        // Toggle selection for other keys\n        setSelectedComparisonColumns(selectedComparisonColumns.includes(key) ?\n        selectedComparisonColumns.filter((k) => k !== key) // Deselect if already selected\n        : [...selectedComparisonColumns, key]); // Select if not already selected\n      }\n    };\n    const handleOnBlur = () => {\n      if (selectedComparisonColumns.length === 3) {\n        setSelectedComparisonColumns([comparisonColumns[0].key]);\n      }\n    };\n    return _jsx(Dropdown, { placement: \"bottomRight\", visible: showComparisonDropdown, onVisibleChange: (flag) => {\n        setShowComparisonDropdown(flag);\n      }, overlay: _jsxs(Menu, { multiple: true, onClick: handleOnClick, onBlur: handleOnBlur, selectedKeys: selectedComparisonColumns, children: [\n        _jsx(\"div\", { css: css`\n                max-width: 242px;\n                padding: 0 ${theme.gridUnit * 2}px;\n                color: ${theme.colors.grayscale.base};\n                font-size: ${theme.typography.sizes.s}px;\n              `, children:\n          t('Select columns that will be displayed in the table. You can multiselect columns.') }\n        ),\n        comparisonColumns.map((column) => _jsxs(Menu.Item, { children: [\n          _jsx(\"span\", { css: css`\n                    color: ${theme.colors.grayscale.dark2};\n                  `, children:\n            column.label }\n          ),\n          _jsx(\"span\", { css: css`\n                    float: right;\n                    font-size: ${theme.typography.sizes.s}px;\n                  `, children:\n            selectedComparisonColumns.includes(column.key) && _jsx(CheckOutlined, {}) }\n          )] }, column.key\n        ))] }\n      ), trigger: ['click'], children:\n      _jsxs(\"span\", { children: [\n        _jsx(TableOutlined, {}), \" \", _jsx(DownOutlined, {})] }\n      ) }\n    );\n  };\n  const renderGroupingHeaders = () => {\n    // TODO: Make use of ColumnGroup to render the aditional headers\n    const headers = [];\n    let currentColumnIndex = 0;\n    Object.entries(groupHeaderColumns || {}).forEach(([key, value]) => {\n      // Calculate the number of placeholder columns needed before the current header\n      const startPosition = value[0];\n      const colSpan = value.length;\n      // Add placeholder <th> for columns before this header\n      for (let i = currentColumnIndex; i < startPosition; i += 1) {\n        headers.push(_jsx(\"th\", { style: { borderBottom: 0 }, \"aria-label\": `Header-${i}` }, `placeholder-${i}`));\n      }\n      // Add the current header <th>\n      headers.push(_jsxs(\"th\", { colSpan: colSpan, style: { borderBottom: 0 }, children: [\n        key,\n        _jsx(\"span\", { css: css`\n              float: right;\n              & svg {\n                color: ${theme.colors.grayscale.base} !important;\n              }\n            `, children:\n          hideComparisonKeys.includes(key) ? _jsx(PlusCircleOutlined, { onClick: () => setHideComparisonKeys(hideComparisonKeys.filter((k) => k !== key)) }) : _jsx(MinusCircleOutlined, { onClick: () => setHideComparisonKeys([...hideComparisonKeys, key]) }) }\n        )] }, `header-${key}`\n      ));\n      // Update the current column index\n      currentColumnIndex = startPosition + colSpan;\n    });\n    return _jsx(\"tr\", { css: css`\n          th {\n            border-right: 2px solid ${theme.colors.grayscale.light2};\n          }\n          th:first-child {\n            border-left: none;\n          }\n          th:last-child {\n            border-right: none;\n          }\n        `, children:\n      headers }\n    );\n  };\n  const groupHeaderColumns = useMemo(() => getHeaderColumns(filteredColumnsMeta, isUsingTimeComparison), [filteredColumnsMeta, isUsingTimeComparison]);\n  const getColumnConfigs = useCallback((column, i) => {\n    const { key, label, isNumeric, dataType, isMetric, isPercentMetric, config = {} } = column;\n    const columnWidth = Number.isNaN(Number(config.columnWidth)) ?\n    config.columnWidth :\n    Number(config.columnWidth);\n    // inline style for both th and td cell\n    const sharedStyle = getSharedStyle(column);\n    const alignPositiveNegative = config.alignPositiveNegative === undefined ?\n    defaultAlignPN :\n    config.alignPositiveNegative;\n    const colorPositiveNegative = config.colorPositiveNegative === undefined ?\n    defaultColorPN :\n    config.colorPositiveNegative;\n    const { truncateLongCells } = config;\n    const hasColumnColorFormatters = isNumeric &&\n    Array.isArray(columnColorFormatters) &&\n    columnColorFormatters.length > 0;\n    const hasBasicColorFormatters = isUsingTimeComparison &&\n    Array.isArray(basicColorFormatters) &&\n    basicColorFormatters.length > 0;\n    const valueRange = !hasBasicColorFormatters &&\n    !hasColumnColorFormatters && (\n    config.showCellBars === undefined ?\n    showCellBars :\n    config.showCellBars) && (\n    isMetric || isRawRecords || isPercentMetric) &&\n    getValueRange(key, alignPositiveNegative);\n    let className = '';\n    if (emitCrossFilters && !isMetric) {\n      className += ' dt-is-filter';\n    }\n    if (!isMetric && !isPercentMetric) {\n      className += ' right-border-only';\n    } else\n    if (comparisonLabels.includes(label)) {\n      const groupinHeader = key.substring(label.length);\n      const columnsUnderHeader = groupHeaderColumns[groupinHeader] || [];\n      if (i === columnsUnderHeader[columnsUnderHeader.length - 1]) {\n        className += ' right-border-only';\n      }\n    }\n    return {\n      id: String(i),\n      // must use custom accessor to allow `.` in column names\n      // typing is incorrect in current version of `@types/react-table`\n      // so we ask TS not to check.\n      accessor: (datum) => datum[key],\n      Cell: ({ value, row }) => {var _basicColorFormatters3;\n        const [isHtml, text] = formatColumnValue(column, value);\n        const html = isHtml && allowRenderHtml ? { __html: text } : undefined;\n        let backgroundColor;\n        let arrow = '';\n        const originKey = column.key.substring(column.label.length).trim();\n        if (!hasColumnColorFormatters && hasBasicColorFormatters) {var _basicColorFormatters, _basicColorFormatters2;\n          backgroundColor = (_basicColorFormatters =\n          basicColorFormatters[row.index][originKey]) == null ? void 0 : _basicColorFormatters.backgroundColor;\n          arrow =\n          column.label === comparisonLabels[0] ? (_basicColorFormatters2 =\n          basicColorFormatters[row.index][originKey]) == null ? void 0 : _basicColorFormatters2.mainArrow :\n          '';\n        }\n        if (hasColumnColorFormatters) {\n          columnColorFormatters.\n          filter((formatter) => formatter.column === column.key).\n          forEach((formatter) => {\n            const formatterResult = value || value === 0 ?\n            formatter.getColorFromValue(value) :\n            false;\n            if (formatterResult) {\n              backgroundColor = formatterResult;\n            }\n          });\n        }\n        if (basicColorColumnFormatters &&\n        (basicColorColumnFormatters == null ? void 0 : basicColorColumnFormatters.length) > 0) {var _basicColorColumnForm, _basicColorColumnForm2;\n          backgroundColor =\n          ((_basicColorColumnForm = basicColorColumnFormatters[row.index][column.key]) == null ? void 0 : _basicColorColumnForm.\n          backgroundColor) || backgroundColor;\n          arrow =\n          column.label === comparisonLabels[0] ? (_basicColorColumnForm2 =\n          basicColorColumnFormatters[row.index][column.key]) == null ? void 0 : _basicColorColumnForm2.mainArrow :\n          '';\n        }\n        const StyledCell = styled.td`\n            text-align: ${sharedStyle.textAlign};\n            white-space: ${value instanceof Date ? 'nowrap' : undefined};\n            position: relative;\n            background: ${backgroundColor || undefined};\n          `;\n        const cellBarStyles = css`\n            position: absolute;\n            height: 100%;\n            display: block;\n            top: 0;\n            ${valueRange &&\n        `\n                width: ${`${cellWidth({\n          value: value,\n          valueRange,\n          alignPositiveNegative\n        })}%`};\n                left: ${`${cellOffset({\n          value: value,\n          valueRange,\n          alignPositiveNegative\n        })}%`};\n                background-color: ${cellBackground({\n          value: value,\n          colorPositiveNegative\n        })};\n              `}\n          `;\n        let arrowStyles = css`\n            color: ${basicColorFormatters &&\n        ((_basicColorFormatters3 = basicColorFormatters[row.index][originKey]) == null ? void 0 : _basicColorFormatters3.arrowColor) ===\n        ColorSchemeEnum.Green ?\n        theme.colors.success.base :\n        theme.colors.error.base};\n            margin-right: ${theme.gridUnit}px;\n          `;\n        if (basicColorColumnFormatters &&\n        (basicColorColumnFormatters == null ? void 0 : basicColorColumnFormatters.length) > 0) {var _basicColorColumnForm3;\n          arrowStyles = css`\n              color: ${((_basicColorColumnForm3 = basicColorColumnFormatters[row.index][column.key]) == null ? void 0 : _basicColorColumnForm3.\n          arrowColor) === ColorSchemeEnum.Green ?\n          theme.colors.success.base :\n          theme.colors.error.base};\n              margin-right: ${theme.gridUnit}px;\n            `;\n        }\n        const cellProps = {\n          'aria-labelledby': `header-${column.key}`,\n          role: 'cell',\n          // show raw number in title in case of numeric values\n          title: typeof value === 'number' ? String(value) : undefined,\n          onClick: emitCrossFilters && !valueRange && !isMetric ?\n          () => {\n            // allow selecting text in a cell\n            if (!getSelectedText()) {\n              toggleFilter(key, value);\n            }\n          } :\n          undefined,\n          onContextMenu: (e) => {\n            if (handleContextMenu) {\n              e.preventDefault();\n              e.stopPropagation();\n              handleContextMenu(row.original, { key, value, isMetric }, e.nativeEvent.clientX, e.nativeEvent.clientY);\n            }\n          },\n          className: [\n          className,\n          value == null ? 'dt-is-null' : '',\n          isActiveFilterValue(key, value) ? ' dt-is-active-filter' : ''].\n          join(' '),\n          tabIndex: 0\n        };\n        if (html) {\n          if (truncateLongCells) {\n            // eslint-disable-next-line react/no-danger\n            return _jsx(StyledCell, { ...cellProps, children:\n              _jsx(\"div\", { className: \"dt-truncate-cell\", style: columnWidth ? { width: columnWidth } : undefined, dangerouslySetInnerHTML: html }) }\n            );\n          }\n          // eslint-disable-next-line react/no-danger\n          return _jsx(StyledCell, { ...cellProps, dangerouslySetInnerHTML: html });\n        }\n        // If cellProps renders textContent already, then we don't have to\n        // render `Cell`. This saves some time for large tables.\n        return _jsxs(StyledCell, { ...cellProps, children: [\n          valueRange && _jsx(\"div\", {\n            /* The following classes are added to support custom CSS styling */\n            className: cx('cell-bar', _isNumber(value) && value < 0 ? 'negative' : 'positive'), css: cellBarStyles, role: \"presentation\" }),\n          truncateLongCells ? _jsxs(\"div\", { className: \"dt-truncate-cell\", style: columnWidth ? { width: columnWidth } : undefined, children: [\n            arrow && _jsx(\"span\", { css: arrowStyles, children: arrow }),\n            text] }\n          ) : _jsxs(_Fragment, { children: [\n            arrow && _jsx(\"span\", { css: arrowStyles, children: arrow }),\n            text] }\n          )] }\n        );\n      },\n      Header: ({ column: col, onClick, style, onDragStart, onDrop }) => _jsxs(\"th\", { id: `header-${column.key}`, title: t('Shift + Click to sort by multiple columns'), className: [className, col.isSorted ? 'is-sorted' : ''].join(' '), style: {\n          ...sharedStyle,\n          ...style\n        }, onKeyDown: (e) => {\n          // programatically sort column on keypress\n          if (Object.values(ACTION_KEYS).includes(e.key)) {\n            col.toggleSortBy();\n          }\n        }, role: \"columnheader button\", onClick: onClick, \"data-column-name\": col.id, ...(allowRearrangeColumns && {\n          draggable: 'true',\n          onDragStart,\n          onDragOver: (e) => e.preventDefault(),\n          onDragEnter: (e) => e.preventDefault(),\n          onDrop\n        }), tabIndex: 0, children: [\n\n        config.columnWidth ?\n        // column width hint\n        _jsx(\"div\", { style: {\n            width: columnWidth,\n            height: 0.01\n          } }) : null,\n        _jsxs(\"div\", { \"data-column-name\": col.id, css: _ref, children: [\n\n\n\n          _jsx(\"span\", { \"data-column-name\": col.id, children: label }),\n          _jsx(SortIcon, { column: col })] }\n        )] }\n      ),\n      Footer: totals ? i === 0 ? _jsx(\"th\", { children:\n        _jsxs(\"div\", { css: css`\n                  display: flex;\n                  align-items: center;\n                  & svg {\n                    margin-left: ${theme.gridUnit}px;\n                    color: ${theme.colors.grayscale.dark1} !important;\n                  }\n                `, children: [\n          t('Summary'),\n          _jsx(Tooltip, { overlay: t('Show total aggregations of selected metrics. Note that row limit does not apply to the result.'), children:\n            _jsx(InfoCircleOutlined, {}) }\n          )] }\n        ) }\n      ) : _jsx(\"td\", { style: sharedStyle, children:\n        _jsx(\"strong\", { children: formatColumnValue(column, totals[key])[1] }) }\n      ) : undefined,\n      sortDescFirst: sortDesc,\n      sortType: getSortTypeByDataType(dataType)\n    };\n  }, [\n  defaultAlignPN,\n  defaultColorPN,\n  emitCrossFilters,\n  getValueRange,\n  isActiveFilterValue,\n  isRawRecords,\n  showCellBars,\n  sortDesc,\n  toggleFilter,\n  totals,\n  columnColorFormatters,\n  columnOrderToggle]\n  );\n  const columns = useMemo(() => filteredColumnsMeta.map(getColumnConfigs), [filteredColumnsMeta, getColumnConfigs]);\n  const handleServerPaginationChange = useCallback((pageNumber, pageSize) => {\n    updateExternalFormData(setDataMask, pageNumber, pageSize);\n  }, [setDataMask]);\n  const handleSizeChange = useCallback(({ width, height }) => {\n    setTableSize({ width, height });\n  }, []);\n  useLayoutEffect(() => {\n    // After initial load the table should resize only when the new sizes\n    // Are not only scrollbar updates, otherwise, the table would twicth\n    const scrollBarSize = getScrollBarSize();\n    const { width: tableWidth, height: tableHeight } = tableSize;\n    // Table is increasing its original size\n    if (width - tableWidth > scrollBarSize ||\n    height - tableHeight > scrollBarSize) {\n      handleSizeChange({\n        width: width - scrollBarSize,\n        height: height - scrollBarSize\n      });\n    } else\n    if (tableWidth - width > scrollBarSize ||\n    tableHeight - height > scrollBarSize) {\n      // Table is decreasing its original size\n      handleSizeChange({\n        width,\n        height\n      });\n    }\n  }, [width, height, handleSizeChange, tableSize]);\n  const { width: widthFromState, height: heightFromState } = tableSize;\n  return _jsx(Styles, { children:\n    _jsx(DataTable, { columns: columns, data: data, rowCount: rowCount, tableClassName: \"table table-striped table-condensed\", pageSize: pageSize, serverPaginationData: serverPaginationData, pageSizeOptions: pageSizeOptions, width: widthFromState, height: heightFromState, serverPagination: serverPagination, onServerPaginationChange: handleServerPaginationChange, onColumnOrderChange: () => setColumnOrderToggle(!columnOrderToggle)\n      // 9 page items in > 340px works well even for 100+ pages\n      , maxPageItemCount: width > 340 ? 9 : 7, noResults: getNoResultsMessage, searchInput: includeSearch && SearchInput, selectPageSize: pageSize !== null && SelectPageSize\n      // not in use in Superset, but needed for unit tests\n      , sticky: sticky, renderGroupingHeaders: !_isEmpty(groupHeaderColumns) ? renderGroupingHeaders : undefined, renderTimeComparisonDropdown: isUsingTimeComparison ? renderTimeComparisonDropdown : undefined }) }\n  );\n}__signature__(TableChart, \"useCallback{timestampFormatter}\\nuseState{[tableSize, setTableSize]({\\n        width: 0,\\n        height: 0,\\n    })}\\nuseState{[columnOrderToggle, setColumnOrderToggle](false)}\\nuseState{[showComparisonDropdown, setShowComparisonDropdown](false)}\\nuseState{[selectedComparisonColumns, setSelectedComparisonColumns]([\\n        comparisonColumns[0].key,\\n    ])}\\nuseState{[hideComparisonKeys, setHideComparisonKeys]([])}\\nuseTheme{theme}\\nuseMemo{pageSizeOptions}\\nuseCallback{getValueRange}\\nuseCallback{isActiveFilterValue}\\nuseCallback{toggleFilter}\\nuseMemo{filteredColumnsMeta}\\nuseMemo{groupHeaderColumns}\\nuseCallback{getColumnConfigs}\\nuseMemo{columns}\\nuseCallback{handleServerPaginationChange}\\nuseCallback{handleSizeChange}\\nuseLayoutEffect{}\", () => [useTheme]);;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(ACTION_KEYS, \"ACTION_KEYS\", \"/app/superset-frontend/plugins/plugin-chart-table/src/TableChart.tsx\");reactHotLoader.register(getSortTypeByDataType, \"getSortTypeByDataType\", \"/app/superset-frontend/plugins/plugin-chart-table/src/TableChart.tsx\");reactHotLoader.register(cellWidth, \"cellWidth\", \"/app/superset-frontend/plugins/plugin-chart-table/src/TableChart.tsx\");reactHotLoader.register(cellOffset, \"cellOffset\", \"/app/superset-frontend/plugins/plugin-chart-table/src/TableChart.tsx\");reactHotLoader.register(cellBackground, \"cellBackground\", \"/app/superset-frontend/plugins/plugin-chart-table/src/TableChart.tsx\");reactHotLoader.register(SortIcon, \"SortIcon\", \"/app/superset-frontend/plugins/plugin-chart-table/src/TableChart.tsx\");reactHotLoader.register(SearchInput, \"SearchInput\", \"/app/superset-frontend/plugins/plugin-chart-table/src/TableChart.tsx\");reactHotLoader.register(SelectPageSize, \"SelectPageSize\", \"/app/superset-frontend/plugins/plugin-chart-table/src/TableChart.tsx\");reactHotLoader.register(getNoResultsMessage, \"getNoResultsMessage\", \"/app/superset-frontend/plugins/plugin-chart-table/src/TableChart.tsx\");reactHotLoader.register(TableChart, \"TableChart\", \"/app/superset-frontend/plugins/plugin-chart-table/src/TableChart.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["useCallback","useLayoutEffect","useMemo","useState","extent","d3Extent","max","d3Max","FaSort","FaSortDown","FaSortDesc","FaSortUp","FaSortAsc","cx","DTTM_ALIAS","ensureIsArray","GenericDataType","getSelectedText","getTimeFormatterForGranularity","styled","css","t","tn","useTheme","Dropdown","Menu","Tooltip","CheckOutlined","InfoCircleOutlined","DownOutlined","MinusCircleOutlined","PlusCircleOutlined","TableOutlined","ColorSchemeEnum","DataTable","Styles","formatColumnValue","PAGE_SIZE_OPTIONS","updateExternalFormData","getScrollBarSize","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","ACTION_KEYS","enter","spacebar","space","getSortTypeByDataType","dataType","Temporal","String","cellWidth","value","valueRange","alignPositiveNegative","minValue","maxValue","perc","Math","abs","round","posExtent","negExtent","min","tot","perc2","cellOffset","cellBackground","colorPositiveNegative","r","SortIcon","column","isSorted","isSortedDesc","sortIcon","SearchInput","count","onChange","className","children","placeholder","SelectPageSize","options","current","onBlur","e","Number","target","map","option","size","text","Array","isArray","sizeLabel","getNoResultsMessage","filter","_ref","process","env","NODE_ENV","name","styles","toString","_EMOTION_STRINGIFIED_CSS_ERROR__","TableChart","props","timeGrain","height","width","data","totals","isRawRecords","rowCount","columns","columnsMeta","defaultAlignPN","defaultColorPN","includeSearch","pageSize","serverPagination","serverPaginationData","setDataMask","showCellBars","sortDesc","filters","sticky","columnColorFormatters","allowRearrangeColumns","allowRenderHtml","onContextMenu","emitCrossFilters","isUsingTimeComparison","basicColorFormatters","basicColorColumnFormatters","comparisonColumns","key","label","timestampFormatter","tableSize","setTableSize","columnOrderToggle","setColumnOrderToggle","showComparisonDropdown","setShowComparisonDropdown","selectedComparisonColumns","setSelectedComparisonColumns","hideComparisonKeys","setHideComparisonKeys","theme","pageSizeOptions","getServerPagination","n","length","getValueRange","_data$","nums","row","isActiveFilterValue","val","_filters$key","includes","getCrossFilterDataMask","updatedFilters","groupBy","Object","keys","groupByValues","values","labelElements","forEach","col","_updatedFilters","isTimestamp","filterValues","valueLabels","push","join","dataMask","extraFormData","_updatedFilters2","op","el","Date","getTime","grain","undefined","filterState","isCurrentValueSelected","toggleFilter","getSharedStyle","isNumeric","config","textAlign","horizontalAlign","comparisonLabels","filteredColumnsMeta","allColumns","main","showAllColumns","keyPortion","substring","isKeyHidded","isLableMain","handleContextMenu","cellPoint","clientX","clientY","drillToDetailFilters","isMetric","dataRecordValue","formattedVal","drillToDetail","crossFilter","drillBy","groupbyFieldName","getHeaderColumns","enableTimeComparison","resultMap","element","index","renderTimeComparisonDropdown","allKey","handleOnClick","k","handleOnBlur","placement","visible","onVisibleChange","flag","overlay","multiple","onClick","selectedKeys","gridUnit","colors","grayscale","base","typography","sizes","s","Item","dark2","trigger","renderGroupingHeaders","headers","currentColumnIndex","entries","groupHeaderColumns","startPosition","colSpan","i","style","borderBottom","light2","getColumnConfigs","isPercentMetric","columnWidth","isNaN","sharedStyle","truncateLongCells","hasColumnColorFormatters","hasBasicColorFormatters","groupinHeader","columnsUnderHeader","id","accessor","datum","Cell","_basicColorFormatters3","isHtml","html","__html","backgroundColor","arrow","originKey","trim","_basicColorFormatters","_basicColorFormatters2","mainArrow","formatter","formatterResult","getColorFromValue","_basicColorColumnForm","_basicColorColumnForm2","StyledCell","td","cellBarStyles","arrowStyles","arrowColor","Green","success","error","_basicColorColumnForm3","cellProps","role","title","preventDefault","stopPropagation","original","nativeEvent","tabIndex","dangerouslySetInnerHTML","_isNumber","Header","onDragStart","onDrop","onKeyDown","toggleSortBy","draggable","onDragOver","onDragEnter","Footer","dark1","sortDescFirst","sortType","handleServerPaginationChange","pageNumber","handleSizeChange","scrollBarSize","tableWidth","tableHeight","widthFromState","heightFromState","tableClassName","onServerPaginationChange","onColumnOrderChange","maxPageItemCount","noResults","searchInput","selectPageSize","_isEmpty","__signature__","reactHotLoader","reactHotLoaderGlobal","default","register","leaveModule","module"],"sources":["/app/superset-frontend/plugins/plugin-chart-table/src/TableChart.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  CSSProperties,\n  useCallback,\n  useLayoutEffect,\n  useMemo,\n  useState,\n  MouseEvent,\n  KeyboardEvent as ReactKeyboardEvent,\n} from 'react';\n\nimport {\n  ColumnInstance,\n  ColumnWithLooseAccessor,\n  DefaultSortTypes,\n  Row,\n} from 'react-table';\nimport { extent as d3Extent, max as d3Max } from 'd3-array';\nimport { FaSort } from '@react-icons/all-files/fa/FaSort';\nimport { FaSortDown as FaSortDesc } from '@react-icons/all-files/fa/FaSortDown';\nimport { FaSortUp as FaSortAsc } from '@react-icons/all-files/fa/FaSortUp';\nimport cx from 'classnames';\nimport {\n  DataRecord,\n  DataRecordValue,\n  DTTM_ALIAS,\n  ensureIsArray,\n  GenericDataType,\n  getSelectedText,\n  getTimeFormatterForGranularity,\n  BinaryQueryObjectFilterClause,\n  styled,\n  css,\n  t,\n  tn,\n  useTheme,\n} from '@superset-ui/core';\nimport { Dropdown, Menu, Tooltip } from '@superset-ui/chart-controls';\nimport {\n  CheckOutlined,\n  InfoCircleOutlined,\n  DownOutlined,\n  MinusCircleOutlined,\n  PlusCircleOutlined,\n  TableOutlined,\n} from '@ant-design/icons';\nimport { isEmpty, isNumber } from 'lodash';\nimport {\n  ColorSchemeEnum,\n  DataColumnMeta,\n  TableChartTransformedProps,\n} from './types';\nimport DataTable, {\n  DataTableProps,\n  SearchInputProps,\n  SelectPageSizeRendererProps,\n  SizeOption,\n} from './DataTable';\n\nimport Styles from './Styles';\nimport { formatColumnValue } from './utils/formatValue';\nimport { PAGE_SIZE_OPTIONS } from './consts';\nimport { updateExternalFormData } from './DataTable/utils/externalAPIs';\nimport getScrollBarSize from './DataTable/utils/getScrollBarSize';\n\ntype ValueRange = [number, number];\n\ninterface TableSize {\n  width: number;\n  height: number;\n}\n\nconst ACTION_KEYS = {\n  enter: 'Enter',\n  spacebar: 'Spacebar',\n  space: ' ',\n};\n\n/**\n * Return sortType based on data type\n */\nfunction getSortTypeByDataType(dataType: GenericDataType): DefaultSortTypes {\n  if (dataType === GenericDataType.Temporal) {\n    return 'datetime';\n  }\n  if (dataType === GenericDataType.String) {\n    return 'alphanumeric';\n  }\n  return 'basic';\n}\n\n/**\n * Cell background width calculation for horizontal bar chart\n */\nfunction cellWidth({\n  value,\n  valueRange,\n  alignPositiveNegative,\n}: {\n  value: number;\n  valueRange: ValueRange;\n  alignPositiveNegative: boolean;\n}) {\n  const [minValue, maxValue] = valueRange;\n  if (alignPositiveNegative) {\n    const perc = Math.abs(Math.round((value / maxValue) * 100));\n    return perc;\n  }\n  const posExtent = Math.abs(Math.max(maxValue, 0));\n  const negExtent = Math.abs(Math.min(minValue, 0));\n  const tot = posExtent + negExtent;\n  const perc2 = Math.round((Math.abs(value) / tot) * 100);\n  return perc2;\n}\n\n/**\n * Cell left margin (offset) calculation for horizontal bar chart elements\n * when alignPositiveNegative is not set\n */\nfunction cellOffset({\n  value,\n  valueRange,\n  alignPositiveNegative,\n}: {\n  value: number;\n  valueRange: ValueRange;\n  alignPositiveNegative: boolean;\n}) {\n  if (alignPositiveNegative) {\n    return 0;\n  }\n  const [minValue, maxValue] = valueRange;\n  const posExtent = Math.abs(Math.max(maxValue, 0));\n  const negExtent = Math.abs(Math.min(minValue, 0));\n  const tot = posExtent + negExtent;\n  return Math.round((Math.min(negExtent + value, negExtent) / tot) * 100);\n}\n\n/**\n * Cell background color calculation for horizontal bar chart\n */\nfunction cellBackground({\n  value,\n  colorPositiveNegative = false,\n}: {\n  value: number;\n  colorPositiveNegative: boolean;\n}) {\n  const r = colorPositiveNegative && value < 0 ? 150 : 0;\n  return `rgba(${r},0,0,0.2)`;\n}\n\nfunction SortIcon<D extends object>({ column }: { column: ColumnInstance<D> }) {\n  const { isSorted, isSortedDesc } = column;\n  let sortIcon = <FaSort />;\n  if (isSorted) {\n    sortIcon = isSortedDesc ? <FaSortDesc /> : <FaSortAsc />;\n  }\n  return sortIcon;\n}\n\nfunction SearchInput({ count, value, onChange }: SearchInputProps) {\n  return (\n    <span className=\"dt-global-filter\">\n      {t('Search')}{' '}\n      <input\n        aria-label={t('Search %s records', count)}\n        className=\"form-control input-sm\"\n        placeholder={tn('search.num_records', count)}\n        value={value}\n        onChange={onChange}\n      />\n    </span>\n  );\n}\n\nfunction SelectPageSize({\n  options,\n  current,\n  onChange,\n}: SelectPageSizeRendererProps) {\n  return (\n    <span className=\"dt-select-page-size form-inline\">\n      {t('page_size.show')}{' '}\n      <select\n        className=\"form-control input-sm\"\n        value={current}\n        onBlur={() => {}}\n        onChange={e => {\n          onChange(Number((e.target as HTMLSelectElement).value));\n        }}\n      >\n        {options.map(option => {\n          const [size, text] = Array.isArray(option)\n            ? option\n            : [option, option];\n          const sizeLabel = size === 0 ? t('all') : size;\n          return (\n            <option\n              aria-label={t('Show %s entries', sizeLabel)}\n              key={size}\n              value={size}\n            >\n              {text}\n            </option>\n          );\n        })}\n      </select>{' '}\n      {t('page_size.entries')}\n    </span>\n  );\n}\n\nconst getNoResultsMessage = (filter: string) =>\n  filter ? t('No matching records found') : t('No records found');\n\nexport default function TableChart<D extends DataRecord = DataRecord>(\n  props: TableChartTransformedProps<D> & {\n    sticky?: DataTableProps<D>['sticky'];\n  },\n) {\n  const {\n    timeGrain,\n    height,\n    width,\n    data,\n    totals,\n    isRawRecords,\n    rowCount = 0,\n    columns: columnsMeta,\n    alignPositiveNegative: defaultAlignPN = false,\n    colorPositiveNegative: defaultColorPN = false,\n    includeSearch = false,\n    pageSize = 0,\n    serverPagination = false,\n    serverPaginationData,\n    setDataMask,\n    showCellBars = true,\n    sortDesc = false,\n    filters,\n    sticky = true, // whether to use sticky header\n    columnColorFormatters,\n    allowRearrangeColumns = false,\n    allowRenderHtml = true,\n    onContextMenu,\n    emitCrossFilters,\n    isUsingTimeComparison,\n    basicColorFormatters,\n    basicColorColumnFormatters,\n  } = props;\n  const comparisonColumns = [\n    { key: 'all', label: t('Display all') },\n    { key: '#', label: '#' },\n    { key: '△', label: '△' },\n    { key: '%', label: '%' },\n  ];\n  const timestampFormatter = useCallback(\n    value => getTimeFormatterForGranularity(timeGrain)(value),\n    [timeGrain],\n  );\n  const [tableSize, setTableSize] = useState<TableSize>({\n    width: 0,\n    height: 0,\n  });\n  // keep track of whether column order changed, so that column widths can too\n  const [columnOrderToggle, setColumnOrderToggle] = useState(false);\n  const [showComparisonDropdown, setShowComparisonDropdown] = useState(false);\n  const [selectedComparisonColumns, setSelectedComparisonColumns] = useState([\n    comparisonColumns[0].key,\n  ]);\n  const [hideComparisonKeys, setHideComparisonKeys] = useState<string[]>([]);\n  const theme = useTheme();\n\n  // only take relevant page size options\n  const pageSizeOptions = useMemo(() => {\n    const getServerPagination = (n: number) => n <= rowCount;\n    return PAGE_SIZE_OPTIONS.filter(([n]) =>\n      serverPagination ? getServerPagination(n) : n <= 2 * data.length,\n    ) as SizeOption[];\n  }, [data.length, rowCount, serverPagination]);\n\n  const getValueRange = useCallback(\n    function getValueRange(key: string, alignPositiveNegative: boolean) {\n      if (typeof data?.[0]?.[key] === 'number') {\n        const nums = data.map(row => row[key]) as number[];\n        return (\n          alignPositiveNegative\n            ? [0, d3Max(nums.map(Math.abs))]\n            : d3Extent(nums)\n        ) as ValueRange;\n      }\n      return null;\n    },\n    [data],\n  );\n\n  const isActiveFilterValue = useCallback(\n    function isActiveFilterValue(key: string, val: DataRecordValue) {\n      return !!filters && filters[key]?.includes(val);\n    },\n    [filters],\n  );\n\n  const getCrossFilterDataMask = (key: string, value: DataRecordValue) => {\n    let updatedFilters = { ...(filters || {}) };\n    if (filters && isActiveFilterValue(key, value)) {\n      updatedFilters = {};\n    } else {\n      updatedFilters = {\n        [key]: [value],\n      };\n    }\n    if (\n      Array.isArray(updatedFilters[key]) &&\n      updatedFilters[key].length === 0\n    ) {\n      delete updatedFilters[key];\n    }\n\n    const groupBy = Object.keys(updatedFilters);\n    const groupByValues = Object.values(updatedFilters);\n    const labelElements: string[] = [];\n    groupBy.forEach(col => {\n      const isTimestamp = col === DTTM_ALIAS;\n      const filterValues = ensureIsArray(updatedFilters?.[col]);\n      if (filterValues.length) {\n        const valueLabels = filterValues.map(value =>\n          isTimestamp ? timestampFormatter(value) : value,\n        );\n        labelElements.push(`${valueLabels.join(', ')}`);\n      }\n    });\n\n    return {\n      dataMask: {\n        extraFormData: {\n          filters:\n            groupBy.length === 0\n              ? []\n              : groupBy.map(col => {\n                  const val = ensureIsArray(updatedFilters?.[col]);\n                  if (!val.length)\n                    return {\n                      col,\n                      op: 'IS NULL' as const,\n                    };\n                  return {\n                    col,\n                    op: 'IN' as const,\n                    val: val.map(el =>\n                      el instanceof Date ? el.getTime() : el!,\n                    ),\n                    grain: col === DTTM_ALIAS ? timeGrain : undefined,\n                  };\n                }),\n        },\n        filterState: {\n          label: labelElements.join(', '),\n          value: groupByValues.length ? groupByValues : null,\n          filters:\n            updatedFilters && Object.keys(updatedFilters).length\n              ? updatedFilters\n              : null,\n        },\n      },\n      isCurrentValueSelected: isActiveFilterValue(key, value),\n    };\n  };\n\n  const toggleFilter = useCallback(\n    function toggleFilter(key: string, val: DataRecordValue) {\n      if (!emitCrossFilters) {\n        return;\n      }\n      setDataMask(getCrossFilterDataMask(key, val).dataMask);\n    },\n    [emitCrossFilters, getCrossFilterDataMask, setDataMask],\n  );\n\n  const getSharedStyle = (column: DataColumnMeta): CSSProperties => {\n    const { isNumeric, config = {} } = column;\n    const textAlign =\n      config.horizontalAlign ||\n      (isNumeric && !isUsingTimeComparison ? 'right' : 'left');\n    return {\n      textAlign,\n    };\n  };\n\n  const comparisonLabels = [t('Main'), '#', '△', '%'];\n  const filteredColumnsMeta = useMemo(() => {\n    if (!isUsingTimeComparison) {\n      return columnsMeta;\n    }\n    const allColumns = comparisonColumns[0].key;\n    const main = comparisonLabels[0];\n    const showAllColumns = selectedComparisonColumns.includes(allColumns);\n\n    return columnsMeta.filter(({ label, key }) => {\n      // Extract the key portion after the space, assuming the format is always \"label key\"\n      const keyPortion = key.substring(label.length);\n      const isKeyHidded = hideComparisonKeys.includes(keyPortion);\n      const isLableMain = label === main;\n\n      return (\n        isLableMain ||\n        (!isKeyHidded &&\n          (!comparisonLabels.includes(label) ||\n            showAllColumns ||\n            selectedComparisonColumns.includes(label)))\n      );\n    });\n  }, [\n    columnsMeta,\n    comparisonColumns,\n    comparisonLabels,\n    isUsingTimeComparison,\n    hideComparisonKeys,\n    selectedComparisonColumns,\n  ]);\n\n  const handleContextMenu =\n    onContextMenu && !isRawRecords\n      ? (\n          value: D,\n          cellPoint: {\n            key: string;\n            value: DataRecordValue;\n            isMetric?: boolean;\n          },\n          clientX: number,\n          clientY: number,\n        ) => {\n          const drillToDetailFilters: BinaryQueryObjectFilterClause[] = [];\n          filteredColumnsMeta.forEach(col => {\n            if (!col.isMetric) {\n              const dataRecordValue = value[col.key];\n              drillToDetailFilters.push({\n                col: col.key,\n                op: '==',\n                val: dataRecordValue as string | number | boolean,\n                formattedVal: formatColumnValue(col, dataRecordValue)[1],\n              });\n            }\n          });\n          onContextMenu(clientX, clientY, {\n            drillToDetail: drillToDetailFilters,\n            crossFilter: cellPoint.isMetric\n              ? undefined\n              : getCrossFilterDataMask(cellPoint.key, cellPoint.value),\n            drillBy: cellPoint.isMetric\n              ? undefined\n              : {\n                  filters: [\n                    {\n                      col: cellPoint.key,\n                      op: '==',\n                      val: cellPoint.value as string | number | boolean,\n                    },\n                  ],\n                  groupbyFieldName: 'groupby',\n                },\n          });\n        }\n      : undefined;\n\n  const getHeaderColumns = (\n    columnsMeta: DataColumnMeta[],\n    enableTimeComparison?: boolean,\n  ) => {\n    const resultMap: Record<string, number[]> = {};\n\n    if (!enableTimeComparison) {\n      return resultMap;\n    }\n\n    columnsMeta.forEach((element, index) => {\n      // Check if element's label is one of the comparison labels\n      if (comparisonLabels.includes(element.label)) {\n        // Extract the key portion after the space, assuming the format is always \"label key\"\n        const keyPortion = element.key.substring(element.label.length);\n\n        // If the key portion is not in the map, initialize it with the current index\n        if (!resultMap[keyPortion]) {\n          resultMap[keyPortion] = [index];\n        } else {\n          // Add the index to the existing array\n          resultMap[keyPortion].push(index);\n        }\n      }\n    });\n\n    return resultMap;\n  };\n\n  const renderTimeComparisonDropdown = (): JSX.Element => {\n    const allKey = comparisonColumns[0].key;\n    const handleOnClick = (data: any) => {\n      const { key } = data;\n      // Toggle 'All' key selection\n      if (key === allKey) {\n        setSelectedComparisonColumns([allKey]);\n      } else if (selectedComparisonColumns.includes(allKey)) {\n        setSelectedComparisonColumns([key]);\n      } else {\n        // Toggle selection for other keys\n        setSelectedComparisonColumns(\n          selectedComparisonColumns.includes(key)\n            ? selectedComparisonColumns.filter(k => k !== key) // Deselect if already selected\n            : [...selectedComparisonColumns, key],\n        ); // Select if not already selected\n      }\n    };\n\n    const handleOnBlur = () => {\n      if (selectedComparisonColumns.length === 3) {\n        setSelectedComparisonColumns([comparisonColumns[0].key]);\n      }\n    };\n\n    return (\n      <Dropdown\n        placement=\"bottomRight\"\n        visible={showComparisonDropdown}\n        onVisibleChange={(flag: boolean) => {\n          setShowComparisonDropdown(flag);\n        }}\n        overlay={\n          <Menu\n            multiple\n            onClick={handleOnClick}\n            onBlur={handleOnBlur}\n            selectedKeys={selectedComparisonColumns}\n          >\n            <div\n              css={css`\n                max-width: 242px;\n                padding: 0 ${theme.gridUnit * 2}px;\n                color: ${theme.colors.grayscale.base};\n                font-size: ${theme.typography.sizes.s}px;\n              `}\n            >\n              {t(\n                'Select columns that will be displayed in the table. You can multiselect columns.',\n              )}\n            </div>\n            {comparisonColumns.map(column => (\n              <Menu.Item key={column.key}>\n                <span\n                  css={css`\n                    color: ${theme.colors.grayscale.dark2};\n                  `}\n                >\n                  {column.label}\n                </span>\n                <span\n                  css={css`\n                    float: right;\n                    font-size: ${theme.typography.sizes.s}px;\n                  `}\n                >\n                  {selectedComparisonColumns.includes(column.key) && (\n                    <CheckOutlined />\n                  )}\n                </span>\n              </Menu.Item>\n            ))}\n          </Menu>\n        }\n        trigger={['click']}\n      >\n        <span>\n          <TableOutlined /> <DownOutlined />\n        </span>\n      </Dropdown>\n    );\n  };\n\n  const renderGroupingHeaders = (): JSX.Element => {\n    // TODO: Make use of ColumnGroup to render the aditional headers\n    const headers: any = [];\n    let currentColumnIndex = 0;\n\n    Object.entries(groupHeaderColumns || {}).forEach(([key, value]) => {\n      // Calculate the number of placeholder columns needed before the current header\n      const startPosition = value[0];\n      const colSpan = value.length;\n\n      // Add placeholder <th> for columns before this header\n      for (let i = currentColumnIndex; i < startPosition; i += 1) {\n        headers.push(\n          <th\n            key={`placeholder-${i}`}\n            style={{ borderBottom: 0 }}\n            aria-label={`Header-${i}`}\n          />,\n        );\n      }\n\n      // Add the current header <th>\n      headers.push(\n        <th key={`header-${key}`} colSpan={colSpan} style={{ borderBottom: 0 }}>\n          {key}\n          <span\n            css={css`\n              float: right;\n              & svg {\n                color: ${theme.colors.grayscale.base} !important;\n              }\n            `}\n          >\n            {hideComparisonKeys.includes(key) ? (\n              <PlusCircleOutlined\n                onClick={() =>\n                  setHideComparisonKeys(\n                    hideComparisonKeys.filter(k => k !== key),\n                  )\n                }\n              />\n            ) : (\n              <MinusCircleOutlined\n                onClick={() =>\n                  setHideComparisonKeys([...hideComparisonKeys, key])\n                }\n              />\n            )}\n          </span>\n        </th>,\n      );\n\n      // Update the current column index\n      currentColumnIndex = startPosition + colSpan;\n    });\n\n    return (\n      <tr\n        css={css`\n          th {\n            border-right: 2px solid ${theme.colors.grayscale.light2};\n          }\n          th:first-child {\n            border-left: none;\n          }\n          th:last-child {\n            border-right: none;\n          }\n        `}\n      >\n        {headers}\n      </tr>\n    );\n  };\n\n  const groupHeaderColumns = useMemo(\n    () => getHeaderColumns(filteredColumnsMeta, isUsingTimeComparison),\n    [filteredColumnsMeta, isUsingTimeComparison],\n  );\n\n  const getColumnConfigs = useCallback(\n    (column: DataColumnMeta, i: number): ColumnWithLooseAccessor<D> => {\n      const {\n        key,\n        label,\n        isNumeric,\n        dataType,\n        isMetric,\n        isPercentMetric,\n        config = {},\n      } = column;\n      const columnWidth = Number.isNaN(Number(config.columnWidth))\n        ? config.columnWidth\n        : Number(config.columnWidth);\n\n      // inline style for both th and td cell\n      const sharedStyle: CSSProperties = getSharedStyle(column);\n\n      const alignPositiveNegative =\n        config.alignPositiveNegative === undefined\n          ? defaultAlignPN\n          : config.alignPositiveNegative;\n      const colorPositiveNegative =\n        config.colorPositiveNegative === undefined\n          ? defaultColorPN\n          : config.colorPositiveNegative;\n\n      const { truncateLongCells } = config;\n\n      const hasColumnColorFormatters =\n        isNumeric &&\n        Array.isArray(columnColorFormatters) &&\n        columnColorFormatters.length > 0;\n\n      const hasBasicColorFormatters =\n        isUsingTimeComparison &&\n        Array.isArray(basicColorFormatters) &&\n        basicColorFormatters.length > 0;\n\n      const valueRange =\n        !hasBasicColorFormatters &&\n        !hasColumnColorFormatters &&\n        (config.showCellBars === undefined\n          ? showCellBars\n          : config.showCellBars) &&\n        (isMetric || isRawRecords || isPercentMetric) &&\n        getValueRange(key, alignPositiveNegative);\n\n      let className = '';\n      if (emitCrossFilters && !isMetric) {\n        className += ' dt-is-filter';\n      }\n\n      if (!isMetric && !isPercentMetric) {\n        className += ' right-border-only';\n      } else if (comparisonLabels.includes(label)) {\n        const groupinHeader = key.substring(label.length);\n        const columnsUnderHeader = groupHeaderColumns[groupinHeader] || [];\n        if (i === columnsUnderHeader[columnsUnderHeader.length - 1]) {\n          className += ' right-border-only';\n        }\n      }\n\n      return {\n        id: String(i), // to allow duplicate column keys\n        // must use custom accessor to allow `.` in column names\n        // typing is incorrect in current version of `@types/react-table`\n        // so we ask TS not to check.\n        accessor: ((datum: D) => datum[key]) as never,\n        Cell: ({ value, row }: { value: DataRecordValue; row: Row<D> }) => {\n          const [isHtml, text] = formatColumnValue(column, value);\n          const html = isHtml && allowRenderHtml ? { __html: text } : undefined;\n\n          let backgroundColor;\n          let arrow = '';\n          const originKey = column.key.substring(column.label.length).trim();\n          if (!hasColumnColorFormatters && hasBasicColorFormatters) {\n            backgroundColor =\n              basicColorFormatters[row.index][originKey]?.backgroundColor;\n            arrow =\n              column.label === comparisonLabels[0]\n                ? basicColorFormatters[row.index][originKey]?.mainArrow\n                : '';\n          }\n\n          if (hasColumnColorFormatters) {\n            columnColorFormatters!\n              .filter(formatter => formatter.column === column.key)\n              .forEach(formatter => {\n                const formatterResult =\n                  value || value === 0\n                    ? formatter.getColorFromValue(value as number)\n                    : false;\n                if (formatterResult) {\n                  backgroundColor = formatterResult;\n                }\n              });\n          }\n\n          if (\n            basicColorColumnFormatters &&\n            basicColorColumnFormatters?.length > 0\n          ) {\n            backgroundColor =\n              basicColorColumnFormatters[row.index][column.key]\n                ?.backgroundColor || backgroundColor;\n            arrow =\n              column.label === comparisonLabels[0]\n                ? basicColorColumnFormatters[row.index][column.key]?.mainArrow\n                : '';\n          }\n\n          const StyledCell = styled.td`\n            text-align: ${sharedStyle.textAlign};\n            white-space: ${value instanceof Date ? 'nowrap' : undefined};\n            position: relative;\n            background: ${backgroundColor || undefined};\n          `;\n\n          const cellBarStyles = css`\n            position: absolute;\n            height: 100%;\n            display: block;\n            top: 0;\n            ${valueRange &&\n            `\n                width: ${`${cellWidth({\n                  value: value as number,\n                  valueRange,\n                  alignPositiveNegative,\n                })}%`};\n                left: ${`${cellOffset({\n                  value: value as number,\n                  valueRange,\n                  alignPositiveNegative,\n                })}%`};\n                background-color: ${cellBackground({\n                  value: value as number,\n                  colorPositiveNegative,\n                })};\n              `}\n          `;\n\n          let arrowStyles = css`\n            color: ${basicColorFormatters &&\n            basicColorFormatters[row.index][originKey]?.arrowColor ===\n              ColorSchemeEnum.Green\n              ? theme.colors.success.base\n              : theme.colors.error.base};\n            margin-right: ${theme.gridUnit}px;\n          `;\n\n          if (\n            basicColorColumnFormatters &&\n            basicColorColumnFormatters?.length > 0\n          ) {\n            arrowStyles = css`\n              color: ${basicColorColumnFormatters[row.index][column.key]\n                ?.arrowColor === ColorSchemeEnum.Green\n                ? theme.colors.success.base\n                : theme.colors.error.base};\n              margin-right: ${theme.gridUnit}px;\n            `;\n          }\n\n          const cellProps = {\n            'aria-labelledby': `header-${column.key}`,\n            role: 'cell',\n            // show raw number in title in case of numeric values\n            title: typeof value === 'number' ? String(value) : undefined,\n            onClick:\n              emitCrossFilters && !valueRange && !isMetric\n                ? () => {\n                    // allow selecting text in a cell\n                    if (!getSelectedText()) {\n                      toggleFilter(key, value);\n                    }\n                  }\n                : undefined,\n            onContextMenu: (e: MouseEvent) => {\n              if (handleContextMenu) {\n                e.preventDefault();\n                e.stopPropagation();\n                handleContextMenu(\n                  row.original,\n                  { key, value, isMetric },\n                  e.nativeEvent.clientX,\n                  e.nativeEvent.clientY,\n                );\n              }\n            },\n            className: [\n              className,\n              value == null ? 'dt-is-null' : '',\n              isActiveFilterValue(key, value) ? ' dt-is-active-filter' : '',\n            ].join(' '),\n            tabIndex: 0,\n          };\n          if (html) {\n            if (truncateLongCells) {\n              // eslint-disable-next-line react/no-danger\n              return (\n                <StyledCell {...cellProps}>\n                  <div\n                    className=\"dt-truncate-cell\"\n                    style={columnWidth ? { width: columnWidth } : undefined}\n                    dangerouslySetInnerHTML={html}\n                  />\n                </StyledCell>\n              );\n            }\n            // eslint-disable-next-line react/no-danger\n            return <StyledCell {...cellProps} dangerouslySetInnerHTML={html} />;\n          }\n          // If cellProps renders textContent already, then we don't have to\n          // render `Cell`. This saves some time for large tables.\n          return (\n            <StyledCell {...cellProps}>\n              {valueRange && (\n                <div\n                  /* The following classes are added to support custom CSS styling */\n                  className={cx(\n                    'cell-bar',\n                    isNumber(value) && value < 0 ? 'negative' : 'positive',\n                  )}\n                  css={cellBarStyles}\n                  role=\"presentation\"\n                />\n              )}\n              {truncateLongCells ? (\n                <div\n                  className=\"dt-truncate-cell\"\n                  style={columnWidth ? { width: columnWidth } : undefined}\n                >\n                  {arrow && <span css={arrowStyles}>{arrow}</span>}\n                  {text}\n                </div>\n              ) : (\n                <>\n                  {arrow && <span css={arrowStyles}>{arrow}</span>}\n                  {text}\n                </>\n              )}\n            </StyledCell>\n          );\n        },\n        Header: ({ column: col, onClick, style, onDragStart, onDrop }) => (\n          <th\n            id={`header-${column.key}`}\n            title={t('Shift + Click to sort by multiple columns')}\n            className={[className, col.isSorted ? 'is-sorted' : ''].join(' ')}\n            style={{\n              ...sharedStyle,\n              ...style,\n            }}\n            onKeyDown={(e: ReactKeyboardEvent<HTMLElement>) => {\n              // programatically sort column on keypress\n              if (Object.values(ACTION_KEYS).includes(e.key)) {\n                col.toggleSortBy();\n              }\n            }}\n            role=\"columnheader button\"\n            onClick={onClick}\n            data-column-name={col.id}\n            {...(allowRearrangeColumns && {\n              draggable: 'true',\n              onDragStart,\n              onDragOver: e => e.preventDefault(),\n              onDragEnter: e => e.preventDefault(),\n              onDrop,\n            })}\n            tabIndex={0}\n          >\n            {/* can't use `columnWidth &&` because it may also be zero */}\n            {config.columnWidth ? (\n              // column width hint\n              <div\n                style={{\n                  width: columnWidth,\n                  height: 0.01,\n                }}\n              />\n            ) : null}\n            <div\n              data-column-name={col.id}\n              css={{\n                display: 'inline-flex',\n                alignItems: 'flex-end',\n              }}\n            >\n              <span data-column-name={col.id}>{label}</span>\n              <SortIcon column={col} />\n            </div>\n          </th>\n        ),\n        Footer: totals ? (\n          i === 0 ? (\n            <th>\n              <div\n                css={css`\n                  display: flex;\n                  align-items: center;\n                  & svg {\n                    margin-left: ${theme.gridUnit}px;\n                    color: ${theme.colors.grayscale.dark1} !important;\n                  }\n                `}\n              >\n                {t('Summary')}\n                <Tooltip\n                  overlay={t(\n                    'Show total aggregations of selected metrics. Note that row limit does not apply to the result.',\n                  )}\n                >\n                  <InfoCircleOutlined />\n                </Tooltip>\n              </div>\n            </th>\n          ) : (\n            <td style={sharedStyle}>\n              <strong>{formatColumnValue(column, totals[key])[1]}</strong>\n            </td>\n          )\n        ) : undefined,\n        sortDescFirst: sortDesc,\n        sortType: getSortTypeByDataType(dataType),\n      };\n    },\n    [\n      defaultAlignPN,\n      defaultColorPN,\n      emitCrossFilters,\n      getValueRange,\n      isActiveFilterValue,\n      isRawRecords,\n      showCellBars,\n      sortDesc,\n      toggleFilter,\n      totals,\n      columnColorFormatters,\n      columnOrderToggle,\n    ],\n  );\n\n  const columns = useMemo(\n    () => filteredColumnsMeta.map(getColumnConfigs),\n    [filteredColumnsMeta, getColumnConfigs],\n  );\n\n  const handleServerPaginationChange = useCallback(\n    (pageNumber: number, pageSize: number) => {\n      updateExternalFormData(setDataMask, pageNumber, pageSize);\n    },\n    [setDataMask],\n  );\n\n  const handleSizeChange = useCallback(\n    ({ width, height }: { width: number; height: number }) => {\n      setTableSize({ width, height });\n    },\n    [],\n  );\n\n  useLayoutEffect(() => {\n    // After initial load the table should resize only when the new sizes\n    // Are not only scrollbar updates, otherwise, the table would twicth\n    const scrollBarSize = getScrollBarSize();\n    const { width: tableWidth, height: tableHeight } = tableSize;\n    // Table is increasing its original size\n    if (\n      width - tableWidth > scrollBarSize ||\n      height - tableHeight > scrollBarSize\n    ) {\n      handleSizeChange({\n        width: width - scrollBarSize,\n        height: height - scrollBarSize,\n      });\n    } else if (\n      tableWidth - width > scrollBarSize ||\n      tableHeight - height > scrollBarSize\n    ) {\n      // Table is decreasing its original size\n      handleSizeChange({\n        width,\n        height,\n      });\n    }\n  }, [width, height, handleSizeChange, tableSize]);\n\n  const { width: widthFromState, height: heightFromState } = tableSize;\n\n  return (\n    <Styles>\n      <DataTable<D>\n        columns={columns}\n        data={data}\n        rowCount={rowCount}\n        tableClassName=\"table table-striped table-condensed\"\n        pageSize={pageSize}\n        serverPaginationData={serverPaginationData}\n        pageSizeOptions={pageSizeOptions}\n        width={widthFromState}\n        height={heightFromState}\n        serverPagination={serverPagination}\n        onServerPaginationChange={handleServerPaginationChange}\n        onColumnOrderChange={() => setColumnOrderToggle(!columnOrderToggle)}\n        // 9 page items in > 340px works well even for 100+ pages\n        maxPageItemCount={width > 340 ? 9 : 7}\n        noResults={getNoResultsMessage}\n        searchInput={includeSearch && SearchInput}\n        selectPageSize={pageSize !== null && SelectPageSize}\n        // not in use in Superset, but needed for unit tests\n        sticky={sticky}\n        renderGroupingHeaders={\n          !isEmpty(groupHeaderColumns) ? renderGroupingHeaders : undefined\n        }\n        renderTimeComparisonDropdown={\n          isUsingTimeComparison ? renderTimeComparisonDropdown : undefined\n        }\n      />\n    </Styles>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}